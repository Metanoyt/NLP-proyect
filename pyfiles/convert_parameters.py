collections abc Iterable typing Optional torch parameters_to_vector parameters Iterable torch Tensor - torch Tensor r Flatten iterable parameters into single vector Args parameters Iterable Tensor iterable Tensors parameters model Returns The parameters represented single vector Flag device where parameter located param_device = None vec = param parameters Ensure parameters located same device param_device = _check_param_device param param_device vec append param view - torch cat vec vector_to_parameters vec torch Tensor parameters Iterable torch Tensor - None r Copy slices vector into iterable parameters Args vec Tensor single vector representing parameters model parameters Iterable Tensor iterable Tensors parameters model Ensure vec type Tensor isinstance vec torch Tensor raise TypeError f expected torch Tensor got torch typename vec Flag device where parameter located param_device = None Pointer slicing vector each parameter pointer = param parameters Ensure parameters located same device param_device = _check_param_device param param_device The length parameter num_param = param numel Slice vector reshape replace old data parameter param data = vec pointer pointer + num_param view_as param data Increment pointer pointer += num_param _check_param_device param torch Tensor old_param_device Optional int - int r Check parameters located same device Currently conversion between model parameters single vector form supported multiple allocations e g parameters different GPUs PrivateUse s mixture CPU GPU PrivateUse Args param Tensor Tensor parameter model old_param_device int device where first parameter model allocated Returns old_param_device int report device first time Meet first parameter support_device_types = cuda torch _C _get_privateuse _backend_name old_param_device None old_param_device = param get_device param device type support_device_types - warn = False param device type support_device_types Check same GPU PrivateUse warn = param get_device = old_param_device Check CPU warn = old_param_device = - warn raise TypeError Found two parameters different devices currently supported old_param_device