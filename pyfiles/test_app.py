tests test_cli py io sys unittest contextlib redirect_stderr redirect_stdout unittest mock patch cli run main TestArgparseCLI unittest TestCase patch cli build_cli register_build VllmBuildRunner run return_value=None patch cli build_cli register_build VllmBuildRunner __init__ return_value=None test_cli_run_build_external mock_init mock_run cli run main after patches needed test_args = cli run build external vllm patch object sys argv test_args argparse may call sys exit error capture avoid test aborts try main except SystemExit pass mock_init assert_called_once got constructed mock_run assert_called_once_with run called test_build_help test_args = cli run build -- help patch object sys argv test_args stdout = io StringIO stderr = io StringIO -- help always raises SystemExit assertRaises SystemExit cm redirect_stdout stdout redirect_stderr stderr main assertEqual cm exception code output = stdout getvalue assertIn usage output assertIn external output __name__ == __main__ unittest main