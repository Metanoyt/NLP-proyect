Owner s oncall distributed torch torch distributed distributed_c d _get_default_group torch distributed fsdp _shard_utils _create_chunk_dtensor _create_chunk_sharded_tensor torch testing _internal common_fsdp FSDPTest torch testing _internal common_utils run_tests torch testing _internal distributed _tensor common_dtensor DTensorTestBase skip_if_lt_x_gpu with_comms device_type = acc type acc = torch accelerator current_accelerator cpu TestShardUtilsDistributed FSDPTest property world_size _create_tensor size Keep everything deterministic torch manual_seed torch rand size device=device_type skip_if_lt_x_gpu test_create_chunk_sharded_tensor size tensor = _create_tensor size sharded_tensor = _create_chunk_sharded_tensor tensor rank world_size torch accelerator device_count _get_default_group output = torch empty size device=device_type rank == None sharded_tensor gather output rank == assertEqual tensor output TestShardUtilsDistributedDTensor DTensorTestBase property world_size _create_tensor size Keep everything deterministic torch manual_seed torch rand size device=device_type with_comms skip_if_lt_x_gpu test_create_chunk_dtensor device_mesh = build_device_mesh size tensor = _create_tensor size tensor_chunks = torch chunk tensor world_size dim= dtensor = _create_chunk_dtensor tensor rank device_mesh local_tensor = dtensor to_local local_tensor numel = assertEqual local_tensor tensor_chunks rank assertEqual rank = len tensor_chunks True __name__ == __main__ run_tests