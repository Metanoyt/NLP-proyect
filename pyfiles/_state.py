mypy allow-untyped-defs JIT-related state This module stores various pieces Python-global state relating JIT This intended imported directly please exposed functionalities ` torch jit ` os weakref typing Any torch EnabledProxy Stores whether JIT enabled This just wrapper bool so we get reference semantics __init__ - None enabled = parse_env PYTORCH_JIT True Using PyTorch JIT PyTorch JIT DISABLED parse_env name default true_message false_message value = os environ get name value None default value lower true yes True value lower false no False value == v print true_message True value == v print false_message False raise ValueError f Unknown setting name Try using __bool__ enabled _enabled = EnabledProxy disable _enabled enabled = False enable _enabled enabled = True The Python CompilationUnit All functions modules defined Python will live here It s defined Python because doing cpp creates static destruction order issues _python_cu = torch _C CompilationUnit python = ScriptClass mapping _script_classes dict type Any type Any = _name_to_pyclass dict str type Any = _add_script_class python_class script_class _script_classes python_class = script_class _name_to_pyclass script_class qualified_name = python_class _get_script_class python_class override = getattr python_class _jit_override_qualname None override None python_class = _get_python_class override _script_classes get python_class _get_python_class qualified_name _name_to_pyclass get qualified_name _clear_class_state _script_classes clear _name_to_pyclass clear Caching we currently cache compilation free functions overloaded functions To cache free functions we hold weak ref function object map compiled fn s qualified name To cache overloaded functions we hold weak ref function obj map all its overloaded compiled fns In future we could consider caching more types objects so aliasing preserved across separate compilations same object _jit_caching_layer weakref WeakKeyDictionary = weakref WeakKeyDictionary _jit_function_overload_caching weakref WeakKeyDictionary = weakref WeakKeyDictionary _try_get_jit_cached_overloads key qual_names = _jit_function_overload_caching get key None qual_names _python_cu find_function qual_name qual_name qual_names None _set_jit_overload_cache key compiled_fns _jit_function_overload_caching key = fn qualified_name fn compiled_fns _try_get_jit_cached_function key getattr key __disable_jit_function_caching__ False True None qual_name = _jit_caching_layer get key None qual_name _python_cu find_function qual_name None _set_jit_function_cache key value only free functions currently supported assert isinstance value torch jit ScriptFunction _jit_caching_layer key = value qualified_name