Owner s oncall cpu inductor sys unittest typing NamedTuple torch torch _inductor config torch _inductor test_case TestCase InductorTestCase torch testing _internal common_device_type get_desired_device_type_test_bases torch testing _internal common_utils IS_MACOS IS_WINDOWS slowTest TEST_MKL TEST_WITH_ROCM torch testing _internal inductor_utils HAS_CPU try try test_cpu_repro test_cpu_select_algorithm test_mkldnn_pattern_matcher test_torchinductor test_torchinductor_dynamic_shapes except ImportError test_cpu_repro manual=fbcode caffe test inductor test_cpu_repro-library test_cpu_select_algorithm manual=fbcode caffe test inductor cpu_select_algorithm_cpu-library test_mkldnn_pattern_matcher manual test_torchinductor manual=fbcode caffe test inductor test_inductor-library test_torchinductor_dynamic_shapes manual=fbcode caffe test inductor test_inductor-library_dynamic_shapes except unittest SkipTest __name__ == __main__ sys exit raise _desired_test_bases = get_desired_device_type_test_bases RUN_CPU = HAS_CPU any getattr x device_type == cpu x _desired_test_bases IS_MACOS CppWrapperTemplate pass TestCppWrapper InductorTestCase device = cpu DynamicShapesCppWrapperCpuTests InductorTestCase device = cpu test_failures_cpp_wrapper = conv d will fallback dynamic shapes fallback path yet supported test_conv d_unary_cpu_dynamic_shapes test_torchinductor TestFailure cpp_wrapper is_skip=True test_conv d_binary_inplace_fusion_failed_cpu_dynamic_shapes test_torchinductor TestFailure cpp_wrapper is_skip=True test_conv d_binary_inplace_fusion_pass_cpu_dynamic_shapes test_torchinductor TestFailure cpp_wrapper is_skip=True aten _native_multi_head_attention default yet supported dynamic shapes test_multihead_attention_cpu_dynamic_shapes test_torchinductor TestFailure cpp_wrapper is_skip=True TEST_WITH_ROCM test_failures_cpp_wrapper update test_linear_packed test_torchinductor TestFailure cpp_wrapper is_skip=True test_linear_packed_dynamic_shapes test_torchinductor TestFailure cpp_wrapper is_skip=True make_test_case name device tests condition=True slow=False func_inputs=None code_string_count=None test_build_separate=False test_name = f name _ device device name code_string_count None code_string_count = func = getattr tests test_name assert callable func callable func = slowTest func slow func new_test_name = f test_name _separate test_build_separate test_name config patch cpp_wrapper=True cpp_wrapper_build_separate=test_build_separate fn tests setUpClass tests setUp try torch _C _PreserveDispatchKeyGuard torch _C _dispatch_tls_set_dispatch_key_included torch _C DispatchKey Dense True _ code = test_torchinductor run_and_get_cpp_code func func_inputs func_inputs If test generates no code skip remaining checks This can happen tests validating build-dependent features e g datatypes available some platforms others code test_build_separate assertIn kernel_src code assertIn CppWrapperCodeCache code assertTrue all code count string == code_string_count string string code_string_count finally tests tearDown tests tearDownClass fn __name__ = new_test_name copy fn __dict__ = copy deepcopy func __dict__ condition setattr CppWrapperTemplate new_test_name fn RUN_CPU BaseTest NamedTuple name str device str = cpu tests InductorTestCase = test_torchinductor CpuTests condition bool = True slow bool = False func_inputs list = None code_string_count dict = test_build_separate bool = False item BaseTest test_add_complex BaseTest test_add_complex test_build_separate=True BaseTest test_add_complex BaseTest test_add_complex test_build_separate=True BaseTest test_as_strided buffer reuse BaseTest test_bernoulli BaseTest test_bitwise int BaseTest test_bmm BaseTest test_bmm test_build_separate=True BaseTest test_bmm BaseTest test_cat alias BaseTest test_conv d_binary_inplace_fusion_failed cpu test_mkldnn_pattern_matcher TestPatternMatcher condition=torch backends mkldnn is_available func_inputs= aoti_torch_cpu_mkldnn__convolution_pointwise_binary aoti_torch_cpu_mkldnn__convolution_pointwise_binary_ BaseTest test_conv d_binary_inplace_fusion_pass cpu test_mkldnn_pattern_matcher TestPatternMatcher condition=torch backends mkldnn is_available func_inputs= aoti_torch_cpu_mkldnn__convolution_pointwise_binary_ aoti_torch_cpu_mkldnn__convolution_pointwise_binary BaseTest test_conv d_unary cpu test_mkldnn_pattern_matcher TestPatternMatcherGenericCPU condition=torch backends mkldnn is_available slow=True BaseTest test_conv_transpose d_packed cpu test_cpu_repro CPUReproTests BaseTest test_cumsum BaseTest test_custom_op_ BaseTest test_custom_op_ BaseTest test_custom_op_ BaseTest test_dtype_sympy_expr BaseTest test_embedding_bag test default FallbackKernel BaseTest test_index_put BaseTest test_index_put_deterministic_fallback BaseTest test_adding_tensor_offsets BaseTest test_inductor_layout_optimization_input_mutations BaseTest test_int_div test_cpu_repro CPUReproTests BaseTest test_int _weight_only_quant BaseTest test_linear BaseTest test_linear BaseTest func test_cpu_select_algorithm TestSelectAlgorithmCPU func dir test_cpu_select_algorithm TestSelectAlgorithmCPU func startswith test_linear_with_pointwise test_grouped_linear BaseTest test_polar BaseTest test_linear_binary test_mkldnn_pattern_matcher TestPatternMatcher torch backends mkldnn is_available torch ops mkldnn _is_mkldnn_bf _supported BaseTest test_linear_packed test_cpu_repro CPUReproTests torch backends mkldnn is_available torch ops mkldnn _is_mkldnn_bf _supported torch ops mkldnn _is_mkldnn_fp _supported BaseTest func test_cpu_repro CPUReproTests condition=torch backends mkldnn is_available IS_WINDOWS func dir test_cpu_repro CPUReproTests func startswith test_lstm_packed_change_input_sizes BaseTest test_max_pool d _dilation_ BaseTest test_max_pool d _dilation_ BaseTest test_mkl_linear test_cpu_repro CPUReproTests condition=TEST_MKL BaseTest test_mm_views BaseTest test_multihead_attention cpu test_cpu_repro CPUReproTests BaseTest test_multi_threading condition=not IS_WINDOWS Two threads compile so we expect output code printed twice code_string_count= py gil_scoped_release_simple release BaseTest test_profiler_mark_wrapper_call BaseTest test_qconv d cpu test_mkldnn_pattern_matcher TestPatternMatcher condition=torch backends mkldnn is_available IS_WINDOWS BaseTest test_qconv d_relu cpu test_mkldnn_pattern_matcher TestPatternMatcher condition=torch backends mkldnn is_available IS_WINDOWS BaseTest test_qconv d_add cpu test_mkldnn_pattern_matcher TestPatternMatcher condition=torch backends mkldnn is_available IS_WINDOWS BaseTest test_qconv d_add_relu cpu test_mkldnn_pattern_matcher TestPatternMatcher condition=torch backends mkldnn is_available IS_WINDOWS BaseTest test_qconv d_dequant_promotion cpu test_mkldnn_pattern_matcher TestPatternMatcher condition=torch backends mkldnn is_available IS_WINDOWS BaseTest test_qconv d_maxpool d_linear_dynamic cpu test_mkldnn_pattern_matcher TestDynamicPatternMatcher condition=torch backends mkldnn is_available IS_WINDOWS func_inputs= aoti_torch_cpu__qconv_pointwise_tensor torch ops quantized max_pool d aoti_torch_cpu__qlinear_pointwise_tensor BaseTest func test_mkldnn_pattern_matcher TestPatternMatcher condition=torch backends mkldnn is_available IS_WINDOWS func dir test_mkldnn_pattern_matcher TestPatternMatcher func startswith test_qlinear BaseTest test_qconv d_with_concat cpu test_mkldnn_pattern_matcher TestPatternMatcher condition=torch backends mkldnn is_available IS_WINDOWS BaseTest test_dynamic_qlinear cpu test_mkldnn_pattern_matcher TestPatternMatcher condition=torch backends mkldnn is_available IS_WINDOWS BaseTest test_dynamic_qlinear_qat cpu test_mkldnn_pattern_matcher TestPatternMatcher condition=torch backends mkldnn is_available IS_WINDOWS BaseTest test_randint BaseTest test_randn_with_dtype_and_device BaseTest test_reduction Reduction BaseTest test_relu multiple inputs BaseTest test_repeat_interleave test_cpu_repro CPUReproTests BaseTest test_scalar_input BaseTest test_scalar_output BaseTest test_scaled_dot_product_attention BaseTest test_scatter BaseTest test_scatter BaseTest test_scatter BaseTest test_scatter BaseTest test_scatter BaseTest test_scatter BaseTest test_scatter_reduce BaseTest test_scatter_reduce BaseTest test_scatter_reduce BaseTest test_silu single input single output BaseTest test_sort BaseTest test_sum_dtype float BaseTest test_sum_int bool int int uint BaseTest test_tensor constant input BaseTest test_transpose code_string_count= reset multiple outputs buffer clear BaseTest test_view_as_complex BaseTest test_view_as_real BaseTest test_woq_int cpu test_mkldnn_pattern_matcher TestPatternMatcher make_test_case item name item device item tests item condition item slow item func_inputs item code_string_count item test_build_separate test_torchinductor copy_tests CppWrapperTemplate TestCppWrapper cpp_wrapper test_failures_cpp_wrapper DynamicShapesCppWrapperTemplate = test_torchinductor_dynamic_shapes make_dynamic_cls CppWrapperTemplate test_torchinductor copy_tests DynamicShapesCppWrapperTemplate DynamicShapesCppWrapperCpuTests cpp_wrapper test_failures_cpp_wrapper xfail_prop= _expected_failure_dynamic_wrapper __name__ == __main__ torch _inductor test_case run_tests RUN_CPU run_tests needs= filelock