__future__ annotations contextlib functools typing Any Optional TYPE_CHECKING TypeVar Union torchgen local local torchgen model BackendIndex DispatchKey NativeFunction NativeFunctionsGroup NativeFunctionsViewGroup torchgen utils context S T TYPE_CHECKING collections abc Callable Iterator Helper functions defining generators things model F = TypeVar F NativeFunction NativeFunctionsGroup NativeFunctionsViewGroup Union NativeFunction NativeFunctionsGroup Union NativeFunction NativeFunctionsViewGroup F = TypeVar F NativeFunction NativeFunctionsGroup Optional NativeFunction bool str F = TypeVar F tuple NativeFunction Any list NativeFunction contextlib contextmanager native_function_manager g NativeFunctionsGroup &#124; NativeFunctionsViewGroup &#124; NativeFunction - Iterator None isinstance g NativeFunctionsGroup By default we associate all errors structured native functions out variant In some cases might better have more specific place hang things so use native_function_manager again inside f = g out isinstance g NativeFunctionsViewGroup We associate errors view operator f = g view f = g context lambda f native_functions yaml line f loc \n f func local parametrize use_const_ref_for_mutable_tensors=f use_const_ref_for_mutable_tensors use_ilistref_for_tensor_lists=f part_of_structured_group yield Given function operates NativeFunction wrap into new function sets some appropriate context managers native function YOU MUST WRAP FUNCTIONS IN THIS calls api modules sound you will get error we try access local variables without having set them with_native_function func Callable F T - Callable F T functools wraps func wrapper f F - T native_function_manager f func f wrapper with_native_function_and func Callable F F T - Callable F F T functools wraps func wrapper f F f F - T The first native_function assumed one appropriate context native_function_manager f func f f wrapper method_with_native_function func Callable S F T - Callable S F T functools wraps func wrapper slf S f F - T native_function_manager f func slf f wrapper method_with_nested_native_function func Callable S F T - Callable S F T functools wraps func wrapper slf S f F - T native_function_manager f func slf f wrapper Convenience decorator functions explicitly take BackendIndex instead indirectly taking one closure with_native_function_and_index func Callable F BackendIndex T - Callable F BackendIndex T functools wraps func wrapper f F backend_index BackendIndex - T native_function_manager f func f backend_index wrapper Convenience decorator functions explicitly take Dict BackendIndices with_native_function_and_indices func Callable F dict DispatchKey BackendIndex T - Callable F dict DispatchKey BackendIndex T functools wraps func wrapper f F backend_indices dict DispatchKey BackendIndex - T native_function_manager f func f backend_indices wrapper