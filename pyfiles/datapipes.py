mypy allow-untyped-defs random typing Any torch utils data datapipes _decorator functional_datapipe torch utils data datapipes dataframe dataframe_wrapper df_wrapper torch utils data datapipes datapipe DFIterDataPipe IterDataPipe __all__ = ConcatDataFramesPipe DataFramesAsTuplesPipe ExampleAggregateAsDataFrames FilterDataFramesPipe PerRowDataFramesPipe ShuffleDataFramesPipe functional_datapipe _dataframes_as_tuples DataFramesAsTuplesPipe IterDataPipe __init__ source_datapipe source_datapipe = source_datapipe __iter__ df source_datapipe record df to_records index=False yield df_wrapper iterate df functional_datapipe _dataframes_per_row enable_df_api_tracing=True PerRowDataFramesPipe DFIterDataPipe __init__ source_datapipe source_datapipe = source_datapipe __iter__ df source_datapipe TODO VitalyFedyunin Replacing TorchArrow only API we dropping pandas followup i range len df yield df i i + functional_datapipe _dataframes_concat enable_df_api_tracing=True ConcatDataFramesPipe DFIterDataPipe __init__ source_datapipe batch= source_datapipe = source_datapipe n_batch = batch __iter__ buffer = df source_datapipe buffer append df len buffer == n_batch yield df_wrapper concat buffer buffer = buffer yield df_wrapper concat buffer functional_datapipe _dataframes_shuffle enable_df_api_tracing=True ShuffleDataFramesPipe DFIterDataPipe __init__ source_datapipe source_datapipe = source_datapipe __iter__ size = None all_buffer list Any = df source_datapipe size None size = df_wrapper get_len df all_buffer extend df_wrapper get_item df i i range df_wrapper get_len df random shuffle all_buffer buffer = df all_buffer buffer append df len buffer == size yield df_wrapper concat buffer buffer = buffer yield df_wrapper concat buffer functional_datapipe _dataframes_filter enable_df_api_tracing=True FilterDataFramesPipe DFIterDataPipe __init__ source_datapipe filter_fn source_datapipe = source_datapipe filter_fn = filter_fn __iter__ size = None all_buffer = filter_res = pyrefly ignore bad-assignment df source_datapipe size None size = len df index i range len df index all_buffer append df i i + filter_res append filter_fn df iloc i buffer = df res zip all_buffer filter_res strict=True res buffer append df len buffer == size yield df_wrapper concat buffer buffer = buffer yield df_wrapper concat buffer functional_datapipe _to_dataframes_pipe enable_df_api_tracing=True ExampleAggregateAsDataFrames DFIterDataPipe __init__ source_datapipe dataframe_size= columns=None source_datapipe = source_datapipe columns = columns dataframe_size = dataframe_size _as_list item try list item except Exception TODO VitalyFedyunin Replace better iterable exception item __iter__ aggregate = item source_datapipe aggregate append _as_list item len aggregate == dataframe_size yield df_wrapper create_dataframe aggregate columns=self columns aggregate = len aggregate yield df_wrapper create_dataframe aggregate columns=self columns