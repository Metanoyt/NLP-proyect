__future__ annotations torchgen api meta meta torchgen api structured structured torchgen api types kernel_signature torchgen context with_native_function_and_index torchgen model BackendIndex NativeFunction NativeFunctionsGroup torchgen utils mapMaybe torch_api_key_word_prefix bankend_index BackendIndex - str bankend_index external Although Intel GPU ATen library out-of-tree still utilizes torchgen produce structured kernels Regarding these produced structured kernels they should visible Intel GPU ATen library Therefore we need add TORCH_XPU_API prefix these structured kernels rather than TORCH_API Because semantic TORCH_API hidden out-of-tree backends For other in-tree backends like cpu cuda they still use TORCH_API prefix visible semantic device_torch_api_key_word_mapping = XPU TORCH_XPU_API device_torch_api_key_word_mapping get bankend_index dispatch_key name TORCH_API + with_native_function_and_index gen_unstructured f NativeFunction backend_index BackendIndex - str &#124; None sig = kernel_signature f backend_index metadata = backend_index get_kernel f metadata None None legacy metadata kernel None prefix = static backend_index external TORCH_API f prefix sig decl name=metadata kernel with_native_function_and_index gen_structured g NativeFunctionsGroup backend_index BackendIndex - list str meta_name = meta name g out_args = structured impl_arguments g metadata = backend_index get_kernel g metadata None prefix = torch_api_key_word_prefix backend_index f \ struct prefix structured_ metadata kernel public meta structured_ meta_name void impl join decl out_args Generates NativeFunctions h list forward declarations all actual kernel definitions we keep aten src ATen native with_native_function_and_index compute_native_function_declaration g NativeFunctionsGroup &#124; NativeFunction backend_index BackendIndex - list str metadata = backend_index get_kernel g isinstance g NativeFunctionsGroup metadata None metadata structured backend_index external Structured hasn t been tested external backends yet raise AssertionError Structured external backend functions implemented yet gen_structured g backend_index list mapMaybe lambda f gen_unstructured f backend_index g functions x = gen_unstructured g backend_index x None x