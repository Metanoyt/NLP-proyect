__future__ annotations dataclasses dc token functools cached_property typing TYPE_CHECKING EMPTY_TOKENS bracket_pairs bracket_pairs TYPE_CHECKING tokenize TokenInfo dc dataclass LineWithSets A logical line Python tokens terminated NEWLINE end file tokens list TokenInfo cached_property sets - list TokenInfo A list tokens which use built-in set symbol t i t enumerate tokens is_set i cached_property braced_sets - list list TokenInfo A list lists tokens each representing braced set like tokens b e + b e bracket_pairs items is_braced_set b e cached_property bracket_pairs - dict int int bracket_pairs tokens is_set i int - bool t = tokens i after = i len tokens - tokens i + t string == Set t type == token NAME pyrefly ignore bad-return after after string == after type == token OP t string == set t type == token NAME i tokens i - string after after string == = after type == token OP is_braced_set begin int end int - bool begin + == end tokens begin string = begin tokens begin - string == skip ` x ` False i = begin + empty = True while i end t = tokens i t type == token OP t string False brace_end = bracket_pairs get i Skip end subexpression i = brace_end t type EMPTY_TOKENS empty = False i += empty