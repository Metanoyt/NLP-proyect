Owner s oncall fx itertools torch torch fx experimental proxy_tensor make_fx torch fx graph_module GraphModule torch fx passes dialect common cse_pass CSEPass torch testing _internal common_utils instantiate_parametrized_tests parametrize raise_on_run_directly TestCase FactoryFunctionCall x device y = torch full x shape device=device z = torch add y x z TorchTensorCall x y = torch tensor x + y TakeList x z = torch cat x x z ReturnList x = torch arange reshape z = torch split z Mutation x y = x + y add_ x + y MutationInput x x add_ y = x + x + y MutationFactory x device y = torch full x shape device=device y add_ x + y MutationTorchTensorCall x y = torch tensor y add_ x + y MutationMetadata x x resize_ x Passes = CSEPass Test_Cases = TakeList ReturnList Mutation MutationInput MutationMetadata MutationTorchTensorCall Factory_Test_Cases = FactoryFunctionCall MutationFactory Devices = cpu torch cuda is_available Devices append cuda name_fn common_pass f device Names parameterized test cases f type common_pass __name__ _ f __name__ _ device instantiate_parametrized_tests TestCommonPass TestCase parametrize common_pass f device itertools product Passes Test_Cases Devices name_fn test_correctness common_pass f device inp = torch randn device=device traced_m = make_fx f inp P = common_pass res = P traced_m modified_m = res graph_module assert isinstance modified_m GraphModule inp_copy = inp clone expected = f inp result = modified_m inp_copy assertEqual result expected parametrize common_pass f device itertools product Passes Factory_Test_Cases Devices name_fn test_correctness_factory common_pass f device inp = torch randn device=device traced_m = make_fx f inp device P = common_pass res = P traced_m modified_m = res graph_module assert isinstance modified_m GraphModule inp_copy = inp clone expected = f inp device result = modified_m inp_copy device assertEqual result expected __name__ == __main__ raise_on_run_directly test test_fx py