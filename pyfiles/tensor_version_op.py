This module implements tensor version operations Dynamo tracing It provides primitives handling tensor versioning during tracing particularly context functionalization where version operations handled eagerly fake tensors When we functionalize _tensor_version + _unsafe_set_version_counter ops disappear traced graph We run them eagerly fake tensors used tracing order get past asserts would fail autograd Why ok Versions functional tensors do make any sense since you cannot mutate functional tensor The whole point version munging trick autograd into doing what we want after AotAutograd there no longer any need these ops Note similar how no_grad handled contextlib AbstractContextManager typing Any torch torch SymInt torch _prims _make_prim RETURN_TYPE torch _subclasses FakeTensorMode torch _subclasses functional_tensor FunctionalTensorMode _tensor_version = _make_prim schema= _tensor_version Tensor - SymInt return_type=RETURN_TYPE NEW meta=torch ops aten _version default impl_aten=torch ops aten _version default doc= Tracable unbacked SymInt version torch Tensor _version _tensor_version py_impl FakeTensorMode type ignore misc _tensor_version_fake fake_mode FakeTensorMode self_tensor Any - SymInt The initial dynamo capture _tensor_version + _unsafe_set_version_counter turns ` _version ` into unbacked SymInt so we don t need specialize ` _version ` input tensors graph assert fake_mode shape_env None fake_mode shape_env create_unbacked_symint _unsafe_set_version_counter = _make_prim schema= _unsafe_set_version_counter Tensor tensors SymInt versions - return_type=RETURN_TYPE NEW meta=lambda version None impl_aten=torch _C _autograd _unsafe_set_version_counter doc= Tracable+SymInt version torch _C _autograd _unsafe_set_version_counter torch fx node has_side_effect _unsafe_set_version_counter _tensor_version py_impl FunctionalTensorMode type ignore misc _tensor_version_functional mode FunctionalTensorMode Any - int _version _unsafe_set_version_counter py_impl FunctionalTensorMode type ignore misc _unsafe_set_version_counter_functional ctx AbstractContextManager Any tensors tuple torch Tensor versions tuple int - None torch _C _autograd _unsafe_set_version_counter tensors versions