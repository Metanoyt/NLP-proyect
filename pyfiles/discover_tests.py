__future__ annotations glob os sys pathlib Path CPP_TEST_PREFIX = cpp CPP_TEST_PATH = build bin CPP_TESTS_DIR = os path abspath os getenv CPP_TESTS_DIR default=CPP_TEST_PATH REPO_ROOT = Path __file__ resolve parents parse_test_module test str - str test split maxsplit= discover_tests base_dir Path = REPO_ROOT test cpp_tests_dir str &#124; Path &#124; None = None blocklisted_patterns list str &#124; None = None blocklisted_tests list str &#124; None = None extra_tests list str &#124; None = None - list str Searches all python files starting test_ excluding one specified patterns If cpp_tests_dir provided also scan all C++ tests under directory They usually found build bin skip_test_p name str - bool rc = False blocklisted_patterns None rc &#124; = any name startswith pattern pattern blocklisted_patterns blocklisted_tests None rc &#124; = name blocklisted_tests rc This supports symlinks so we can link domain library tests PyTorch test directory all_py_files = Path p p glob glob f base_dir test_ py recursive=True cpp_tests_dir = f base_dir parent CPP_TEST_PATH cpp_tests_dir None cpp_tests_dir CPP test files located under pytorch build bin Unlike Python test C++ tests just binaries could have any name i e basic atest all_cpp_files = Path p p glob glob f cpp_tests_dir recursive=True rc = str fname relative_to base_dir - fname all_py_files Add cpp prefix C++ tests so we can tell them apart rc extend parse_test_module f CPP_TEST_PREFIX fname relative_to cpp_tests_dir fname all_cpp_files Invert slashes Windows sys platform == win rc = name replace \\ name rc rc = test test rc skip_test_p test extra_tests None rc += extra_tests sorted rc TESTS = discover_tests cpp_tests_dir=CPP_TESTS_DIR blocklisted_patterns= ao custom_backend custom_operator fx executed test_fx py jit executed test_jit py mobile onnx_caffe package executed test_package py quantization executed test_quantization py autograd executed test_autograd py cpp_extensions open_registration_extension torch_openreg tests executed test_openreg py blocklisted_tests= test_bundled_images test_cpp_extensions_aot test_determination test_jit_fuser test_jit_simple test_jit_string test_kernel_launch_checks test_nnapi test_static_runtime test_throughput_benchmark distributed bin test_script distributed elastic multiprocessing bin test_script distributed launcher bin test_script distributed launcher bin test_script_init_method distributed launcher bin test_script_is_torchelastic_launched distributed launcher bin test_script_local_rank distributed test_c d_spawn distributions test_transforms distributions test_utils lazy test_meta_kernel lazy test_extract_compiled_graph test inductor test_aot_inductor_utils inductor test_aoti_cross_compile_windows onnx test_onnxscript_no_runtime onnx test_pytorch_onnx_onnxruntime_cuda onnx test_models These C++ tests f CPP_TEST_PREFIX CMakeFiles f CPP_TEST_PREFIX CTestTestfile cmake f CPP_TEST_PREFIX Makefile f CPP_TEST_PREFIX cmake_install cmake f CPP_TEST_PREFIX c _intrusive_ptr_benchmark f CPP_TEST_PREFIX example_allreduce f CPP_TEST_PREFIX parallel_benchmark f CPP_TEST_PREFIX protoc f CPP_TEST_PREFIX protoc- f CPP_TEST_PREFIX torch_shm_manager f CPP_TEST_PREFIX tutorial_tensorexpr extra_tests= test_cpp_extensions_aot_ninja test_cpp_extensions_aot_no_ninja distributed elastic timer api_test distributed elastic timer local_timer_example distributed elastic timer local_timer_test distributed elastic events lib_test distributed elastic metrics api_test distributed elastic utils logging_test distributed elastic utils util_test distributed elastic utils distributed_test distributed elastic multiprocessing api_test doctests test_autoload_enable test_autoload_disable test_openreg __name__ == __main__ print TESTS