mypy allow-untyped-defs argparse base functools importlib logging os sys typing TypeVar torch _inductor async_compile pre_fork_setup torch _inductor codecache torch_key torch _inductor compile_worker subproc_pool SubprocKind SubprocMain SubprocPickler torch _inductor compile_worker utils _async_compile_initializer torch _inductor runtime compile_tasks _set_triton_ptxas_path _T = TypeVar _T log = logging getLogger __name__ _set_triton_ptxas_path try triton assert triton None preload parent except ImportError pass _lookup_and_create_type base type _T qname str - _T Given base type qualified name lookup name check s given type then instantiate pkg name = qname rsplit mod = importlib import_module pkg ty = getattr mod name issubclass ty base raise TypeError f Type ty subtype base ty main try parser = argparse ArgumentParser parser add_argument -- pickler type=functools partial _lookup_and_create_type SubprocPickler parser add_argument -- kind type=SubprocKind parser add_argument -- workers type=int parser add_argument -- parent type=int parser add_argument -- read-fd type=int parser add_argument -- write-fd type=int parser add_argument -- torch-key type=str args = parser parse_args os getppid = args parent sys exit read_fd = os fdopen args read_fd rb write_fd = os fdopen args write_fd wb pre_fork_setup torch_key set base b decode args torch_key encode utf- type ignore attr-defined _async_compile_initializer args parent SubprocMain args pickler args kind args workers read_fd write_fd main except Exception log exception Uncaught exception compile_worker subprocess __name__ == __main__ main