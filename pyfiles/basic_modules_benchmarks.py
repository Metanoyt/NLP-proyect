sys benchmark_base BenchmarkBase torch torch nn nn torch _inductor utils fresh_cache ListOfLinears nn Module __init__ super __init__ linears = nn ModuleList nn Linear i range forward x ModuleList can act iterable indexed using ints i l enumerate linears x = linears i x + l x x Benchmark BenchmarkBase __init__ ModuleClass backend is_gpu=False dynamic=False force_shape_pad=False ModuleClass = ModuleClass _name = ModuleClass __name__ _is_gpu = is_gpu _force_shape_pad = force_shape_pad super __init__ category= basic_modules backend=backend device= cuda _is_gpu cpu dynamic=dynamic name prefix = f category _ _name _ backend is_dynamic prefix += _dynamic _is_gpu prefix += _gpu _force_shape_pad prefix += _force_shape_pad prefix _prepare_once m = ModuleClass torch set_float _matmul_precision high input = torch ones device=self device _prepare torch _dynamo reset _work fresh_cache torch _inductor config patch force_shape_pad=self _force_shape_pad opt_m = torch compile backend=self backend dynamic=self is_dynamic m cuda _is_gpu m opt_m input main result_path = sys argv benchmarks = Benchmark ListOfLinears eager Benchmark ListOfLinears inductor Benchmark ListOfLinears inductor is_gpu=True Benchmark ListOfLinears inductor is_gpu=True force_shape_pad=True b benchmarks b enable_compile_time_instruction_count collect_all append_results result_path __name__ == __main__ main