mypy ignore-errors __future__ annotations argparse json sys enum Enum pathlib Path typing Any NamedTuple REPO_ROOT = Path __file__ resolve parents sys path insert str REPO_ROOT tools dynamo gb_id_mapping find_unimplemented_v _calls load_registry next_gb_id LINTER_CODE = GB_REGISTRY LintSeverity str Enum ERROR = error WARNING = warning ADVICE = advice DISABLED = disabled LintMessage NamedTuple path str &#124; None line int &#124; None char int &#124; None code str severity LintSeverity name str original str &#124; None replacement str &#124; None description str &#124; None _collect_all_calls dynamo_dir Path - dict str list tuple dict str Any Path Return mapping gb_type → list call_info file_path all occurrences gb_type_calls dict str list tuple dict str Any Path = py_file dynamo_dir rglob py call find_unimplemented_v _calls py_file dynamo_dir gb_type = call gb_type gb_type gb_type_calls gb_type_calls gb_type = gb_type_calls gb_type append call py_file gb_type_calls _create_registry_entry gb_type str context str explanation str hints list str - dict str Any Create registry entry consistent format Gb_type gb_type Context context Explanation explanation Hints hints _update_registry_with_changes registry dict calls dict str tuple dict str Any Path renames dict str str &#124; None = None - dict Calculate what updated registry should look like renames = renames updated_registry = dict registry latest_entry dict str Any = entries Gb_type entries entries registry values gb_type_to_key dict str str = entries Gb_type key key entries registry items Method determining add vs update - If gb_type exists registry content differs UPDATE append new entry preserve history - If gb_type new content matches existing entry RENAME append new entry new gb_type - If gb_type completely new ADD create new registry entry new GBID old_gb_type new_gb_type renames items registry_key = gb_type_to_key old_gb_type old_entry = updated_registry registry_key new_entry = _create_registry_entry new_gb_type old_entry Context old_entry Explanation old_entry Hints updated_registry registry_key = new_entry + updated_registry registry_key latest_entry new_gb_type = new_entry gb_type_to_key new_gb_type = registry_key del latest_entry old_gb_type del gb_type_to_key old_gb_type gb_type call file_path calls items gb_type latest_entry existing_entry = latest_entry gb_type call context == existing_entry Context call explanation == existing_entry Explanation sorted call hints == sorted existing_entry Hints registry_key = gb_type_to_key gb_type new_entry = _create_registry_entry gb_type call context call explanation call hints updated_registry registry_key = new_entry + updated_registry registry_key new_key = next_gb_id updated_registry new_entry = _create_registry_entry gb_type call context call explanation call hints updated_registry new_key = new_entry updated_registry check_registry_sync dynamo_dir Path registry_path Path - list LintMessage Check registry sync lint messages lint_messages = all_calls = _collect_all_calls dynamo_dir duplicates = gb_type call_list all_calls items len call_list first_call = call_list call file_path call_list call context = first_call context call explanation = first_call explanation sorted call hints = sorted first_call hints duplicates append gb_type gb_type calls call_list break dup duplicates gb_type = dup gb_type calls = dup calls description = f The gb_type gb_type used len calls times different content description += Each gb_type must unique across your entire codebase lint_messages append LintMessage path=str calls line=None char=None code=LINTER_CODE severity=LintSeverity ERROR name= Duplicate gb_type original=None replacement=None description=description duplicates lint_messages calls = gb_type calls gb_type calls all_calls items registry = load_registry registry_path latest_entry dict str Any = entries Gb_type entries entries registry values renames dict str str = remaining_calls = dict calls gb_type call file_path calls items gb_type latest_entry existing_gb_type existing_entry latest_entry items call context == existing_entry Context call explanation == existing_entry Explanation sorted call hints == sorted existing_entry Hints renames existing_gb_type = gb_type del remaining_calls gb_type break needs_update = bool renames gb_type call file_path remaining_calls items gb_type latest_entry existing_entry = latest_entry gb_type call context == existing_entry Context call explanation == existing_entry Explanation sorted call hints == sorted existing_entry Hints needs_update = True break needs_update = True break needs_update updated_registry = _update_registry_with_changes registry remaining_calls renames original_content = registry_path read_text encoding= utf- replacement_content = json dumps updated_registry indent= ensure_ascii=False + \n changes = renames old new renames items changes append f renamed old → new remaining_calls new_count = sum gb_type remaining_calls gb_type latest_entry new_count changes append f added new_count new gb_types description = f Registry sync needed join changes Run ` lintrunner -a ` apply changes lint_messages append LintMessage path=str registry_path line=None char=None code=LINTER_CODE severity=LintSeverity WARNING name= Registry sync needed original=original_content replacement=replacement_content description=description lint_messages __name__ == __main__ script_dir = Path __file__ resolve repo_root = script_dir parents default_registry_path = repo_root torch _dynamo graph_break_registry json default_dynamo_dir = repo_root torch _dynamo parser = argparse ArgumentParser description= Auto-sync graph break registry source code parser add_argument -- dynamo-dir type=Path default=default_dynamo_dir help=f Path dynamo directory default default_dynamo_dir parser add_argument -- registry-path type=Path default=default_registry_path help=f Path registry file default default_registry_path args = parser parse_args lint_messages = check_registry_sync dynamo_dir=args dynamo_dir registry_path=args registry_path lint_message lint_messages print json dumps lint_message _asdict flush=True