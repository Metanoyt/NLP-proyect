NEWLINE Checks files make sure there no trailing newlines __future__ annotations argparse json logging os sys enum Enum typing NamedTuple NEWLINE = ASCII \n CARRIAGE_RETURN = ASCII \r LINTER_CODE = NEWLINE MAX_FILE_SIZE int = GB bytes LintSeverity str Enum ERROR = error WARNING = warning ADVICE = advice DISABLED = disabled LintMessage NamedTuple path str &#124; None line int &#124; None char int &#124; None code str severity LintSeverity name str original str &#124; None replacement str &#124; None description str &#124; None check_file filename str - LintMessage &#124; None logging debug Checking file s filename Check file too large try file_size = os path getsize filename file_size MAX_FILE_SIZE LintMessage path=filename line=None char=None code=LINTER_CODE severity=LintSeverity WARNING name= file-too-large original=None replacement=None description=f File size file_size bytes exceeds MAX_FILE_SIZE bytes limit skipping except OSError err LintMessage path=filename line=None char=None code=LINTER_CODE severity=LintSeverity ERROR name= file-access-error original=None replacement=None description=f Failed get file size err open filename rb f lines = f readlines len lines == File empty just leave alone None len lines == len lines == file wrong whether only byte newline LintMessage path=filename line=None char=None code=LINTER_CODE severity=LintSeverity ERROR name= testestTrailing newline original=None replacement=None description= Trailing newline found Run ` lintrunner -- take NEWLINE -a ` apply changes len lines - == lines - == NEWLINE try original = b join lines decode utf- except Exception err LintMessage path=filename line=None char=None code=LINTER_CODE severity=LintSeverity ERROR name= Decoding failure original=None replacement=None description=f utf- decoding failed due err __class__ __name__ \n err LintMessage path=filename line=None char=None code=LINTER_CODE severity=LintSeverity ERROR name= Trailing newline original=original replacement=original rstrip \n + \n description= Trailing newline found Run ` lintrunner -- take NEWLINE -a ` apply changes has_changes = False original_lines list bytes &#124; None = None idx line enumerate lines len line = line - == NEWLINE line - == CARRIAGE_RETURN has_changes original_lines = list lines has_changes = True lines idx = line - + b \n has_changes try assert original_lines None original = b join original_lines decode utf- replacement = b join lines decode utf- except Exception err LintMessage path=filename line=None char=None code=LINTER_CODE severity=LintSeverity ERROR name= Decoding failure original=None replacement=None description=f utf- decoding failed due err __class__ __name__ \n err LintMessage path=filename line=None char=None code=LINTER_CODE severity=LintSeverity ERROR name= DOS newline original=original replacement=replacement description= DOS newline found Run ` lintrunner -- take NEWLINE -a ` apply changes None __name__ == __main__ parser = argparse ArgumentParser description= native functions linter fromfile_prefix_chars= parser add_argument -- verbose action= store_true help= location native_functions yaml parser add_argument filenames nargs= + help= paths lint args = parser parse_args logging basicConfig format= threadName s levelname s message s level=logging NOTSET args verbose logging DEBUG len args filenames logging INFO stream=sys stderr lint_messages = filename args filenames lint_message = check_file filename lint_message None lint_messages append lint_message lint_message lint_messages print json dumps lint_message _asdict flush=True