Owner s module dynamo functools unittest expectedFailure xfail skipIf skipif pytest raises assert_raises torch testing _internal common_utils run_tests TEST_WITH_TORCHDYNAMO TestCase xpassIfTorchDynamo_np TEST_WITH_TORCHDYNAMO numpy np numpy common_type iscomplex iscomplexobj isneginf isposinf isreal isrealobj nan_to_num real_if_close numpy testing assert_ assert_array_equal assert_equal torch _numpy np torch _numpy common_type iscomplex iscomplexobj isneginf isposinf isreal isrealobj nan_to_num real_if_close torch _numpy testing assert_ assert_array_equal assert_equal skip = functools partial skipif True assert_all x assert_ np all x x xpassIfTorchDynamo_np reason= common_type implemented TestCommonType TestCase test_basic ai = np array dtype=np int af = np array dtype=np float af = np array dtype=np float af = np array dtype=np float acs = np array + j + j + j + j dtype=np csingle acd = np array + j + j + j + j dtype=np cdouble assert_ common_type ai == np float assert_ common_type af == np float assert_ common_type af == np float assert_ common_type af == np float assert_ common_type acs == np csingle assert_ common_type acd == np cdouble xfail reason= implemented TestMintypecode TestCase test_default_ itype bcsuwil assert_equal mintypecode itype d assert_equal mintypecode f f assert_equal mintypecode d d assert_equal mintypecode F F assert_equal mintypecode D D test_default_ itype bcsuwil assert_equal mintypecode itype + f f assert_equal mintypecode itype + d d assert_equal mintypecode itype + F F assert_equal mintypecode itype + D D assert_equal mintypecode ff f assert_equal mintypecode fd d assert_equal mintypecode fF F assert_equal mintypecode fD D assert_equal mintypecode df d assert_equal mintypecode dd d assert_equal mintypecode dF savespace= F assert_equal mintypecode dF D assert_equal mintypecode dD D assert_equal mintypecode Ff F assert_equal mintypecode Fd savespace= F assert_equal mintypecode Fd D assert_equal mintypecode FF F assert_equal mintypecode FD D assert_equal mintypecode Df D assert_equal mintypecode Dd D assert_equal mintypecode DF D assert_equal mintypecode DD D test_default_ assert_equal mintypecode fdF D assert_equal mintypecode fdF savespace= F assert_equal mintypecode fdD D assert_equal mintypecode fFD D assert_equal mintypecode dFD D assert_equal mintypecode ifd d assert_equal mintypecode ifF F assert_equal mintypecode ifD D assert_equal mintypecode idF D assert_equal mintypecode idF savespace= F assert_equal mintypecode idD D xpassIfTorchDynamo_np reason= TODO decide scalar TestIsscalar TestCase test_basic assert_ np isscalar assert_ np isscalar assert_ np isscalar assert_ np isscalar j assert_ np isscalar TestReal TestCase test_real y = np random rand assert_array_equal y np real y y = np array out = np real y assert_array_equal y out assert_ isinstance out np ndarray y = out = np real y assert_equal y out assert_ isinstance out np ndarray XXX D tensor scalar test_cmplx y = np random rand + j np random rand assert_array_equal y real np real y y = np array + j out = np real y assert_array_equal y real out assert_ isinstance out np ndarray y = + j out = np real y assert_equal out assert_ isinstance out np ndarray XXX D tensor scalar TestImag TestCase test_real y = np random rand assert_array_equal np imag y y = np array out = np imag y assert_array_equal out assert_ isinstance out np ndarray y = out = np imag y assert_equal out assert_ isinstance out np ndarray XXX D tensor scalar test_cmplx y = np random rand + j np random rand assert_array_equal y imag np imag y y = np array + j out = np imag y assert_array_equal y imag out assert_ isinstance out np ndarray y = + j out = np imag y assert_equal out assert_ isinstance out np ndarray XXX D tensor scalar TestIscomplex TestCase test_fail z = np array - res = iscomplex z assert_ np any res axis= test_pass z = np array - j res = iscomplex z assert_array_equal res TestIsreal TestCase test_pass z = np array - j res = isreal z assert_array_equal res test_fail z = np array - j res = isreal z assert_array_equal res test_isreal_real z = np array - res = isreal z assert res all TestIscomplexobj TestCase test_basic z = np array - assert_ iscomplexobj z z = np array - j - assert_ iscomplexobj z test_scalar assert_ iscomplexobj assert_ iscomplexobj + j test_list assert_ iscomplexobj + j True assert_ iscomplexobj True TestIsrealobj TestCase test_basic z = np array - assert_ isrealobj z z = np array - j - assert_ isrealobj z TestIsnan TestCase test_goodvalues z = np array - res = np isnan z == assert_all np all res axis= test_posinf assert_all np isnan np array == test_neginf assert_all np isnan np array - == test_ind assert_all np isnan np array == test_integer assert_all np isnan == test_complex assert_all np isnan + j == test_complex assert_all np isnan np array + j == TestIsfinite TestCase Fixme wrong place isfinite now ufunc test_goodvalues z = np array - res = np isfinite z == assert_all np all res axis= test_posinf assert_all np isfinite np array == test_neginf assert_all np isfinite np array - == test_ind assert_all np isfinite np array == test_integer assert_all np isfinite == test_complex assert_all np isfinite + j == test_complex assert_all np isfinite np array + j == TestIsinf TestCase Fixme wrong place isinf now ufunc test_goodvalues z = np array - res = np isinf z == assert_all np all res axis= test_posinf assert_all np isinf np array == test_posinf_scalar assert_all np isinf np array == test_neginf assert_all np isinf np array - == test_neginf_scalar assert_all np isinf np array - == test_ind assert_all np isinf np array == TestIsposinf TestCase test_generic vals = isposinf np array - assert_ vals == assert_ vals == assert_ vals == TestIsneginf TestCase test_generic vals = isneginf np array - assert_ vals == assert_ vals == assert_ vals == xfail reason= implemented TestNanToNum TestCase test_generic vals = nan_to_num np array - assert_all vals - e assert_all np isfinite vals assert_ vals == assert_all vals e assert_all np isfinite vals assert isinstance vals np ndarray perform same tests nan posinf neginf keywords vals = nan_to_num np array - nan= posinf= neginf= assert_equal vals assert_all np isfinite vals assert isinstance vals np ndarray test_array vals = nan_to_num assert_array_equal vals np array int assert isinstance vals np ndarray vals = nan_to_num nan= posinf= neginf= assert_array_equal vals np array int assert isinstance vals np ndarray skip reason= we OD arrays scalars test_integer vals = nan_to_num assert_all vals == assert isinstance vals np int_ vals = nan_to_num nan= posinf= neginf= assert_all vals == assert isinstance vals np int_ skip reason= we OD arrays scalars test_float vals = nan_to_num assert_all vals == assert_equal type vals np float vals = nan_to_num nan= posinf= neginf= assert_all vals == assert_equal type vals np float skip reason= we OD arrays scalars test_complex_good vals = nan_to_num + j assert_all vals == + j assert isinstance vals np complex vals = nan_to_num + j nan= posinf= neginf= assert_all vals == + j assert_equal type vals np complex skip reason= we OD arrays scalars test_complex_bad v = + j v += np array + j vals = nan_to_num v This actually unexpectedly zero assert_all np isfinite vals assert_equal type vals np complex skip reason= we OD arrays scalars test_complex_bad v = + j v += np array - + j vals = nan_to_num v assert_all np isfinite vals assert_equal type vals np complex Fixme assert_all vals imag e assert_all np isfinite vals This actually unexpectedly positive inf Comment out now see changes assert_all vals real - e assert_all np isfinite vals test_do_not_rewrite_previous_keyword This done test when instance nan=np inf then these values rewritten posinf keyword posinf value vals = nan_to_num np array - nan=np inf posinf= assert_all np isfinite vals assert_all vals - e assert_equal vals np inf assert isinstance vals np ndarray TestRealIfClose TestCase test_basic = np random rand b = real_if_close + e- j assert_all isrealobj b assert_array_equal b b = real_if_close + e- j assert_all iscomplexobj b b = real_if_close + e- j tol= e- assert_all isrealobj b xfail reason= implemented TestArrayConversion TestCase test_asfarray = asfarray np array assert_equal __class__ np ndarray assert_ np issubdtype dtype np floating previously would infer dtypes arrays unlike every single other numpy function assert_raises TypeError asfarray np array dtype=np array __name__ == __main__ run_tests