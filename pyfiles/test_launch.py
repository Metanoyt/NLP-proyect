Owner s module intel shutil subprocess tempfile unittest torch testing _internal common_utils IS_LINUX run_tests TestCase unittest skipIf IS_LINUX Only works linux TestTorchrun TestCase setUp _test_dir = tempfile mkdtemp prefix=self __class__ __name__ tearDown shutil rmtree _test_dir test_cpu_info lscpu_info = The following parsable format which can fed other programs Each different item every column has unique ID starting zero CPU Core Socket Node torch backends xeon run_cpu _CPUinfo cpuinfo = _CPUinfo lscpu_info assert cpuinfo _physical_core_nums == assert cpuinfo _logical_core_nums == assert cpuinfo get_node_physical_cores == assert cpuinfo get_node_physical_cores == assert cpuinfo get_node_logical_cores == assert cpuinfo get_node_logical_cores == assert cpuinfo get_all_physical_cores == assert cpuinfo get_all_logical_cores == assert cpuinfo numa_aware_check == assert cpuinfo numa_aware_check == assert cpuinfo numa_aware_check == test_multi_threads num = subprocess Popen f python -m torch backends xeon run_cpu -- ninstances -- use-default-allocator \ -- disable-iomp -- disable-numactl -- disable-taskset -- log-path _test_dir -- no-python pwd shell=True stdout=subprocess PIPE stderr=subprocess STDOUT p line p stdout readlines segs = str line utf- strip split - segs - strip == pwd num += assert num == Failed launch multiple instances inference __name__ == __main__ run_tests