Owner s module dynamo functools inspect unittest expectedFailure xfail skipIf skip numpy _np pytest raises assert_raises torch torch _numpy w torch _numpy _ufuncs _ufuncs torch _numpy _util _util torch _numpy testing assert_allclose assert_equal torch testing _internal common_cuda TEST_CUDA torch testing _internal common_utils instantiate_parametrized_tests parametrize run_tests TestCase These function receive one array_like arg one array_like result one_arg_funcs = w asarray w empty_like w ones_like w zeros_like functools partial w full_like fill_value= w corrcoef w squeeze w argmax w bincount XXX input dtypes w prod w sum w real w imag w angle w real_if_close w isreal w iscomplex w isneginf w isposinf w i w copy w array w round w around w flip w vstack w hstack w dstack w column_stack w row_stack w flatnonzero ufunc_names = _ufuncs _unary ufunc_names remove invert torch bitwise_not_cpu implemented Float ufunc_names remove bitwise_not one_arg_funcs += getattr _ufuncs name name ufunc_names instantiate_parametrized_tests TestOneArr TestCase Base smoke tests one-arg functions array_like - array_like Accepts array_likes torch Tensors w ndarays returns ndarray parametrize func one_arg_funcs test_asarray_tensor func t = torch Tensor ta = func t assert isinstance ta w ndarray parametrize func one_arg_funcs test_asarray_list func lst = la = func lst assert isinstance la w ndarray parametrize func one_arg_funcs test_asarray_array func = w asarray la = func assert isinstance la w ndarray one_arg_axis_funcs = w argmax w argmin w prod w sum w all w any w mean w argsort w std w var w flip instantiate_parametrized_tests TestOneArrAndAxis TestCase parametrize func one_arg_axis_funcs parametrize axis - None test_andaxis_tensor func axis t = torch Tensor ta = func t axis=axis assert isinstance ta w ndarray parametrize func one_arg_axis_funcs parametrize axis - None test_andaxis_list func axis t = ta = func t axis=axis assert isinstance ta w ndarray parametrize func one_arg_axis_funcs parametrize axis - None test_andaxis_array func axis t = w asarray ta = func t axis=axis assert isinstance ta w ndarray instantiate_parametrized_tests TestOneArrAndAxesTuple TestCase parametrize func w transpose parametrize axes None test_andtuple_tensor func axes t = torch ones ta = func t axes=axes assert isinstance ta w ndarray np transpose -specific test axes None newshape = newshape = tuple t shape axes i i range w ndim t assert ta shape == newshape parametrize func w transpose parametrize axes None test_andtuple_list func axes t = shape = ta = func t axes=axes assert isinstance ta w ndarray parametrize func w transpose parametrize axes None test_andtuple_array func axes t = w asarray ta = func t axes=axes assert isinstance ta w ndarray axes None newshape = newshape = tuple t shape axes i i range t ndim assert ta shape == newshape arr_shape_funcs = w reshape w empty_like w ones_like functools partial w full_like fill_value= w broadcast_to instantiate_parametrized_tests TestOneArrAndShape TestCase Smoke test functions array_like shape_like - array_like setUp shape = shape_arg_name = w reshape newshape reshape expects ` newshape ` parametrize func arr_shape_funcs test_andshape_tensor func t = torch Tensor shape_dict = shape_arg_name get func shape shape ta = func t shape_dict assert isinstance ta w ndarray assert ta shape == shape parametrize func arr_shape_funcs test_andshape_list func t = shape_dict = shape_arg_name get func shape shape ta = func t shape_dict assert isinstance ta w ndarray assert ta shape == shape parametrize func arr_shape_funcs test_andshape_array func t = w asarray shape_dict = shape_arg_name get func shape shape ta = func t shape_dict assert isinstance ta w ndarray assert ta shape == shape one_arg_scalar_funcs = w size _np size w shape _np shape w ndim _np ndim instantiate_parametrized_tests TestOneArrToScalar TestCase Smoke test functions array_like - scalar python object parametrize func np_func one_arg_scalar_funcs test_toscalar_tensor func np_func t = torch Tensor ta = func t tn = np_func _np asarray t assert isinstance ta w ndarray assert ta == tn parametrize func np_func one_arg_scalar_funcs test_toscalar_list func np_func t = ta = func t tn = np_func t assert isinstance ta w ndarray assert ta == tn parametrize func np_func one_arg_scalar_funcs test_toscalar_array func np_func t = w asarray ta = func t tn = np_func t assert isinstance ta w ndarray assert ta == tn shape_funcs = w zeros w empty w ones functools partial w full fill_value= instantiate_parametrized_tests TestShapeLikeToArray TestCase Smoke test shape_like - array shape = parametrize func shape_funcs test_shape func = func shape assert isinstance w ndarray assert shape == shape seq_funcs = w atleast_ d w atleast_ d w atleast_ d w broadcast_arrays instantiate_parametrized_tests TestSequenceOfArrays TestCase Smoke test sequence arrays - sequence arrays parametrize func seq_funcs test_single_tensor func t = torch Tensor ta = func t single argument broadcast_arrays returns tuple while atleast_ d array unpack = w broadcast_arrays True get func False res = ta unpack ta assert isinstance res w ndarray parametrize func seq_funcs test_single_list func lst = la = func lst unpack = w broadcast_arrays True get func False res = la unpack la assert isinstance res w ndarray parametrize func seq_funcs test_single_array func = w asarray la = func unpack = w broadcast_arrays True get func False res = la unpack la assert isinstance res w ndarray parametrize func seq_funcs test_several func arys = torch Tensor w asarray result = func arys assert isinstance result tuple list assert len result == len arys assert all isinstance _ w ndarray _ result seq_to_single_funcs = w concatenate w stack w vstack w hstack w dstack w column_stack w row_stack instantiate_parametrized_tests TestSequenceOfArraysToSingle TestCase Smoke test sequence arrays - array parametrize func seq_to_single_funcs test_several func arys = torch Tensor w asarray result = func arys assert isinstance result w ndarray single_to_seq_funcs = w nonzero https github com Quansight-Labs numpy_pytorch_interop pull #discussion_r w tril_indices_from w triu_indices_from w where instantiate_parametrized_tests TestArrayToSequence TestCase Smoke test array - tuple arrays parametrize func single_to_seq_funcs test_asarray_tensor func t = torch Tensor ta = func t assert isinstance ta tuple assert all isinstance x w ndarray x ta parametrize func single_to_seq_funcs test_asarray_list func lst = la = func lst assert isinstance la tuple assert all isinstance x w ndarray x la parametrize func single_to_seq_funcs test_asarray_array func = w asarray la = func assert isinstance la tuple assert all isinstance x w ndarray x la funcs_and_args = w linspace w logspace w logspace w geomspace w eye w identity w arange w arange w arange w tri - instantiate_parametrized_tests TestPythonArgsToArray TestCase Smoke_test sequence scalars - array parametrize func args funcs_and_args test_argstoarray_simple func args = func args assert isinstance w ndarray TestNormalizations TestCase Smoke test generic problems normalizations test_unknown_args Check unknown args decorated functions fail = w arange == unknown positional args assert_raises TypeError w nonzero kaboom unknown kwarg assert_raises TypeError w nonzero oops= ouch test_too_few_args_positional assert_raises TypeError w nonzero test_unknown_args_with_defaults check function arguments defaults should work w eye five arguments four defaults should fail assert_raises TypeError w eye TestCopyTo TestCase test_copyto_basic dst = w empty src = w arange w copyto dst src assert dst == src all test_copytobcast dst = w empty src = w arange cannot broadcast = error out assert_raises RuntimeError w copyto dst src broadcast src against dst dst = w empty w copyto dst src assert dst == src all test_copyto_typecast dst = w empty dtype=int src = w arange dtype=float assert_raises TypeError w copyto dst src casting= no force type cast w copyto dst src casting= unsafe assert dst == src all TestDivmod TestCase test_divmod_out x = w arange x = w arange out = w empty_like x w empty_like x quot rem = w divmod x x out=out assert_equal quot x x assert_equal rem x x out out = out assert quot out assert rem out test_divmod_out_list x = x = out = w empty_like x w empty_like x quot rem = w divmod x x out=out assert quot out assert rem out xfail out out implemented test_divmod_pos_only x = x = out out = w empty_like x w empty_like x quot rem = w divmod x x out out assert quot out assert rem out test_divmod_no_out check out= machinery handles no out all x = w array x = w array quot rem = w divmod x x assert_equal quot x x assert_equal rem x x test_divmod_out_both_pos_and_kw o = w empty assert_raises TypeError w divmod o o out= o o TestSmokeNotImpl TestCase test_nimpl_basic smoke test NotImplemented annotation picked up assert_raises NotImplementedError w empty like= ooops instantiate_parametrized_tests TestDefaultDtype TestCase test_defaultdtype_defaults default both floats ints bit x = w empty z = x + j x assert x dtype torch_dtype == torch float assert z dtype torch_dtype == torch complex assert w arange dtype torch_dtype == torch int parametrize dt pytorch float torch float test_set_default_float dt try w set_default_dtype fp_dtype=dt x = w empty z = x + j x assert x dtype torch_dtype == torch float assert z dtype torch_dtype == torch complex finally restore w set_default_dtype fp_dtype= numpy skip _np __version__ = reason= from_dlpack new NumPy TestExport TestCase test_exported_objects exported_fns = x x dir w inspect isfunction getattr w x x startswith _ x = set_default_dtype _np __version__ The following methods removed NumPy See https numpy org devdocs numpy_ _ _migration_guide html#main-namespace exported_fns -= product round_ sometrue cumproduct alltrue diff = exported_fns difference set dir _np assert len diff == str diff TestCtorNested TestCase test_arrays_in_lists lst = w array assert_equal w asarray lst TestMisc TestCase test_ndarrays_to_tensors out = _util ndarrays_to_tensors w asarray assert len out == assert isinstance out tuple len out == assert isinstance out torch Tensor skip TEST_CUDA reason= requires cuda test_f _on_cuda make sure operations float tensors give same results CUDA CPU t = torch arange dtype=torch float assert_allclose w vdot t cuda t cuda w vdot t t assert_allclose w inner t cuda t cuda w inner t t assert_allclose w matmul t cuda t cuda w matmul t t assert_allclose w einsum i i t cuda t cuda w einsum i i t t assert_allclose w mean t cuda w mean t assert_allclose w cov t cuda t cuda w cov t t tensor cuda assert_allclose w corrcoef t cuda w corrcoef t tensor cuda __name__ == __main__ run_tests