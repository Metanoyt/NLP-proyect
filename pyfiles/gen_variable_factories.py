Generates C++ functions wrap ATen tensor factory methods turn them into Variables This writes one file variable_factories h __future__ annotations re torchgen api python python torchgen api cpp torchgen api types CppSignatureGroup torchgen context with_native_function torchgen gen parse_native_yaml torchgen model NativeFunction TensorOptionsArguments Variant torchgen utils FileManager mapMaybe OPTIONAL_TYPE_PATTERN = re compile r std optional + TYPE_PATTERN = re compile r const\s+ A-Z \w+ Add types defined ATen namespace e g Tensor TensorList IntArrayRef etc TODO maybe update cpp argument API take optional namespace argument fully_qualified_type argument_type str - str maybe_optional_type type str is_opt bool - str f std optional type is_opt type opt_match = OPTIONAL_TYPE_PATTERN match argument_type is_opt = opt_match None opt_match argument_type = argument_type opt_match start opt_match end match = TYPE_PATTERN match argument_type match None maybe_optional_type argument_type is_opt index = match start qualified_type = f argument_type index argument_type index maybe_optional_type qualified_type is_opt gen_variable_factories out str native_yaml_path str tags_yaml_path str template_path str - None native_functions = parse_native_yaml native_yaml_path tags_yaml_path native_functions factory_functions = fn fn native_functions is_factory_function fn fm = FileManager install_dir=out template_dir=template_path dry_run=False fm write_with_template variable_factories h variable_factories h lambda generated_comment + f generated fm template_dir_for_comments variable_factories h ops_headers f #include ATen ops fn root_name h fn factory_functions function_definitions list mapMaybe process_function factory_functions with_native_function is_factory_function f NativeFunction - bool Variant function f variants False name = cpp name f func has_tensor_options = python has_tensor_options f has_tensor_options name endswith _like with_native_function process_function f NativeFunction - str &#124; None name = cpp name f func has_tensor_options = python has_tensor_options f is_factory = has_tensor_options name endswith _like Variant function f variants is_factory None cpp_sigs = CppSignatureGroup from_native_function f method=False sigs = cpp_sigs signature cpp_sigs symint_signature None sigs append cpp_sigs symint_signature r = sig sigs formals list str = exprs list str = requires_grad = false arg sig arguments qualified_type = fully_qualified_type arg type arg default formals append f qualified_type arg name = arg default formals append f qualified_type arg name isinstance arg argument TensorOptionsArguments note we remove requires_grad setting TensorOptions because ignored anyways we actually have assertion isn t set which would fail otherwise We handle requires_grad explicitly here instead passing through kernel exprs append f TensorOptions arg name requires_grad std nullopt Manually set requires_grad bit result tensor requires_grad = f arg name requires_grad exprs append arg name r += f \ inline Tensor sig name join formals AutoDispatchBelowADInplaceOrView guard autograd make_variable sig name join exprs requires_grad= requires_grad r