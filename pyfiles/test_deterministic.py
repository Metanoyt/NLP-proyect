Owner s module inductor contextlib unittest torch torch _inductor config inductor_config torch _dynamo utils counters torch _inductor test_case run_tests TestCase torch _inductor utils fresh_cache torch testing _internal common_utils instantiate_parametrized_tests parametrize torch testing _internal inductor_utils GPU_TYPE HAS_CUDA_AND_TRITON IS_BIG_GPU instantiate_parametrized_tests DeterministicTest TestCase setUp - None super setUp _exit_stack = contextlib ExitStack _exit_stack enter_context fresh_cache tearDown - None _exit_stack close super tearDown test_use_deterministic_algorithsm old_val = torch are_deterministic_algorithms_enabled try new_val True False True torch use_deterministic_algorithms new_val warn_only=True assertEqual inductor_config deterministic new_val finally torch use_deterministic_algorithms old_val warn_only=True parametrize deterministic False True test_mm_padding deterministic inductor_config patch deterministic=deterministic torch compile foo x y x y inps = torch rand device=GPU_TYPE _ range out = foo inps assertEqual out inps inps deterministic assertTrue counters inductor pad_mm_bench == assertTrue counters inductor pad_mm_bench parametrize deterministic False True inductor_config patch max_autotune=True unittest skipIf IS_BIG_GPU templates require big gpu test_max_autotune deterministic inductor_config patch deterministic=deterministic torch compile foo x y x y inps = torch rand device=GPU_TYPE _ range out = foo inps assertEqual out inps inps deterministic assertTrue counters inductor select_algorithm_autotune == assertTrue counters inductor select_algorithm_autotune test_pointwise_coordesc_tuning torch compile mode= max-autotune f x x + x = torch randn device=GPU_TYPE assertEqual f x x + assertTrue counters inductor coordesc_tuning_bench parametrize deterministic False True test_reduction_coordesc_tuning deterministic inductor_config patch deterministic=deterministic coordinate_descent_tuning=True torch compile foo x x sum dim=- inp = torch rand device=GPU_TYPE out = foo inp assertEqual out inp sum dim=- deterministic assertTrue counters inductor coordesc_tuning_bench == assertTrue counters inductor coordesc_tuning_bench __name__ == __main__ HAS_CUDA_AND_TRITON run_tests