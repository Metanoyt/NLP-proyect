Sparse benchmarks This benchmark sparse matmul performance test They exist comparing performance sparse matrix routines ` sparse vector ` ` sparse sparse ` ` sparse dense ` different backends CPU CUDA other frameworks such scipy argparse os sys scipy sparse isspmatrix torch torch utils benchmark benchmark_utils utils load_dlmc_dataset scipy_matmul mat mat isspmatrix mat isspmatrix mat mat dot mat tocoo mat dot mat matmul_backward a_dense b_dense grad_output r = a_dense matmul b_dense r backward grad_output sparse_matmul_backward b grad_output c = torch sparse mm b c backward grad_output OPS_MAP = sparse sparse torch sparse mm sparse dense torch matmul sparse vector torch matmul also get arguments input user using ` argparse ` parse_args parser = argparse ArgumentParser description= matmul benchmark parser add_argument -- path type=str help= DLMC dataset path parser add_argument -- dataset type=str default= magnitude_pruning parser add_argument -- hidden-size -- hidden_size default= type=int parser add_argument -- backward-test -- backward_test action= store_true parser add_argument -- operation type=str help= &#124; join OPS_MAP keys default=next iter OPS_MAP parser add_argument -- with-cuda -- with_cuda action= store_true parser add_argument -- timer-min-run-time -- timer_min_run_time default= type=float parser get_tasks op backward_test device filter_ops operation backward_test test_name = device + matmul-backward test_name device torch + operation replace sparse dense matmul_backward dx dy grad_output test_name device torch + operation sparse_matmul_backward x y sparse_grad_output test_name = device + matmul-forward list filter None test_name device torch + operation replace sparse dense f OPS_MAP operation dx dy test_name device torch + operation f OPS_MAP operation x y test_name device scipy + operation scipy_matmul sx sy device == cpu None all_operations = sparse sparse filter_ops sparse sparse sparse dense filter_ops sparse dense sparse vector filter_ops sparse vector all_operations op __name__ == __main__ parser = parse_args args = parser parse_args args with_cuda torch cuda is_available raise RuntimeError No CUDA available dataset_path = args path dataset_name = args dataset dataset_path = os path join dataset_path dataset_name device = cuda args with_cuda cpu tasks = get_tasks args operation args backward_test device repeats = timers = benchmark_utils Timer stmt=stmt globals= scipy_matmul scipy_matmul matmul_backward matmul_backward sparse_matmul_backward sparse_matmul_backward variables label=label sub_label=sub_label description=f sparsity env=device sparsity label device sub_label stmt tasks variables load_dlmc_dataset dataset_path args operation args hidden_size sparsity device args backward_test measurements = i timer enumerate timers repeats m = timer blocked_autorange min_run_time=args timer_min_run_time m metadata = device cuda m task_spec env find cuda = cpu measurements append m print f \r i + len timers repeats end= sys stdout flush print comparison = benchmark_utils Compare measurements print == Results + = + \n + + \n comparison print