mypy allow-untyped-defs This file contains canonical definitions our symbol naming conventions across torch fx experimental symbolic_shapes torch _inductor The intention To make easily greppable where all sites we use prefix Make possible easily tell we can introduce new prefix without introducing conflict You can occasionally test prefixes have been hardcoded renaming prefixes file seeing what breaks collections abc Iterable enum auto Enum typing Union sympy SymT Enum SIZE = auto FLOAT = auto UNBACKED_INT = auto UNBACKED_FLOAT = auto Inductor The intermediates inner_fn tmp one generated per ops call If one these shows up indexing expression means indirect load happening TMP = auto Inductor Placeholder variable later replaced TMP INDIRECT = auto Inductor Some size expressions replaced precomputed size ps which computed host side then directly reused kernel so we don t repeatedly recompute device PRECOMPUTED_SIZE = auto Inductor An indexing variable i loops IR which ranges over non-reduced dim loop INDEX = auto Inductor A reduction indexing r r variables loops IR which ranges over reduced dim s loop R _INDEX = auto R _INDEX = auto Inductor In templated kernels torch _inductor kernel we have hook store final output append epilogue fusions To do we must know what indexes outputs range over NB These will also advertise INDEX probably OK TEMPLATE_INDEX = auto Inductor iteration domain blockIdx x blockIdx y XBLOCK = auto YBLOCK = auto ZBLOCK = auto Inductor used solely dynamic_reshape_indexer VIEW = auto Alternate non-modular indexing used halide kernels HALIDE = auto Invariant there must prefix which prefix another string introduces ambiguity prefix_str = SymT SIZE s integer SymT UNBACKED_INT u integer Prefix z here chosen avoid false aliasing symbol_is_type test DO NOT add z type You also need avoid conflicts these prefixes somewhat easier manage SymT FLOAT zf SymT UNBACKED_FLOAT zuf SymT TMP tmp SymT PRECOMPUTED_SIZE ps SymT INDEX i SymT R _INDEX r _ SymT R _INDEX r _ SymT TEMPLATE_INDEX idx SymT XBLOCK x SymT YBLOCK y SymT ZBLOCK z SymT INDIRECT indirect false aliasing SymT VIEW view SymT HALIDE h make_symbol prefix SymT idx int kwargs - sympy Symbol TODO maybe put assumptions here directly sympy Symbol f prefix_str prefix idx kwargs This type little wider than should because free_symbols says contains Basic rather than Symbol symbol_is_type sym sympy Basic prefix Union SymT Iterable SymT - bool isinstance sym sympy Symbol raise AssertionError expected sympy Symbol name_str = sym name lower Match capitalized names like XBLOCK RBLOCK isinstance prefix SymT name_str startswith prefix_str prefix name_str startswith tuple prefix_str p p prefix free_symbol_is_type e sympy Expr prefix Union SymT Iterable SymT - bool any symbol_is_type v prefix v e free_symbols