os pathlib Path subprocess check_call repo_root = Path __file__ absolute parent parent third_party_path = repo_root third_party _read_file path Path - str path open encoding= utf- f f read strip _checkout_by_tag repo str tag str - None check_call git clone -- depth -- branch tag repo cwd=third_party_path read_nccl_pin - str nccl_file = nccl-cu txt os getenv DESIRED_CUDA os getenv CUDA_VERSION startswith nccl_file = nccl-cu txt nccl_pin_path = repo_root ci docker ci_commit_pins nccl_file _read_file nccl_pin_path checkout_nccl - None release_tag = read_nccl_pin print f -- Checkout nccl release tag release_tag nccl_basedir = third_party_path nccl nccl_basedir exists _checkout_by_tag https github com NVIDIA nccl release_tag checkout_eigen - None eigen_tag = _read_file third_party_path eigen_pin txt print f -- Checkout Eigen release tag eigen_tag eigen_basedir = third_party_path eigen eigen_basedir exists _checkout_by_tag https gitlab com libeigen eigen eigen_tag __name__ == __main__ sys len sys argv == If no arguments given checkout all optional dependency checkout_nccl checkout_eigen Otherwise just call top-level function choice globals sys argv