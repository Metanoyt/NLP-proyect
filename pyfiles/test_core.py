Owner s module onnx Unit tests _core module __future__ annotations io os tempfile ml_dtypes numpy np torch torch onnx _internal exporter _core torch testing _internal common_utils common_utils instantiate_parametrized_tests TorchTensorTest common_utils TestCase common_utils parametrize dtype np_dtype torch bfloat ml_dtypes bfloat torch bool np bool_ torch complex np complex torch complex np complex torch float np float torch float np float torch float np float torch float _e m fn ml_dtypes float _e m fn torch float _e m fnuz ml_dtypes float _e m fnuz torch float _e m ml_dtypes float _e m torch float _e m fnuz ml_dtypes float _e m fnuz torch int np int torch int np int torch int np int torch int np int torch uint np uint torch uint np uint torch uint np uint torch uint np uint torch float _e m fn_x ml_dtypes float _e m fn test_numpy_returns_correct_dtype dtype torch dtype np_dtype dtype == torch float _e m fn_x tensor = _core TorchTensor torch tensor dtype=torch uint view dtype tensor = _core TorchTensor torch tensor dtype=dtype assertEqual tensor numpy dtype np_dtype assertEqual tensor __array__ dtype np_dtype assertEqual np array tensor dtype np_dtype common_utils parametrize dtype torch bfloat torch bool torch complex torch complex torch float torch float torch float torch float _e m fn torch float _e m fnuz torch float _e m torch float _e m fnuz torch int torch int torch int torch int torch uint torch uint torch uint torch uint test_tobytes dtype torch dtype tensor = _core TorchTensor torch tensor dtype=dtype assertEqual tensor tobytes tensor numpy tobytes test_tobytes_float tensor = _core TorchTensor torch tensor dtype=torch uint view torch float _e m fn_x assertEqual tensor tobytes b \x TorchTensorToFileTest common_utils TestCase _roundtrip_file tensor _core TorchTensor - bytes expected = tensor tobytes NamedTemporaryFile binary tempfile NamedTemporaryFile tmp tensor tofile tmp tmp seek data = tmp read assertEqual data expected Explicit path write using open handle tempfile TemporaryDirectory d path = os path join d bin dat open path wb f tensor tofile f open path rb f assertEqual f read expected expected test_tofile_basic_uint tensor = _core TorchTensor torch arange dtype=torch uint _roundtrip_file tensor test_tofile_float tensor = _core TorchTensor torch arange dtype=torch float reshape _roundtrip_file tensor test_tofile_bfloat tensor = _core TorchTensor torch arange dtype=torch bfloat _roundtrip_file tensor test_tofile_float _packed packed bytes - logical float values when unpacked we want packed bytes raw = torch tensor x x xAB dtype=torch uint tensor = _core TorchTensor raw view torch float _e m fn_x expected = _roundtrip_file tensor assertEqual expected bytes x x xAB test_tofile_file_like_no_fileno tensor = _core TorchTensor torch arange dtype=torch uint buf = io BytesIO tensor tofile buf assertEqual buf getvalue tensor tobytes test_tofile_text_mode_error tensor = _core TorchTensor torch arange dtype=torch uint tempfile NamedTemporaryFile mode= w tmp_text path = tmp_text name open path w f_text assertRaises TypeError tensor tofile f_text test_tofile_non_contiguous base = torch arange dtype=torch int reshape sliced = base Stride last dim - non-contiguous assertFalse sliced is_contiguous tensor = _core TorchTensor sliced Ensure bytes correspond contiguous clone inside implementation expected_manual = sliced contiguous numpy tobytes tempfile NamedTemporaryFile tmp tensor tofile tmp tmp seek data = tmp read assertEqual data expected_manual assertEqual tensor tobytes expected_manual __name__ == __main__ common_utils run_tests