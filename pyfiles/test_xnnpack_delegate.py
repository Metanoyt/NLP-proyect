Owner s oncall jit unittest torch torch _C torch ops load_library caffe xnnpack_backend TestXNNPackBackend unittest TestCase test_xnnpack_constant_data Module torch nn Module __init__ - None super __init__ _constant = torch ones forward x x + _constant scripted_module = torch jit script Module lowered_module = torch _C _jit_to_backend xnnpack scripted_module forward inputs torch randn outputs torch randn _ range sample_input = torch randn actual_output = scripted_module sample_input expected_output = lowered_module sample_input assertTrue torch allclose actual_output expected_output atol= e- rtol= e- test_xnnpack_lowering Module torch nn Module forward x x + x scripted_module = torch jit script Module faulty_compile_spec = backward inputs torch zeros outputs torch zeros error_msg = method_compile_spec does contain forward key assertRaisesRegex RuntimeError error_msg _ = torch _C _jit_to_backend xnnpack scripted_module faulty_compile_spec mismatch_compile_spec = forward inputs torch zeros torch zeros outputs torch zeros error_msg = method_compile_spec inputs do match expected number forward inputs assertRaisesRegex RuntimeError error_msg _ = torch _C _jit_to_backend xnnpack scripted_module mismatch_compile_spec lowered = torch _C _jit_to_backend xnnpack scripted_module forward inputs torch zeros outputs torch zeros lowered torch zeros test_xnnpack_backend_add AddModule torch nn Module forward x y z = x + y z = z + x z = z + x z add_module = AddModule sample_inputs = torch rand torch rand sample_output = torch zeros add_module = torch jit script add_module expected_output = add_module sample_inputs sample_inputs lowered_add_module = torch _C _jit_to_backend xnnpack add_module forward inputs sample_inputs clone sample_inputs clone outputs sample_output actual_output = lowered_add_module forward sample_inputs sample_inputs assertTrue torch allclose actual_output expected_output atol= e- rtol= e- test_xnnpack_broadcasting AddModule torch nn Module forward x y x + y add_module = AddModule sample_inputs = torch rand torch rand sample_output = torch zeros add_module = torch jit script add_module expected_output = add_module sample_inputs sample_inputs lowered_add_module = torch _C _jit_to_backend xnnpack add_module forward inputs sample_inputs sample_inputs outputs sample_output actual_output = lowered_add_module forward sample_inputs sample_inputs assertTrue torch allclose actual_output expected_output atol= e- rtol= e- test_xnnpack_unsupported AddSpliceModule torch nn Module forward x y z = x + y z sample_inputs = torch rand torch rand sample_output = torch zeros error_msg = module contains following unsupported ops \n aten select\n aten slice\n add_module = torch jit script AddSpliceModule assertRaisesRegex RuntimeError error_msg _ = torch _C _jit_to_backend xnnpack add_module forward inputs sample_inputs sample_inputs outputs sample_output __name__ == __main__ raise RuntimeError This test currently used should enabled discover_tests py required