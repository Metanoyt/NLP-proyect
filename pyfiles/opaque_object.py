typing Any NewType Optional torch fake_class_registry FakeScriptObject register_fake_class register_fake_class aten OpaqueObject FakeOpaqueObject __init__ - None pass classmethod __obj_unflatten__ cls flattened_ctx dict str Any - None raise RuntimeError FakeOpaqueObject should created through __obj_unflatten__ should special handled Please file issue Github OpaqueTypeStr = __torch__ torch classes aten OpaqueObject OpaqueType = NewType OpaqueType torch _C ScriptObject make_opaque payload Any = None - torch _C ScriptObject Creates opaque object which stores given Python object This opaque object can passed any custom operator argument The Python object can then accessed opaque object using ` get_payload ` API The opaque object has ` _type ` __torch__ torch classes aten OpaqueObject which should type used when creating custom operator schemas Args payload Any The Python object store opaque object This can empty can set ` set_payload ` later Returns torch _C ScriptObject The opaque object stores given Python object Example random torch torch _library opaque_object make_opaque get_payload set_payload RNGState __init__ seed rng = random Random seed rng = RNGState obj = make_opaque set_payload obj rng assert get_payload obj == rng lib = torch library Library mylib FRAGMENT torch library define mylib noisy_inject Tensor x __torch__ torch classes aten OpaqueObject obj - Tensor tags=torch Tag pt _compliant_tag lib=lib torch library impl mylib noisy_inject CompositeExplicitAutograd lib=lib noisy_inject x torch Tensor obj torch _C ScriptObject - torch Tensor rng_state = get_payload obj assert isinstance rng_state RNGState out = x clone i range out numel out view - i += rng_state rng random out print torch ops mylib noisy_inject torch ones obj torch _C _make_opaque_object payload get_payload opaque_object torch _C ScriptObject - Any Retrieves Python object stored given opaque object Args torch _C ScriptObject The opaque object stores given Python object Returns payload Any The Python object stored opaque object This can set ` set_payload ` isinstance opaque_object FakeScriptObject raise ValueError get_payload function called FakeScriptObject implying you calling get_payload inside fake kernel The fake kernel should depend contents OpaqueObject all so we re erroring out If you need functionality consider creating custom TorchBind Object instead note more difficult isinstance opaque_object torch _C ScriptObject opaque_object _type qualified_name == OpaqueTypeStr type_ = opaque_object _type qualified_name isinstance opaque_object torch _C ScriptObject type opaque_object raise ValueError f Tried get payload non-OpaqueObject type ` type_ ` torch _C _get_opaque_object_payload opaque_object set_payload opaque_object torch _C ScriptObject payload Any - None Sets Python object stored given opaque object Args torch _C ScriptObject The opaque object stores given Python object payload Any The Python object store opaque object isinstance opaque_object FakeScriptObject raise ValueError set_payload function called FakeScriptObject implying you calling get_payload inside fake kernel The fake kernel should depend contents OpaqueObject all so we re erroring out If you need functionality consider creating custom TorchBind Object instead note more difficult isinstance opaque_object torch _C ScriptObject opaque_object _type qualified_name == OpaqueTypeStr type_ = opaque_object _type qualified_name isinstance opaque_object torch _C ScriptObject type opaque_object raise ValueError f Tried get payload non-OpaqueObject type ` type_ ` torch _C _set_opaque_object_payload opaque_object payload _OPAQUE_TYPES dict Any str = register_opaque_type cls Any name Optional str = None - None Registers given type opaque type which allows consumed custom operator Args cls type The register opaque type name str A unique qualified name type name None name = cls __name__ name The schema_type_parser will break up types periods raise ValueError f Unable accept name name opaque type contains _OPAQUE_TYPES cls = name torch _C _register_opaque_type name is_opaque_type cls Any - bool Checks given type opaque type cls _OPAQUE_TYPES False torch _C _is_opaque_type_registered _OPAQUE_TYPES cls