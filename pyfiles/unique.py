Unique operator implementation typing Optional torchfuzz operators base Operator torchfuzz tensor_fuzzer Spec TensorSpec UniqueOperator Operator Operator finding unique elements tensor __init__ super __init__ unique property torch_op_name - Optional str Return torch operation name torch unique can_produce output_spec Spec - bool Unique can produce D tensor outputs arbitrary length without guards We will synthesize input exactly desired number unique elements so torch unique returns target size deterministically isinstance output_spec TensorSpec len output_spec size == fuzz_inputs_specs output_spec Spec num_inputs int = - list Spec Generate input spec unique operation isinstance output_spec TensorSpec raise ValueError UniqueOperator can only produce TensorSpec outputs Input can any tensor - unique will flatten find unique values input_spec = TensorSpec size= Fixed size consistency stride= Contiguous dtype=output_spec dtype Match output dtype input_spec codegen output_name str input_names list str output_spec Spec - str Generate code unique deterministic target size input no guards len input_names = raise ValueError UniqueOperator requires exactly one input Desired output length target dtype desired_len = output_spec size isinstance output_spec TensorSpec Synthesize wide dtype int guarantee desired_len distinct values apply unique then cast target dtype No conditionals guards f _inp_unique_wide = torch arange desired_len device= input_names device dtype=torch int \n f _uniq_wide = torch unique _inp_unique_wide \n f output_name = _uniq_wide input_names dtype