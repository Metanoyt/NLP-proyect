os sys unittest collections Counter datetime datetime timedelta adding sys path makes monitor script able path tools stats utilization_stats_lib sys path insert os path join os path dirname __file__ tools stats upload_utilization_stats upload_utilization_stats SegmentGenerator tools stats utilization_stats_lib OssCiSegmentV UtilizationRecord datetimes January TEST_DT_BASE = datetime TEST_DT_PLUS_ S = TEST_DT_BASE + timedelta seconds= TEST_DT_PLUS_ S = TEST_DT_BASE + timedelta seconds= TEST_DT_PLUS_ S = TEST_DT_BASE + timedelta seconds= TEST_DT_PLUS_ S = TEST_DT_BASE + timedelta seconds= TEST_DT_PLUS_ S = TEST_DT_BASE + timedelta seconds= timestamps January TEST_TS_BASE = int TEST_DT_BASE timestamp TEST_TS_PLUS_ S = int TEST_DT_PLUS_ S timestamp TEST_TS_PLUS_ S = int TEST_DT_PLUS_ S timestamp TEST_TS_PLUS_ S = int TEST_DT_PLUS_ S timestamp TEST_TS_PLUS_ S = int TEST_DT_PLUS_ S timestamp TEST_TS_PLUS_ S = int TEST_DT_PLUS_ S timestamp test cmd names PYTEST _NAME = python test py PYTEST _NAME = python test py PYPIP_INSTALL_NAME = python pip install install TestSegmentGenerator unittest TestCase test_generate_empty_records - None records list UtilizationRecord = execute generator = SegmentGenerator segments = generator generate records assert assertEqual segments test_generate_single_record - None record = UtilizationRecord timestamp=TEST_TS_BASE cmd_names= PYTEST _NAME level= PYTHON_CMD records = record execute generator = SegmentGenerator segments = generator generate records assert assertEqual len segments test_generate_single_record_with_multiple_cmds - None record = UtilizationRecord timestamp=TEST_TS_BASE cmd_names= PYTEST _NAME PYPIP_INSTALL_NAME level= PYTHON_CMD records = record execute generator = SegmentGenerator segments = generator generate records assert assertEqual len segments test_generate_multiple_records - None records = get_base_test_records execute generator = SegmentGenerator segments = generator generate records assert assertEqual len segments validate_segment segments PYTEST _NAME TEST_TS_BASE TEST_TS_PLUS_ S validate_segment segments PYPIP_INSTALL_NAME TEST_TS_PLUS_ S TEST_TS_PLUS_ S test_generate_cmd_interval_larger_than_default_threshold_setting - None records = get_base_test_records record has more than minute gap than last default record test_gap_dt = TEST_DT_PLUS_ S + timedelta seconds= test_gap_dt = TEST_DT_PLUS_ S + timedelta seconds= record_gap_ = UtilizationRecord timestamp=int test_gap_dt timestamp cmd_names= PYTEST _NAME level= PYTHON_CMD record_gap_ = UtilizationRecord timestamp=int test_gap_dt timestamp cmd_names= PYTEST _NAME level= PYTHON_CMD records += record_gap_ record_gap_ execute generator = SegmentGenerator segments = generator generate records assert counter = Counter seg name seg segments assertEqual counter PYTEST _NAME assertEqual counter PYPIP_INSTALL_NAME assertEqual len segments validate_segment segments PYTEST _NAME TEST_TS_BASE TEST_TS_PLUS_ S validate_segment segments PYTEST _NAME test_gap_dt timestamp test_gap_dt timestamp validate_segment segments PYPIP_INSTALL_NAME TEST_TS_PLUS_ S TEST_TS_PLUS_ S test_generate_multiple_segments_with_customized_threshold - None set threshold consider continuous segment seconds test_threshold = records = get_base_test_records execute generator = SegmentGenerator segments = generator generate records test_threshold assert counter = Counter seg name seg segments assertEqual counter PYTEST _NAME assertEqual counter PYPIP_INSTALL_NAME assertEqual len segments validate_segment segments PYTEST _NAME TEST_TS_BASE TEST_TS_PLUS_ S validate_segment segments PYTEST _NAME TEST_TS_PLUS_ S TEST_TS_PLUS_ S validate_segment segments PYPIP_INSTALL_NAME TEST_TS_PLUS_ S TEST_TS_PLUS_ S validate_segment segment OssCiSegmentV name str start_at float end_at float - None assertEqual segment name name assertEqual segment start_at start_at assertEqual segment end_at end_at get_base_test_records - list UtilizationRecord record = UtilizationRecord timestamp=TEST_TS_BASE cmd_names= PYTEST _NAME level= PYTHON_CMD record = UtilizationRecord timestamp=TEST_TS_PLUS_ S cmd_names= PYTEST _NAME level= PYTHON_CMD record = UtilizationRecord timestamp=TEST_TS_PLUS_ S cmd_names= PYTEST _NAME PYPIP_INSTALL_NAME level= PYTHON_CMD record = UtilizationRecord timestamp=TEST_TS_PLUS_ S cmd_names= PYTEST _NAME PYPIP_INSTALL_NAME level= PYTHON_CMD record = UtilizationRecord timestamp=TEST_TS_PLUS_ S cmd_names= PYTEST _NAME level= PYTHON_CMD record = UtilizationRecord timestamp=TEST_TS_PLUS_ S cmd_names= level= PYTHON_CMD record record record record record record __name__ == __main__ unittest main getTimestampStr timestamp float - str f timestamp f getCurrentTimestampStr - str timestamp_now = datetime now timestamp getTimestampStr timestamp_now