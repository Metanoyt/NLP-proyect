mypy allow-untyped-defs __future__ annotations dataclasses re typing TYPE_CHECKING torch onnx _internal exporter _analysis _registration _verification TYPE_CHECKING os onnxscript ir torch dataclasses dataclass ExportStatus Whether torch export export strict=True succeeds torch_export_strict bool &#124; None = None Whether torch export export strict=False succeeds torch_export_non_strict bool &#124; None = None Whether torch export draft_export succeeds torch_export_draft_export bool &#124; None = None Whether decomposition succeeds decomposition bool &#124; None = None Whether ONNX translation succeeds onnx_translation bool &#124; None = None Whether ONNX model passes onnx checker check_model onnx_checker bool &#124; None = None Whether ONNX model runs successfully ONNX Runtime onnx_runtime bool &#124; None = None Whether output ONNX model accurate output_accuracy bool &#124; None = None _status_emoji status bool &#124; None - str status None ⚪ ✅ status ❌ _format_export_status status ExportStatus - str f ` ` ` \n f _status_emoji status torch_export_non_strict Obtain model graph ` torch export export strict=False ` \n f _status_emoji status torch_export_strict Obtain model graph ` torch export export strict=True ` \n f _status_emoji status torch_export_draft_export Obtain model graph ` torch export draft_export ` \n f _status_emoji status decomposition Decompose operators ONNX compatibility\n f _status_emoji status onnx_translation Translate graph into ONNX\n f _status_emoji status onnx_checker Run ` onnx checker ` ONNX model\n f _status_emoji status onnx_runtime Execute model ONNX Runtime\n f _status_emoji status output_accuracy Validate model output accuracy\n f ` ` ` \n\n _strip_color_from_string text str - str This regular expression matches ANSI escape codes https github com pytorch pytorch blob af c e c c afcf ae torch _dynamo utils py#L -L ansi_escape = re compile r \x B -_ - - -~ ansi_escape sub text _format_exported_program exported_program torch export ExportedProgram - str Adapted https github com pytorch pytorch pull remove colors Even though we can call graph_module print_readable directly since colored option added only recently we can t guarantee version PyTorch used user has option Therefore we still call str ExportedProgram text = f ` ` ` python\n _strip_color_from_string str exported_program \n ` ` ` \n\n text construct_report_file_name timestamp str status ExportStatus - str Status could None So we need check False explicitly status torch_export_non_strict status torch_export_strict status torch_export_draft_export All strategies failed postfix = pt_export status decomposition False postfix = decomp status onnx_translation False postfix = conversion status onnx_checker False postfix = checker status onnx_runtime False postfix = runtime status output_accuracy False postfix = accuracy status torch_export_strict False status torch_export_non_strict False status torch_export_draft_export False Some strategies failed postfix = strategies postfix = success f onnx_export_ timestamp _ postfix md format_decomp_comparison pre_decomp_unique_ops set str post_decomp_unique_ops set str - str Format decomposition comparison result Args unique_ops_in_a The unique ops first program unique_ops_in_b The unique ops second program Returns The formatted comparison result f Ops exist only ExportedProgram before decomposition ` sorted pre_decomp_unique_ops ` \n\n f Ops exist only ExportedProgram after decomposition ` sorted post_decomp_unique_ops ` \n format_verification_infos verification_infos list _verification VerificationInfo - str Format verification result Args verification_infos The verification result Returns The formatted verification result \n join f ` info name ` ` max_abs_diff= info max_abs_diff e ` ` max_rel_diff= info max_rel_diff e ` f ` abs_diff_hist= info abs_diff_hist ` ` rel_diff_hist= info rel_diff_hist ` info verification_infos create_torch_export_error_report filename str &#124; os PathLike formatted_traceback str export_status ExportStatus profile_result str &#124; None open filename w encoding= utf- f f write PyTorch ONNX Conversion Error Report\n\n f write _format_export_status export_status f write Error message \n\n f write ` ` ` pytb\n f write formatted_traceback f write ` ` ` \n\n profile_result None f write ## Profiling result\n\n f write ` ` ` \n f write profile_result f write ` ` ` \n create_onnx_export_report filename str &#124; os PathLike formatted_traceback str program torch export ExportedProgram decomp_comparison str &#124; None = None export_status ExportStatus profile_result str &#124; None model ir Model &#124; None = None registry _registration ONNXRegistry &#124; None = None verification_result str &#124; None = None open filename w encoding= utf- f f write PyTorch ONNX Conversion Report\n\n f write _format_export_status export_status f write ## Error messages\n\n f write ` ` ` pytb\n f write formatted_traceback f write \n ` ` ` \n\n f write ## Exported program\n\n f write _format_exported_program program model None f write ## ONNX model\n\n f write ` ` ` python\n f write str model f write \n ` ` ` \n\n f write ## Analysis\n\n _analysis analyze program file=f registry=registry decomp_comparison None f write \n## Decomposition comparison\n\n f write decomp_comparison f write \n verification_result None f write \n## Verification results\n\n f write verification_result f write \n profile_result None f write \n## Profiling result\n\n f write ` ` ` \n f write profile_result f write ` ` ` \n