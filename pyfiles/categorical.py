mypy allow-untyped-defs typing Optional torch torch nan Tensor torch distributions constraints torch distributions distribution Distribution torch distributions utils lazy_property logits_to_probs probs_to_logits __all__ = Categorical Categorical Distribution r Creates categorical distribution parameterized either attr ` probs ` attr ` logits ` both note It equivalent distribution func ` torch multinomial ` samples Samples integers math ` \ \ldots K- \ ` where ` K ` ` ` probs size - ` ` If ` probs ` -dimensional length- ` K ` each element relative probability sampling index If ` probs ` N-dimensional first N- dimensions treated batch relative probability vectors note The ` probs ` argument must non-negative finite have non-zero sum will normalized sum along last dimension attr ` probs ` will normalized value The ` logits ` argument will interpreted unnormalized log probabilities can therefore any real number It will likewise normalized so resulting probabilities sum along last dimension attr ` logits ` will normalized value See also func ` torch multinomial ` Example xdoctest +IGNORE_WANT non-deterministic m = Categorical torch tensor m sample equal probability tensor Args probs Tensor event probabilities logits Tensor event log probabilities unnormalized pyrefly ignore bad-override arg_constraints = probs constraints simplex logits constraints real_vector has_enumerate_support = True __init__ probs Optional Tensor = None logits Optional Tensor = None validate_args Optional bool = None - None probs None == logits None raise ValueError Either ` probs ` ` logits ` must specified both probs None probs dim raise ValueError ` probs ` parameter must least one-dimensional pyrefly ignore read-only probs = probs probs sum - keepdim=True assert logits None helps mypy logits dim raise ValueError ` logits ` parameter must least one-dimensional Normalize pyrefly ignore read-only logits = logits - logits logsumexp dim=- keepdim=True _param = probs probs None logits _num_events = _param size - batch_shape = _param size - _param ndimension torch Size super __init__ batch_shape validate_args=validate_args expand batch_shape _instance=None new = _get_checked_instance Categorical _instance batch_shape = torch Size batch_shape param_shape = batch_shape + torch Size _num_events probs __dict__ new probs = probs expand param_shape new _param = new probs logits __dict__ new logits = logits expand param_shape new _param = new logits new _num_events = _num_events super Categorical new __init__ batch_shape validate_args=False new _validate_args = _validate_args new _new args kwargs _param new args kwargs constraints dependent_property is_discrete=True event_dim= pyrefly ignore bad-override support constraints integer_interval _num_events - lazy_property logits - Tensor probs_to_logits probs lazy_property probs - Tensor logits_to_probs logits property param_shape - torch Size _param size property mean - Tensor torch full _extended_shape nan dtype=self probs dtype device=self probs device property mode - Tensor probs argmax dim=- property variance - Tensor torch full _extended_shape nan dtype=self probs dtype device=self probs device sample sample_shape=torch Size isinstance sample_shape torch Size sample_shape = torch Size sample_shape probs_ d = probs reshape - _num_events samples_ d = torch multinomial probs_ d sample_shape numel True T samples_ d reshape _extended_shape sample_shape log_prob value _validate_args _validate_sample value value = value long unsqueeze - value log_pmf = torch broadcast_tensors value logits value = value log_pmf gather - value squeeze - entropy min_real = torch finfo logits dtype min logits = torch clamp logits min=min_real p_log_p = logits probs -p_log_p sum - enumerate_support expand=True num_events = _num_events values = torch arange num_events dtype=torch long device=self _param device values = values view - + len _batch_shape expand values = values expand - + _batch_shape values