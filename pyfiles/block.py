__future__ annotations dataclasses dc itertools token enum Enum functools cached_property total_ordering typing Any Optional TYPE_CHECKING typing_extensions Self TYPE_CHECKING collections abc Iterator Sequence tokenize TokenInfo _OVERRIDES = override typing_extensions override typing override total_ordering dc dataclass Block A block Python code starting either ` ` ` ` Category str Enum CLASS = DEF = category Category The sequence tokens contains Block Tokens represented ` Block ` indexes into ` tokens ` tokens Sequence TokenInfo = dc field repr=False The name function being defined name str The index very first token block keyword begin int The index first INDENT token block indent int The index DEDENT token end block dedent int The docstring block docstring str These next members only get filled after all blocks have been constructed figure out family ties The full qualified name block within file This name block all its parents joined ` ` full_name str = The index block within full list blocks file index int = Is block contained within function definition is_local bool = dc field default=False repr=False Is block function definition definition is_method bool = dc field default=False repr=False A block index parent block None top-level block parent Optional int = None A list block indexes children children list int = dc field default_factory=list property start_line - int The line number statement tokens begin start property end_line - int = dedent len tokens tokens dedent start - tokens - start Only happens one case so far file whose last line function dedent correctly pointed one past end tokens property line_count - int end_line - start_line property is_class - bool category == Block Category CLASS property display_name - str A user-friendly name like One One method ending = is_class f category value full_name ending cached_property decorators - list str A list decorators function method Each decorator both symbol any arguments decorator no extra whitespace _get_decorators tokens begin cached_property is_override - bool is_class bool _OVERRIDES intersection decorators DATA_FIELDS = category children decorators display_name docstring full_name index is_local is_method line_count parent start_line as_data - dict str Any d = i getattr i i DATA_FIELDS d category = d category value d property is_init - bool is_class name == __init__ contains b Block - bool start_line b start_line end_line = b end_line __eq__ o object - bool assert isinstance o Block o tokens tokens o index == index __hash__ - int super __hash__ __lt__ o Self - bool assert isinstance o Block o tokens tokens o index index _IGNORE = token COMMENT token DEDENT token INDENT token NL _get_decorators tokens Sequence TokenInfo block_start int - list str decorators - Iterator str rev = reversed range block_start newlines = i i rev tokens i type == token NEWLINE = iter itertools chain newlines - The - accounts very first line file end = next - Like itertools pairwise Python begin i range begin + end t = tokens i t type == token OP t string == useful = t t tokens i end t type _IGNORE yield join s string strip \n s useful break t type _IGNORE A statement means no more decorators end = begin out = list decorators out reverse out