torch torchvision torchvision transforms transforms transforms os torch ao quantization torchvision models quantization resnet resnet torch autograd Variable Setup warnings warnings warnings filterwarnings action= ignore category=DeprecationWarning module=r warnings filterwarnings action= default module=r torch ao quantization Define helper functions APoT PTQ QAT Specify random seed repeatable results _ = torch manual_seed train_batch_size = eval_batch_size = AverageMeter Computes stores average current value __init__ name fmt= f name = name fmt = fmt reset reset val = avg = sum = count = update val n= val = val sum += val n count += n avg = sum count __str__ fmtstr = name val + fmt + avg + fmt + fmtstr format __dict__ accuracy output target topk= Computes accuracy over k top predictions specified values k torch no_grad maxk = max topk batch_size = target size _ pred = output topk maxk True True pred = pred t correct = pred eq target view - expand_as pred res = k topk correct_k = correct k reshape - float sum keepdim=True res append correct_k mul_ batch_size res evaluate model criterion data_loader model eval top = AverageMeter Acc f top = AverageMeter Acc f torch no_grad image target data_loader output = model image loss = criterion output target noqa F acc acc = accuracy output target topk= top update acc image size top update acc image size print top top load_model model_file model = resnet pretrained=False state_dict = torch load model_file model load_state_dict state_dict model cpu model print_size_of_model model isinstance model torch jit RecursiveScriptModule torch jit save model temp p torch jit save torch jit script model temp p print Size MB os path getsize temp p e os remove temp p prepare_data_loaders data_path normalize = transforms Normalize mean= std= dataset = torchvision datasets ImageNet data_path split= train transform=transforms Compose transforms RandomResizedCrop transforms RandomHorizontalFlip transforms ToTensor normalize dataset_test = torchvision datasets ImageNet data_path split= val transform=transforms Compose transforms Resize transforms CenterCrop transforms ToTensor normalize train_sampler = torch utils data RandomSampler dataset test_sampler = torch utils data SequentialSampler dataset_test data_loader = torch utils data DataLoader dataset batch_size=train_batch_size sampler=train_sampler data_loader_test = torch utils data DataLoader dataset_test batch_size=eval_batch_size sampler=test_sampler data_loader data_loader_test training_loop model criterion data_loader optimizer = torch optim Adam model parameters lr= train_loss correct total = model train _ range data target data_loader optimizer zero_grad output = model data loss = criterion output target loss = Variable loss requires_grad=True loss backward optimizer step train_loss += loss item _ predicted = torch max output total += target size correct += predicted == target sum item train_loss correct total