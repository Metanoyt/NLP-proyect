usr bin env python Owner s oncall r p Copyright c Facebook Inc its affiliates All rights reserved This source code licensed under BSD-style license found LICENSE file root directory source tree os shutil tempfile unittest contextlib closing torch distributed launch launch torch distributed elastic utils get_socket_with_port torch testing _internal common_utils skip_but_pass_in_sandcastle_if TEST_WITH_DEV_DBG_ASAN path script os path join os path dirname __file__ script LaunchTest unittest TestCase setUp test_dir = tempfile mkdtemp set sentinel env var parent proc should present child gets asserted ` ` bin test_script py ` ` os environ TEST_SENTINEL_PARENT = FOOBAR tearDown shutil rmtree test_dir skip_but_pass_in_sandcastle_if TEST_WITH_DEV_DBG_ASAN test incompatible dev dbg asan test_launch_without_env nnodes = nproc_per_node = sock = get_socket_with_port closing sock master_port = sock getsockname args = f -- nnodes= nnodes f -- nproc-per-node= nproc_per_node -- monitor-interval= -- start-method=spawn -- master-addr=localhost f -- master-port= master_port -- node-rank= path bin test_script_local_rank py launch main args skip_but_pass_in_sandcastle_if TEST_WITH_DEV_DBG_ASAN test incompatible dev dbg asan test_launch_with_env nnodes = nproc_per_node = world_size = nnodes nproc_per_node sock = get_socket_with_port closing sock master_port = sock getsockname args = f -- nnodes= nnodes f -- nproc-per-node= nproc_per_node -- monitor-interval= -- start-method=spawn -- master-addr=localhost f -- master-port= master_port -- node-rank= -- use-env path bin test_script py f -- touch-file-dir= test_dir launch main args make sure all workers ran each worker touches file its global rank name assertSetEqual str i i range world_size set os listdir test_dir __name__ == __main__ raise RuntimeError This test currently used should enabled discover_tests py required