typing Any unittest main mock TestCase gitutils get_git_remote_name get_git_repo_dir GitRepo test_trymerge mocked_gh_graphql trymerge GitHubPR tryrebase additional_rebase_failure_info rebase_ghstack_onto rebase_onto mocked_rev_parse branch str - str branch MAIN_BRANCH = refs remotes origin main VIABLE_STRICT_BRANCH = refs remotes origin viable strict TestRebase TestCase mock patch trymerge gh_graphql side_effect=mocked_gh_graphql mock patch gitutils GitRepo _run_git mock patch gitutils GitRepo rev_parse side_effect=mocked_rev_parse mock patch tryrebase gh_post_comment test_rebase mocked_post_comment Any mocked_rp Any mocked_run_git Any mocked_gql Any - None Tests rebase successfully pr = GitHubPR pytorch pytorch repo = GitRepo get_git_repo_dir get_git_remote_name rebase_onto pr repo MAIN_BRANCH calls = mock call fetch origin pull head pull head mock call rebase MAIN_BRANCH pull head mock call push -f https github com mingxiaoh pytorch git pull head master mocked_run_git assert_has_calls calls assertIn f Successfully rebased ` master ` onto ` MAIN_BRANCH ` mocked_post_comment call_args mock patch trymerge gh_graphql side_effect=mocked_gh_graphql mock patch gitutils GitRepo _run_git mock patch gitutils GitRepo rev_parse side_effect=mocked_rev_parse mock patch tryrebase gh_post_comment test_rebase_to_stable mocked_post_comment Any mocked_rp Any mocked_run_git Any mocked_gql Any - None Tests rebase viable strict successfully pr = GitHubPR pytorch pytorch repo = GitRepo get_git_repo_dir get_git_remote_name rebase_onto pr repo VIABLE_STRICT_BRANCH False calls = mock call fetch origin pull head pull head mock call rebase VIABLE_STRICT_BRANCH pull head mock call push -f https github com mingxiaoh pytorch git pull head master mocked_run_git assert_has_calls calls assertIn f Successfully rebased ` master ` onto ` VIABLE_STRICT_BRANCH ` mocked_post_comment call_args mock patch trymerge gh_graphql side_effect=mocked_gh_graphql mock patch gitutils GitRepo _run_git return_value= Everything up-to-date mock patch gitutils GitRepo rev_parse side_effect=mocked_rev_parse mock patch tryrebase gh_post_comment test_no_need_to_rebase mocked_post_comment Any mocked_rp Any mocked_run_git Any mocked_gql Any - None Tests branch already up date pr = GitHubPR pytorch pytorch repo = GitRepo get_git_repo_dir get_git_remote_name rebase_onto pr repo MAIN_BRANCH calls = mock call fetch origin pull head pull head mock call rebase MAIN_BRANCH pull head mock call push -f https github com mingxiaoh pytorch git pull head master mocked_run_git assert_has_calls calls assertIn Tried rebase push PR already up date mocked_post_comment call_args assertNotIn Try rebasing against main mocked_post_comment call_args mock patch trymerge gh_graphql side_effect=mocked_gh_graphql mock patch gitutils GitRepo _run_git return_value= Everything up-to-date mock patch gitutils GitRepo rev_parse side_effect=mocked_rev_parse mock patch tryrebase gh_post_comment test_no_need_to_rebase_try_main mocked_post_comment Any mocked_rp Any mocked_run_git Any mocked_gql Any - None Tests branch already up date again viable strict pr = GitHubPR pytorch pytorch repo = GitRepo get_git_repo_dir get_git_remote_name rebase_onto pr repo VIABLE_STRICT_BRANCH assertIn Tried rebase push PR already up date Try rebasing against main mocked_post_comment call_args mock patch trymerge gh_graphql side_effect=mocked_gh_graphql mock patch gitutils GitRepo _run_git mock patch gitutils GitRepo rev_parse side_effect=lambda branch same sha mock patch tryrebase gh_post_comment test_same_sha mocked_post_comment Any mocked_rp Any mocked_run_git Any mocked_gql Any - None Tests rebase results same sha pr = GitHubPR pytorch pytorch repo = GitRepo get_git_repo_dir get_git_remote_name assertRaisesRegex Exception same sha target branch rebase_onto pr repo MAIN_BRANCH assertRaisesRegex Exception same sha target branch rebase_ghstack_onto pr repo MAIN_BRANCH test_additional_rebase_failure_info - None error = Command ` git -C Users csl zzzzzzzz pytorch push -- dry-run -f https github com Lightning-Sandbox pytorch git pull head fix spaces ` returned non-zero exit code \n ` ` ` \n remote Permission Lightning-Sandbox pytorch git denied clee \n fatal unable access https github com Lightning-Sandbox pytorch git The requested URL returned error \n ` ` ` additional_msg = additional_rebase_failure_info Exception error assertTrue This likely because additional_msg __name__ == __main__ main