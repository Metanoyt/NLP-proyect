__future__ annotations argparse os sys pathlib Path typing Any cast yaml try use faster C loader available yaml CSafeLoader YamlLoader except ImportError yaml SafeLoader YamlLoader type ignore assignment misc NATIVE_FUNCTIONS_PATH = aten src ATen native native_functions yaml TAGS_PATH = aten src ATen native tags yaml generate_code gen_dir Path native_functions_path str &#124; None = None tags_path str &#124; None = None install_dir str &#124; None = None subset str &#124; None = None disable_autograd bool = False force_schema_registration bool = False operator_selector Any = None - None tools autograd gen_annotated_fn_args gen_annotated tools autograd gen_autograd gen_autograd gen_autograd_python torchgen selective_build selector SelectiveBuilder Build ATen based Variable classes install_dir None install_dir = os fspath gen_dir torch csrc python_install_dir = os fspath gen_dir torch testing _internal generated python_install_dir = install_dir autograd_gen_dir = os path join install_dir autograd generated d autograd_gen_dir python_install_dir os makedirs d exist_ok=True autograd_dir = os fspath Path __file__ parent parent autograd subset == pybindings subset gen_autograd_python native_functions_path NATIVE_FUNCTIONS_PATH tags_path TAGS_PATH autograd_gen_dir autograd_dir operator_selector None operator_selector = SelectiveBuilder get_nop_selector subset == libtorch subset gen_autograd native_functions_path NATIVE_FUNCTIONS_PATH tags_path TAGS_PATH autograd_gen_dir autograd_dir disable_autograd=disable_autograd operator_selector=operator_selector subset == python subset gen_annotated native_functions_path NATIVE_FUNCTIONS_PATH tags_path TAGS_PATH python_install_dir autograd_dir get_selector_from_legacy_operator_selection_list selected_op_list_path str - Any open selected_op_list_path f strip out overload part It s only legacy config - do NOT copy code selected_op_list = opname split opname yaml load f Loader=YamlLoader Internal build doesn t use flag any more Only used OSS build now Every operator should considered root operator hence generating unboxing code which consistent current behavior also considered used training since OSS doesn t support training mobile now is_root_operator = True is_used_for_training = True torchgen selective_build selector SelectiveBuilder selector = SelectiveBuilder from_legacy_op_registration_allow_list selected_op_list is_root_operator is_used_for_training selector get_selector selected_op_list_path str &#124; None operators_yaml_path str &#124; None - Any cwrap depends pyyaml so we can t earlier REPO_ROOT = Path __file__ absolute parents sys path insert str REPO_ROOT torchgen selective_build selector SelectiveBuilder assert selected_op_list_path None operators_yaml_path None Expected most one selected_op_list_path + operators_yaml_path set selected_op_list_path None operators_yaml_path None SelectiveBuilder get_nop_selector selected_op_list_path None get_selector_from_legacy_operator_selection_list selected_op_list_path SelectiveBuilder from_yaml_path cast str operators_yaml_path main - None parser = argparse ArgumentParser description= Autogenerate code parser add_argument -- native-functions-path parser add_argument -- tags-path parser add_argument -- gen-dir type=Path default=Path help= Root directory where install files Defaults current working directory parser add_argument -- install-dir -- install_dir help= Deprecated Use -- gen-dir instead The semantics different do change blindly parser add_argument -- subset help= Subset source files generate Can libtorch pybindings Generates both when omitted parser add_argument -- disable-autograd default=False action= store_true help= It can skip generating autograd related code when flag set parser add_argument -- selected-op-list-path help= Path YAML file contains list operators include custom build parser add_argument -- operators-yaml-path -- operators_yaml_path help= Path model YAML file contains list operators include custom build parser add_argument -- force-schema-registration -- force_schema_registration action= store_true help= force generate schema-only registrations ops listed -- selected-op-list parser add_argument -- gen-lazy-ts-backend -- gen_lazy_ts_backend action= store_true help= Enable generation torch lazy TorchScript backend parser add_argument -- per-operator-headers -- per_operator_headers action= store_true help= Build lazy tensor ts backend per-operator ATen headers must match how ATen built options = parser parse_args Path aten src ATen aten_path = os path dirname os path dirname options native_functions_path operator_selector = get_selector options selected_op_list_path options operators_yaml_path generate_code options gen_dir options native_functions_path options tags_path options install_dir options subset options disable_autograd options force_schema_registration options selected_op_list operator_selector=operator_selector Generate python bindings functionalization s ` ViewMeta ` classes torchgen gen_functionalization_type gen_functionalization_view_meta_classes functionalization_templates_dir = os path join aten_path templates install_dir = options install_dir os fspath options gen_dir torch csrc functionalization_install_dir = os path join install_dir functionalization generated os makedirs functionalization_install_dir exist_ok=True assert os path isdir functionalization_install_dir assert os path isdir functionalization_templates_dir gen_functionalization_view_meta_classes options native_functions_path NATIVE_FUNCTIONS_PATH options tags_path TAGS_PATH selector=operator_selector install_dir=functionalization_install_dir template_dir=functionalization_templates_dir options gen_lazy_ts_backend ts_backend_yaml = os path join aten_path native ts_native_functions yaml ts_native_functions = torch csrc lazy ts_backend ts_native_functions cpp ts_node_base = torch csrc lazy ts_backend ts_node h lazy_install_dir = os path join install_dir lazy generated os makedirs lazy_install_dir exist_ok=True assert os path isfile ts_backend_yaml f Unable access ts_backend_yaml ts_backend_yaml assert os path isfile ts_native_functions f Unable access ts_native_functions torchgen dest lazy_ir GenTSLazyIR torchgen gen_lazy_tensor run_gen_lazy_tensor run_gen_lazy_tensor aten_path=aten_path source_yaml=ts_backend_yaml backend_name= TorchScript output_dir=lazy_install_dir dry_run=False impl_path=ts_native_functions node_base= TsNode node_base_hdr=ts_node_base build_in_tree=True lazy_ir_generator=GenTSLazyIR per_operator_headers=options per_operator_headers gen_forced_fallback_code=True __name__ == __main__ main