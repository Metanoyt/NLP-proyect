tempfile unittest tools gen_vulkan_spv DEFAULT_ENV SPVGenerator #################### Data testing #################### test_shader = #version core #define FORMAT $ FORMAT #define PRECISION $ PRECISION #define OP X $ OPERATOR $ is_int dtype $ dtype int int int $ is_uint dtype $ dtype uint uint uint $ is_int DTYPE #define VEC _T ivec $ is_uint DTYPE #define VEC _T uvec $ #define VEC _T vec $ INPLACE $ is_int DTYPE layout set = binding = FORMAT uniform PRECISION restrict writeonly iimage D uOutput layout set = binding = uniform PRECISION isampler D uInput $ is_uint DTYPE layout set = binding = FORMAT uniform PRECISION restrict writeonly uimage D uOutput layout set = binding = uniform PRECISION usampler D uInput $ layout set = binding = FORMAT uniform PRECISION restrict writeonly image D uOutput layout set = binding = uniform PRECISION sampler D uInput $ $ is_int DTYPE layout set = binding = FORMAT uniform PRECISION restrict iimage D uOutput $ is_uint DTYPE layout set = binding = FORMAT uniform PRECISION restrict uimage D uOutput $ layout set = binding = FORMAT uniform PRECISION restrict image D uOutput layout local_size_x_id = local_size_y_id = local_size_z_id = void main const ivec pos = ivec gl_GlobalInvocationID $ INPLACE VEC _T v = texelFetch uInput pos $ VEC _T v = imageLoad uOutput pos $ i range ITER int i = i $ ITER ++i v = OP v + i imageStore uOutput pos OP v test_params_yaml = test_shader parameter_names_with_default_values DTYPE float INPLACE false OPERATOR X + ITER python tuple generate_variant_forall INPLACE - VALUE false SUFFIX - VALUE true SUFFIX inplace DTYPE - VALUE int - VALUE float shader_variants - NAME test_shader_ - NAME test_shader_ OPERATOR X - ITER python tuple generate_variant_forall DTYPE - VALUE float - VALUE int ############## Unit Tests ############## TestVulkanSPVCodegen unittest TestCase setUp - None tmpdir = tempfile TemporaryDirectory open f tmpdir name test_shader glsl w f f write test_shader open f tmpdir name test_params yaml w f f write test_params_yaml tmpoutdir = tempfile TemporaryDirectory generator = SPVGenerator src_dir_paths=self tmpdir name env=DEFAULT_ENV glslc_path=None cleanUp - None tmpdir cleanup tmpoutdir cleanup testOutputMap - None Each shader variant will produce variants generated based all possible combinations DTYPE INPLACE parameters test_shader_ has fewer generated variants due custom specified generate_variant_forall field expected_output_shaders = test_shader_ _float test_shader_ _inplace_float test_shader_ _inplace_int test_shader_ _int test_shader_ _float test_shader_ _int actual_output_shaders = set generator output_shader_map keys assertEqual expected_output_shaders actual_output_shaders