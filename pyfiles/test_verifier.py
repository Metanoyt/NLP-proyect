Owner s oncall export unittest torch functorch experimental control_flow torch Tensor torch _dynamo eval_frame is_dynamo_supported torch _export verifier SpecViolationError Verifier torch export export torch export exported_program InputKind InputSpec TensorArgument torch testing _internal common_utils IS_WINDOWS run_tests TestCase unittest skipIf is_dynamo_supported dynamo isn t supported TestVerifier TestCase test_verifier_basic - None Foo torch nn Module forward x torch Tensor y torch Tensor - torch Tensor x + y f = Foo ep = export f torch randn torch randn strict=True verifier = Verifier verifier check ep test_verifier_call_module - None M torch nn Module __init__ - None super __init__ linear = torch nn Linear forward x Tensor - Tensor linear x gm = torch fx symbolic_trace M verifier = Verifier assertRaises SpecViolationError verifier _check_graph_module gm test_verifier_no_functional - None Foo torch nn Module forward x torch Tensor y torch Tensor - torch Tensor x + y f = Foo ep = export f torch randn torch randn strict=True run_decompositions node ep graph nodes node target == torch ops aten add Tensor node target = torch ops aten add_ Tensor verifier = Verifier assertRaises SpecViolationError verifier check ep unittest skipIf IS_WINDOWS Windows supported test test_verifier_higher_order - None Foo torch nn Module forward x torch Tensor y torch Tensor - torch Tensor true_fn x torch Tensor y torch Tensor - torch Tensor x + y false_fn x torch Tensor y torch Tensor - torch Tensor x - y control_flow cond x sum true_fn false_fn x y f = Foo ep = export f torch randn torch randn strict=True verifier = Verifier verifier check ep unittest skipIf IS_WINDOWS Windows supported test test_verifier_nested_invalid_module - None Foo torch nn Module forward x torch Tensor y torch Tensor - torch Tensor true_fn x torch Tensor y torch Tensor - torch Tensor x + y false_fn x torch Tensor y torch Tensor - torch Tensor x - y control_flow cond x sum true_fn false_fn x y f = Foo ep = export f torch randn torch randn strict=True run_decompositions node ep graph_module true_graph_ graph nodes node target == torch ops aten add Tensor node target = torch ops aten add_ Tensor verifier = Verifier assertRaises SpecViolationError verifier check ep test_ep_verifier_basic - None M torch nn Module __init__ - None super __init__ linear = torch nn Linear forward x Tensor - Tensor linear x ep = export M torch randn strict=True ep validate test_ep_verifier_invalid_param - None M torch nn Module __init__ - None super __init__ register_parameter name= param=torch nn Parameter torch randn forward x torch Tensor y torch Tensor - torch Tensor x + y + ep = export M torch randn torch randn strict=True Parameter doesn t exist state dict ep graph_signature input_specs = InputSpec kind=InputKind PARAMETER arg=TensorArgument name= p_a target= bad_param assertRaisesRegex SpecViolationError state dict ep validate Add non-torch nn Parameter parameter state dict ep state_dict bad_param = torch randn assertRaisesRegex SpecViolationError instance torch nn Parameter ep validate test_ep_verifier_invalid_buffer - None M torch nn Module __init__ - None super __init__ = torch tensor forward x torch Tensor y torch Tensor - torch Tensor x + y + ep = export M torch randn torch randn strict=True Buffer doesn t exist state dict ep graph_signature input_specs = InputSpec kind=InputKind BUFFER arg=TensorArgument name= c_a target= bad_buffer persistent=True assertRaisesRegex SpecViolationError state dict ep validate test_ep_verifier_buffer_mutate - None M torch nn Module __init__ - None super __init__ my_parameter = torch nn Parameter torch tensor my_buffer = torch nn Buffer torch tensor my_buffer = torch nn Buffer torch tensor forward x x Use parameter buffers both inputs forward method output = x + my_parameter my_buffer + x my_buffer Mutate one buffers e g increment my_buffer add_ output ep = export M torch tensor torch tensor strict=True ep validate test_ep_verifier_invalid_output - None M torch nn Module __init__ - None super __init__ my_parameter = torch nn Parameter torch tensor my_buffer = torch nn Buffer torch tensor my_buffer = torch nn Buffer torch tensor forward x x Use parameter buffers both inputs forward method output = x + my_parameter my_buffer + x my_buffer Mutate one buffers e g increment my_buffer add_ output ep = export M torch tensor torch tensor strict=True output_node = list ep graph nodes - output_node args = output_node args next iter ep graph nodes assertRaisesRegex SpecViolationError Number output nodes ep validate __name__ == __main__ run_tests