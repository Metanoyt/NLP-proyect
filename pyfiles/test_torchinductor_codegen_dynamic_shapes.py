Owner s module inductor importlib os sys torch torch _inductor compile_fx compile_fx torch _inductor test_case TestCase torch testing _internal common_utils IS_LINUX TEST_WITH_ASAN TEST_WITH_ROCM torch testing _internal inductor_utils _check_has_dynamic_shape GPU_TYPE HAS_CPU HAS_GPU importlib import_module filelock Make helper files test importable pytorch_test_dir = os path dirname os path dirname os path realpath __file__ sys path append pytorch_test_dir inductor test_torchinductor manual=fbcode caffe test inductor test_inductor-library add_test_failures CommonTemplate copy_tests run_and_get_cpp_code run_and_get_triton_code TestFailure inductor test_torchinductor_dynamic_shapes manual make_dynamic_cls test_failures dynamic_shapes_test_failures Checks patterns generated C++ Triton code see s dynamic check_codegen TestCase model example_inputs kwargs=None device torch types Device is_cpp_code bool kwargs = kwargs is_cpp_code False hasattr model model = model device=device copy_fn x preserve strides input device isinstance x torch Tensor x torch empty_strided x size x stride device=device dtype=x dtype copy_ x example_inputs = tuple copy_fn x x example_inputs torch _dynamo reset torch _inductor codecache FxGraphCache clear torch _inductor metrics reset called = False compile_fx_wrapper model_ example_inputs_ nonlocal called called = True compile_fx model_ example_inputs_ run ex kwargs model ex kwargs run = torch compile run backend=compile_fx_wrapper fullgraph=True is_cpp_code _ code = run_and_get_cpp_code run example_inputs kwargs _check_has_dynamic_shape code code = run_and_get_triton_code run example_inputs kwargs assertTrue triton code f Failed find triton kernel\n code assert called Ran graph without calling compile_fx torch _dynamo reset xfail default set is_skip=True skip test_failures = Failed find dynamic loop variable no kernels generated test_fft_real_input_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_fft_real_input_real_output_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_to_device_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_as_strided_on_views_dynamic_shapes TestFailure cpu cuda xpu is_skip=True Failed find dynamic loop variable test_conv d_with_permute_dynamic_shapes TestFailure cpu is_skip=True test_triton_argmin_argmax_transpose_logical_index_dynamic_shapes TestFailure cpu is_skip=True XPU always convert conv d conv d can match expected codegen result test_conv d_depthwise_dynamic_shapes TestFailure xpu is_skip=True test_arange _dynamic_shapes TestFailure cpu test_arange _dynamic_shapes TestFailure cpu test_arange _dynamic_shapes TestFailure cpu test_arange _dynamic_shapes TestFailure cpu test_arange _dynamic_shapes TestFailure cpu test_clamp_type_promotion_dynamic_shapes TestFailure cpu test_conv d_channels_last_dynamic_shapes TestFailure cpu test_conv d_dynamic_shapes TestFailure cpu test_conv d_channels_last_use_block_ptr_False_dynamic_shapes TestFailure cpu test_expand_dynamic_shapes TestFailure cpu test_full_boolean_dynamic_shapes TestFailure cpu test_glu_dynamic_shapes TestFailure cpu test_isinf _dynamic_shapes TestFailure cpu test_linspace _dynamic_shapes TestFailure cpu test_masked_scatter_dynamic_shapes TestFailure cpu test_stack_dynamic_shapes TestFailure cpu test_tensor _dynamic_shapes TestFailure cpu test_tensor _dynamic_shapes TestFailure cpu test_to_device_constant_dynamic_shapes TestFailure cpu test_upsample_nearest d_backward_dynamic_shapes TestFailure cpu test_views _dynamic_shapes TestFailure cpu test_views _dynamic_shapes TestFailure cpu test_zeros_dynamic_shapes TestFailure cpu test_uint_dynamic_shapes TestFailure cpu test_issue _dynamic_shapes TestFailure cpu test_repeat_as_strided_dynamic_shapes TestFailure cpu test_mul_index_expr_dynamic_shapes TestFailure cpu test_flip_cat_dynamic_shapes TestFailure cpu test_pad_single_dynamic_shapes TestFailure cpu test_slice_scatter_dtype_consistency_dynamic_shapes TestFailure cpu mps test_embedding_sparse_dynamic_shapes TestFailure cpu cuda xpu Failed find loop triton kernel test_complex_fallback_dynamic_shapes TestFailure cpu cuda xpu test_adaptive_avg_pool d _dynamic_shapes TestFailure cpu cuda xpu test_adaptive_max_pool d _dynamic_shapes TestFailure cpu cuda xpu test_argmax_to_float_dynamic_shapes TestFailure cpu cuda xpu test_avg_pool d _dynamic_shapes TestFailure cpu cuda xpu test_avg_pool d_backward _dynamic_shapes TestFailure cpu cuda xpu test_avg_pool d_backward _dynamic_shapes TestFailure cpu cuda xpu test_baddbmm_dynamic_shapes TestFailure cpu cuda xpu test_bmm _dynamic_shapes TestFailure cpu cuda xpu test_both_scalars_dynamic_shapes TestFailure cpu cuda xpu test_compar_dynamic_shapes TestFailure cpu test_complex_from_real_imag_dynamic_shapes TestFailure cpu cuda xpu test_const_int _to_float_dynamic_shapes TestFailure cpu cuda xpu test_conv d_backward_channels_last_dynamic_shapes TestFailure cpu test_conv_backward_dynamic_shapes TestFailure cpu cuda xpu test_conv_functional_bn_fuse_dynamic_shapes TestFailure cpu is_skip=True test_convolution _dynamic_shapes TestFailure cpu test_cumprod_zero_dim_dynamic_shapes TestFailure cpu test_cummin_dynamic_shapes TestFailure cpu cuda xpu test_cumsum_dynamic_shapes TestFailure cpu test_cumsum_no_mask_dynamic_shapes TestFailure cpu test_cumsum_zero_dim_dynamic_shapes TestFailure cpu test_div _dynamic_shapes TestFailure cpu cuda xpu test_embedding_bag_dynamic_shapes TestFailure cpu cuda xpu test_empty _dynamic_shapes TestFailure cpu cuda xpu test_empty _dynamic_shapes TestFailure cpu cuda xpu test_empty_strided_dynamic_shapes TestFailure cpu cuda xpu test_bucketize_nd_tiling_False_dynamic_shapes TestFailure cpu test_bucketize_nd_tiling_True_dynamic_shapes TestFailure cpu test_bucketize_default_kwargs_dynamic_shapes TestFailure cpu test_bucketize_int_uint _uint _dynamic_shapes TestFailure cpu test_bucketize_int_int _int _dynamic_shapes TestFailure cpu test_bucketize_int_int _int _dynamic_shapes TestFailure cpu test_bucketize_int_int _int _dynamic_shapes TestFailure cpu test_bucketize_int_int _int _dynamic_shapes TestFailure cpu test_searchsorted_dynamic_shapes TestFailure cpu test_like_rands_dynamic_shapes TestFailure cpu cuda xpu test_like_rands_sliced_dynamic_shapes TestFailure cpu cuda xpu test_linspace _dynamic_shapes TestFailure cpu cuda xpu test_linspace _dynamic_shapes TestFailure cpu cuda xpu test_linspace _dynamic_shapes TestFailure cpu cuda xpu test_logcumsumexp_dynamic_shapes TestFailure cpu test_logcumsumexp_zero_dim_dynamic_shapes TestFailure cpu test_max_pool d_with_indices_backward _dynamic_shapes TestFailure cpu cuda test_max_pool d_with_indices_backward _dynamic_shapes TestFailure cpu cuda xpu test_misaligned_address_issue _dynamic_shapes TestFailure cpu test_mm_views_dynamic_shapes TestFailure cpu cuda xpu test_new_empty_dynamic_shapes TestFailure cpu cuda xpu test_new_empty_strided_dynamic_shapes TestFailure cpu cuda xpu test_new_ones_dynamic_shapes TestFailure cpu test_permute _dynamic_shapes TestFailure cpu cuda xpu test_pointwise_airy_ai_dynamic_shapes TestFailure cuda xpu test_pointwise_digamma_dynamic_shapes TestFailure cuda xpu test_pointwise_gammainc_dynamic_shapes TestFailure cuda xpu test_pointwise_gammaincc_dynamic_shapes TestFailure cuda xpu test_pointwise_i e_dynamic_shapes TestFailure cuda xpu test_pointwise_i e_dynamic_shapes TestFailure cuda xpu test_pointwise_modified_bessel_k _dynamic_shapes TestFailure cuda xpu test_pointwise_modified_bessel_k _dynamic_shapes TestFailure cuda xpu test_pointwise_ndtri_dynamic_shapes TestFailure cuda xpu test_pointwise_polygamma_dynamic_shapes TestFailure cuda xpu test_pointwise_psi_dynamic_shapes TestFailure cuda xpu test_pointwise_scaled_modified_bessel_k _dynamic_shapes TestFailure cuda xpu test_pointwise_scaled_modified_bessel_k _dynamic_shapes TestFailure cuda xpu test_pointwise_spherical_bessel_j _dynamic_shapes TestFailure cuda xpu test_pointwise_zeta_dynamic_shapes TestFailure cuda xpu test_pointwise_chebyshev_polynomial_t_dynamic_shapes TestFailure cuda xpu test_pointwise_chebyshev_polynomial_u_dynamic_shapes TestFailure cuda xpu test_pointwise_chebyshev_polynomial_v_dynamic_shapes TestFailure cuda xpu test_pointwise_chebyshev_polynomial_w_dynamic_shapes TestFailure cuda xpu test_pointwise_shifted_chebyshev_polynomial_t_dynamic_shapes TestFailure cuda xpu test_pointwise_shifted_chebyshev_polynomial_u_dynamic_shapes TestFailure cuda xpu test_pointwise_shifted_chebyshev_polynomial_v_dynamic_shapes TestFailure cuda xpu test_pointwise_shifted_chebyshev_polynomial_w_dynamic_shapes TestFailure cuda xpu test_pointwise_hermite_polynomial_h_dynamic_shapes TestFailure cuda xpu test_pointwise_hermite_polynomial_he_dynamic_shapes TestFailure cuda xpu test_pointwise_laguerre_polynomial_l_dynamic_shapes TestFailure cuda xpu test_pointwise_legendre_polynomial_p_dynamic_shapes TestFailure cuda xpu test_polar_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_add_complex _dynamic_shapes TestFailure cpu is_skip=True test_add_complex _dynamic_shapes TestFailure cpu is_skip=True test_add_complex _dynamic_shapes TestFailure cpu is_skip=True test_randn_generator_dynamic_shapes TestFailure cpu test_randn_like_empty_dynamic_shapes TestFailure cpu cuda xpu test_single_elem_dynamic_shapes TestFailure cpu test_single_elem_indirect_dynamic_shapes TestFailure cpu test_sort_dynamic_shapes TestFailure cpu cuda xpu test_sort_stable_dynamic_shapes TestFailure cpu cuda xpu test_sort_transpose_dynamic_shapes TestFailure cpu cuda xpu test_split_cumsum_dynamic_shapes TestFailure cpu test_split_cumsum_low_prec_dynamic_shapes TestFailure cpu test_split_cumprod_dynamic_shapes TestFailure cpu test_split_cumprod_low_prec_dynamic_shapes TestFailure cpu test_split_dynamic_shapes TestFailure cpu cuda xpu test_topk_dynamic_shapes TestFailure cpu cuda xpu test_unbind_dynamic_shapes TestFailure cpu cuda xpu test_views _dynamic_shapes TestFailure cpu cuda xpu test_view_detach_dynamic_shapes TestFailure cpu cuda xpu test_view_on_aliased_dynamic_shapes TestFailure cpu cuda xpu test_linear_float _dynamic_shapes TestFailure cpu test_adaptive_avg_pool_with_output_size_ _dynamic_shapes TestFailure cpu cuda xpu test_zero_element_mutation_dynamic_shapes TestFailure cpu cuda xpu test_custom_op_ _dynamic_shapes TestFailure cpu cuda xpu test_cat_uint _dynamic_shapes TestFailure cpu cat uint input using aten fallback cpu Tests using common directly calling assertEqual test_arange _dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_cat_inplace_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_cat_of_loops_and_extern_kernel_dynamic_shapes TestFailure cpu cuda xpu is_skip=True need enable CL dynamic shapes test_scaled_dot_product_efficient_attention_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_dropout_deterministic_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_dropout_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_dtype_mismatch_issue_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_forced_buffer_realize_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_tmp_not_defined_issue _dynamic_shapes TestFailure cpu is_skip=True test_gather _dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_inplace_add_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_inplace_mixed_dtype_ops_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_input_mutation _dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_input_mutation _dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_input_mutation _dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_input_mutation _dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_kernel_names_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_lerp_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_linear_buffer_reuse_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_list_clearing_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_dropout_trivial_ _dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_dropout _dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_dropout _dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_masked_fill_promotion_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_min_max_reduction_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_multi_gpu_recompile_on_index_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_output_strides_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_pow _dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_profiler_mark_wrapper_call_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_rand_like_deterministic_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_repeat_interleave_ _dynamic_shapes TestFailure cpu test_slice_mutation _dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_strided_inputs_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_transposed_propagates_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_require_stride_expanded_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_unspec_inputs_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_zero_dim_reductions_dynamic_shapes TestFailure cpu cuda xpu is_skip=True test_sdpa_dynamic_shapes TestFailure cpu is_skip=True test_sdpa_unaligned_mask_dynamic_shapes TestFailure cpu is_skip=True The following tests do support dynamic shapes yet test_cudnn_rnn_dynamic_shapes TestFailure cuda test_roi_align uses torchvision which doesn t work dynamic shapes test_roi_align_dynamic_shapes TestFailure cpu cuda xpu test_aliased_buffer_reuse_dynamic_shapes TestFailure cpu The input case has only elements test_mutations_loop_fusion_dynamic_shapes TestFailure cpu cuda xpu is_skip=True Refinement means we don t actually generate dynamic shapes only cpu apparently test_nonzero_unbacked_refinement_dynamic_shapes TestFailure cpu add_test_failures test_failures dynamic_shapes_test_failures TEST_WITH_ROCM test_failures update test_custom_op_fixed_layout_sequential_dynamic_shapes TestFailure cuda IS_LINUX cpu cuda xpu DynamicShapesCodegenCommonTemplate = make_dynamic_cls CommonTemplate xfail_prop= _expected_failure_codegen_dynamic HAS_CPU DynamicShapesCodegenCpuTests TestCase maxDiff = None device = cpu common TestCase model example_inputs kwargs=None _rest check_codegen self=self model=model example_inputs=example_inputs device=self device kwargs=kwargs is_cpp_code=torch _inductor config cpu_backend == cpp copy_tests DynamicShapesCodegenCommonTemplate DynamicShapesCodegenCpuTests cpu test_failures HAS_GPU TEST_WITH_ASAN DynamicShapesCodegenGPUTests TestCase maxDiff = None device = GPU_TYPE common TestCase model example_inputs kwargs=None _rest check_codegen self=self model=model example_inputs=example_inputs device=self device kwargs=kwargs is_cpp_code=False copy_tests DynamicShapesCodegenCommonTemplate DynamicShapesCodegenGPUTests GPU_TYPE test_failures __name__ == __main__ torch _inductor test_case run_tests HAS_CPU HAS_GPU run_tests needs= filelock