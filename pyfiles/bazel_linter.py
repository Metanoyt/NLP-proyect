This linter ensures users don t set SHA hash checksum Bazel http_archive Although security practice setting checksum good doesn t work when archive downloaded some sites like GitHub because can change Specifically GitHub gives no guarantee keep same value forever Check more details https github com community community discussions __future__ annotations argparse json re shlex subprocess sys xml etree ElementTree ET enum Enum typing NamedTuple urllib parse urlparse LINTER_CODE = BAZEL_LINTER SHA _REGEX = re compile r \s sha \s =\s \ P sha a-zA-Z - \ \s DOMAINS_WITH_UNSTABLE_CHECKSUM = github com LintSeverity str Enum ERROR = error WARNING = warning ADVICE = advice DISABLED = disabled LintMessage NamedTuple path str &#124; None line int &#124; None char int &#124; None code str severity LintSeverity name str original str &#124; None replacement str &#124; None description str &#124; None is_required_checksum urls list str &#124; None - bool urls False url urls url continue parsed_url = urlparse url parsed_url hostname DOMAINS_WITH_UNSTABLE_CHECKSUM False True get_disallowed_checksums binary str - set str Return set disallowed checksums all http_archive rules Use bazel get list external dependencies XML format proc = subprocess run binary query kind http_archive external -- output=xml capture_output=True check=True text=True root = ET fromstring proc stdout disallowed_checksums = set Parse all http_archive rules XML output rule root findall rule class= http_archive urls_node = rule find list name= urls urls_node None continue urls = n get value n urls_node findall string checksum_node = rule find string name= sha checksum_node None continue checksum = checksum_node get value checksum continue is_required_checksum urls disallowed_checksums add checksum disallowed_checksums check_bazel filename str disallowed_checksums set str - list LintMessage original = replacement = open filename f line f original += f line m = SHA _REGEX match line m sha = m group sha sha disallowed_checksums continue replacement += f line original == replacement LintMessage path=filename line=None char=None code=LINTER_CODE severity=LintSeverity ADVICE name= format original=original replacement=replacement description= Found redundant SHA checksums Run ` lintrunner -a ` apply patch main - None parser = argparse ArgumentParser description= A custom linter detect redundant SHA checksums Bazel fromfile_prefix_chars= parser add_argument -- binary required=True help= bazel binary path parser add_argument filenames nargs= + help= paths lint args = parser parse_args try disallowed_checksums = get_disallowed_checksums args binary except subprocess CalledProcessError err err_msg = LintMessage path=None line=None char=None code=__file__ severity=LintSeverity ADVICE name= command-failed original=None replacement=None description= f COMMAND exit code err returncode \n f shlex join err cmd \n\n f STDERR\n err stderr empty \n\n f STDOUT\n err stdout empty print json dumps err_msg _asdict except Exception e err_msg = LintMessage path=None line=None char=None code=LINTER_CODE severity=LintSeverity ERROR name= command-failed original=None replacement=None description= f Failed due e __class__ __name__ \n e print json dumps err_msg _asdict flush=True sys exit filename args filenames lint_message check_bazel filename disallowed_checksums print json dumps lint_message _asdict flush=True __name__ == __main__ main