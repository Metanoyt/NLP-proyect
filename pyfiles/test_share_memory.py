usr bin env python Owner s oncall distributed contextlib copyreg os sys torch torch distributed dist dist is_available print Distributed available skipping tests file=sys stderr sys exit torch distributed rpc rpc torch multiprocessing reductions TorchMpReductions torch multiprocessing torch distributed rpc api _use_rpc_pickler torch distributed rpc internal _InternalRPCPickler torch testing _internal common_utils run_tests TestCase contextlib contextmanager fs_sharing prev_strategy = multiprocessing get_sharing_strategy multiprocessing set_sharing_strategy file_system try yield finally multiprocessing set_sharing_strategy prev_strategy ShareMemoryRPCPickler _InternalRPCPickler __init__ - None super __init__ _dispatch_table pyre-fixme Attribute must annotated _dispatch_table = copyreg dispatch_table copy t torch _storage_classes _dispatch_table t = TorchMpReductions reduce_storage t torch _tensor_classes _dispatch_table t = TorchMpReductions reduce_tensor _dispatch_table torch Tensor = TorchMpReductions reduce_tensor _dispatch_table torch nn parameter Parameter = TorchMpReductions reduce_tensor worker_loop rpc init_rpc worker rank= world_size= rpc shutdown worker_fn m pass TestRPCPickler TestCase test_case os environ MASTER_ADDR = localhost os environ MASTER_PORT = fs_sharing r = multiprocessing spawn worker_loop join=False try _use_rpc_pickler ShareMemoryRPCPickler rpc init_rpc worker rank= world_size= m = torch nn Linear m share_memory rref = rpc remote worker worker_fn args= m rref to_here finally rpc shutdown r join __name__ == __main__ run_tests