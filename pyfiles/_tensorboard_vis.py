mypy allow-untyped-defs time collections defaultdict functools partial torch Unfortunately doesn t seem there any way get TensorBoard do anything without having TF installed so file has hard dependency well It really debugging tool so doesn t matter try tensorflow core framework graph_pb tensorflow core util event_pb tensorflow python summary writer writer FileWriter except ImportError raise ImportError TensorBoard visualization GraphExecutors requires having TensorFlow installed None dump_tensorboard_summary graph_executor logdir FileWriter logdir w pb_graph = visualize graph_executor evt = event_pb Event wall_time=time time graph_def=pb_graph SerializeToString w add_event evt visualize graph name_prefix= pb_graph=None executors_it=None Visualizes independent graph graph executor value_map = pb_graph = pb_graph graph_pb GraphDef isinstance graph torch _C GraphExecutorState visualize_graph_executor graph name_prefix pb_graph partial visualize pb_graph=pb_graph pb_graph Set up input node pb_graph node add op= input name=name_prefix + input i value enumerate graph param_node outputs value_map value unique = name_prefix + input + str i visualize_rec graph value_map name_prefix pb_graph executors_it Gather all outputs return_node = pb_graph node add op= output name=name_prefix + output value graph return_node inputs return_node input append value_map value unique pb_graph visualize_graph_executor state name_prefix pb_graph inline_graph Append state given GraphExecutor graph protobuf Args state GraphExecutor GraphExecutorState GraphExecutor display name_prefix str Name prefix containing subgraph pb_graph GraphDef graph append inline_graph Callable function handles setting up value_map so some graphs here can inlined This necessary because will simply ` visualize ` top-level GraphExecutor ` inline_graph ` all nested ones The signature should look like Graph name_prefix - It will called exactly once The strategy embed all different configurations independent subgraphs while inlining original graph one actually produces values state autograd_fallback_graph None visualize graph=state autograd_fallback_graph name_prefix=name_prefix + autograd_fallback pb_graph=pb_graph executors_it=iter state autograd_fallback executors i arg_spec plan enumerate state execution_plans items subgraph_name = name_prefix + f plan i Create disconnected node will keep information regarding input types trace This unfortunately bit too verbose included subgraph name input_kinds = pb_graph node add op= INPUT_KIND name=subgraph_name input_kinds attr inputs s = repr arg_spec encode ascii visualize plan graph subgraph_name pb_graph iter plan code executors Show gradient independent subgraph plan plan grad_executor None grad_subgraph_name = subgraph_name + grad visualize plan grad_executor grad_subgraph_name pb_graph inline_graph state graph name_prefix + original visualize_rec graph value_map name_prefix pb_graph executors_it=None Recursive part visualize basically skips setting up input output nodes inline_graph subgraph name node rec_value_map = inp unique value_map val unique inp val zip subgraph inputs node inputs visualize_rec graph=subgraph value_map=rec_value_map name_prefix=name pb_graph=pb_graph out val zip subgraph outputs node outputs value_map val unique = rec_value_map out unique op_id_counter defaultdict str int = defaultdict int name_for node kind = node kind node kind index + op_id_counter kind += kind name_prefix + kind + _ + str op_id_counter kind add_fusion_group node op name = name_for node inline_graph node g Subgraph name + node add_graph_executor node op name = name_for node executors_it None add_node node ge = next executors_it visualize_graph_executor ge name + pb_graph partial inline_graph node=node add_node node node kind == prim FusionGroup add_fusion_group node node kind == prim GraphExecutor add_graph_executor node op name = name_for node pb_node = pb_graph node add op=op name=name value node inputs pb_node input append value_map value unique TODO handle attrs i value enumerate node outputs value_map value unique = name + + str i node graph nodes add_node node