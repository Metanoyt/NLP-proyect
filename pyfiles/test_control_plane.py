usr bin env python Owner s oncall distributed json os pickle socket tempfile contextlib contextmanager urllib connection HTTPConnection urllib connectionpool HTTPConnectionPool torch distributed elastic control_plane TORCH_WORKER_SERVER_SOCKET worker_main torch testing _internal common_utils requires_cuda run_tests TestCase UnixHTTPConnection HTTPConnection __init__ socket_path str - None super __init__ localhost socket_path = socket_path connect - None sock = socket socket socket AF_UNIX socket SOCK_STREAM sock connect socket_path UnixHTTPConnectionPool HTTPConnectionPool __init__ socket_path str - None super __init__ localhost socket_path = socket_path _new_conn UnixHTTPConnection socket_path contextmanager local_worker_server - None tempfile TemporaryDirectory tmpdir socket_path = os path join tmpdir socket sock os environ TORCH_WORKER_SERVER_SOCKET = socket_path worker_main pool = UnixHTTPConnectionPool socket_path yield pool WorkerServerTest TestCase test_worker_server - None local_worker_server pool resp = pool request GET assertEqual resp status assertEqual resp data b h torch distributed WorkerServer h \n b href= b handler b Handler names \n resp = pool request POST handler ping assertEqual resp status assertEqual resp data b pong resp = pool request GET handler assertEqual resp status assertIn ping json loads resp data resp = pool request POST handler nonexistent assertEqual resp status assertIn b Handler nonexistent found resp data requires_cuda test_dump_nccl_trace_pickle - None local_worker_server pool resp = pool request POST handler dump_nccl_trace_pickle assertEqual resp status out = pickle loads resp data assertIsInstance out dict assertIn version out requires_cuda test_dump_nccl_trace_pickle_with_params - None local_worker_server pool bad key - lower case resp = pool request POST handler dump_nccl_trace_pickle includeCollectives=true assertEqual resp status unknown key resp = pool request POST handler dump_nccl_trace_pickle unknownkey=true assertEqual resp status bad value - bool resp = pool request POST handler dump_nccl_trace_pickle includecollectives=notabool assertEqual resp status bad value - value lowercase resp = pool request POST handler dump_nccl_trace_pickle includecollectives=True assertEqual resp status good key value resp = pool request POST handler dump_nccl_trace_pickle includecollectives=true assertEqual resp status multiple good keys values resp = pool request POST handler dump_nccl_trace_pickle includecollectives=true includestacktraces=false onlyactive=true assertEqual resp status requires_cuda test_dump_nccl_trace_pickle_with_json - None local_worker_server pool bad key - lower case resp = pool request POST handler dump_nccl_trace_json includeCollectives=true assertEqual resp status unknown key resp = pool request POST handler dump_nccl_trace_json unknownkey=true assertEqual resp status bad value - bool resp = pool request POST handler dump_nccl_trace_json includecollectives=notabool assertEqual resp status bad value - value lowercase resp = pool request POST handler dump_nccl_trace_json includecollectives=True assertEqual resp status good key value resp = pool request POST handler dump_nccl_trace_json includecollectives=true assertEqual resp status multiple good keys values resp = pool request POST handler dump_nccl_trace_json includecollectives=true onlyactive=true assertEqual resp status test_tcp - None requests torch _C _distributed_c d _WorkerServer server = _WorkerServer out = requests get http localhost handler assertEqual out status_code server shutdown test_dump_traceback - None local_worker_server pool resp = pool request POST handler dump_traceback assertEqual resp status assertIn b test_dump_traceback\n resp data test_run_handler - None torch _C _distributed_c d _get_handler _Request _Response handler = _get_handler ping Request _Request __init__ - None _Request __init__ body - bytes b dummy params - dict str str Response _Response __init__ - None _Response __init__ set_content content str content_type str - None content = content content_type = content_type set_status status int - None status = status req = Request resp = Response handler req resp assertEqual resp status assertEqual resp content pong assertEqual resp content_type text plain test_get_handler_nonexistant - None torch _C _distributed_c d _get_handler assertRaisesRegex ValueError Failed find handler nonexistent _get_handler nonexistent test_get_handler_names - None torch _C _distributed_c d _get_handler_names names = _get_handler_names assertIn ping names __name__ == __main__ run_tests