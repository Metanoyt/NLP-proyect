__future__ annotations json os pathlib Path typing Any tools stats import_test_stats ADDITIONAL_CI_FILES_FOLDER TD_HEURISTIC_PREVIOUSLY_FAILED TD_HEURISTIC_PREVIOUSLY_FAILED_ADDITIONAL tools testing target_determination heuristics interface HeuristicInterface TestPrioritizations tools testing target_determination heuristics utils python_test_file_to_test_name tools testing test_run TestRun REPO_ROOT = Path __file__ resolve parents PreviouslyFailedInPR HeuristicInterface __init__ kwargs dict str Any - None super __init__ kwargs get_prediction_confidence tests list str - TestPrioritizations critical_tests = get_previous_failures &#124; read_additional_test_failures_file TestPrioritizations tests TestRun test test critical_tests test tests get_previous_failures - set str path = REPO_ROOT ADDITIONAL_CI_FILES_FOLDER TD_HEURISTIC_PREVIOUSLY_FAILED os path exists path print f could find path path set open path f python_test_file_to_test_name _parse_prev_failing_test_files json load f _parse_prev_failing_test_files last_failed_tests dict str bool - set str prioritized_tests = set The keys formatted test_file py test_class test_method params We just need test_file part test last_failed_tests parts = test split len parts test_file = parts prioritized_tests add test_file prioritized_tests gen_additional_test_failures_file tests list str - None Segfaults usually result no xml some tests don t run through pytest ex doctests In these cases there will no entry pytest cache so we should generate separate file them upload s along pytest cache pytest_cache_dir = REPO_ROOT pytest_cache os path exists pytest_cache_dir os makedirs pytest_cache_dir open pytest_cache_dir TD_HEURISTIC_PREVIOUSLY_FAILED_ADDITIONAL w f json dump tests f indent= read_additional_test_failures_file - set str path = REPO_ROOT ADDITIONAL_CI_FILES_FOLDER TD_HEURISTIC_PREVIOUSLY_FAILED_ADDITIONAL os path exists path print f could find path path set open path f s = set json load f print f additional failures s s