Owner s module dynamo torch torch _dynamo torch _dynamo test_case torch _functorch torch _dynamo precompile_context BackendCacheArtifact PrecompileContext torch _functorch config functorch_config torch _functorch _aot_autograd autograd_cache BundledAOTAutogradCacheArtifact torch _inductor test_case TestCase InductorTestCase torch testing _internal inductor_utils GPU_TYPE requires_triton functorch_config patch enable_autograd_cache True torch _dynamo config patch caching_precompile True Requires bundledaotautograd cache now PrecompileContextTests InductorTestCase setUp Reset all counters caches before each unit test super setUp Clear PrecompileContext cache artifacts PrecompileContext clear requires_triton test_basic Test after torch compile PrecompileContext _new_cache_artifacts length simple_function x x sin + x cos compiled_fn = torch compile simple_function Run compiled function x = torch randn device=GPU_TYPE requires_grad=True result = compiled_fn x result sum backward assertEqual len PrecompileContext _dynamo_cache_entries assertEqual len PrecompileContext _backend_artifacts_by_key cache_entries _ = PrecompileContext create_cache_entries assertEqual len cache_entries requires_triton test_serialize_by_key simple_function x x sin + x cos compiled_fn = torch compile simple_function Run compiled function x = torch randn device=GPU_TYPE requires_grad=True result = compiled_fn x result sum backward assertEqual len PrecompileContext _dynamo_cache_entries assertEqual len PrecompileContext _backend_artifacts_by_key key PrecompileContext _backend_artifacts_by_key keys result = PrecompileContext serialize_artifact_by_key key assert isinstance result BackendCacheArtifact assertEqual result key key This should still work result _ = PrecompileContext create_cache_entries assert len result == requires_triton test_editable Test after torch compile PrecompileContext _new_cache_artifacts length simple_function x x sin + x cos compiled_fn = torch compile simple_function Run compiled function x = torch randn device=GPU_TYPE requires_grad=True result = compiled_fn x result sum backward assertEqual len PrecompileContext _dynamo_cache_entries assertEqual len PrecompileContext _backend_artifacts_by_key Find key artifact type precompile_aot_autograd key = next iter PrecompileContext _backend_artifacts_by_key edit_fn x x _my_private_field = x PrecompileContext edit_artifact key edit_fn result = PrecompileContext serialize_artifact_by_key key assert isinstance result BundledAOTAutogradCacheArtifact assertEqual result key key result _ = PrecompileContext create_cache_entries assert len result == aot_autograd_artifacts = next iter result values backends assert len aot_autograd_artifacts == entry = next iter aot_autograd_artifacts values content assertEqual entry _my_private_field __name__ == __main__ torch _dynamo test_case run_tests run_tests