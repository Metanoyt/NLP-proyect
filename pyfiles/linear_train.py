Copyright c Facebook Inc its affiliates All rights reserved This source code licensed under BSD-style license found LICENSE file root directory source tree time torch torch nn nn functorch make_functional functorch compile nnc_jit torch _C _jit_override_can_fuse_on_cpu True bench f iters= warmup= _ range warmup f begin = time time _ range iters f print time time - begin Foo nn Module __init__ num_layers= features= super __init__ mods = _ range num_layers mods append nn Linear features features bias=False mod = nn Sequential mods forward x mod x sum batch_size = features = num_layers = inp = torch randn batch_size features mod = Foo num_layers features jit_mod = torch jit script mod func_model weights = make_functional mod lr = functional_step x weights weights = weight detach requires_grad_ weight weights out = func_model weights x out backward new_weights = weight - lr weight grad weight weights out new_weights optim = torch optim SGD jit_mod parameters lr=lr momentum= dampening= weight_decay= jit_step x weights optim zero_grad loss = jit_mod x loss backward optim step loss None train train_step weights torch manual_seed train_step inp weights begin = time time itr range loss weights = train_step torch randn batch_size features weights itr == print f Loss itr loss print Time taken time time - begin print grad_pt = functional_step grad_nnc = nnc_jit functional_step print Starting PT training train grad_pt weights print Starting NNC training train grad_nnc weights print Starting JIT training train jit_step None