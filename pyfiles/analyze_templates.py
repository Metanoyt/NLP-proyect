This script uses linear programming analyze outputs triton mm config tuning To generate output can fed into script set env varTORCHINDUCTOR_MM_LOGGING_FILE That file can fed into script generate minimizes total weighted matmul time function allowed templates json click pulp parse_log_file file_path open file_path f logs = json load f occurrence_count = benchmark_logs = Parse logs entry logs invoke entry shape = entry invoke shape occurrence_count occurrence_count shape = occurrence_count shape += shape timings entry items shape benchmark_logs benchmark_logs shape = benchmark_logs shape extend timings occurrence_count benchmark_logs optimize_templates N occurrence_count benchmark_logs verbose=False Set all possible Triton templates keyed their attributes triton_templates = set timings benchmark_logs values timing timings timing type == triton triton_templates add timing BLOCK_M timing BLOCK_N timing BLOCK_K timing num_stages timing num_warps Print initial data verbose print Occurrence Count occurrence_count print Triton Templates triton_templates Create dictionary store template selection variables template_vars = template pulp LpVariable f Template_ template pulp LpBinary template triton_templates Variables select specific timing option each shape selection_vars = shape cublas pulp LpVariable f Select_ shape _cublas pulp LpBinary shape occurrence_count shape occurrence_count template triton_templates selection_vars shape template = pulp LpVariable f Select_ shape _ template pulp LpBinary Variables total time each shape min_time_vars = pulp LpVariable dicts MinTime occurrence_count keys None pulp LpContinuous Define problem prob = pulp LpProblem MatrixMultiplicationOptimization pulp LpMinimize Objective Minimize weighted total time prob += pulp lpSum occurrence_count shape min_time_vars shape shape occurrence_count Constraints select exactly N templates prob += pulp lpSum template_vars template template triton_templates == N Store triton options per shape debugging triton_options_per_shape = Constraints total time each shape shape occurrence_count Get cuBLAS time cublas_times = timing time timing benchmark_logs shape timing type == cublas min_cublas_time = min cublas_times Collect Triton options triton_options = template triton_templates triton_times = timing time timing benchmark_logs shape timing type == triton timing BLOCK_M timing BLOCK_N timing BLOCK_K timing num_stages timing num_warps == template triton_times min_triton_time = min triton_times triton_options append min_triton_time template Save triton options debugging triton_options_per_shape shape = triton_options Ensure exactly one timing option selected each shape prob += pulp lpSum selection_vars shape cublas + selection_vars shape template triton_time template triton_options == Ensure min_time_vars shape matches selected timing option prob += min_time_vars shape == selection_vars shape cublas min_cublas_time + pulp lpSum selection_vars shape template triton_time triton_time template triton_options Ensure Triton templates can only selected they included N allowed templates triton_time template triton_options prob += selection_vars shape template = template_vars template Print constraints verbose print Constraints constraint prob constraints values print constraint Solve problem suppressed output prob solve pulp PULP_CBC_CMD msg=False Output selected templates their configurations selected_templates = template template triton_templates pulp value template_vars template == total_time = sum pulp value min_time_vars shape occurrence_count shape shape occurrence_count Print values decision variables after solving verbose print Decision Variable Values var prob variables print f var name = var varValue Debugging information verbose shape occurrence_count print f Shape shape print f Min Time pulp value min_time_vars shape print f Occurrences occurrence_count shape print f Min CuBLAS Time min_cublas_time Selected pulp value selection_vars shape cublas triton_time template triton_options_per_shape shape print f Triton Template template Time triton_time Selected pulp value selection_vars shape template selected_templates total_time Main code parse log file optimize templates click command click argument filename click option -- min-templates default= help= Minimum number templates click option -- max-templates default= help= Maximum number templates click option -- verbose is_flag=True help= Enable verbose output main filename min_templates max_templates verbose occurrence_count benchmark_logs = parse_log_file filename times = N range min_templates max_templates + selected_templates total_time = optimize_templates N occurrence_count benchmark_logs verbose print f N = N print f Selected Templates selected_templates print f Total Weighted Time total_time times append total_time print times __name__ == __main__ main