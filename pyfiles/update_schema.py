argparse os yaml dump Dumper torch _export serde schema_check __name__ == __main__ parser = argparse ArgumentParser prog= update_schema parser add_argument -- prefix type=str required=True help= The root pytorch directory parser add_argument -- dry-run action= store_true help= Print schema instead writing file parser add_argument -- force-unsafe action= store_true help= Only use option when you chad Force write schema even schema validation doesn t pass args = parser parse_args assert os path exists args prefix f Assuming path args prefix root pytorch directory doesn t exist commit = schema_check update_schema os path exists args prefix + commit yaml_path commit result SCHEMA_VERSION commit base SCHEMA_VERSION raise RuntimeError f Schema version downgraded commit base SCHEMA_VERSION commit result SCHEMA_VERSION commit result TREESPEC_VERSION commit base TREESPEC_VERSION raise RuntimeError f Treespec version downgraded commit base TREESPEC_VERSION commit result TREESPEC_VERSION assert args force_unsafe Existing schema yaml file found please use -- force-unsafe try again next_version reason = schema_check check commit args force_unsafe next_version None next_version = commit result SCHEMA_VERSION raise RuntimeError f Schema version updated commit base SCHEMA_VERSION next_version \n + Please either \n + update schema py break compatibility \n + bump schema version expected value \n + use -- force-unsafe override schema yaml recommended \n + try again \n + f Reason reason first_line = + generated + os path basename __file__ rsplit + py checksum = f checksum commit checksum_next yaml_header = + first_line yaml_header += \n# + checksum yaml_payload = dump commit result Dumper=Dumper sort_keys=False cpp_header = + first_line cpp_header += \n + checksum cpp_header += \n clang-format off cpp_header += \n + commit cpp_header cpp_header += \n clang-format cpp_header += \n yaml_content = yaml_header + \n + yaml_payload thrift_schema = + first_line thrift_schema += f \n checksum commit thrift_checksum_next thrift_schema += \n + commit thrift_schema args dry_run print yaml_content print \nWill write above schema + args prefix + commit yaml_path open os path join args prefix commit yaml_path w f f write yaml_content open os path join args prefix commit cpp_header_path w f f write cpp_header open os path join args prefix commit thrift_schema_path w f f write thrift_schema