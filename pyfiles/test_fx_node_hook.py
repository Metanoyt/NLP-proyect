Owner s module fx torch torch fx symbolic_trace torch testing _internal common_utils TestCase TestFXNodeHook TestCase test_hooks_for_node_update global create_node_hook _called global create_node_hook _called global erase_node_hook _called global erase_node_hook _called global replace_node_hook _called global replace_node_hook _called create_node_hook _called = False create_node_hook _called = False erase_node_hook _called = False erase_node_hook _called = False replace_node_hook _called = False replace_node_hook _called = False fn b c x = torch nn functional linear b x = x + c x cos create_node_hook node global create_node_hook _called create_node_hook _called = True create_node_hook node global create_node_hook _called create_node_hook _called = True erase_node_hook node global erase_node_hook _called erase_node_hook _called = True erase_node_hook node global erase_node_hook _called erase_node_hook _called = True replace_node_hook old new user global replace_node_hook _called assertEqual old name assertEqual new a_ assertEqual user name linear replace_node_hook _called = True replace_node_hook old new user global replace_node_hook _called replace_node_hook _called = True gm = symbolic_trace fn gm _register_create_node_hook create_node_hook gm _register_create_node_hook create_node_hook gm _register_erase_node_hook erase_node_hook gm _register_erase_node_hook erase_node_hook gm _register_replace_node_hook replace_node_hook gm _register_replace_node_hook replace_node_hook graph = gm graph node_a = None node graph find_nodes op= placeholder node_a = node break assert node_a None This will create new node node_a_copy = graph node_copy node_a node_a replace_all_uses_with node_a_copy graph erase_node node_a assert create_node_hook _called create_node_hook _called erase_node_hook _called erase_node_hook _called replace_node_hook _called replace_node_hook _called gm _unregister_create_node_hook create_node_hook gm _unregister_create_node_hook create_node_hook gm _unregister_erase_node_hook erase_node_hook gm _unregister_erase_node_hook erase_node_hook gm _unregister_replace_node_hook replace_node_hook gm _unregister_replace_node_hook replace_node_hook assert gm _create_node_hooks == assert gm _erase_node_hooks == assert gm _replace_hooks == __name__ == __main__ raise RuntimeError This test currently used should enabled discover_tests py required