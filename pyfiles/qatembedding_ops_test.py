numpy pt configs operator_benchmark op_bench torch torch ao nn qat nnqat torch ao quantization default_embedding_qat_qconfig Microbenchmarks QAT Embedding + EmbeddingBag operators QATEmbeddingBagBenchmark op_bench TorchBenchmarkBase init embeddingbags dim mode input_size offset sparse include_last_offset device qconfig = default_embedding_qat_qconfig embedding = nnqat EmbeddingBag num_embeddings=embeddingbags embedding_dim=dim mode=mode include_last_offset=include_last_offset sparse=sparse device=device qconfig=qconfig numpy random seed - offsets = torch LongTensor offset device=device input = torch tensor numpy random randint embeddingbags input_size device=device long inputs = input input offset torch cat offsets torch tensor input size dtype=torch long set_module_name qatEmbeddingBag forward input offset embedding input offset Currently EmbeddingBag QAT does support sparse embeddings embeddingbag_short_dense_configs = config config configs embeddingbag_short_configs sparse True config op_bench generate_pt_test embeddingbag_short_dense_configs QATEmbeddingBagBenchmark op_bench generate_pt_gradient_test embeddingbag_short_dense_configs QATEmbeddingBagBenchmark QATEmbeddingBenchmark op_bench TorchBenchmarkBase init num_embeddings embedding_dim input_size device qconfig = default_embedding_qat_qconfig embedding = nnqat Embedding num_embeddings=num_embeddings embedding_dim=embedding_dim qconfig=qconfig device=device embedding qconfig = default_embedding_qat_qconfig numpy random seed - input = torch tensor numpy random randint num_embeddings input_size device=device long inputs = input input set_module_name qatEmbedding forward input embedding input op_bench generate_pt_test configs embedding_short_configs QATEmbeddingBenchmark op_bench generate_pt_gradient_test configs embedding_short_configs QATEmbeddingBenchmark __name__ == __main__ op_bench benchmark_runner main