Dynamo profiling implementation This module provides profiling functionality Dynamo including - ProfileMetrics Class collecting aggregating performance metrics like execution time operator counts fusion statistics - ProfileResult Class analyzing reporting profiling results - Utilities tracking missed uncaptured operations - Functions instrumenting FX graphs profiling capabilities The profiler helps measure optimize performance Dynamo-compiled code tracking both captured total operations timing graph statistics __future__ annotations dataclasses os typing Any typing_extensions Self torch utils print_once dataclasses dataclass ProfileMetrics microseconds float = operators int = fusions int = graphs int = __iadd__ other Self - Self microseconds += other microseconds operators += other operators fusions += other fusions __add__ other ProfileMetrics - ProfileMetrics assert isinstance other ProfileMetrics ProfileMetrics microseconds + other microseconds operators + other operators fusions + other fusions __truediv__ other Any - ProfileMetrics isinstance other int other = ProfileMetrics other other other ProfileMetrics pyrefly ignore no-matching-overload microseconds max other microseconds pyrefly ignore bad-argument-type operators max other operators pyrefly ignore bad-argument-type fusions max other fusions __str__ - str f operators ops microseconds time tocsv - list float operators microseconds ProfileResult __init__ captured ProfileMetrics total ProfileMetrics unique_graphs int - None captured ProfileMetrics = captured ProfileMetrics total ProfileMetrics = total ProfileMetrics unique_graphs int = unique_graphs __iadd__ other Self - Self captured += other captured total += other total unique_graphs += other unique_graphs percent - ProfileMetrics captured total __str__ - str f unique_graphs graphs captured graphs graph calls f captured operators total operators = + str percent tocsv - list Any unique_graphs captured graphs captured operators total operators + percent tocsv should_print_missing - bool os environ get TORCHDYNAMO_PRINT_MISSING == print_missing stack list str - None any torch autograd profiler py x x stack stack = x x stack built-in x site-packages torch x print_once MISSING join stack - Profiler unique_graphs int = __init__ - None prof = torch profiler profile activities= torch profiler ProfilerActivity CPU with_stack=should_print_missing results - ProfileResult captured_regions = captured_ops = captured_microseconds = total_ops = total_microseconds = last_op_end_time = - captured_region_end_time = - events = sorted prof events key=lambda x x time_range start e events e name == TORCHDYNAMO captured_region_end_time = e time_range end captured_regions += ignore ` handle = torch zeros ` record_function __init__ total_ops -= e time_range start = last_op_end_time last_op_end_time = e time_range end e time_range end = captured_region_end_time captured_ops += captured_microseconds += e time_range elapsed_us should_print_missing print_missing e stack total_ops += total_microseconds += e time_range elapsed_us pass ops recursively called other ops ignored unique_graphs = Profiler unique_graphs Profiler unique_graphs = we counted one extra op part profiler setup code total_ops -= ProfileResult captured=ProfileMetrics microseconds=captured_microseconds operators=captured_ops fusions=captured_ops - captured_regions graphs=captured_regions total=ProfileMetrics microseconds=total_microseconds operators=total_ops fusions=total_ops - unique_graphs=unique_graphs fx_insert_profiling gm torch fx GraphModule example_inputs list Any - Any _wrapped args Any - Any torch profiler record_function TORCHDYNAMO gm forward args Profiler unique_graphs += _wrapped