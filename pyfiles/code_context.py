This module provides thread-safe code context management TorchDynamo using weak references The CodeContextDict maintains mapping between Python code objects their associated context data using weak references automatically clean up entries when code objects garbage collected This prevents memory leaks while allowing context data associated code objects throughout their lifecycle Key features - Thread-safe context storage retrieval - Automatic cleanup using weak references - Safe context management Python code objects - Memory-leak prevention Example usage code_obj = compile x = string exec Store context context = code_context get_context code_obj context metadata = optimized True Retrieve context code_context has_context code_obj ctx = code_context get_context code_obj Use context data Remove context ctx = code_context pop_context code_obj types typing Any utils ExactWeakKeyDictionary CodeContextDict __init__ - None code_context ExactWeakKeyDictionary = ExactWeakKeyDictionary has_context code types CodeType - bool code code_context get_context code types CodeType - dict str Any ctx = code_context get code ctx None ctx = code_context code = ctx ctx pop_context code types CodeType - dict str Any ctx = get_context code code_context _remove_id id code ctx clear - None code_context clear code_context CodeContextDict = CodeContextDict