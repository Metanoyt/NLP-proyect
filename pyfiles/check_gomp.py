ctypes os sys pathlib Path get_gomp_thread Retrieves maximum number OpenMP threads after loading ` libgomp so ` library ` libtorch_cpu so ` library It then queries maximum number threads available OpenMP parallel regions using ` omp_get_max_threads ` function Returns int The maximum number OpenMP threads available Notes - The function assumes default path ` libgomp so ` AlmaLinux OS - The path ` libtorch_cpu so ` constructed based Python executable s installation directory - This function specific environments where PyTorch OpenMP used together may require adjustments other setups python_path = Path sys executable resolve python_prefix = python_path parent parent Typically goes Python installation root Get additional ABI flags any may empty string abiflags = getattr sys abiflags Construct Python directory name correctly e g python t python_version = f python sys version_info major sys version_info minor abiflags libtorch_cpu_path = python_prefix lib python_version site-packages torch lib libtorch_cpu so use default gomp path AlmaLinux OS libgomp_path = usr lib libgomp so does exist try Ubuntu path os path exists libgomp_path libgomp_path = f usr lib os uname machine -linux-gnu libgomp so os environ GOMP_CPU_AFFINITY = - libgomp = ctypes CDLL libgomp_path libgomp = ctypes CDLL libtorch_cpu_path libgomp omp_get_max_threads restype = ctypes c_int libgomp omp_get_max_threads argtypes = omp_max_threads = libgomp omp_get_max_threads omp_max_threads main omp_max_threads = get_gomp_thread print f omp_max_threads after loading libgomp so libtorch_cpu so omp_max_threads omp_max_threads == raise RuntimeError omp_max_threads Check whether libgomp so loaded twice __name__ == __main__ main