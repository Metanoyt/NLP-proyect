mypy allow-untyped-defs random collections abc Iterator typing Optional TypeVar torch torch utils data datapipes datapipe IterDataPipe MapDataPipe __all__ = ShufflerIterDataPipe _T_co = TypeVar _T_co covariant=True functional_datapipe shuffle ShufflerIterDataPipe IterDataPipe _T_co r Shuffle input MapDataPipe via its indices functional name ` ` shuffle ` ` When used ` ~torch utils data DataLoader ` methods set up random seed different based attr ` num_workers ` For single-process mode attr ` num_workers == ` random seed set before ` ~torch utils data DataLoader ` main process For multi-process mode attr ` num_worker ` ` ` worker_init_fn ` ` used set up random seed each worker process Args datapipe MapDataPipe being shuffled indices list indices MapDataPipe If provided we assume uses -based indexing Example xdoctest +SKIP torchdata datapipes map SequenceWrapper dp = SequenceWrapper range shuffle_dp = dp shuffle set_seed list shuffle_dp list shuffle_dp Reset seed Shuffler shuffle_dp = shuffle_dp set_seed list shuffle_dp Note Even thought ` ` shuffle ` ` operation takes ` ` MapDataPipe ` ` input would ` ` IterDataPipe ` ` rather than ` ` MapDataPipe ` ` because ` ` MapDataPipe ` ` should non-sensitive order data order sake random reads ` ` IterDataPipe ` ` depends order data during data-processing datapipe MapDataPipe _T_co _enabled bool _seed Optional int _rng random Random __init__ datapipe MapDataPipe _T_co indices Optional list = None - None super __init__ datapipe = datapipe pyrefly ignore bad-argument-type indices = list range len datapipe indices None indices _enabled = True _seed = None _rng = random Random _shuffled_indices list = indices set_shuffle shuffle=True _enabled = shuffle set_seed seed int _seed = seed __iter__ - Iterator _T_co _enabled idx indices yield datapipe idx while _shuffled_indices idx = _shuffled_indices pop yield datapipe idx reset - None _enabled _seed None _seed = int torch empty dtype=torch int random_ item _rng seed _seed _seed = None _shuffled_indices = _rng sample indices len indices __len__ - int pyrefly ignore bad-argument-type len datapipe __getstate__ state = datapipe indices _enabled _seed _rng getstate _shuffled_indices _valid_iterator_id _number_of_samples_yielded IterDataPipe getstate_hook None IterDataPipe getstate_hook state state __setstate__ state datapipe indices _enabled _seed rng_state _shuffled_indices _valid_iterator_id _number_of_samples_yielded = state _rng = random Random _rng setstate rng_state MapDataPipe register_datapipe_as_function shuffle ShufflerIterDataPipe