Owner s module functorch Adapted https github com arogozhnikov einops blob ac c f c e f c f df tests test_parsing py MIT License Copyright c Alex Rogozhnikov Permission hereby granted free charge any person obtaining copy software associated documentation files Software deal Software without restriction including without limitation rights use copy modify merge publish distribute sublicense sell copies Software permit persons whom Software furnished do so subject following conditions The above copyright notice permission notice shall included all copies substantial portions Software THE SOFTWARE IS PROVIDED AS IS WITHOUT WARRANTY OF ANY KIND EXPRESS OR IMPLIED INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM DAMAGES OR OTHER LIABILITY WHETHER IN AN ACTION OF CONTRACT TORT OR OTHERWISE ARISING FROM OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE typing Any unittest mock functorch einops _parsing _ellipsis AnonymousAxis parse_pattern ParsedExpression validate_rearrange_expressions torch testing _internal common_utils run_tests TestCase mock_anonymous_axis_eq AnonymousAxis other object - bool isinstance other AnonymousAxis value == other value TestAnonymousAxis TestCase test_anonymous_axes - None b = AnonymousAxis AnonymousAxis assertNotEqual b mock patch object AnonymousAxis __eq__ mock_anonymous_axis_eq c d = AnonymousAxis AnonymousAxis assertEqual c assertEqual b c assertNotEqual d assertNotEqual b d assertListEqual b c c TestParsedExpression TestCase test_elementary_axis_name - None name b h dx h zz i somelongname Alex camelCase u_n_d_e_r_score unreasonablyLongAxisName assertTrue ParsedExpression check_axis_name name name b _startWithUnderscore endWithUnderscore_ _ _ellipsis assertFalse ParsedExpression check_axis_name name test_invalid_expressions - None double ellipsis should raise error ParsedExpression b c d assertRaises ValueError ParsedExpression b c d assertRaises ValueError ParsedExpression b c d assertRaises ValueError ParsedExpression b c d double missing enclosed parenthesis ParsedExpression b c d assertRaises ValueError ParsedExpression b c d assertRaises ValueError ParsedExpression b c d assertRaises ValueError ParsedExpression b c d assertRaises ValueError ParsedExpression b c d invalid identifiers ParsedExpression camelCase under_scored cApiTaLs \u df assertRaises ValueError ParsedExpression assertRaises ValueError ParsedExpression _pre assertRaises ValueError ParsedExpression pre assertRaises ValueError ParsedExpression pre mock patch object AnonymousAxis __eq__ mock_anonymous_axis_eq test_parse_expression mocks mock MagicMock - None parsed = ParsedExpression b c d assertSetEqual parsed identifiers b c d assertListEqual parsed composition b c d assertFalse parsed has_non_unitary_anonymous_axes assertFalse parsed has_ellipsis parsed = ParsedExpression assertSetEqual parsed identifiers set assertListEqual parsed composition assertFalse parsed has_non_unitary_anonymous_axes assertFalse parsed has_ellipsis parsed = ParsedExpression assertSetEqual parsed identifiers set assertListEqual parsed composition assertFalse parsed has_non_unitary_anonymous_axes assertFalse parsed has_ellipsis parsed = ParsedExpression assertEqual len parsed identifiers assertSetEqual i value isinstance i AnonymousAxis i i parsed identifiers assertListEqual parsed composition AnonymousAxis AnonymousAxis AnonymousAxis assertTrue parsed has_non_unitary_anonymous_axes assertFalse parsed has_ellipsis parsed = ParsedExpression assertEqual len parsed identifiers assertSetEqual i value isinstance i AnonymousAxis i i parsed identifiers assertListEqual parsed composition AnonymousAxis AnonymousAxis parsed = ParsedExpression name name assertEqual len parsed identifiers assertEqual len parsed identifiers - name _ellipsis name assertListEqual parsed composition name _ellipsis AnonymousAxis name AnonymousAxis assertTrue parsed has_non_unitary_anonymous_axes assertTrue parsed has_ellipsis assertFalse parsed has_ellipsis_parenthesized parsed = ParsedExpression name name assertEqual len parsed identifiers assertEqual len parsed identifiers - name _ellipsis name assertListEqual parsed composition name _ellipsis AnonymousAxis name AnonymousAxis assertTrue parsed has_non_unitary_anonymous_axes assertTrue parsed has_ellipsis assertTrue parsed has_ellipsis_parenthesized TestParsingUtils TestCase test_parse_pattern_number_of_arrows - None axes_lengths dict str int = too_many_arrows_pattern = - b - c - d assertRaises ValueError parse_pattern too_many_arrows_pattern axes_lengths too_few_arrows_pattern = assertRaises ValueError parse_pattern too_few_arrows_pattern axes_lengths just_right_arrows = - parse_pattern just_right_arrows axes_lengths test_ellipsis_invalid_identifier - None axes_lengths dict str int = _ellipsis pattern = f _ellipsis - _ellipsis assertRaises ValueError parse_pattern pattern axes_lengths test_ellipsis_matching - None axes_lengths dict str int = pattern = - assertRaises ValueError parse_pattern pattern axes_lengths raising error pattern handled rearrange expression validation pattern = - parse_pattern pattern axes_lengths pattern = - parse_pattern pattern axes_lengths test_left_parenthesized_ellipsis - None axes_lengths dict str int = pattern = - assertRaises ValueError parse_pattern pattern axes_lengths MaliciousRepr __repr__ - str print hello world TestValidateRearrangeExpressions TestCase test_validate_axes_lengths_are_integers - None axes_lengths dict str Any = b c pattern = b c - c b left right = parse_pattern pattern axes_lengths validate_rearrange_expressions left right axes_lengths axes_lengths = b c MaliciousRepr left right = parse_pattern pattern axes_lengths assertRaises TypeError validate_rearrange_expressions left right axes_lengths test_non_unitary_anonymous_axes_raises_error - None axes_lengths dict str int = left_non_unitary_axis = - left right = parse_pattern left_non_unitary_axis axes_lengths assertRaises ValueError validate_rearrange_expressions left right axes_lengths right_non_unitary_axis = - left right = parse_pattern right_non_unitary_axis axes_lengths assertRaises ValueError validate_rearrange_expressions left right axes_lengths test_identifier_mismatch - None axes_lengths dict str int = mismatched_identifiers = - b left right = parse_pattern mismatched_identifiers axes_lengths assertRaises ValueError validate_rearrange_expressions left right axes_lengths mismatched_identifiers = b - left right = parse_pattern mismatched_identifiers axes_lengths assertRaises ValueError validate_rearrange_expressions left right axes_lengths test_unexpected_axes_lengths - None axes_lengths dict str int = c pattern = b - b left right = parse_pattern pattern axes_lengths assertRaises ValueError validate_rearrange_expressions left right axes_lengths __name__ == __main__ run_tests