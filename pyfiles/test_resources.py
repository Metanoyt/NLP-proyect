Owner s oncall package deploy io BytesIO sys version_info textwrap dedent unittest skipIf torch package PackageExporter PackageImporter torch testing _internal common_utils run_tests try common PackageTestCase except ImportError Support case where we run file directly common PackageTestCase TestResources PackageTestCase Tests access APIs packaged resources test_resource_reader Test compliance get_resource_reader importlib API buffer = BytesIO PackageExporter buffer pe Layout looks like package &#124; -- one &#124; &#124; -- txt &#124; &#124; -- b txt &#124; &#124; -- c txt &#124; + -- three &#124; &#124; -- d txt &#124; + -- e txt + -- two &#124; -- f txt + -- g txt pe save_text one txt hello pe save_text one b txt hello b pe save_text one c txt hello c pe save_text one three d txt hello d pe save_text one three e txt hello e pe save_text two f txt hello f pe save_text two g txt hello g buffer seek importer = PackageImporter buffer reader_one = importer get_resource_reader one assertRaises FileNotFoundError reader_one resource_path txt assertTrue reader_one is_resource txt assertEqual reader_one open_resource txt getbuffer b hello assertFalse reader_one is_resource three reader_one_contents = list reader_one contents assertSequenceEqual reader_one_contents txt b txt c txt three reader_two = importer get_resource_reader two assertTrue reader_two is_resource f txt assertEqual reader_two open_resource f txt getbuffer b hello f reader_two_contents = list reader_two contents assertSequenceEqual reader_two_contents f txt g txt reader_one_three = importer get_resource_reader one three assertTrue reader_one_three is_resource d txt assertEqual reader_one_three open_resource d txt getbuffer b hello d reader_one_three_contenst = list reader_one_three contents assertSequenceEqual reader_one_three_contenst d txt e txt assertIsNone importer get_resource_reader nonexistent_package skipIf version_info = https github com python cpython issues test_package_resource_access Packaged modules should able use importlib resources API access resources saved package mod_src = dedent \ importlib resources my_cool_resources secret_message importlib resources read_text my_cool_resources sekrit txt buffer = BytesIO PackageExporter buffer pe pe save_source_string foo bar mod_src pe save_text my_cool_resources sekrit txt my sekrit plays buffer seek importer = PackageImporter buffer assertEqual importer import_module foo bar secret_message my sekrit plays test_importer_access buffer = BytesIO PackageExporter buffer he he save_text main main my string he save_binary main main_binary b my string src = dedent \ importlib torch_package_importer resources t = resources load_text main main b = resources load_binary main main_binary he save_source_string main src is_package=True buffer seek hi = PackageImporter buffer m = hi import_module main assertEqual m t my string assertEqual m b b my string test_resource_access_by_path Tests packaged code can used importlib resources path buffer = BytesIO PackageExporter buffer he he save_binary string_module my_string b my string src = dedent \ importlib resources string_module importlib resources path string_module my_string path open path mode= r encoding= utf- f s = f read he save_source_string main src is_package=True buffer seek hi = PackageImporter buffer m = hi import_module main assertEqual m s my string __name__ == __main__ run_tests