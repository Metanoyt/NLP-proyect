Owner s module inductor torch torch _inductor torch _dynamo utils counters torch _inductor test_case run_tests TestCase torch testing _internal inductor_utils GPU_TYPE torch testing _internal triton_utils requires_cuda_and_triton try importing will register fbgemm lowerings inductor deeplearning fbgemm fbgemm_gpu fb inductor_lowerings noqa F has_fbgemm = True except Exception has_fbgemm = False TestSplitCat torch nn Module __init__ - None super __init__ forward x torch Tensor y torch Tensor z torch Tensor cat = torch ops aten cat default x y split = torch ops aten split Tensor cat getitem = split getitem_ = split getitem_ = split getitem_ = split getitem_ = split getitem_ = split getitem_ = split getitem_ = split cat_ = torch ops aten cat default getitem getitem_ getitem_ getitem_ getitem_ getitem_ getitem_ getitem_ cat_ = torch ops aten cat default getitem z torch ops aten cat default cat_ cat_ TestSplitCatSingular torch nn Module __init__ - None super __init__ forward x torch Tensor y torch Tensor z torch Tensor cat = torch ops aten cat default x y split = torch ops aten split Tensor cat getitem = split cat_ = torch ops aten cat default getitem cat_ = torch ops aten cat default getitem z torch ops aten cat default cat_ cat_ TestSplitCatPartial torch nn Module __init__ - None super __init__ forward x torch Tensor x torch Tensor y torch Tensor z torch Tensor split_with_sizes_ = torch ops aten split_with_sizes default x split_with_sizes_ = torch ops aten split_with_sizes default x getitem_ = split_with_sizes_ getitem_ = split_with_sizes_ getitem_ = split_with_sizes_ getitem_ = split_with_sizes_ getitem_ = split_with_sizes_ getitem_ = split_with_sizes_ getitem_ = split_with_sizes_ getitem_ = split_with_sizes_ getitem_ = split_with_sizes_ getitem_ = split_with_sizes_ getitem_ = split_with_sizes_ getitem_ = split_with_sizes_ getitem_ = split_with_sizes_ getitem_ = split_with_sizes_ getitem_ = split_with_sizes_ getitem_ = split_with_sizes_ getitem_ = split_with_sizes_ getitem_ = split_with_sizes_ cat = torch ops aten cat default z getitem_ getitem_ getitem_ getitem_ getitem_ getitem_ getitem_ getitem_ getitem_ y getitem_ getitem_ getitem_ getitem_ getitem_ y getitem_ getitem_ getitem_ getitem_ z cat TestMoveViewAferCat torch nn Module __init__ - None super __init__ forward x torch Tensor split_with_sizes_ = torch ops aten split_with_sizes default x getitem_ = split_with_sizes_ getitem_ = split_with_sizes_ getitem_ = split_with_sizes_ getitem_ = split_with_sizes_ getitem_ = split_with_sizes_ getitem_ = split_with_sizes_ getitem_ = split_with_sizes_ view_ = torch ops aten view default getitem_ view_ = torch ops aten view default getitem_ view_ = torch ops aten view default getitem_ view_ = torch ops aten view default getitem_ view_ = torch ops aten view default getitem_ view_ = torch ops aten view default getitem_ view_ = torch ops aten view default getitem_ clone = torch ops aten clone default view_ cat = torch ops aten cat default view_ view_ view_ view_ view_ view_ view_ cat_ = torch ops aten cat default clone cat torch cat clone cat_ TestSelectCat torch nn Module __init__ - None super __init__ forward x torch Tensor y torch Tensor select = torch ops aten select int x select_ = torch ops aten select int x select_ = torch ops aten select int x select_ = torch ops aten select int x select_ = torch ops aten select int x select_ = torch ops aten select int x cat = torch ops aten cat default select select_ select_ select_ select_ select_ cat = torch ops aten cat default select select_ select_ select_ select_ cat = torch ops aten cat default select select_ select_ select_ = torch ops aten select int y select_ = torch ops aten select int y select_ = torch ops aten select int y select_ = torch ops aten select int y select_ = torch ops aten select int y cat = torch ops aten cat default select_ select_ select_ select_ select_ cat cat cat cat TestSplitCatAten TestCase compare_dict_tensors ref_dict res_dict rtol= e- atol= e- len set ref_dict keys = len set res_dict keys False key ref_dict keys key = _orig_mod + key assert key res_dict f key does exist traced module torch allclose ref_dict key res_dict key rtol=rtol atol=atol False True compare_pred module traced input rtol= e- atol= e- ref = module input res = traced input assertEqual ref res rtol=rtol atol=atol compare_parameters module traced rtol= e- atol= e- ref_params = dict module named_parameters res_params = dict traced named_parameters assertTrue compare_dict_tensors ref_params res_params rtol atol compare_gradients module traced rtol= e- atol= e- ref_grad = key param grad key param module named_parameters res_grad = key param grad key param traced named_parameters assertTrue compare_dict_tensors ref_grad res_grad rtol=rtol atol=atol requires_cuda_and_triton torch _inductor config patch pre_grad_fusion_options= post_grad_fusion_options= normalization_aten_pass split_cat_aten_pass threshold_to_cat test_split_cat_post_grad counters clear inputs = torch randn device=torch device device=GPU_TYPE torch randn device=torch device device=GPU_TYPE torch randn device=torch device device=GPU_TYPE module = TestSplitCat traced = torch compile module ref = module inputs res = traced inputs compare_pred module traced inputs assertEqual counters inductor normalization_aten_pass assertEqual counters inductor split_cat_aten_pass assertEqual ref res rtol= e- atol= e- compare_parameters module traced rtol= e- atol= e- counters clear inputs = torch randn device=torch device device=GPU_TYPE torch randn device=torch device device=GPU_TYPE torch randn device=torch device device=GPU_TYPE torch randn device=torch device device=GPU_TYPE module = TestSplitCatPartial traced = torch compile module ref = module inputs res = traced inputs compare_pred module traced inputs assertEqual counters inductor normalization_aten_pass assertEqual counters inductor split_cat_aten_pass assertEqual ref res rtol= e- atol= e- compare_parameters module traced rtol= e- atol= e- counters clear requires_cuda_and_triton torch _inductor config patch pre_grad_fusion_options= post_grad_fusion_options= normalization_aten_pass split_cat_aten_pass threshold_to_cat test_split_cat_post_grad_singular counters clear inputs = torch randn device=torch device device=GPU_TYPE torch randn device=torch device device=GPU_TYPE torch randn device=torch device device=GPU_TYPE module = TestSplitCatSingular traced = torch compile module ref = module inputs res = traced inputs compare_pred module traced inputs assertEqual counters inductor normalization_aten_pass assertEqual counters inductor split_cat_aten_pass assertEqual ref res rtol= e- atol= e- compare_parameters module traced rtol= e- atol= e- counters clear requires_cuda_and_triton torch _inductor config patch pre_grad_fusion_options= post_grad_fusion_options= normalization_aten_pass select_cat_aten_pass test_select_cat_post_grad counters clear inputs = torch randn device=torch device device=GPU_TYPE torch randn device=torch device device=GPU_TYPE module = TestSelectCat traced = torch compile module ref = module inputs res = traced inputs compare_pred module traced inputs assertEqual counters inductor normalization_aten_pass assertEqual counters inductor select_cat_aten_pass assertEqual ref res rtol= e- atol= e- compare_parameters module traced rtol= e- atol= e- counters clear requires_cuda_and_triton torch _inductor config patch pre_grad_fusion_options= post_grad_fusion_options= normalization_aten_pass move_view_after_cat_aten_pass test_move_view_after_cat_aten counters clear inputs = torch randn device=torch device device=GPU_TYPE module = TestMoveViewAferCat traced = torch compile module ref = module inputs res = traced inputs compare_pred module traced inputs assertEqual counters inductor normalization_aten_pass assertEqual counters inductor move_view_after_cat_aten_pass assertEqual ref res rtol= e- atol= e- compare_parameters module traced rtol= e- atol= e- counters clear TestSplitCatAtenNormalizationPasses TestCase torch _inductor config patch pre_grad_fusion_options= post_grad_fusion_options= normalization_aten_pass test_split_aten_normalization arg_only_size_same x torch ops aten split Tensor x arg_only_size_different x torch ops aten split Tensor x args = torch randn fn expected_split_norm_count arg_only_size_same arg_only_size_different expected = fn args actual = torch compile fn args torch testing assert_close actual expected assertEqual counters inductor normalization_aten_pass expected_split_norm_count msg=f fn counters clear __name__ == __main__ run_tests