Owner s oncall distributed sys itertools product torch torch distributed _shard _shard_tensor sharded_tensor torch distributed _shard sharding_spec EnumerableShardingSpec ShardMetadata torch testing _internal common_distributed requires_nccl skip_if_lt_x_gpu torch testing _internal common_utils run_tests TEST_WITH_DEV_DBG_ASAN torch testing _internal distributed _shard sharded_tensor ShardedTensorTestBase with_comms torch testing _internal distributed _shard sharded_tensor _test_st_common _chunk_sharding_specs_list_for_test TEST_WITH_DEV_DBG_ASAN print Skip dev-asan torch + multiprocessing spawn have known issues file=sys stderr sys exit TestReshard ShardedTensorTestBase _run_sharded_tensor_reshard sharding_spec reshard_spec input_size torch manual_seed local_tensor = torch rand input_size cuda rank st = _shard_tensor local_tensor sharding_spec st_compare = _shard_tensor local_tensor reshard_spec st reshard reshard_spec assertEqual len st local_shards assertEqual len st_compare local_shards st_compare _metadata shards_metadata sort key=lambda metadata metadata placement rank assertEqual st _metadata st_compare _metadata assertEqual st local_tensor st_compare local_tensor assertEqual st local_shards metadata st_compare local_shards metadata with_comms init_rpc=False skip_if_lt_x_gpu requires_nccl test_sharded_tensor_reshard dims = sharding_dim reshard_dim product dims dims specs = _chunk_sharding_specs_list_for_test sharding_dim reshard_dim seed= spec reshard_spec = specs specs _run_sharded_tensor_reshard spec reshard_spec _run_sharded_tensor_reshard spec reshard_spec _run_sharded_tensor_reshard spec reshard_spec _run_sharded_tensor_reshard spec reshard_spec with_comms init_rpc=False skip_if_lt_x_gpu requires_nccl test_sharded_tensor_reshard_errors specs = _chunk_sharding_specs_list_for_test seed= spec reshard_spec = specs specs enumerable_sharding_spec = EnumerableShardingSpec ShardMetadata shard_offsets= shard_sizes= placement= rank cuda ShardMetadata shard_offsets= shard_sizes= placement= rank cuda st = sharded_tensor rand spec assertRaisesRegex NotImplementedError Only ChunkShardingSpec supported reshard st reshard enumerable_sharding_spec st _local_shards = st local_shards st local_shards assertRaisesRegex NotImplementedError Only single local shard supported reshard st reshard reshard_spec __name__ == __main__ run_tests