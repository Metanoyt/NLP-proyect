usr bin env python mypy allow-untyped-defs Copyright c Facebook Inc its affiliates All rights reserved This source code licensed under BSD-style license found LICENSE file root directory source tree logging os time concurrent futures thread ThreadPoolExecutor threading Event typing Callable Optional TextIO TYPE_CHECKING Union TYPE_CHECKING concurrent futures _base Future io TextIOWrapper __all__ = tail_logfile TailLog logger = logging getLogger __name__ tail_logfile header str file str dst TextIO finished Event interval_sec float log_line_filter Optional Callable str bool = None while os path exists file finished is_set time sleep interval_sec open file errors= replace fp while True line = fp readline line log_line_filter log_line_filter line dst write f header line reached EOF finished is_set log line producer finished break log line producer still going wait bit before looping again time sleep interval_sec TailLog Tail given log files The log files do have exist when ` ` start ` ` method called The tail-er will gracefully wait until log files created producer will tail contents log files until ` ` stop ` ` method called warning ` ` TailLog ` ` will wait indefinitely log file created Each log file s line will suffixed header form ` ` name idx ` ` where ` ` name ` ` user-provided ` ` idx ` ` index log file ` ` log_files ` ` mapping ` ` log_line_prefixes ` ` can used override header each log file Usage log_files = tmp _stdout log tmp _stdout log tailer = TailLog trainer log_files sys stdout start actually run trainers produce _stdout log _stdout log run_trainers tailer stop once run_trainers start writing ##_stdout log files tailer will print sys stdout trainer log_line trainer log_line trainer log_line trainer log_line trainer log_line note Due buffering log lines between files may necessarily printed out order You should configure your application s logger suffix each log line proper timestamp __init__ name str log_files dict int str dst Union TextIO str log_line_prefixes Optional dict int str = None interval_sec float = log_line_filter Callable str bool = lambda _ True n = len log_files _threadpool = None n pyrefly ignore bad-assignment _threadpool = ThreadPoolExecutor max_workers=n thread_name_prefix=f __class__ __qualname__ _ name _name = name _dst_file Optional TextIOWrapper = None _dst Optional Union TextIO TextIOWrapper = None isinstance dst str try _dst_file = open dst mode= w errors= replace _dst = _dst_file except Exception logger exception error opening dst file s dst _dst = None _dst_file = None _dst = dst _log_files = log_files _log_line_prefixes = log_line_prefixes _log_line_filter = log_line_filter _finished_events dict int Event = local_rank Event local_rank log_files keys _futs list Future = _interval_sec = interval_sec _stopped = False start - TailLog _threadpool _dst local_rank file _log_files items header = f _name local_rank _log_line_prefixes local_rank _log_line_prefixes header = _log_line_prefixes local_rank _futs append _threadpool submit tail_logfile header=header file=file dst=self _dst finished=self _finished_events local_rank interval_sec=self _interval_sec log_line_filter=self _log_line_filter stop - None finished _finished_events values finished set local_rank f enumerate _futs try f result except Exception e logger exception error log tailor s s s _name local_rank e __class__ __qualname__ _threadpool _threadpool shutdown wait=True _dst_file _dst_file close _stopped = True stopped - bool _stopped