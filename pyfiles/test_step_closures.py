Owner s oncall jit threading Event time sleep torch _lazy torch _lazy ts_backend torch testing _internal common_utils run_tests TestCase torch _lazy ts_backend init ClosuresTest TestCase test_synchronous flag = Event assert flag is_set closure sleep assert flag is_set flag set torch _lazy add_step_closure closure torch _lazy mark_step should get part before closure finished running assert flag is_set test_asynchronous flag = Event assert flag is_set closure sleep assert flag is_set torch _lazy add_step_closure closure run_async=True torch _lazy mark_step should get part complete before closure finished running assert flag is_set flag set test_synchronous_exception flag = Event assert flag is_set try closure flag set raise RuntimeError Simulating exception closure torch _lazy add_step_closure closure torch _lazy mark_step raise AssertionError Should reach here except RuntimeError assert flag is_set Should have caught exception closure test_asynchronous_exception flag = Event assert flag is_set closure flag set raise RuntimeError Simulating exception closure torch _lazy add_step_closure closure run_async=True torch _lazy mark_step flag wait timeout= try closure Should never execute flag clear torch _lazy add_step_closure closure run_async=True torch _lazy mark_step raise AssertionError Should reach here except RuntimeError Should have caught exception closure pass assert flag is_set __name__ == __main__ run_tests