usr bin env python os shutil sys subprocess check_call tempfile TemporaryDirectory auditwheel elfutils elf_file_filter auditwheel lddtree lddtree auditwheel patcher Patchelf auditwheel repair copylib auditwheel wheeltools InWheelCtx replace_tag filename open filename f lines = f read split \\n i line enumerate lines line startswith Tag continue lines i = line replace -linux_ -manylinux _ print f Updated tag line lines i open filename w f f write \\n join lines AlignedPatchelf Patchelf set_soname file_name str new_soname str - None check_call patchelf -- page-size -- set-soname new_soname file_name replace_needed file_name str soname str new_soname str - None check_call patchelf -- page-size -- replace-needed soname new_soname file_name embed_library whl_path lib_soname update_tag=False patcher = AlignedPatchelf out_dir = TemporaryDirectory whl_name = os path basename whl_path tmp_whl_name = os path join out_dir name whl_name InWheelCtx whl_path ctx torchlib_path = os path join ctx _tmpdir name torch lib ctx out_wheel = tmp_whl_name new_lib_path new_lib_soname = None None filename _ elf_file_filter ctx iter_files filename startswith torch lib continue libtree = lddtree filename lib_soname libtree needed continue lib_path = libtree libs lib_soname path lib_path None print f Can t embed lib_soname could found break lib_path startswith torchlib_path continue new_lib_path None new_lib_soname new_lib_path = copylib lib_path torchlib_path patcher patcher replace_needed filename lib_soname new_lib_soname print f Replacing lib_soname new_lib_soname filename update_tag Add manylinux tag filename ctx iter_files os path basename filename = WHEEL continue replace_tag filename shutil move tmp_whl_name whl_path __name__ == __main__ embed_library sys argv libgomp so len sys argv sys argv == -- update-tag