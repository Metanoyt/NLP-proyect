mypy allow-untyped-defs collections defaultdict copy deepcopy typing Any Optional TYPE_CHECKING pytorch_lightning pl type ignore _data_sparstity_utils _attach_model_to_data_sparsifier _get_valid_name _log_sparsified_level TYPE_CHECKING torch PostTrainingDataSparsity pl callbacks Callback Lightning callback enables post-training sparsity This callback aims sparsify model inside lightning module after training Note model copied then sparsified so existing model modified The sparsified model can used comparison can accessed using callback_obj sparsified Args data_sparsifier_class some implemented BaseDataSparsifier The data sparsifier object created when training starts Note Objects should passed here they created once training completes data_sparsifier_args Dict Dictionary args passed data sparsifier Note data_list arg should ignored Hooks implemented on_fit_end copies model attaches sparsifier sparsier step called squashes mask __init__ data_sparsifier_class data_sparsifier_args super __init__ data_sparsifier_class = data_sparsifier_class data_sparsifier_args = data_sparsifier_args data_sparsifier Any = None sparsified Optional torch nn Module = None on_fit_end trainer pl_module - None sparsified = deepcopy pl_module model eval data_sparsifier = data_sparsifier_class data_sparsifier_args _attach_model_to_data_sparsifier sparsified data_sparsifier data_sparsifier step data_sparsifier squash_mask currently squashes params all mask _log_sparsified_level sparsified data_sparsifier TrainingAwareDataSparsity pl callbacks Callback Lightning callback enables in-training sparsity This callback aims sparsify model inside lightning module during training Note model copied then sparsified so existing model modified The sparsified model can used comparison can accessed using callback_obj sparsified Args data_sparsifier_class some implemented BaseDataSparsifier The data sparsifier object created when training starts Note Objects should passed here they created when training starts data_sparsifier_args Dict Dictionary args passed data sparsifier Note data_list arg should ignored data_scheduler_class some implemented BaseDataScheduler The data scheduler created when training starts Note Objects should passed here they created when training starts data_scheduler_args Dict Dictionary args passed data scheduler Note data_sparsifier arg should ignored recipe creates pass sparsifier object into Hooks implemented on_train_start Data sparsifier scheduler objects created Pytorch model attached sparsifier on_train_epoch_start Loads state_dict data sparsifier on_train_epoch_end Copies model attaches sparsifier sparsifier step scheduler step Dump state_dict current sparsifier on_train_end squash mask __init__ data_sparsifier_class data_sparsifier_args data_scheduler_class data_scheduler_args super __init__ data sparsifier objects data_sparsifier_class = data_sparsifier_class data_sparsifier_args = data_sparsifier_args scheduler objects data_scheduler_class = data_scheduler_class data_scheduler_args = data_scheduler_args fields data_sparsifier Any = None data_scheduler Any = None sparsified Optional torch nn Module = None data_sparsifier_state_dict Any = None on_train_start trainer pl_module - None create sparsifier data_sparsifier = data_sparsifier_class data_sparsifier_args sparsified = deepcopy pl_module model _attach_model_to_data_sparsifier sparsified data_sparsifier just populate base_sl scheduler create scheduler args = deepcopy data_scheduler_args args data_sparsifier = data_sparsifier data_scheduler = data_scheduler_class args on_train_epoch_start trainer pl_module data_sparsifier_state_dict None probably first epoch load existing config each data data_sparsifier load_state_dict data_sparsifier_state_dict __create_config_based_on_state pl_module config dict = defaultdict data_sparsifier_state_dict None config name _ pl_module model named_parameters valid_name = _get_valid_name name config valid_name = data_sparsifier data_groups valid_name config on_train_epoch_end trainer pl_module sparsified = deepcopy pl_module model config = __create_config_based_on_state pl_module attach model data sparsifier _attach_model_to_data_sparsifier sparsified data_sparsifier config=config data_sparsifier step data_scheduler step data_sparsifier_state_dict = data_sparsifier state_dict on_train_end trainer pl_module data_sparsifier squash_mask