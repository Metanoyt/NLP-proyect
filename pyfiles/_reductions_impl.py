mypy ignore-errors Implementation reduction operations wrapped into arrays dtypes etc public layer Anything here only deals torch objects e g dtype torch dtype instance etc __future__ annotations functools typing Optional TYPE_CHECKING torch _dtypes_impl _util TYPE_CHECKING _normalizations ArrayLike AxisLike DTypeLike KeepDims NotImplementedType OutArray _deco_axis_expand func Generically handle axis arguments reductions axis always nd arg function so no need have look its signature functools wraps func wrapped axis=None args kwds axis None axis = _util normalize_axis_tuple axis ndim axis == So we insert length-one axis run reduction along We cannot clone would sidestep checks inside function newshape = _util expand_shape shape axis= = reshape newshape axis = func axis args kwds wrapped _atleast_float dtype other_dtype Return dtype real complex floating-point For inputs boolean integer dtypes returns default float dtype inputs complex get converted default complex dtype real floating-point dtypes ` float ` get passed through unchanged dtype None dtype = other_dtype dtype is_floating_point dtype is_complex _dtypes_impl default_dtypes float_dtype dtype _deco_axis_expand count_nonzero ArrayLike axis AxisLike = None keepdims KeepDims = False count_nonzero axis _deco_axis_expand argmax ArrayLike axis AxisLike = None out Optional OutArray = None keepdims KeepDims = False is_complex raise NotImplementedError f argmax dtype= dtype axis = _util allow_only_single_axis axis dtype == torch bool RuntimeError argmax_cpu implemented Bool = torch uint torch argmax axis _deco_axis_expand argmin ArrayLike axis AxisLike = None out Optional OutArray = None keepdims KeepDims = False is_complex raise NotImplementedError f argmin dtype= dtype axis = _util allow_only_single_axis axis dtype == torch bool RuntimeError argmin_cpu implemented Bool = torch uint torch argmin axis _deco_axis_expand any ArrayLike axis AxisLike = None out Optional OutArray = None keepdims KeepDims = False where NotImplementedType = None axis = _util allow_only_single_axis axis axis_kw = axis None dim axis torch any axis_kw _deco_axis_expand all ArrayLike axis AxisLike = None out Optional OutArray = None keepdims KeepDims = False where NotImplementedType = None axis = _util allow_only_single_axis axis axis_kw = axis None dim axis torch all axis_kw _deco_axis_expand amax ArrayLike axis AxisLike = None out Optional OutArray = None keepdims KeepDims = False initial NotImplementedType = None where NotImplementedType = None is_complex raise NotImplementedError f amax dtype= dtype amax axis max = amax _deco_axis_expand amin ArrayLike axis AxisLike = None out Optional OutArray = None keepdims KeepDims = False initial NotImplementedType = None where NotImplementedType = None is_complex raise NotImplementedError f amin dtype= dtype amin axis min = amin _deco_axis_expand ptp ArrayLike axis AxisLike = None out Optional OutArray = None keepdims KeepDims = False amax axis - amin axis _deco_axis_expand sum ArrayLike axis AxisLike = None dtype Optional DTypeLike = None out Optional OutArray = None keepdims KeepDims = False initial NotImplementedType = None where NotImplementedType = None assert dtype None isinstance dtype torch dtype dtype == torch bool dtype = _dtypes_impl default_dtypes int_dtype axis_kw = axis None dim axis sum dtype=dtype axis_kw _deco_axis_expand prod ArrayLike axis AxisLike = None dtype Optional DTypeLike = None out Optional OutArray = None keepdims KeepDims = False initial NotImplementedType = None where NotImplementedType = None axis = _util allow_only_single_axis axis dtype == torch bool dtype = _dtypes_impl default_dtypes int_dtype axis_kw = axis None dim axis prod dtype=dtype axis_kw product = prod _deco_axis_expand mean ArrayLike axis AxisLike = None dtype Optional DTypeLike = None out Optional OutArray = None keepdims KeepDims = False where NotImplementedType = None dtype = _atleast_float dtype dtype axis_kw = axis None dim axis result = mean dtype=dtype axis_kw result _deco_axis_expand std ArrayLike axis AxisLike = None dtype Optional DTypeLike = None out Optional OutArray = None ddof= keepdims KeepDims = False where NotImplementedType = None in_dtype = dtype dtype = _atleast_float dtype dtype tensor = _util cast_if_needed dtype result = tensor std dim=axis correction=ddof _util cast_if_needed result in_dtype _deco_axis_expand var ArrayLike axis AxisLike = None dtype Optional DTypeLike = None out Optional OutArray = None ddof= keepdims KeepDims = False where NotImplementedType = None in_dtype = dtype dtype = _atleast_float dtype dtype tensor = _util cast_if_needed dtype result = tensor var dim=axis correction=ddof _util cast_if_needed result in_dtype cumsum cumprod almost reductions no keepdims axis=None flattens cumsum ArrayLike axis AxisLike = None dtype Optional DTypeLike = None out Optional OutArray = None dtype == torch bool dtype = _dtypes_impl default_dtypes int_dtype dtype None dtype = dtype axis = _util axis_none_flatten axis=axis axis = _util normalize_axis_index axis ndim cumsum axis=axis dtype=dtype cumprod ArrayLike axis AxisLike = None dtype Optional DTypeLike = None out Optional OutArray = None dtype == torch bool dtype = _dtypes_impl default_dtypes int_dtype dtype None dtype = dtype axis = _util axis_none_flatten axis=axis axis = _util normalize_axis_index axis ndim cumprod axis=axis dtype=dtype cumproduct = cumprod average ArrayLike axis=None weights ArrayLike = None returned=False keepdims=False weights None result = mean axis=axis wsum = torch as_tensor numel result numel dtype=result dtype dtype is_floating_point = double axis weights shape = weights shape axis None raise TypeError Axis must specified when shapes weights differ weights ndim = raise TypeError D weights expected when shapes weights differ weights shape = shape axis raise ValueError Length weights compatible specified axis setup weight broadcast along axis weights = torch broadcast_to weights ndim - + weights shape weights = weights swapaxes - axis do work result_dtype = _dtypes_impl result_type_impl weights numerator = sum weights axis dtype=result_dtype wsum = sum weights axis dtype=result_dtype result = numerator wsum We process keepdims manually because decorator does deal variadic returns keepdims result = _util apply_keepdims result axis ndim returned wsum shape = result shape wsum = torch broadcast_to wsum result shape clone result wsum result Not using deco_axis_expand assumes axis second arg quantile ArrayLike q ArrayLike axis AxisLike = None out Optional OutArray = None overwrite_input=False method= linear keepdims KeepDims = False interpolation NotImplementedType = None overwrite_input raise NotImplementedError overwrite_input quantile implemented NumPy documents ` overwrite_input ` MAY modify inputs https numpy org doc stable reference generated numpy percentile html#numpy-percentile Here we choose work out-of-place because why pass dtype is_floating_point dtype = _dtypes_impl default_dtypes float_dtype = dtype edge case torch quantile only supports float float dtype == torch float = torch float axis None = flatten q = q flatten axis = axis = _util normalize_axis_tuple axis ndim FIXME Mario Doesn t np quantile accept tuple torch quantile does accept number If we don t want implement tuple behaviour s deffo low prio change ` normalize_axis_tuple ` into normalize_axis index above axis = _util allow_only_single_axis axis q = _util cast_if_needed q dtype torch quantile q axis=axis interpolation=method percentile ArrayLike q ArrayLike axis AxisLike = None out Optional OutArray = None overwrite_input=False method= linear keepdims KeepDims = False interpolation NotImplementedType = None np percentile float_tensor q dtype int = q float _dtypes_impl python_type_for_torch q dtype int q = q _dtypes_impl default_dtypes float_dtype qq = q quantile qq axis=axis overwrite_input=overwrite_input method=method keepdims=keepdims interpolation=interpolation median ArrayLike axis=None out Optional OutArray = None overwrite_input=False keepdims KeepDims = False quantile torch as_tensor axis=axis overwrite_input=overwrite_input out=out keepdims=keepdims