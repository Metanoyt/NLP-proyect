Nonzero operator implementation typing Optional torch torchfuzz operators base Operator torchfuzz tensor_fuzzer Spec TensorSpec NonzeroOperator Operator Operator finding nonzero elements tensor __init__ super __init__ nonzero property torch_op_name - Optional str Return torch operation name torch nonzero can_produce output_spec Spec - bool Nonzero produces tensor shape n_nonzero n_dims We can deterministically synthesize inputs match any D int output shape k d without data-dependent guards constructing input exactly k non-zero elements d dimensions isinstance output_spec TensorSpec output_spec dtype torch int torch long len output_spec size == fuzz_inputs_specs output_spec Spec num_inputs int = - list Spec Generate input spec nonzero operation The actual values will synthesized codegen achieve target size isinstance output_spec TensorSpec raise ValueError NonzeroOperator can only produce TensorSpec outputs Provide placeholder spec codegen will ignore actual input content synthesize tensor desired nonzero count dimensionality d = output_spec size input_spec = TensorSpec size=tuple d d stride=tuple d d dtype=torch bool input_spec codegen output_name str input_names list str output_spec Spec - str Generate code nonzero using synthesized input match target size No data-dependent conditionals guards Constructs input exactly k = output_spec size non-zero elements d = output_spec size dims then calls torch nonzero len input_names = raise ValueError NonzeroOperator requires exactly one input isinstance output_spec TensorSpec len output_spec size = raise ValueError NonzeroOperator requires D TensorSpec output k = output_spec size d = output_spec size Construct concrete shape literal like k shape_elems = str k + max d - shape_literal = + join shape_elems + d == + d f _x_nz = torch zeros shape_literal dtype=torch bool device= input_names device \n f _x_nz_flat = _x_nz reshape - \n f _x_nz_flat k = True\n f output_name = torch nonzero _x_nz