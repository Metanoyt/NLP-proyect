mypy allow-untyped-defs _warnings os path note implementations copied cpython s code _zip_searchorder defines how we search module Zip archive we first search package __init__ then non-package pyc py entries The pyc entries swapped initzipimport we run optimized mode Also replaced path_sep there _zip_searchorder = __init__ py True py False Replace any occurrences \r\n input string \n This converts DOS Mac line endings Unix line endings _normalize_line_endings source source = source replace b \r\n b \n source = source replace b \r b \n source _resolve_name name package level Resolve relative module name absolute one bits = package rsplit level - len bits level raise ValueError attempted relative beyond top-level package base = bits f base name name base _sanity_check name package level Verify arguments sane isinstance name str raise TypeError f module name must str type name level raise ValueError level must = level isinstance package str raise TypeError __package__ set string package raise ImportError attempted relative no known parent package name level == raise ValueError Empty module name _calc___package__ globals Calculate what __package__ should __package__ guaranteed defined could set None represent its proper value unknown package = globals get __package__ spec = globals get __spec__ package None spec None package = spec parent _warnings warn noqa G f __package__ = __spec__ parent package r = spec parent r noqa G ImportWarning stacklevel= package spec None spec parent _warnings warn noqa G can t resolve package __spec__ __package__ falling back __name__ __path__ ImportWarning stacklevel= package = globals __name__ __path__ globals package = package rpartition package _normalize_path path Normalize path ensuring string If resulting string contains path separators exception raised parent file_name = os path split path parent raise ValueError f path r must only file name file_name