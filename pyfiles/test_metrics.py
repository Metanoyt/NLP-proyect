Owner s module inductor torch torch _inductor config metrics torch _inductor test_case run_tests TestCase torch _inductor utils collect_defined_kernels torch _inductor wrapper_benchmark get_kernel_category_by_source_code torch testing _internal common_device_type largeTensorTest torch testing _internal inductor_utils GPU_TYPE HAS_GPU example_kernel = triton_heuristics reduction size_hints= reduction_hint=ReductionHint INNER filename=__file__ triton_meta= signature in_out_ptr fp in_ptr fp xnumel i rnumel i device device_type GPU_TYPE constants configs AttrsDescriptor divisible_by_ = equal_to_ = inductor_meta= autotune_hints set kernel_name triton_red_fused_add_sum_ mutated_arg_names in_out_ptr no_x_dim False kernel_num_gb triton jit triton_red_fused_add_sum_ in_out_ptr in_ptr xnumel rnumel XBLOCK tl constexpr RBLOCK tl constexpr xnumel = rnumel = xoffset = tl program_id XBLOCK xindex = xoffset + tl arange XBLOCK None xmask = xindex xnumel rbase = tl arange RBLOCK None x = xindex _tmp = tl full XBLOCK RBLOCK tl float roffset range rnumel RBLOCK rindex = roffset + rbase rmask = rindex rnumel r = rindex tmp = tl load in_ptr + r + x rmask xmask eviction_policy= evict_first other= tmp = tl broadcast_to tmp XBLOCK RBLOCK tmp = _tmp + tmp _tmp = tl where rmask xmask tmp _tmp tmp = tl sum _tmp None tmp = tl load in_out_ptr + x xmask eviction_policy= evict_last tmp = tmp + tmp tl debug_barrier tl store in_out_ptr + x tmp xmask replace GPU_TYPE GPU_TYPE TestMetrics TestCase test_parse_proper_kernel_fn_code proper_kernel_fn_code = metrics _parse_proper_kernel_fn_code example_kernel assert proper_kernel_fn_code startswith test_count_args proper_kernel_fn_code = metrics _parse_proper_kernel_fn_code example_kernel assertEqual metrics _count_args proper_kernel_fn_code test_count_pattern proper_kernel_fn_code = metrics _parse_proper_kernel_fn_code example_kernel assertEqual metrics _count_pattern proper_kernel_fn_code tl load assertEqual metrics _count_pattern proper_kernel_fn_code tl store assertEqual metrics _count_pattern proper_kernel_fn_code test_parse_reduction_hint kernel_category = get_kernel_category_by_source_code example_kernel assertEqual reduction kernel_category assertEqual INNER metrics _parse_reduction_hint kernel_category example_kernel config patch fx_graph_remote_cache False test_atomic_add torch compile f lhs index rhs lhs index_put_ index rhs accumulate=True lhs = torch randn device=GPU_TYPE index = torch randint device=GPU_TYPE dtype=torch int rhs = torch randn device=GPU_TYPE kernel_list = collect_defined_kernels kernel_list f lhs index rhs assertEqual len kernel_list kernel_code = kernel_list assertEqual metrics _count_pattern kernel_code tl atomic_add largeTensorTest e device=GPU_TYPE inductor=True config patch fx_graph_remote_cache False config patch benchmark_kernel True test_kernel_args_num_gb torch compile f x x + x = torch randn int e device=GPU_TYPE kernel_list = collect_defined_kernels kernel_list f x assertEqual len kernel_list kernel_code = kernel_list assertEqual metrics _parse_kernel_args_num_gb kernel_code pointwise __name__ == __main__ HAS_GPU run_tests