mypy allow-untyped-defs typing Optional Union torch _remote_device Represents device remote worker Args remote_device str torch device Represents device remote worker The string format should one following workername device where device field can parsed torch device type E g trainer cpu trainer ps cuda In addition device field can optional default value cpu rank rank device where rank rank process device can parsed torch device type E g rank cpu rank rank cuda workername rank optional formats like cpu cuda just represent local devices __init__ remote_device Union str torch device PARSE_ERROR = f Could parse remote_device remote_device The valid format workername device rank rank device device _worker_name = None _rank = None _device Optional Union str int torch device = None isinstance remote_device torch device _device = remote_device isinstance remote_device str fields = remote_device split len fields == pyrefly ignore bad-assignment _worker_name _device = fields len fields == Check valid device _remote_device _is_valid_local_device fields _device = fields pyrefly ignore bad-assignment _worker_name = fields _device = cpu raise ValueError PARSE_ERROR raise TypeError f Invalid type remote_device type remote_device Do some basic sanity check no empty string _worker_name None _worker_name raise ValueError PARSE_ERROR Validate device _device = torch device _device Check rank based format _worker_name None fields = _worker_name split len fields == rank rank device format extract rank fields == rank fields isdigit _rank = int fields type ignore assignment pyrefly ignore bad-assignment _worker_name = None raise ValueError PARSE_ERROR len fields raise ValueError PARSE_ERROR staticmethod _is_valid_local_device device Check torch device try torch device device True except Exception False worker_name - Optional str Return name remote worker representing remote device ` ` None ` ` no worker name available _worker_name rank - Optional int Returns rank remote worker representing remote device Returns ` ` None ` ` no rank available _rank device - torch device Return local device remote worker _device type ignore return-value __repr__ _device None _worker_name None f _worker_name _device _rank None f rank _rank _device str _device _worker_name None f _worker_name _rank None f _rank raise RuntimeError Invalid state __eq__ other isinstance other _remote_device _worker_name == other _worker_name _device == other _device _rank == other _rank __hash__ hash _worker_name ^ hash _device ^ hash _rank