usr bin env python Owner s oncall distributed Copyright c Facebook Inc its affiliates All rights reserved This source code licensed under BSD-style license found LICENSE file root directory source tree os unittest argparse ArgumentParser torch distributed argparse_util check_env env ArgParseUtilTest unittest TestCase setUp remove any lingering environment variables e os environ keys e startswith PET_ del os environ e test_env_string_arg_no_env parser = ArgumentParser parser add_argument -f -- foo action=env default= bar assertEqual bar parser parse_args foo assertEqual baz parser parse_args -f baz foo assertEqual baz parser parse_args -- foo baz foo test_env_string_arg_env os environ PET_FOO = env_baz parser = ArgumentParser parser add_argument -f -- foo action=env default= bar assertEqual env_baz parser parse_args foo assertEqual baz parser parse_args -f baz foo assertEqual baz parser parse_args -- foo baz foo test_env_int_arg_no_env parser = ArgumentParser parser add_argument -f -- foo action=env default= type=int assertEqual parser parse_args foo assertEqual parser parse_args -f foo assertEqual parser parse_args -- foo foo test_env_int_arg_env os environ PET_FOO = parser = ArgumentParser parser add_argument -f -- foo action=env default= type=int assertEqual parser parse_args foo assertEqual parser parse_args -f foo assertEqual parser parse_args -- foo foo test_env_no_default_no_env parser = ArgumentParser parser add_argument -f -- foo action=env assertIsNone parser parse_args foo assertEqual baz parser parse_args -f baz foo assertEqual baz parser parse_args -- foo baz foo test_env_no_default_env os environ PET_FOO = env_baz parser = ArgumentParser parser add_argument -f -- foo action=env assertEqual env_baz parser parse_args foo assertEqual baz parser parse_args -f baz foo assertEqual baz parser parse_args -- foo baz foo test_env_required_no_env parser = ArgumentParser parser add_argument -f -- foo action=env required=True assertEqual baz parser parse_args -f baz foo assertEqual baz parser parse_args -- foo baz foo test_env_required_env os environ PET_FOO = env_baz parser = ArgumentParser parser add_argument -f -- foo action=env default= bar required=True assertEqual env_baz parser parse_args foo assertEqual baz parser parse_args -f baz foo assertEqual baz parser parse_args -- foo baz foo test_check_env_no_env parser = ArgumentParser parser add_argument -v -- verbose action=check_env assertFalse parser parse_args verbose assertTrue parser parse_args -v verbose assertTrue parser parse_args -- verbose verbose test_check_env_default_no_env parser = ArgumentParser parser add_argument -v -- verbose action=check_env default=True assertTrue parser parse_args verbose assertTrue parser parse_args -v verbose assertTrue parser parse_args -- verbose verbose test_check_env_env_zero os environ PET_VERBOSE = parser = ArgumentParser parser add_argument -v -- verbose action=check_env assertFalse parser parse_args verbose assertTrue parser parse_args -- verbose verbose test_check_env_env_one os environ PET_VERBOSE = parser = ArgumentParser parser add_argument -v -- verbose action=check_env assertTrue parser parse_args verbose assertTrue parser parse_args -- verbose verbose test_check_env_default_env_zero os environ PET_VERBOSE = parser = ArgumentParser parser add_argument -v -- verbose action=check_env default=True assertFalse parser parse_args verbose assertTrue parser parse_args -- verbose verbose test_check_env_default_env_one os environ PET_VERBOSE = parser = ArgumentParser parser add_argument -v -- verbose action=check_env default=True assertTrue parser parse_args verbose assertTrue parser parse_args -- verbose verbose