Owner s module fx copy unittest collections defaultdict torch torch fx fx torch _dynamo source LocalSource torch fx experimental shape_inference infer_shape infer_shape torch fx experimental shape_inference infer_symbol_values infer_symbol_values torch fx experimental symbolic_shapes DimDynamic ShapeEnv TestShapeInference unittest TestCase test_infer_symbol_values mksym shape_env value source dynamic_dim - None shape_env create_symintnode shape_env create_symbol value source=source dynamic_dim=dynamic_dim hint=value source=source shape_env = ShapeEnv N = sample = f s i i range N init_symints = mksym shape_env v LocalSource k DimDynamic DYNAMIC k v sample items symints = copy deepcopy init_symints symbol_to_idx_dict = f s i i i range N padding_constraints = defaultdict list prepare constraints strings constraints = constraints append The size tensor s must match size tensor b non-singleton dimension constraints append Expected size first two dimensions batch tensor s s + got s constraints append shape s - invalid input size s s constraints append b must have same reduction dim got s s X constraints append b must have same reduction dim got s s + X constraints append Expected size first two dimensions batch tensor s got s s constraints append shape s - invalid input size s s + s constraints append shape - invalid input size s s + s constraints append Expected size first two dimensions batch tensor s s got s s constraints append Split sizes add up got tensor s size s constraint constraints infer_symbol_values symints init_symints symbol_to_idx_dict padding_constraints constraint assertEqual symints assertEqual symints assertEqual symints assertEqual symints assertEqual symints assertEqual symints assertEqual symints test_infer_shape TestModule torch nn Module __init__ - None super __init__ w_ = torch empty b_ = torch empty w_ = torch empty b_ = torch empty forward x l_ = torch nn functional linear x w_ bias=self b_ s_ = torch sigmoid l_ l_ = torch nn functional linear s_ w_ bias=self b_ t_ = torch tanh l_ t_ generate_graph_module model gm = fx symbolic_trace model gm m = TestModule gm = generate_graph_module m input_tensors = torch randn infer_shape gm input_tensors __name__ == __main__ raise RuntimeError This test currently used should enabled discover_tests py required