Owner s module inductor contextlib torch torch _inductor dependencies MemoryDep torch _inductor graph GraphLowering torch _inductor ir Buffer FixedLayout Pointwise torch _inductor test_case TestCase InductorTestCase torch _inductor utils sympy_index_symbol torch _inductor virtualized ops V torch testing _internal inductor_utils GPU_TYPE HAS_CPU HAS_GPU TestDependencies InductorTestCase _create_buffer name shape dtype=torch float Buffer name=name layout=FixedLayout torch device GPU_TYPE dtype=dtype size=shape setUp super setUp DummyModule torch nn Module forward x x _gm = torch fx symbolic_trace DummyModule _graph = GraphLowering _gm _stack = contextlib ExitStack _stack enter_context V set_graph_handler _graph tearDown _stack close super tearDown test_bucketize_dependencies_no_sorter offsets = _create_buffer offsets torch int inner_fn index idx = index ops bucketize values=idx boundaries= offsets get_name offsets get_size - offsets get_size offsets get_stride offsets get_stride - boundary_indices= indexing_dtype=torch int right=True pointwise = Pointwise create device=torch device GPU_TYPE dtype=torch int inner_fn=inner_fn ranges= assertEqual len pointwise get_reads test_bucketize_dependencies_sorter offsets = _create_buffer offsets torch int sorter = _create_buffer sorter torch int inner_fn index idx = index ops bucketize values=idx boundaries= offsets get_name offsets get_size - offsets get_size offsets get_stride offsets get_stride - boundary_indices= indexing_dtype=torch int right=True sorter= sorter get_name sorter get_stride - sorter_indices= pointwise = Pointwise create device=torch device GPU_TYPE dtype=torch int inner_fn=inner_fn ranges= assertEqual len pointwise get_reads test_get_offset x = sympy_index_symbol x y = sympy_index_symbol y var_ranges = x y dep = MemoryDep dep x + y list var_ranges keys list var_ranges values dep = MemoryDep dep x + y + list var_ranges keys list var_ranges values assertEqual dep get_offset assertEqual dep get_offset test_normalize_with_stride_order_equal x = sympy_index_symbol x y = sympy_index_symbol y loop_order = MemoryDep access_the_same_buffer x + y x y loop_order = MemoryDep access_the_same_buffer x + y y x assertTrue loop_order = loop_order normalized_loop_order = loop_order normalize_with_stride_order normalized_loop_order = loop_order normalize_with_stride_order assertTrue normalized_loop_order == normalized_loop_order test_normalize_with_stride_order_unequal x = sympy_index_symbol x y = sympy_index_symbol y loop_order = MemoryDep access_the_same_buffer x + y x y loop_order = MemoryDep access_the_same_buffer x + y + y x assertTrue loop_order = loop_order normalized_loop_order = loop_order normalize_with_stride_order normalized_loop_order = loop_order normalize_with_stride_order unequal due different offset assertTrue normalized_loop_order = normalized_loop_order __name__ == __main__ torch _inductor test_case run_tests HAS_CPU HAS_GPU run_tests sympy