mypy allow-untyped-defs Owner s module typing torch testing _internal common_utils load_tests run_tests set_default_dtype TEST_NUMPY TestCase load_tests common_utils used automatically filter tests sharding sandcastle This line silences flake warnings load_tests = load_tests noqa PLW sys unittest torch TEST_NUMPY numpy np TestDTypeInfo TestCase test_invalid_input dtype torch float torch float torch float torch bfloat torch complex torch complex torch bool assertRaises TypeError _ = torch iinfo dtype dtype torch int torch int torch int torch int torch uint torch bool assertRaises TypeError _ = torch finfo dtype assertRaises RuntimeError dtype to_complex unittest skipIf TEST_NUMPY Numpy found test_iinfo dtype torch int torch int torch int torch int torch uint x = torch zeros dtype=dtype xinfo = torch iinfo x dtype xn = x cpu numpy xninfo = np iinfo xn dtype assertEqual xinfo bits xninfo bits assertEqual xinfo max xninfo max assertEqual xinfo min xninfo min assertEqual xinfo dtype xninfo dtype unittest skipIf TEST_NUMPY Numpy found test_finfo dtype torch float torch float torch float torch complex torch complex x = torch zeros dtype=dtype xinfo = torch finfo x dtype xn = x cpu numpy xninfo = np finfo xn dtype assertEqual xinfo bits xninfo bits assertEqual xinfo max xninfo max assertEqual xinfo min xninfo min assertEqual xinfo eps xninfo eps assertEqual xinfo tiny xninfo tiny assertEqual xinfo resolution xninfo resolution assertEqual xinfo dtype xninfo dtype dtype is_complex set_default_dtype dtype assertEqual torch finfo dtype torch finfo Special test case BFloat type x = torch zeros dtype=torch bfloat xinfo = torch finfo x dtype assertEqual xinfo bits assertEqual xinfo max e assertEqual xinfo min - e assertEqual xinfo eps assertEqual xinfo tiny e- assertEqual xinfo tiny xinfo smallest_normal assertEqual xinfo resolution assertEqual xinfo dtype bfloat set_default_dtype x dtype assertEqual torch finfo x dtype torch finfo Special test case Float _E M xinfo = torch finfo torch float _e m assertEqual xinfo bits assertEqual xinfo max assertEqual xinfo min - assertEqual xinfo eps assertEqual xinfo tiny e- assertEqual xinfo resolution assertEqual xinfo dtype float _e m Special test case Float _E M FN xinfo = torch finfo torch float _e m fn assertEqual xinfo bits assertEqual xinfo max assertEqual xinfo min - assertEqual xinfo eps assertEqual xinfo tiny assertEqual xinfo resolution assertEqual xinfo dtype float _e m fn test_to_complex Regression test https github com pytorch pytorch issues If reference count leaked would set elements ref_cnt = sys getrefcount torch float to_complex _ range assertLess len ref_cnt assertEqual torch float to_complex torch complex assertEqual torch float to_complex torch complex assertEqual torch float to_complex torch complex test_to_real Regression test https github com pytorch pytorch issues If reference count leaked would set elements ref_cnt = sys getrefcount torch cfloat to_real _ range assertLess len ref_cnt assertEqual torch complex to_real torch double assertEqual torch complex to_real torch float assertEqual torch complex to_real torch float __name__ == __main__ TestCase _default_dtype_check_enabled = True run_tests