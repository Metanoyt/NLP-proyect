Owner s module cuda torch testing _internal common_utils TestCase run_tests torch testing _internal check_kernel_launches check_cuda_kernel_launches check_code_for_cuda_kernel_launches AlwaysCheckCudaLaunchTest TestCase test_check_code Verifies regex works few different situations Try some different spacings assertEqual check_code_for_cuda_kernel_launches some_function_call TemplateArg stream arg arg arg C _CUDA_KERNEL_LAUNCH_CHECK some_function_call TemplateArg stream arg arg arg some_function_call TemplateArg stream arg arg arg C _CUDA_KERNEL_LAUNCH_CHECK some_function_call TemplateArg stream arg arg arg some_other_stuff some_function_call TemplateArg stream arg arg arg C _CUDA_KERNEL_LAUNCH_CHECK some_function_call TemplateArg stream arg arg arg C _CUDA_KERNEL_LAUNCH_CHECK some_function_call TemplateArg stream arg arg arg C _CUDA_KERNEL_LAUNCH_CHECK Does work macros assertEqual check_code_for_cuda_kernel_launches r #define SOME_MACRO x some_function_call x \ C _CUDA_KERNEL_LAUNCH_CHECK #define SMALL_INDEX TENSOR_TYPE INDICES_TYPE TYPE SELF_DIM SOURCE_DIM IDX_DIM \ indexAddSmallIndex TENSOR_TYPE INDICES_TYPE TYPE SELF_DIM SOURCE_DIM IDX_DIM \ smallIndexGrid smallIndexBlock stream \ selfInfo sourceInfo indexInfo \ selfAddDim sourceAddDim sliceSize selfAddDimSize \ C _CUDA_KERNEL_LAUNCH_CHECK Does work lambdas assertEqual check_code_for_cuda_kernel_launches r rrelu_with_noise_cuda_kernel scalar_t grid block stream numel rng_engine_inputs output_data input_data noise_data lower upper __device__ curandStatePhilox _ _ _t state curand_uniform _double state C _CUDA_KERNEL_LAUNCH_CHECK rrelu_with_noise_cuda_kernel scalar_t grid block stream numel rng_engine_inputs output_data input_data noise_data lower upper __device__ curandStatePhilox _ _ _t state curand_uniform _double state uh oh C _CUDA_KERNEL_LAUNCH_CHECK test_check_cuda_launches unsafeLaunchesCount = check_cuda_kernel_launches assertTrue unsafeLaunchesCount == __name__ == __main__ run_tests