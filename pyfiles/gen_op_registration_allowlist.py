This util invoked cmake produce op registration allowlist param ` ATen gen py ` custom mobile build For custom build dynamic dispatch takes op dependency graph ATen list root ops outputs all transitive dependencies root ops allowlist For custom build static dispatch op dependency graph will omitted will directly output root ops allowlist __future__ annotations argparse collections defaultdict yaml DepGraph = dict str set str canonical_name opname str - str Skip overload name part s supported code analyzer yet opname split load_op_dep_graph fname str - DepGraph open fname stream result = defaultdict set op yaml safe_load stream op_name = canonical_name op name dep op get depends dep_name = canonical_name dep name result op_name add dep_name dict result load_root_ops fname str - list str result = open fname stream op yaml safe_load stream result append canonical_name op result gen_transitive_closure dep_graph DepGraph root_ops list str train bool = False - list str result = set root_ops queue = root_ops copy The dependency graph might contain special entry key = ` __BASE__ ` value = set ` base ` ops always include custom build queue append __BASE__ The dependency graph might contain special entry key = ` __ROOT__ ` value = set ops reachable C++ functions Insert special ` __ROOT__ ` key include ops which can called C++ code directly addition ops called TorchScript model __ROOT__ only needed full-jit Keep only training TODO when FL migrated full-jit lite trainer remove __ROOT__ train queue append __ROOT__ while queue cur = queue pop dep dep_graph get cur dep result result add dep queue append dep sorted result gen_transitive_closure_str dep_graph DepGraph root_ops list str - str join gen_transitive_closure dep_graph root_ops __name__ == __main__ parser = argparse ArgumentParser description= Util produce transitive dependencies custom build parser add_argument -- op-dependency help= input yaml file op dependency graph - can omitted custom build static dispatch parser add_argument -- root-ops required=True help= input yaml file root directly used operators args = parser parse_args deps = load_op_dep_graph args op_dependency args op_dependency root_ops = load_root_ops args root_ops print gen_transitive_closure_str deps root_ops