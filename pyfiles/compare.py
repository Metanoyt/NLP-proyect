mypy allow-untyped-defs Display aggregate print results many measurements collections enum itertools typing Optional torch utils benchmark utils common torch tensor _tensor operator __all__ = Colorize Compare BEST = \ m GOOD = \ m BAD = \ m\ m VERY_BAD = \ m BOLD = \ m TERMINATE = \ m Colorize enum Enum NONE = none COLUMNWISE = columnwise ROWWISE = rowwise Classes separate internal bookkeeping what rendered _Column __init__ grouped_results list tuple Optional common Measurement time_scale float time_unit str trim_significant_figures bool highlight_warnings bool _grouped_results = grouped_results _flat_results = chain from_iterable grouped_results _time_scale = time_scale _time_unit = time_unit _trim_significant_figures = trim_significant_figures _highlight_warnings = highlight_warnings any r has_warnings r _flat_results r leading_digits = int _tensor r median _time_scale log ceil r None r _flat_results unit_digits = max d d leading_digits d None decimal_digits = min max m significant_figures - digits digits m zip leading_digits _flat_results strict=True m None digits None _trim_significant_figures length = unit_digits + decimal_digits + decimal_digits _template = f length decimal_digits f _highlight_warnings get_results_for group _grouped_results group num_to_str value Optional float estimated_sigfigs int spread Optional float value None len num_to_str estimated_sigfigs None _trim_significant_figures value = common trim_sigfig value estimated_sigfigs _template format value f spread f _highlight_warnings spread None optional_min seq l = list seq None len l == min l _Row __init__ results row_group render_env env_str_len row_name_str_len time_scale colorize num_threads=None super __init__ _results = results _row_group = row_group _render_env = render_env _env_str_len = env_str_len _row_name_str_len = row_name_str_len _time_scale = time_scale _colorize = colorize _columns tuple _Column = _num_threads = num_threads register_columns columns tuple _Column _columns = columns as_column_strings concrete_results = r r _results r None env = f concrete_results env _render_env env = env ljust _env_str_len + output = + env + concrete_results as_row_name m col zip _results _columns strict=False m None output append col num_to_str None None output append col num_to_str m median _time_scale m significant_figures m iqr m median m has_warnings None output staticmethod color_segment segment value best_value value = best_value value = best_value + e- BEST + BOLD + segment + TERMINATE value = best_value GOOD + BOLD + segment + TERMINATE value = best_value VERY_BAD + BOLD + segment + TERMINATE value = best_value BAD + segment + TERMINATE segment row_separator overall_width f _num_threads threads ljust overall_width - _num_threads None finalize_column_strings column_strings col_widths best_values = - _ column_strings _colorize == Colorize ROWWISE row_min = min r median r _results r None best_values = row_min _ column_strings _colorize == Colorize COLUMNWISE best_values = optional_min r median r column get_results_for _row_group r None column _columns row_contents = column_strings ljust col_widths col_str width result best_value zip column_strings col_widths _results best_values strict=False col_str = col_str center width _colorize = Colorize NONE result None best_value None col_str = color_segment col_str result median best_value row_contents append col_str row_contents Table __init__ results list common Measurement colorize Colorize trim_significant_figures bool highlight_warnings bool len r label r results = raise AssertionError All results must share same label results = results _colorize = colorize _trim_significant_figures = trim_significant_figures _highlight_warnings = highlight_warnings label = results label time_unit time_scale = common select_unit min r median r results row_keys = common ordered_unique row_fn i i results row_keys sort key=operator itemgetter slice preserve stmt order column_keys = common ordered_unique col_fn i i results rows columns = populate_rows_and_columns staticmethod row_fn m common Measurement - tuple int Optional str str m num_threads m env m as_row_name staticmethod col_fn m common Measurement - Optional str m description populate_rows_and_columns - tuple tuple _Row tuple _Column rows list _Row = columns list _Column = ordered_results list list Optional common Measurement = None _ column_keys _ row_keys row_position = key i i key enumerate row_keys col_position = key i i key enumerate column_keys r results i = row_position row_fn r j = col_position col_fn r ordered_results i j = r unique_envs = r env r results render_env = len unique_envs env_str_len = max len i i unique_envs render_env row_name_str_len = max len r as_row_name r results prior_num_threads = - prior_env = row_group = - rows_by_group list list list Optional common Measurement = num_threads env _ row zip row_keys ordered_results strict=True thread_transition = num_threads = prior_num_threads thread_transition prior_num_threads = num_threads prior_env = row_group += rows_by_group append rows append _Row results=row row_group=row_group render_env= render_env env = prior_env env_str_len=env_str_len row_name_str_len=row_name_str_len time_scale=self time_scale colorize=self _colorize num_threads=num_threads thread_transition None rows_by_group - append row prior_env = env i range len column_keys grouped_results = tuple row i row g g rows_by_group column = _Column grouped_results=grouped_results time_scale=self time_scale time_unit=self time_unit trim_significant_figures=self _trim_significant_figures highlight_warnings=self _highlight_warnings columns append column rows_tuple columns_tuple = tuple rows tuple columns ri rows_tuple ri register_columns columns_tuple rows_tuple columns_tuple render - str string_rows = + column_keys string_rows extend r as_column_strings r rows num_cols = max len i i string_rows sr string_rows sr extend _ range num_cols - len sr col_widths = max len j j i i zip string_rows strict=True finalized_columns = &#124; join i center w i w zip string_rows col_widths strict=True overall_width = len finalized_columns string_row row zip string_rows rows strict=True finalized_columns extend row row_separator overall_width finalized_columns append &#124; join row finalize_column_strings string_row col_widths newline = \n has_warnings = _highlight_warnings any ri has_warnings ri results f + label + center overall_width - - newline join finalized_columns Times common unit_to_english time_unit s time_unit XX Measurement has high variance where XX IQR median + newline has_warnings Compare Helper displaying results many measurements formatted table The table format based information fields provided ` torch utils benchmark Timer ` ` description ` ` label ` ` sub_label ` ` num_threads ` etc The table can directly printed using meth ` print ` casted ` str ` For full tutorial how use see https pytorch org tutorials recipes recipes benchmark html Args results List Measurement display __init__ results list common Measurement _results list common Measurement = extend_results results _trim_significant_figures = False _colorize = Colorize NONE _highlight_warnings = False __str__ \n join _render extend_results results Append results already stored ones All added results must instances ` ` Measurement ` ` r results isinstance r common Measurement raise ValueError Expected instance ` Measurement ` f got type r instead _results extend results trim_significant_figures Enables trimming significant figures when building formatted table _trim_significant_figures = True colorize rowwise=False Colorize formatted table Colorize columnwise default _colorize = Colorize ROWWISE rowwise Colorize COLUMNWISE highlight_warnings Enables warning highlighting when building formatted table _highlight_warnings = True print Print formatted table print str _render results = common Measurement merge _results grouped_results = _group_by_label results output = _layout group group grouped_results values output _group_by_label results list common Measurement grouped_results collections defaultdict str list common Measurement = collections defaultdict list r results grouped_results r label append r grouped_results _layout results list common Measurement table = Table results _colorize _trim_significant_figures _highlight_warnings table render