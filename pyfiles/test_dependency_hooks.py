Owner s oncall package deploy io BytesIO torch package PackageExporter torch testing _internal common_utils run_tests try common PackageTestCase except ImportError Support case where we run file directly common PackageTestCase TestDependencyHooks PackageTestCase Dependency management hooks API tests - register_mock_hook - register_extern_hook test_single_hook buffer = BytesIO my_externs = set my_extern_hook package_exporter module_name my_externs add module_name PackageExporter buffer exporter exporter extern package_a subpackage module_a exporter register_extern_hook my_extern_hook exporter save_source_string foo module_a assertEqual my_externs module_a test_multiple_extern_hooks buffer = BytesIO my_externs = set my_extern_hook package_exporter module_name my_externs add module_name This also checks ordering since ` remove ` will fail value set my_extern_hook package_exporter module_name my_externs remove module_name PackageExporter buffer exporter exporter extern package_a subpackage module_a exporter register_extern_hook my_extern_hook exporter register_extern_hook my_extern_hook exporter save_source_string foo module_a assertEqual my_externs set test_multiple_mock_hooks buffer = BytesIO my_mocks = set my_mock_hook package_exporter module_name my_mocks add module_name This also checks ordering since ` remove ` will fail value set my_mock_hook package_exporter module_name my_mocks remove module_name PackageExporter buffer exporter exporter mock package_a subpackage module_a exporter register_mock_hook my_mock_hook exporter register_mock_hook my_mock_hook exporter save_source_string foo module_a assertEqual my_mocks set test_remove_hooks buffer = BytesIO my_externs = set my_externs = set my_extern_hook package_exporter module_name my_externs add module_name my_extern_hook package_exporter module_name my_externs add module_name PackageExporter buffer exporter exporter extern package_a subpackage module_a handle = exporter register_extern_hook my_extern_hook exporter register_extern_hook my_extern_hook handle remove exporter save_source_string foo module_a assertEqual my_externs set assertEqual my_externs module_a test_extern_and_mock_hook buffer = BytesIO my_externs = set my_mocks = set my_extern_hook package_exporter module_name my_externs add module_name my_mock_hook package_exporter module_name my_mocks add module_name PackageExporter buffer exporter exporter extern module_a exporter mock package_a exporter register_extern_hook my_extern_hook exporter register_mock_hook my_mock_hook exporter save_source_string foo module_a package_a assertEqual my_externs module_a assertEqual my_mocks package_a __name__ == __main__ run_tests