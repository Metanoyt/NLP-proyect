unittest torchgen model Location NativeFunction torchgen selective_build operator noqa F torchgen selective_build selector combine_selective_builders SelectiveBuilder TestSelectiveBuild unittest TestCase test_selective_build_operator - None op = SelectiveBuildOperator aten add int is_root_operator=True is_used_for_training=False include_all_overloads=False _debug_info=None assertTrue op is_root_operator assertFalse op is_used_for_training assertFalse op include_all_overloads test_selector_factory - None yaml_config_v = debug_info - model v - model v operators aten add is_used_for_training No is_root_operator Yes include_all_overloads Yes aten add int is_used_for_training Yes is_root_operator No include_all_overloads No aten mul int is_used_for_training Yes is_root_operator No include_all_overloads No yaml_config_v = debug_info - model v - model v operators aten sub is_used_for_training No is_root_operator Yes include_all_overloads No debug_info - model v aten sub int is_used_for_training Yes is_root_operator No include_all_overloads No yaml_config_all = include_all_operators Yes yaml_config_invalid = invalid selector = SelectiveBuilder from_yaml_str yaml_config_v assertTrue selector is_operator_selected aten add assertTrue selector is_operator_selected aten add int Overload name used checking v assertTrue selector is_operator_selected aten add float gen SelectiveBuilder from_yaml_str yaml_config_invalid assertRaises Exception gen selector_all = SelectiveBuilder from_yaml_str yaml_config_all assertTrue selector_all is_operator_selected aten add assertTrue selector_all is_operator_selected aten sub assertTrue selector_all is_operator_selected aten sub int assertTrue selector_all is_kernel_dtype_selected add_kernel int selector = SelectiveBuilder from_yaml_str yaml_config_v assertFalse selector is_operator_selected aten add assertTrue selector is_operator_selected aten sub assertTrue selector is_operator_selected aten sub int selector_legacy_v = SelectiveBuilder from_legacy_op_registration_allow_list pyrefly ignore bad-argument-type aten add aten add int aten mul int False False assertTrue selector_legacy_v is_operator_selected aten add float assertTrue selector_legacy_v is_operator_selected aten add assertTrue selector_legacy_v is_operator_selected aten add int assertFalse selector_legacy_v is_operator_selected aten sub assertFalse selector_legacy_v is_root_operator aten add assertFalse selector_legacy_v is_operator_selected_for_training aten add selector_legacy_v = SelectiveBuilder from_legacy_op_registration_allow_list pyrefly ignore bad-argument-type aten add aten add int aten mul int True False assertTrue selector_legacy_v is_root_operator aten add assertFalse selector_legacy_v is_operator_selected_for_training aten add assertTrue selector_legacy_v is_root_operator aten add float assertFalse selector_legacy_v is_operator_selected_for_training aten add float selector_legacy_v = SelectiveBuilder from_legacy_op_registration_allow_list pyrefly ignore bad-argument-type aten add aten add int aten mul int False True assertFalse selector_legacy_v is_root_operator aten add assertTrue selector_legacy_v is_operator_selected_for_training aten add assertFalse selector_legacy_v is_root_operator aten add float assertTrue selector_legacy_v is_operator_selected_for_training aten add float test_operator_combine - None op = SelectiveBuildOperator aten add int is_root_operator=True is_used_for_training=False include_all_overloads=False _debug_info=None op = SelectiveBuildOperator aten add int is_root_operator=False is_used_for_training=False include_all_overloads=False _debug_info=None op = SelectiveBuildOperator aten add is_root_operator=True is_used_for_training=False include_all_overloads=False _debug_info=None op = SelectiveBuildOperator aten add int is_root_operator=True is_used_for_training=True include_all_overloads=False _debug_info=None op = combine_operators op op assertTrue op is_root_operator assertFalse op is_used_for_training op = combine_operators op op assertTrue op is_root_operator assertTrue op is_used_for_training gen_new_op combine_operators op op assertRaises Exception gen_new_op test_training_op_fetch - None yaml_config = operators aten add int is_used_for_training No is_root_operator Yes include_all_overloads No aten add is_used_for_training Yes is_root_operator No include_all_overloads Yes selector = SelectiveBuilder from_yaml_str yaml_config assertTrue selector is_operator_selected_for_training aten add int assertTrue selector is_operator_selected_for_training aten add test_kernel_dtypes - None yaml_config = kernel_metadata add_kernel - int - int sub_kernel - int - int add sub_kernel - float - complex selector = SelectiveBuilder from_yaml_str yaml_config assertTrue selector is_kernel_dtype_selected add_kernel int assertTrue selector is_kernel_dtype_selected add_kernel int assertFalse selector is_kernel_dtype_selected add_kernel int assertFalse selector is_kernel_dtype_selected add _kernel int assertFalse selector is_kernel_dtype_selected add_kernel float assertTrue selector is_kernel_dtype_selected add sub_kernel float assertTrue selector is_kernel_dtype_selected add sub_kernel complex assertFalse selector is_kernel_dtype_selected add sub_kernel int assertFalse selector is_kernel_dtype_selected add sub_kernel int test_merge_kernel_dtypes - None yaml_config = kernel_metadata add_kernel - int add sub_kernel - float - complex - none mul_kernel - int yaml_config = kernel_metadata add_kernel - int sub_kernel - int - int add sub_kernel - float - complex selector = SelectiveBuilder from_yaml_str yaml_config selector = SelectiveBuilder from_yaml_str yaml_config selector = combine_selective_builders selector selector assertTrue selector is_kernel_dtype_selected add_kernel int assertTrue selector is_kernel_dtype_selected add_kernel int assertFalse selector is_kernel_dtype_selected add_kernel int assertFalse selector is_kernel_dtype_selected add _kernel int assertFalse selector is_kernel_dtype_selected add_kernel float assertTrue selector is_kernel_dtype_selected add sub_kernel float assertTrue selector is_kernel_dtype_selected add sub_kernel complex assertTrue selector is_kernel_dtype_selected add sub_kernel none assertFalse selector is_kernel_dtype_selected add sub_kernel int assertFalse selector is_kernel_dtype_selected add sub_kernel int assertTrue selector is_kernel_dtype_selected mul_kernel int assertFalse selector is_kernel_dtype_selected mul_kernel int test_all_kernel_dtypes_selected - None yaml_config = include_all_non_op_selectives True selector = SelectiveBuilder from_yaml_str yaml_config assertTrue selector is_kernel_dtype_selected add_kernel int assertTrue selector is_kernel_dtype_selected add_kernel int assertTrue selector is_kernel_dtype_selected add_kernel int assertTrue selector is_kernel_dtype_selected add _kernel int assertTrue selector is_kernel_dtype_selected add_kernel float test_custom_namespace_selected_correctly - None yaml_config = operators aten add int is_used_for_training No is_root_operator Yes include_all_overloads No custom add is_used_for_training Yes is_root_operator No include_all_overloads Yes selector = SelectiveBuilder from_yaml_str yaml_config native_function _ = NativeFunction from_yaml func custom add - Tensor loc=Location __file__ valid_tags=set assertTrue selector is_native_function_selected native_function