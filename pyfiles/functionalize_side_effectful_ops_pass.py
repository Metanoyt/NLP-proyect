copy typing Optional torch torch _export pass_base _ExportPassBaseDeprecatedDoNotUse Argument PassResult torch _export pass_infra node_metadata NodeMetadata torch _export pass_infra proxy_value ProxyValue torch _ops OpOverload aten = torch ops aten _NON_FUNCTIONAL_TO_FUNCTIONAL_SIDE_EFFECTFUL_FUNCS dict OpOverload OpOverload = aten sym_constrain_range default aten _functional_sym_constrain_range default aten _assert_async msg aten _functional_assert_async msg _FunctionalizeSideEffectfulOpsPass _ExportPassBaseDeprecatedDoNotUse Functionalize ops side effect graph module replacing op functional version A new dependency token ` dep_token ` will created propagated through functional ops output For example ` ` ` f x sym_constrain_range x shape min= max= x add ` ` ` Will transformed ` ` ` f x dep_token = _make_dep_token dep_token = _functional_sym_constrain_range x shape min= max= dep_token=dep_token x add dep_token ` ` ` __init__ - None super __init__ _dep_token Optional ProxyValue = None _next_dep_token_index Optional int = None call graph_module torch fx GraphModule - PassResult Early no non-functional assertions any n target _NON_FUNCTIONAL_TO_FUNCTIONAL_SIDE_EFFECTFUL_FUNCS n graph_module graph nodes PassResult graph_module=graph_module modified=False gm = copy deepcopy graph_module _dep_token = None _next_dep_token_index = None super call gm call_operator op OpOverload args tuple Argument kwargs dict str Argument meta NodeMetadata - ProxyValue op _NON_FUNCTIONAL_TO_FUNCTIONAL_SIDE_EFFECTFUL_FUNCS super call_operator op args kwargs meta _dep_token None _dep_token = super call_operator aten _make_dep_token args= kwargs= meta=self _create_dummy_node_metadata _dep_token node name = dep_token _next_dep_token_index = _dep_token = super call_operator _NON_FUNCTIONAL_TO_FUNCTIONAL_SIDE_EFFECTFUL_FUNCS op args=args kwargs= kwargs dep_token _dep_token meta=meta assert _next_dep_token_index None _dep_token node name = f dep_token _next_dep_token_index _next_dep_token_index += _dep_token output results list Argument meta NodeMetadata - ProxyValue assert _dep_token None super output results= results _dep_token meta=meta type ignore arg-type