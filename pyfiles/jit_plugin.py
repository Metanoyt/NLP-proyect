This coverage plug-in attempts cover JIT d functions methods previously missed code coverage Any function method passed through decorated torch jit script torch jit script_method should now marked covered when coverage run plug-in DISCLAIMER note will mark entire JIT d function method covered without seeking proof compiled code has been executed This means even code chunk merely compiled run will get marked covered inspect getsourcefile getsourcelines isclass iscode isfunction ismethod ismodule time time typing Any coverage CoverageData CoveragePlugin type ignore All coverage stats resulting plug-in will separate coverage file should merged later ` coverage combine ` The convention seems coverage dotted suffix based following link https coverage readthedocs io en coverage- cmd html#combining-data-files-coverage-combine cov_data = CoverageData basename=f coverage jit time is_not_builtin_class obj Any - bool isclass obj type obj __module__ = builtins JitPlugin CoveragePlugin type ignore misc no-any-unimported dynamic_context overridden function gives us access every frame run during coverage process We look when function being run ` should_drop ` all functions get passed into ` should_drop ` will compiled thus should marked covered dynamic_context frame Any - None frame f_code co_name == should_drop obj = frame f_locals fn The many conditions statement below based accepted arguments getsourcefile Based its documentation https docs python org library inspect html#inspect getsourcefile argument must module method function traceback frame code object AND cannot built-in module function Currently we DO NOT include tracebacks frames they should JIT d we have checked built-in modules functions those do seem JIT d either is_not_builtin_class obj ismodule obj ismethod obj isfunction obj iscode obj filename = getsourcefile obj We don t want report filename = None filename TODO Because torch jit _IgnoreContextManager relies Python s ` exec ` method which doesn t generate source codelines getsourcelines obj fails For now we just ignore exception until we figure out better way implement torch jit _IgnoreContextManager try sourcelines starting_lineno = getsourcelines obj except OSError pass line_data = filename range starting_lineno starting_lineno + len sourcelines cov_data add_lines line_data super dynamic_context frame coverage_init reg Any options Any - None reg add_dynamic_context JitPlugin