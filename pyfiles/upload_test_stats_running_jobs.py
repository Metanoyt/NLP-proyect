sys time functools cache typing Any tools stats test_dashboard upload_additional_info tools stats upload_stats_lib get_s _resource tools stats upload_test_stats get_tests BUCKET_PREFIX = workflows_failing_pending_upload cache get_bucket - Any get_s _resource Bucket gha-artifacts delete_obj key str - None Does raise error key does exist get_bucket delete_objects Delete= Objects Key key Quiet True put_object key str - None get_bucket put_object Key=key Body=b do_upload workflow_id int - None workflow_attempt = test_cases = get_tests workflow_id workflow_attempt Flush stdout so any errors upload show up last logs sys stdout flush upload_additional_info workflow_id workflow_attempt test_cases get_workflow_ids pending bool = False - list int prefix = f BUCKET_PREFIX pending pending objs = get_bucket objects filter Prefix=prefix int obj key split - split obj objs read_s pending bool = False - None while True workflows = get_workflow_ids pending workflows pending break Wait more stuff show up print Sleeping seconds time sleep workflow_id workflows print f Processing workflow_id put_object f BUCKET_PREFIX pending workflow_id txt delete_obj f BUCKET_PREFIX workflow_id txt try do_upload workflow_id except Exception e print f Failed upload workflow_id e delete_obj f BUCKET_PREFIX pending workflow_id txt __name__ == __main__ Workflows pending folder previously progress uploading failed complete so we need retry them read_s pending=True read_s