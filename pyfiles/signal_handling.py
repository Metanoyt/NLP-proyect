mypy allow-untyped-defs r Signal handling multiprocessing data loading NOTE Signal handling multiprocessing data loading In cases like DataLoader worker process dies due bus error segfault just hang main process will hang waiting data This difficult avoid PyTorch side can caused limited shm other libraries users call workers In file ` DataLoader cpp ` we make our best effort provide some error message users when such unfortunate events happen When _BaseDataLoaderIter starts worker processes their pids registered defined ` DataLoader cpp ` id _BaseDataLoaderIter = Collection Worker pids via ` _set_worker_pids ` When error happens worker process main process received SIGCHLD Python will eventually call handler registered below ` _set_SIGCHLD_handler ` In handler ` _error_if_any_worker_fails ` call checks all registered worker pids raise proper error message prevent main process hanging waiting data worker Additionally beginning each worker s ` _utils worker _worker_loop ` ` _set_worker_signal_handlers ` called register critical signal handlers e g SIGSEGV SIGBUS SIGFPE SIGTERM C which just prints error message stderr before triggering default handler So message will also printed worker process when killed such signals See NOTE Data Loader Multiprocessing Shutdown Logic reasoning signal handling design other mechanism we implement make our multiprocessing data loading robust errors signal threading Some following imported functions used file used ` _utils signal_handling XXXXX ` torch _C noqa F _error_if_any_worker_fails _remove_worker_pids _set_worker_pids _set_worker_signal_handlers IS_WINDOWS _SIGCHLD_handler_set = False r Whether SIGCHLD handler set DataLoader worker failures Only one handler needs set all DataLoaders process _set_SIGCHLD_handler Windows doesn t support SIGCHLD handler IS_WINDOWS can t set signal child threads isinstance threading current_thread threading _MainThread type ignore attr-defined global _SIGCHLD_handler_set _SIGCHLD_handler_set previous_handler = signal getsignal signal SIGCHLD callable previous_handler This doesn t catch default handler SIGCHLD default handler no-op previous_handler = None handler signum frame This following call uses ` waitid ` WNOHANG C side Therefore Python can still get update process status successfully _error_if_any_worker_fails previous_handler None callable previous_handler raise AssertionError previous_handler callable previous_handler signum frame signal signal signal SIGCHLD handler _SIGCHLD_handler_set = True