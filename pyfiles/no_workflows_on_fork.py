This linter ensures jobs can triggered push pull_request schedule will check repository owner pytorch This ensures forks will run jobs There some edge cases might caught prevents workflows being reused other organizations right now there no workflows both push pull_request etc workflow_call triggers simultaneously so There also setting Github repos can disable all workflows repo __future__ annotations argparse concurrent futures json logging os re enum Enum pathlib Path typing Any NamedTuple Optional TYPE_CHECKING yaml load TYPE_CHECKING collections abc Callable Safely load fast C Yaml loader dumper they available try yaml CSafeLoader Loader except ImportError yaml SafeLoader Loader type ignore assignment misc LintSeverity str Enum ERROR = error WARNING = warning ADVICE = advice DISABLED = disabled LintMessage NamedTuple path str &#124; None line int &#124; None char int &#124; None code str severity LintSeverity name str original str &#124; None replacement str &#124; None description str &#124; None load_yaml path Path - Any open path f load f Loader gen_lint_message filename Optional str = None original Optional str = None replacement Optional str = None description Optional str = None - LintMessage LintMessage path=filename line=None char=None code= NO_WORKFLOWS_ON_FORK severity=LintSeverity ERROR name= format original=original replacement=replacement description=description check_file filename str - list LintMessage logging debug Checking file s filename workflow = load_yaml Path filename bad_jobs dict str Optional str = type workflow dict yaml parses True triggers = workflow get True triggers_to_check = push schedule pull_request pull_request_target any trigger triggers_to_check trigger triggers jobs = workflow get jobs job definition jobs items definition get needs The parent job will have statement continue if_statement = definition get if_statement None bad_jobs job = None type if_statement bool if_statement false pass if_statement = str if_statement valid_checks list Callable str bool = lambda x github repository == pytorch pytorch x github event_name = schedule &#124; &#124; github repository == pytorch pytorch x lambda x github repository_owner == pytorch x any f if_statement f valid_checks bad_jobs job = if_statement open filename f lines = f readlines smart_enough = True original = join lines iterator = iter range len lines replacement = i iterator line = lines i Search job name re_match = re match r + -_\w line re_match re_match group bad_jobs replacement += line continue job_name = re_match group failure_type = bad_jobs job_name failure_type None Just need add statement replacement += f line re_match group github repository_owner == pytorch \n continue Search statement while re match r ^ +if line None replacement += line i = next iterator line = lines i i + len lines re match r ^ + lines i + This multi line statement smart_enough = False break if_statement_match = re match r ^ +if ^# $ line Get comments if_statement_match gen_lint_message description=f Something went wrong when looking job_name if_statement = if_statement_match group strip Handle comment comments comments = if_statement_match group comments comments = + comments Too broad check should catch everything needs_parens = &#124; &#124; if_statement Handle $ has_brackets = re match r \$ \ \ \ \ if_statement internal_statement = has_brackets group strip has_brackets if_statement needs_parens internal_statement = f internal_statement new_line = f internal_statement github repository_owner == pytorch I don t actually know we need $ do just case new_line = $ + new_line + + comments replacement += f re_match group new_line \n description = Please add checks github repository_owner == pytorch following jobs file + join job job bad_jobs smart_enough gen_lint_message filename=filename description=description replacement == original gen_lint_message filename=filename original=original replacement=replacement description=description __name__ == __main__ parser = argparse ArgumentParser description= workflow consistency linter fromfile_prefix_chars= parser add_argument filenames nargs= + help= paths lint args = parser parse_args concurrent futures ProcessPoolExecutor max_workers=os cpu_count executor futures = executor submit check_file x x x args filenames future concurrent futures as_completed futures try lint_message future result print json dumps lint_message _asdict flush=True except Exception logging critical Failed s futures future raise