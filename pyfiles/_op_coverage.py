mypy allow-untyped-defs operator itemgetter torch torch fx torch nn nn functorch compile make_boxed_func torch _functorch compilers aot_module torch _inductor decomposition select_decomp_table torch distributed tensor DTensor inductor_decomps = select_decomp_table graphs list torch fx GraphModule = fwd_bwd_compiler fx_g _ graphs append fx_g make_boxed_func fx_g get_inductor_decomp_graphs model nn Module args kwargs Obtain forward backward graphs model inductor decompositions using tracing aot_module Convenient util get fwd bwd graphs arbitrary model inductor decompositions Note would simply do tracing aot_module don t ensure correctness This useful track ops needed DTensor compiled_mod = aot_module model fw_compiler=fwd_bwd_compiler decompositions=inductor_decomps output = compiled_mod args kwargs output ndim = output scalar tensor default sum order run backward output = output sum output backward one fwd one bwd graph assert len graphs == graphs print_op_coverage_summary model nn Module args kwargs output_csv=False Util print operator coverage summary certain model tabulute Must have tabulate module installed python module required summary csv tabulate tabulate fwd_graph bwd_graph = get_inductor_decomp_graphs model args kwargs op_counts = node fwd_graph graph nodes node op == call_function isinstance node target torch _ops OpOverload node target op_counts op_counts node target = op_counts node target += node bwd_graph graph nodes node op == call_function isinstance node target torch _ops OpOverload node target op_counts op_counts node target = op_counts node target += op_infos = op count op_counts items supported = op DTensor _op_dispatcher sharding_propagator op_to_rules op_infos append op str op _schema count supported sort op info base total count index count_idx = op_infos sort key=itemgetter count_idx reverse=True headers = Operator Schema Total Count Supported pyrefly ignore bad-argument-type print tabulate op_infos headers=headers output_csv Open CSV file writing open op_summary csv w newline= csv_file Create CSV writer object csv_writer = csv writer csv_file csv_writer writerow headers Write each table row CSV file row op_infos pyrefly ignore bad-argument-type csv_writer writerow row