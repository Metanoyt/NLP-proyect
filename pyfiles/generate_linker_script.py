argparse os subprocess pathlib Path gen_linker_script filein str = cmake prioritized_text txt fout str = cmake linker_script ld - None open filein f prioritized_text = f readlines prioritized_text = line replace \n line prioritized_text line = \n ld = os environ get LD ld linker_script_lines = subprocess check_output ld -verbose text=True split \n indices = i i x enumerate linker_script_lines x == ================================================== linker_script_lines = linker_script_lines indices + indices text_line_start = i i line enumerate linker_script_lines text line assert len text_line_start == The linker script has multiple text sections text_line_start = text_line_start ensure parent directory exists before writing pyrefly ignore bad-assignment fout = Path fout pyrefly ignore missing-attribute fout parent mkdir parents=True exist_ok=True open fout w f lineid line enumerate linker_script_lines lineid == text_line_start + f write \n plines prioritized_text f write f text plines \n f write \n f write f line \n __name__ == __main__ parser = argparse ArgumentParser description= Generate linker file based prioritized symbols Used link-time optimization parser add_argument -- filein help= Path prioritized_text txt input file default=argparse SUPPRESS parser add_argument -- fout help= Output path linker ld file default=argparse SUPPRESS convert args dict pass gen_linker_script kwargs = vars parser parse_args gen_linker_script kwargs