Copyright c Meta Platforms Inc affiliates Owner s oncall distributed random torch distributed tensor _dtensor_spec DTensorSpec torch distributed tensor _op_schema OpSchema RuntimeSchemaInfo torch testing _internal common_utils run_tests TestCase TestOpSchema TestCase test_equality_checks_lists_of_dtensor_spec If x == y then we must have h x == h y dts = DTensorSpec mesh=None placements=tuple tensor_meta=None schema = OpSchema op=None args_schema= dts dts kwargs_schema= schema = OpSchema op=None args_schema= dts dts dts kwargs_schema= This regression test these schemas used compare equal assertNotEqual schema schema assertNotEqual hash schema hash schema test_equality_respects_static_attributes _get_sample_op_schemas static_arg_val static_kwarg_val dts = DTensorSpec mesh=None placements=tuple tensor_meta=None static_argnum = static_kwargkey = statickwarg annotated_schemas = False False None True False RuntimeSchemaInfo static_argnum=static_argnum False True RuntimeSchemaInfo static_kwargkey=static_kwargkey True True RuntimeSchemaInfo static_argnum=static_argnum static_kwargkey=static_kwargkey non-tensor args show up hash iff argnum static kwargs show up hash iff their name static_kwargkey random elements random because they supposed matter equality all args_schema = dts random randint static_arg_val kwargs_schema = ignoredkwarg random randint statickwarg static_kwarg_val has_static_arg has_static_kwarg OpSchema op=None args_schema=args_schema kwargs_schema=kwargs_schema schema_info=si has_static_arg has_static_kwarg si annotated_schemas lhs_has_static_arg lhs_has_static_kwarg lhs _get_sample_op_schemas Static arg kwarg both match rhs_has_static_arg rhs_has_static_kwarg rhs _get_sample_op_schemas lhs_has_static_arg == rhs_has_static_arg lhs_has_static_kwarg == rhs_has_static_kwarg assertEqual lhs rhs assertNotEqual lhs rhs Static arg mismatch rhs_has_static_arg rhs_has_static_kwarg rhs _get_sample_op_schemas lhs_has_static_arg rhs_has_static_arg lhs_has_static_kwarg = rhs_has_static_kwarg assertNotEqual lhs rhs assertEqual lhs rhs Static kwarg mismatch rhs_has_static_arg rhs_has_static_kwarg rhs _get_sample_op_schemas lhs_has_static_kwarg rhs_has_static_kwarg lhs_has_static_arg = rhs_has_static_arg assertNotEqual lhs rhs assertEqual lhs rhs Static arg kwarg both mismatch rhs_has_static_arg rhs_has_static_kwarg rhs _get_sample_op_schemas lhs_has_static_arg rhs_has_static_arg lhs_has_static_kwarg rhs_has_static_kwarg assertNotEqual lhs rhs assertEqual lhs rhs __name__ == __main__ run_tests