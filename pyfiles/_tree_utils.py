collections abc Callable typing Any Optional torch utils _pytree Context TreeSpec reorder_kwargs user_kwargs dict str Any spec TreeSpec - dict str Any Reorder user-provided kwargs match order ` spec ` ` spec ` expected in_spec exported program i e spec results flattening ` args kwargs ` We need provide consistent input ordering such so users can pass foo a=a b=b OR foo b=b a=a receive same result Make sure spec actually shaped like args kwargs assert spec type tuple assert spec num_children == kwargs_spec = spec child assert kwargs_spec type dict set user_kwargs = set kwargs_spec context raise ValueError f Ran into kwarg keyword mismatch f Got following keywords list user_kwargs expected kwargs_spec context reordered_kwargs = kw kwargs_spec context reordered_kwargs kw = user_kwargs kw reordered_kwargs is_equivalent spec TreeSpec spec TreeSpec equivalence_fn Callable Optional type Context Optional type Context bool - bool Customizable equivalence check two TreeSpecs Arguments spec The first TreeSpec compare spec The second TreeSpec compare equivalence_fn A function determine equivalence two TreeSpecs examining their types contexts It will called like equivalence_fn spec type spec context spec type spec context This function will applied recursively all children Returns True two TreeSpecs equivalent False otherwise equivalence_fn spec type spec context spec type spec context False Recurse children spec num_children = spec num_children False child_spec child_spec zip spec children spec children is_equivalent child_spec child_spec equivalence_fn False True