mypy allow-untyped-defs __future__ annotations dataclasses dataclass typing Any Optional torch ao quantization QConfigMapping torch ao quantization backend_config BackendConfig torch ao quantization quant_type _get_quant_type_to_str _quant_type_from_str QuantType __all__ = ConvertCustomConfig FuseCustomConfig PrepareCustomConfig StandaloneModuleConfigEntry TODO replace all usages these constants STANDALONE_MODULE_NAME_DICT_KEY = standalone_module_name STANDALONE_MODULE_CLASS_DICT_KEY = standalone_module_class FLOAT_TO_OBSERVED_DICT_KEY = float_to_observed_custom_module_class OBSERVED_TO_QUANTIZED_DICT_KEY = observed_to_quantized_custom_module_class NON_TRACEABLE_MODULE_NAME_DICT_KEY = non_traceable_module_name NON_TRACEABLE_MODULE_CLASS_DICT_KEY = non_traceable_module_class INPUT_QUANTIZED_INDEXES_DICT_KEY = input_quantized_idxs OUTPUT_QUANTIZED_INDEXES_DICT_KEY = output_quantized_idxs PRESERVED_ATTRIBUTES_DICT_KEY = preserved_attributes dataclass StandaloneModuleConfigEntry qconfig_mapping prepare function called submodule None means use qconfig parent qconfig_mapping qconfig_mapping Optional QConfigMapping example_inputs tuple Any prepare_custom_config Optional PrepareCustomConfig backend_config Optional BackendConfig PrepareCustomConfig Custom configuration func ` ~torch ao quantization quantize_fx prepare_fx ` func ` ~torch ao quantization quantize_fx prepare_qat_fx ` Example usage prepare_custom_config = PrepareCustomConfig \ set_standalone_module_name module qconfig_mapping example_inputs \ child_prepare_custom_config backend_config \ set_standalone_module_class MyStandaloneModule qconfig_mapping example_inputs \ child_prepare_custom_config backend_config \ set_float_to_observed_mapping FloatCustomModule ObservedCustomModule \ set_non_traceable_module_names module module \ set_non_traceable_module_classes NonTraceableModule NonTraceableModule \ set_input_quantized_indexes \ set_output_quantized_indexes \ set_preserved_attributes attr attr __init__ - None standalone_module_names dict str StandaloneModuleConfigEntry = standalone_module_classes dict type StandaloneModuleConfigEntry = float_to_observed_mapping dict QuantType dict type type = non_traceable_module_names list str = non_traceable_module_classes list type = input_quantized_indexes list int = output_quantized_indexes list int = preserved_attributes list str = __repr__ dict_nonempty = k v k v __dict__ items len v f PrepareCustomConfig dict_nonempty set_standalone_module_name module_name str qconfig_mapping Optional QConfigMapping example_inputs tuple Any prepare_custom_config Optional PrepareCustomConfig backend_config Optional BackendConfig - PrepareCustomConfig Set configuration running standalone module identified ` ` module_name ` ` If ` ` qconfig_mapping ` ` None parent ` ` qconfig_mapping ` ` will used instead If ` ` prepare_custom_config ` ` None empty ` ` PrepareCustomConfig ` ` will used If ` ` backend_config ` ` None parent ` ` backend_config ` ` will used instead standalone_module_names module_name = StandaloneModuleConfigEntry qconfig_mapping example_inputs prepare_custom_config backend_config set_standalone_module_class module_class type qconfig_mapping Optional QConfigMapping example_inputs tuple Any prepare_custom_config Optional PrepareCustomConfig backend_config Optional BackendConfig - PrepareCustomConfig Set configuration running standalone module identified ` ` module_class ` ` If ` ` qconfig_mapping ` ` None parent ` ` qconfig_mapping ` ` will used instead If ` ` prepare_custom_config ` ` None empty ` ` PrepareCustomConfig ` ` will used If ` ` backend_config ` ` None parent ` ` backend_config ` ` will used instead standalone_module_classes module_class = StandaloneModuleConfigEntry qconfig_mapping example_inputs prepare_custom_config backend_config set_float_to_observed_mapping float_class type observed_class type quant_type QuantType = QuantType STATIC - PrepareCustomConfig Set mapping custom float module custom observed module The observed module must have ` ` from_float ` ` method converts float module observed module This currently only supported static quantization quant_type = QuantType STATIC raise ValueError set_float_to_observed_mapping currently only supported static quantization quant_type float_to_observed_mapping float_to_observed_mapping quant_type = float_to_observed_mapping quant_type float_class = observed_class set_non_traceable_module_names module_names list str - PrepareCustomConfig Set modules symbolically traceable identified name non_traceable_module_names = module_names set_non_traceable_module_classes module_classes list type - PrepareCustomConfig Set modules symbolically traceable identified non_traceable_module_classes = module_classes set_input_quantized_indexes indexes list int - PrepareCustomConfig Set indexes inputs graph should quantized Inputs otherwise assumed fp default instead input_quantized_indexes = indexes set_output_quantized_indexes indexes list int - PrepareCustomConfig Set indexes outputs graph should quantized Outputs otherwise assumed fp default instead output_quantized_indexes = indexes set_preserved_attributes attributes list str - PrepareCustomConfig Set names attributes will persist graph module even they used model s ` ` forward ` ` method preserved_attributes = attributes TODO remove classmethod from_dict cls prepare_custom_config_dict dict str Any - PrepareCustomConfig Create ` ` PrepareCustomConfig ` ` dictionary following items standalone_module_name list module_name qconfig_mapping example_inputs child_prepare_custom_config backend_config tuples standalone_module_class list module_class qconfig_mapping example_inputs child_prepare_custom_config backend_config tuples float_to_observed_custom_module_class nested dictionary mapping quantization mode inner mapping float module classes observed module classes e g static FloatCustomModule ObservedCustomModule non_traceable_module_name list modules names symbolically traceable non_traceable_module_class list module classes symbolically traceable input_quantized_idxs list indexes graph inputs should quantized output_quantized_idxs list indexes graph outputs should quantized preserved_attributes list attributes persist even they used ` ` forward ` ` This function primarily backward compatibility may removed future _get_qconfig_mapping obj Any dict_key str - Optional QConfigMapping Convert given object into QConfigMapping possible throw exception isinstance obj QConfigMapping obj None obj isinstance obj dict QConfigMapping from_dict obj raise ValueError f Expected QConfigMapping prepare_custom_config_dict \ dict_key \ got type obj _get_prepare_custom_config obj Any dict_key str - Optional PrepareCustomConfig Convert given object into PrepareCustomConfig possible throw exception isinstance obj PrepareCustomConfig obj None obj isinstance obj dict PrepareCustomConfig from_dict obj raise ValueError f Expected PrepareCustomConfig prepare_custom_config_dict \ dict_key \ got type obj _get_backend_config obj Any dict_key str - Optional BackendConfig Convert given object into BackendConfig possible throw exception isinstance obj BackendConfig obj None obj isinstance obj dict BackendConfig from_dict obj raise ValueError f Expected BackendConfig prepare_custom_config_dict \ dict_key \ got type obj conf = cls module_name qconfig_dict example_inputs _prepare_custom_config_dict backend_config_dict prepare_custom_config_dict get STANDALONE_MODULE_NAME_DICT_KEY qconfig_mapping = _get_qconfig_mapping qconfig_dict STANDALONE_MODULE_NAME_DICT_KEY prepare_custom_config = _get_prepare_custom_config _prepare_custom_config_dict STANDALONE_MODULE_NAME_DICT_KEY backend_config = _get_backend_config backend_config_dict STANDALONE_MODULE_NAME_DICT_KEY conf set_standalone_module_name module_name qconfig_mapping example_inputs prepare_custom_config backend_config module_class qconfig_dict example_inputs _prepare_custom_config_dict backend_config_dict prepare_custom_config_dict get STANDALONE_MODULE_CLASS_DICT_KEY qconfig_mapping = _get_qconfig_mapping qconfig_dict STANDALONE_MODULE_CLASS_DICT_KEY prepare_custom_config = _get_prepare_custom_config _prepare_custom_config_dict STANDALONE_MODULE_CLASS_DICT_KEY backend_config = _get_backend_config backend_config_dict STANDALONE_MODULE_CLASS_DICT_KEY conf set_standalone_module_class module_class qconfig_mapping example_inputs prepare_custom_config backend_config quant_type_name custom_module_mapping prepare_custom_config_dict get FLOAT_TO_OBSERVED_DICT_KEY items quant_type = _quant_type_from_str quant_type_name float_class observed_class custom_module_mapping items conf set_float_to_observed_mapping float_class observed_class quant_type conf set_non_traceable_module_names prepare_custom_config_dict get NON_TRACEABLE_MODULE_NAME_DICT_KEY conf set_non_traceable_module_classes prepare_custom_config_dict get NON_TRACEABLE_MODULE_CLASS_DICT_KEY conf set_input_quantized_indexes prepare_custom_config_dict get INPUT_QUANTIZED_INDEXES_DICT_KEY conf set_output_quantized_indexes prepare_custom_config_dict get OUTPUT_QUANTIZED_INDEXES_DICT_KEY conf set_preserved_attributes prepare_custom_config_dict get PRESERVED_ATTRIBUTES_DICT_KEY conf to_dict - dict str Any Convert ` ` PrepareCustomConfig ` ` dictionary items described func ` ~torch ao quantization fx custom_config PrepareCustomConfig from_dict ` _make_tuple key Any e StandaloneModuleConfigEntry qconfig_dict = e qconfig_mapping to_dict e qconfig_mapping None prepare_custom_config_dict = e prepare_custom_config to_dict e prepare_custom_config None key qconfig_dict e example_inputs prepare_custom_config_dict e backend_config d dict str Any = module_name sm_config_entry standalone_module_names items STANDALONE_MODULE_NAME_DICT_KEY d d STANDALONE_MODULE_NAME_DICT_KEY = d STANDALONE_MODULE_NAME_DICT_KEY append _make_tuple module_name sm_config_entry module_class sm_config_entry standalone_module_classes items STANDALONE_MODULE_CLASS_DICT_KEY d d STANDALONE_MODULE_CLASS_DICT_KEY = d STANDALONE_MODULE_CLASS_DICT_KEY append _make_tuple module_class sm_config_entry quant_type float_to_observed_mapping float_to_observed_mapping items FLOAT_TO_OBSERVED_DICT_KEY d d FLOAT_TO_OBSERVED_DICT_KEY = d FLOAT_TO_OBSERVED_DICT_KEY _get_quant_type_to_str quant_type = float_to_observed_mapping len non_traceable_module_names d NON_TRACEABLE_MODULE_NAME_DICT_KEY = non_traceable_module_names len non_traceable_module_classes d NON_TRACEABLE_MODULE_CLASS_DICT_KEY = non_traceable_module_classes len input_quantized_indexes d INPUT_QUANTIZED_INDEXES_DICT_KEY = input_quantized_indexes len output_quantized_indexes d OUTPUT_QUANTIZED_INDEXES_DICT_KEY = output_quantized_indexes len preserved_attributes d PRESERVED_ATTRIBUTES_DICT_KEY = preserved_attributes d ConvertCustomConfig Custom configuration func ` ~torch ao quantization quantize_fx convert_fx ` Example usage convert_custom_config = ConvertCustomConfig \ set_observed_to_quantized_mapping ObservedCustomModule QuantizedCustomModule \ set_preserved_attributes attr attr __init__ - None observed_to_quantized_mapping dict QuantType dict type type = preserved_attributes list str = __repr__ dict_nonempty = k v k v __dict__ items len v f ConvertCustomConfig dict_nonempty set_observed_to_quantized_mapping observed_class type quantized_class type quant_type QuantType = QuantType STATIC - ConvertCustomConfig Set mapping custom observed module custom quantized module The quantized module must have ` ` from_observed ` ` method converts observed module quantized module quant_type observed_to_quantized_mapping observed_to_quantized_mapping quant_type = observed_to_quantized_mapping quant_type observed_class = quantized_class set_preserved_attributes attributes list str - ConvertCustomConfig Set names attributes will persist graph module even they used model s ` ` forward ` ` method preserved_attributes = attributes TODO remove classmethod from_dict cls convert_custom_config_dict dict str Any - ConvertCustomConfig Create ` ` ConvertCustomConfig ` ` dictionary following items observed_to_quantized_custom_module_class nested dictionary mapping quantization mode inner mapping observed module classes quantized module classes e g static FloatCustomModule ObservedCustomModule dynamic FloatCustomModule ObservedCustomModule weight_only FloatCustomModule ObservedCustomModule preserved_attributes list attributes persist even they used ` ` forward ` ` This function primarily backward compatibility may removed future conf = cls quant_type_name custom_module_mapping convert_custom_config_dict get OBSERVED_TO_QUANTIZED_DICT_KEY items quant_type = _quant_type_from_str quant_type_name observed_class quantized_class custom_module_mapping items conf set_observed_to_quantized_mapping observed_class quantized_class quant_type conf set_preserved_attributes convert_custom_config_dict get PRESERVED_ATTRIBUTES_DICT_KEY conf to_dict - dict str Any Convert ` ` ConvertCustomConfig ` ` dictionary items described func ` ~torch ao quantization fx custom_config ConvertCustomConfig from_dict ` d dict str Any = quant_type observed_to_quantized_mapping observed_to_quantized_mapping items OBSERVED_TO_QUANTIZED_DICT_KEY d d OBSERVED_TO_QUANTIZED_DICT_KEY = d OBSERVED_TO_QUANTIZED_DICT_KEY _get_quant_type_to_str quant_type = observed_to_quantized_mapping len preserved_attributes d PRESERVED_ATTRIBUTES_DICT_KEY = preserved_attributes d FuseCustomConfig Custom configuration func ` ~torch ao quantization quantize_fx fuse_fx ` Example usage fuse_custom_config = FuseCustomConfig set_preserved_attributes attr attr __init__ - None preserved_attributes list str = __repr__ dict_nonempty = k v k v __dict__ items len v f FuseCustomConfig dict_nonempty set_preserved_attributes attributes list str - FuseCustomConfig Set names attributes will persist graph module even they used model s ` ` forward ` ` method preserved_attributes = attributes TODO remove classmethod from_dict cls fuse_custom_config_dict dict str Any - FuseCustomConfig Create ` ` ConvertCustomConfig ` ` dictionary following items preserved_attributes list attributes persist even they used ` ` forward ` ` This function primarily backward compatibility may removed future conf = cls conf set_preserved_attributes fuse_custom_config_dict get PRESERVED_ATTRIBUTES_DICT_KEY conf to_dict - dict str Any Convert ` ` FuseCustomConfig ` ` dictionary items described func ` ~torch ao quantization fx custom_config ConvertCustomConfig from_dict ` d dict str Any = len preserved_attributes d PRESERVED_ATTRIBUTES_DICT_KEY = preserved_attributes d