__future__ annotations contextlib os typing unittest unittest mock tools setup_helpers cmake tools setup_helpers env noqa F unused resolves circular typing TYPE_CHECKING collections abc Iterator Sequence T = typing TypeVar T TestCMake unittest TestCase unittest mock patch multiprocessing cpu_count test_build_jobs mock_cpu_count unittest mock MagicMock - None Tests number build jobs comes out correctly mock_cpu_count return_value = cases = MAX_JOBS USE_NINJA IS_WINDOWS want True False -j noqa E E None True False None noqa E E False False -j noqa E E None False False -j noqa E E True True -j noqa E E None True True None noqa E E False True -j noqa E E None False True -j noqa E E max_jobs use_ninja is_windows want cases subTest MAX_JOBS=max_jobs USE_NINJA=use_ninja IS_WINDOWS=is_windows contextlib ExitStack stack stack enter_context env_var MAX_JOBS max_jobs stack enter_context unittest mock patch object tools setup_helpers cmake USE_NINJA use_ninja stack enter_context unittest mock patch object tools setup_helpers cmake IS_WINDOWS is_windows cmake = tools setup_helpers cmake CMake unittest mock patch object cmake run cmake_run cmake build cmake_run assert_called_once call = cmake_run mock_calls build_args _ = call args want None assertNotIn -j build_args assert_contains_sequence build_args want staticmethod assert_contains_sequence sequence Sequence T subsequence Sequence T - None Raises assertion subsequence contained sequence len subsequence == all sequences contain empty subsequence Iterate over all windows len subsequence Stop window matches i range len sequence - len subsequence + candidate = sequence i i + len subsequence assert len candidate == len subsequence sanity check candidate == subsequence found raise AssertionError f subsequence found sequence contextlib contextmanager env_var key str value str &#124; None - Iterator None Sets clears environment variable within Python context Get previous value then override previous_value = os environ get key set_env_var key value try yield finally Restore previous value set_env_var key previous_value set_env_var key str value str &#124; None - None Sets clears environment variable value None os environ pop key None os environ key = value __name__ == __main__ unittest main