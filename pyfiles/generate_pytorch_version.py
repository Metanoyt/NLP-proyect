usr bin env python argparse os re subprocess datetime datetime distutils util strtobool pathlib Path LEADING_V_PATTERN = re compile ^v TRAILING_RC_PATTERN = re compile -rc - $ LEGACY_BASE_VERSION_SUFFIX_PATTERN = re compile $ NoGitTagException Exception pass get_pytorch_root - Path Path subprocess check_output git rev-parse -- show-toplevel decode ascii strip get_tag - str root = get_pytorch_root try dirty_tag = subprocess check_output git describe -- tags -- exact cwd=root decode ascii strip except subprocess CalledProcessError Strip leading v we typically do when we tag branches ie v - tag = re sub LEADING_V_PATTERN dirty_tag Strip trailing rc pattern ie -rc - tag = re sub TRAILING_RC_PATTERN tag Ignore ciflow tags tag startswith ciflow tag get_base_version - str root = get_pytorch_root dirty_version = open root version txt read strip Strips trailing version txt too sure why s there first place re sub LEGACY_BASE_VERSION_SUFFIX_PATTERN dirty_version PytorchVersion __init__ gpu_arch_type str gpu_arch_version str no_build_suffix bool - None gpu_arch_type = gpu_arch_type gpu_arch_version = gpu_arch_version no_build_suffix = no_build_suffix get_post_build_suffix - str no_build_suffix gpu_arch_type == cuda f +cu gpu_arch_version replace f + gpu_arch_type gpu_arch_version get_release_version - str get_tag raise NoGitTagException Not git tag you sure you want release version f get_tag get_post_build_suffix get_nightly_version - str date_str = datetime today strftime Y m d build_suffix = get_post_build_suffix f get_base_version dev date_str build_suffix main - None parser = argparse ArgumentParser description= Generate pytorch version binary builds parser add_argument -- no-build-suffix action= store_true help= Whether add build suffix typically +cpu default=strtobool os environ get NO_BUILD_SUFFIX False parser add_argument -- gpu-arch-type type=str help= GPU arch you building typically cpu cuda rocm default=os environ get GPU_ARCH_TYPE cpu parser add_argument -- gpu-arch-version type=str help= GPU arch version typically leave blank CPU default=os environ get GPU_ARCH_VERSION args = parser parse_args version_obj = PytorchVersion args gpu_arch_type args gpu_arch_version args no_build_suffix try print version_obj get_release_version except NoGitTagException print version_obj get_nightly_version __name__ == __main__ main