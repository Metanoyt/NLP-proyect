mypy allow-untyped-defs torch functorch experimental control_flow cond MySubModule torch nn Module foo x x cos forward x foo x CondBranchClassMethod torch nn Module The branch functions ` true_fn ` ` false_fn ` passed cond must follow these rules - both branches must take same args which must also match branch args passed cond - both branches must single tensor - returned tensor must have same tensor metadata e g shape dtype - branch function can free function nested function lambda methods - branch function can have closure variables - no inplace mutations inputs global variables This example demonstrates using method cond NOTE If ` pred ` test dim batch size will specialized __init__ - None super __init__ subm = MySubModule bar x x sin forward x cond x shape = subm forward bar x example_args = torch randn tags = torch cond torch dynamic-shape model = CondBranchClassMethod