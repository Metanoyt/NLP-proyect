Owner s module inductor typing Callable torch torch _dynamo testing rand_strided torch _dynamo utils same torch _inductor config inductor_config torch _inductor test_case run_tests TestCase torch _inductor utils run_and_get_triton_code torch testing FileCheck torch testing _internal common_utils skipIfXpu torch testing _internal inductor_utils GPU_TYPE HAS_GPU aten = torch ops aten inductor_config patch triton native_matmul True TestTritonDotReduction TestCase _check_equal f Callable example_inputs tuple torch Tensor compiled = torch compile f actual = compiled example_inputs expect = f example_inputs assertTrue same expect actual _check_code f Callable example_inputs tuple torch Tensor kernel_count int dot_count int f = torch compile f code = run_and_get_triton_code f example_inputs FileCheck check_regex r triton mm \ run\ run code FileCheck check_count triton jit kernel_count check_count tl dot dot_count run code test_matmul f x y z = x y z M K N = x = rand_strided M K K device=GPU_TYPE y = rand_strided K N N device=GPU_TYPE _check_equal f x y _check_code f x y test_mm_ d_expand f x y M K z = x None expand M K y z M K N = x = rand_strided M device=GPU_TYPE y = rand_strided K N N device=GPU_TYPE _check_equal f x y M K _check_code f x y M K test_mm_ _expand f x y M K z = x None expand M K y z M K N = x = rand_strided device=GPU_TYPE y = rand_strided K N N device=GPU_TYPE _check_equal f x y M K _check_code f x y M K test_matmul_fp f x y z = x y x dtype z M K N = x = rand_strided M K K dtype=torch float device=GPU_TYPE y = rand_strided K N N dtype=torch float device=GPU_TYPE _check_equal f x y _check_code f x y test_reduction_mask_zeroout f x y x + y - M K N = x = rand_strided M K K device=GPU_TYPE y = rand_strided K N N device=GPU_TYPE _check_equal f x y _check_code f x y skipIfXpu msg= Intel triton issue https github com intel intel-xpu-backend-for-triton issues test_ mm_add f x y z w r t x y + z w + r t M K N = x = rand_strided M K K device=GPU_TYPE y = rand_strided K N N device=GPU_TYPE w = rand_strided M K K device=GPU_TYPE z = rand_strided K N N device=GPU_TYPE r = rand_strided M K K device=GPU_TYPE t = rand_strided K N N device=GPU_TYPE _check_equal f x y z w r t _check_code f x y z w r t test_mm_complex f x y z w x z y + w + M K N = x = rand_strided M K K device=GPU_TYPE y = rand_strided K N N device=GPU_TYPE z = torch randint M M K dtype=torch long device=GPU_TYPE w = rand_strided M N N device=GPU_TYPE _check_equal f x y z w _check_code f x y z w test_batchmatmul f x y z = torch bmm x y z B M K N = x = rand_strided B M K M K K device=GPU_TYPE y = rand_strided B K N K N N device=GPU_TYPE _check_equal f x y _check_code f x y HAS_GPU torch set_default_device GPU_TYPE __name__ == __main__ HAS_GPU run_tests