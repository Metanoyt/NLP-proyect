Owner s oncall export torch _export serde schema_check _Commit _diff_schema check SchemaUpdateError update_schema torch testing _internal common_utils IS_FBCODE run_tests TestCase TestSchema TestCase test_schema_compatibility msg = Detected invalidated change export schema Please run following script update schema Example s python scripts export update_schema py -- prefix path_to_torch_development_directory IS_FBCODE msg += buck run caffe export_update_schema -- -- prefix data users $ USER fbsource fbcode caffe try commit = update_schema except SchemaUpdateError e fail f Failed update schema e \n msg assertEqual commit checksum_head commit checksum_next msg test_thrift_schema_unchanged msg = Detected unexpected change schema thrift Please update schema py instead run following script Example s python scripts export update_schema py -- prefix path_to_torch_development_directory IS_FBCODE msg += buck run caffe export_update_schema -- -- prefix data users $ USER fbsource fbcode caffe try commit = update_schema except SchemaUpdateError e fail f Failed update schema e \n msg assertEqual commit thrift_checksum_head commit thrift_checksum_real msg assertEqual commit thrift_checksum_head commit thrift_checksum_next msg test_schema_diff additions subtractions = _diff_schema Type kind struct fields Type kind struct fields field type field type field type default Type kind struct fields field type default field type default field type Type kind struct fields assertEqual additions Type kind struct fields Type fields field type default field default assertEqual subtractions Type kind struct fields Type fields field type field default test_schema_check Adding field without default value dst = Type kind struct fields field type SCHEMA_VERSION src = Type kind struct fields field type field type SCHEMA_VERSION additions subtractions = _diff_schema dst src commit = _Commit result=src checksum_next= yaml_path= additions=additions subtractions=subtractions base=dst checksum_head= cpp_header= cpp_header_path= thrift_checksum_head= thrift_checksum_real= thrift_checksum_next= thrift_schema= thrift_schema_path= next_version _ = check commit assertEqual next_version Removing field dst = Type kind struct fields field type SCHEMA_VERSION src = Type kind struct fields SCHEMA_VERSION additions subtractions = _diff_schema dst src commit = _Commit result=src checksum_next= yaml_path= additions=additions subtractions=subtractions base=dst checksum_head= cpp_header= cpp_header_path= thrift_checksum_head= thrift_checksum_real= thrift_checksum_next= thrift_schema= thrift_schema_path= next_version _ = check commit assertEqual next_version Adding field default value dst = Type kind struct fields field type SCHEMA_VERSION src = Type kind struct fields field type field type default SCHEMA_VERSION additions subtractions = _diff_schema dst src commit = _Commit result=src checksum_next= yaml_path= additions=additions subtractions=subtractions base=dst checksum_head= cpp_header= cpp_header_path= thrift_checksum_head= thrift_checksum_real= thrift_checksum_next= thrift_schema= thrift_schema_path= next_version _ = check commit assertEqual next_version Changing field type dst = Type kind struct fields field type SCHEMA_VERSION src = Type kind struct fields field type int SCHEMA_VERSION assertRaises SchemaUpdateError _diff_schema dst src Adding new type dst = Type kind struct fields field type SCHEMA_VERSION src = Type kind struct fields field type Type kind struct fields SCHEMA_VERSION additions subtractions = _diff_schema dst src commit = _Commit result=src checksum_next= yaml_path= additions=additions subtractions=subtractions base=dst checksum_head= cpp_header= cpp_header_path= thrift_checksum_head= thrift_checksum_real= thrift_checksum_next= thrift_schema= thrift_schema_path= next_version _ = check commit assertEqual next_version Removing type dst = Type kind struct fields field type SCHEMA_VERSION src = SCHEMA_VERSION additions subtractions = _diff_schema dst src commit = _Commit result=src checksum_next= yaml_path= additions=additions subtractions=subtractions base=dst checksum_head= cpp_header= cpp_header_path= thrift_checksum_head= thrift_checksum_real= thrift_checksum_next= thrift_schema= thrift_schema_path= next_version _ = check commit assertEqual next_version Adding new field union dst = Type kind union fields field type SCHEMA_VERSION src = Type kind union fields field type field type SCHEMA_VERSION additions subtractions = _diff_schema dst src commit = _Commit result=src checksum_next= yaml_path= additions=additions subtractions=subtractions base=dst checksum_head= cpp_header= cpp_header_path= thrift_checksum_head= thrift_checksum_real= thrift_checksum_next= thrift_schema= thrift_schema_path= next_version _ = check commit assertEqual next_version Removing field union dst = Type kind union fields field type SCHEMA_VERSION src = Type kind union fields SCHEMA_VERSION additions subtractions = _diff_schema dst src commit = _Commit result=src checksum_next= yaml_path= additions=additions subtractions=subtractions base=dst checksum_head= cpp_header= cpp_header_path= thrift_checksum_head= thrift_checksum_real= thrift_checksum_next= thrift_schema= thrift_schema_path= next_version _ = check commit assertEqual next_version test_schema_comparison torch _export serde schema schema sig = schema ModuleCallSignature inputs= schema Argument create as_none=True schema Argument create as_sym_int=schema SymIntArgument create as_name= s outputs= schema Argument create as_sym_int=schema SymIntArgument create as_name= s in_spec= foo out_spec= bar forward_arg_names= None symint same content sig sig_same = schema ModuleCallSignature inputs= schema Argument create as_none=True schema Argument create as_sym_int=schema SymIntArgument create as_name= s outputs= schema Argument create as_sym_int=schema SymIntArgument create as_name= s in_spec= foo out_spec= bar forward_arg_names= None symint as_name symint different sig_diff = schema ModuleCallSignature inputs= schema Argument create as_none=True schema Argument create as_sym_int=schema SymIntArgument create as_name= s outputs= schema Argument create as_sym_int=schema SymIntArgument create as_name= s in_spec= foo out_spec= bar forward_arg_names= None symint assertEqual sig sig_same assertNotEqual sig sig_diff __name__ == __main__ run_tests