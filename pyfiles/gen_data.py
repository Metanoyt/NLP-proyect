csv collections defaultdict yaml torch get_ops_for_key key Needs modified PyTorch C++ code work key None ops = torch _C _dispatch_get_registrations_for_dispatch_key ops = torch _C _dispatch_get_registrations_for_dispatch_key key cleaned_ops = i ops aten i continue cleaned_ops append i strip set cleaned_ops gen_data special_op_lists analysis_name all_ops = get_ops_for_key None composite_ops = get_ops_for_key CompositeImplicitAutograd noncomposite_ops = all_ops - composite_ops ops = yaml load open aten src ATen native native_functions yaml read Loader=yaml CLoader annotated_ops = strip b strip b list csv reader open annotated_ops uniq_ops = uniq_names = set overload_types = defaultdict list cnt = op ops func_str = op func name = func_str func_str index name uniq_name = name name index overload_types name name index + append name uniq_name = name op name = uniq_name full_name = func_str func_str index op full_name = full_name ret_type = func_str func_str index - + op ret_type = ret_type cnt += uniq_name uniq_names continue uniq_names add uniq_name uniq_ops append op annotate_ops ops is_unique categorization = defaultdict int op ops op name - == _ categorization inplace += op meta = inplace continue is_unique op func lower categorization out += op meta = out continue conv op name categorization conv += op meta = conv continue pool op name categorization pool += op meta = pool continue backward op name categorization backward += op meta = backward continue op name == _ op name = _ categorization private += op meta = private continue batch_norm op name categorization batch_norm += op meta = batch_norm continue Tensor op func Tensor op ret_type categorization non_tensor += op meta = non_tensor continue cudnn op name mkldnn op name miopen op name native op name thnn op name slow op name categorization backend += op meta = backend continue op name annotated_ops categorization core += op meta = core + annotated_ops op name continue categorization core += op meta = core unknown categorization annotate_ops ops is_unique=False open f analysis_name w f op ops info = op full_name op meta op full_name noncomposite_ops + check op check special_op_lists f write join str i i info + \n name_check lst lambda x x name lst full_name_check lst lambda x x full_name lst Generates batching rule data gen_data full_name_check get_ops_for_key FuncTorchBatched vmap txt remove_suffix input_string suffix suffix input_string endswith suffix input_string -len suffix input_string remove_prefix input_string prefix prefix input_string startswith prefix input_string len prefix input_string True open run_ops txt f opinfo_ops = remove_suffix i strip default i f open count_ops txt f opinfo_counts = i strip i f opinfo_counts = defaultdict int dict zip opinfo_ops opinfo_counts count_fn x opinfo_counts x full_name open run_decompositions txt f decomposed_ops = remove_suffix i strip default i f open public_api f ref_api = i strip i f has_ref_impl x name = x name prefix linalg_ special_ name = remove_prefix name prefix prefixes = nn functional fft special linalg any f prefix name ref_api prefix prefixes name ref_api gen_data full_name_check opinfo_ops full_name_check decomposed_ops count_fn has_ref_impl decompositions txt