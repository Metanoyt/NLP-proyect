Owner s module dynamo Test functions matrix module functools unittest expectedFailure xfail skipIf skipif pytest pytest raises assert_raises torch testing _internal common_utils instantiate_parametrized_tests parametrize run_tests TEST_WITH_TORCHDYNAMO TestCase xpassIfTorchDynamo_np If we going trace through these we should use NumPy If testing eager mode we use torch _numpy TEST_WITH_TORCHDYNAMO numpy np numpy arange array diag eye fliplr flipud histogram d ones tri tril_indices tril_indices_from triu_indices triu_indices_from vander zeros numpy testing assert_allclose assert_array_almost_equal assert_array_equal assert_equal torch _numpy np torch _numpy arange array diag eye fliplr flipud histogram d ones tri tril_indices tril_indices_from triu_indices triu_indices_from vander zeros torch _numpy testing assert_allclose assert_array_almost_equal assert_array_equal assert_equal skip = functools partial skipif True get_mat n data = np arange n data = np add outer data data data = data None + data None data TestEye TestCase test_basic assert_equal eye array assert_equal eye dtype= f array f assert_equal eye == eye dtype=bool test_diag assert_equal eye k= array assert_equal eye k=- array test_ d assert_equal eye array assert_equal eye array test_diag d assert_equal eye k= array assert_equal eye k=- array test_eye_bounds assert_equal eye assert_equal eye - assert_equal eye assert_equal eye - assert_equal eye assert_equal eye assert_equal eye - assert_equal eye - assert_equal eye - test_bool assert_equal eye dtype=bool True False False True xpassIfTorchDynamo_np reason= TODO implement order=non-default test_order mat_c = eye k=- mat_f = eye k=- order= F assert_equal mat_c mat_f assert mat_c flags c_contiguous assert mat_c flags f_contiguous assert mat_f flags c_contiguous assert mat_f flags f_contiguous TestDiag TestCase test_vector vals = arange astype l b = zeros k range b k k = vals k assert_equal diag vals b b = zeros c = b copy k range b k k + = vals k c k + k = vals k assert_equal diag vals k= b assert_equal diag vals k=- c test_matrix check_matrix vals= get_mat + astype l check_matrix vals b = zeros k range b k = vals k k assert_equal diag vals b b = b k range b k = vals k k + assert_equal diag vals b k range b k = vals k + k assert_equal diag vals - b xpassIfTorchDynamo_np reason= TODO implement orders test_fortran_order vals = array get_mat + order= F dtype= l check_matrix vals test_diag_bounds A = assert_equal diag A k= assert_equal diag A k= assert_equal diag A k= assert_equal diag A k=- assert_equal diag A k=- assert_equal diag A k=- test_failure assert_raises ValueError RuntimeError diag TestFliplr TestCase test_basic assert_raises ValueError RuntimeError fliplr ones = get_mat b = - b = np flip assert_equal fliplr b = b = assert_equal fliplr b TestFlipud TestCase test_basic = get_mat b = - b = np flip assert_equal flipud b = b = assert_equal flipud b instantiate_parametrized_tests TestHistogram d TestCase test_simple x = array e- y = array xedges = np linspace yedges = np linspace H = histogram d x y xedges yedges answer = array assert_array_equal H T answer H = histogram d x y xedges assert_array_equal H T answer H xedges yedges = histogram d list range list range assert_array_equal H eye assert_array_equal xedges np linspace assert_array_equal yedges np linspace test_asym x = array y = array H xed yed = histogram d x y range= density=True answer = array assert_array_almost_equal H answer assert_array_equal xed np linspace assert_array_equal yed np linspace test_density x = array y = array H xed yed = histogram d x y density=True answer = array assert_array_almost_equal H answer test_all_outliers r = np random rand + + e histogramdd rounds decimal= H xed yed = histogram d r r range= assert_array_equal H test_empty edge edge = histogram d bins= assert_array_max_ulp array assert_allclose np array atol= e- edge edge = histogram d bins= assert_array_max_ulp np zeros assert_allclose np zeros atol= e- xpassIfTorchDynamo_np reason= pytorch does support bins = int array test_binparameter_combination x = array y = array edges = H xe ye = histogram d x y edges answer = array assert_array_equal H answer assert_array_equal ye array H xe ye = histogram d x y edges answer = array assert_array_equal H answer assert_array_equal xe array skip reason= NP_VER fails CI older NumPy parametrize x_len y_len test_bad_length x_len y_len x y = np ones x_len np ones y_len pytest raises ValueError match= x y must have same length histogram d x y TestTri TestCase test_dtype out = array assert_array_equal tri out assert_array_equal tri dtype=bool out astype bool test_tril_triu_ndim dtype np typecodes AllFloat + np typecodes AllInteger = np ones dtype=dtype b = np tril c = np triu assert_array_equal b assert_array_equal c b T should same dtype original array assert_equal b dtype dtype assert_equal c dtype dtype test_tril_triu_ndim dtype np typecodes AllFloat + np typecodes AllInteger = np array dtype=dtype a_tril_desired = np array dtype=dtype a_triu_desired = np array dtype=dtype a_triu_observed = np triu a_tril_observed = np tril assert_array_equal a_triu_observed a_triu_desired assert_array_equal a_tril_observed a_tril_desired assert_equal a_triu_observed dtype dtype assert_equal a_tril_observed dtype dtype test_tril_triu_with_inf Issue arr = np array np inf np inf out_tril = np array np inf out_triu = out_tril T assert_array_equal np triu arr out_triu assert_array_equal np tril arr out_tril test_tril_triu_dtype Issue tril triu should same dtype input c efdFDBbhil np typecodes All arr = np zeros dtype=c assert_equal np triu arr dtype arr dtype assert_equal np tril arr dtype arr dtype xfail reason= TODO implement mask_indices test_mask_indices simple test without offset iu = mask_indices np triu = np arange reshape assert_array_equal iu array Now offset iu = mask_indices np triu assert_array_equal iu array xfail reason= np tril_indices == our tuple tril_indices test_tril_indices indices without offset il = tril_indices il = tril_indices k= il = tril_indices m= il = tril_indices k= m= = np array b = np arange reshape indexing assert_array_equal il array assert_array_equal b il array And assigning values il = - assert_array_equal array - - - - - - - - - - b il = - assert_array_equal b array - - - - - - - - - - These cover almost whole array two diagonals right main one il = - assert_array_equal array - - - - - - - - - - - - - - - b il = - assert_array_equal b array - - - - - - - - - - - - - - - - - xfail reason= np triu_indices == our tuple triu_indices TestTriuIndices TestCase test_triu_indices iu = triu_indices iu = triu_indices k= iu = triu_indices m= iu = triu_indices k= m= = np array b = np arange reshape Both indexing assert_array_equal iu array assert_array_equal b iu array And assigning values iu = - assert_array_equal array - - - - - - - - - - b iu = - assert_array_equal b array - - - - - - - - - - - - - - These cover almost whole array two diagonals right main one iu = - assert_array_equal array - - - - - - - - - - b iu = - assert_array_equal b array - - - - - - - - - - - - - - TestTrilIndicesFrom TestCase test_exceptions assert_raises ValueError tril_indices_from np ones assert_raises ValueError tril_indices_from np ones assert_raises ValueError tril_indices_from np ones TestTriuIndicesFrom TestCase test_exceptions assert_raises ValueError triu_indices_from np ones assert_raises ValueError triu_indices_from np ones assert_raises ValueError triu_indices_from np ones TestVander TestCase test_basic c = np array - v = vander c powers = np array - - Check default value N assert_array_equal v powers Check range N values including greater than default m = powers shape n range v = vander c N=n assert_array_equal v powers m - n m test_dtypes c = array - dtype=np int v = vander c expected = np array - assert_array_equal v expected c = array + j - j v = vander c N= expected = np array j + j - j - j The data floating point values small integers so assert_array_equal should safe here rather than say assert_array_almost_equal assert_array_equal v expected __name__ == __main__ run_tests