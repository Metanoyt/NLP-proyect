Owner s oncall profiler os subprocess sys unittest mock patch torch torch testing _internal common_utils run_tests TestCase SimpleKinetoInitializationTest TestCase patch dict os environ KINETO_USE_DAEMON test_kineto_profiler_with_environment_variable This test checks whether kineto works torch daemon mode please refer issue Besides test will also check kineto will initialized when user loads shared library directly script = torch torch cuda is_available torch cuda init try subprocess check_output sys executable -W always -c script cwd=os path dirname os path realpath __file__ except subprocess CalledProcessError e e returncode = assertTrue False Kineto working properly Dynolog environment variable shared library directly - triggers static init doesn t call kineto_init env = os environ copy env KINETO_USE_DAEMON = KINETO_DAEMON_INIT_DELAY_S env env pop KINETO_DAEMON_INIT_DELAY_S _ stderr = TestCase run_process_no_exception f ctypes CDLL CDLL torch _C __file__ assertNotRegex stderr decode ascii Registering daemon config loader kineto should initialized when shared library imported directly __name__ == __main__ run_tests