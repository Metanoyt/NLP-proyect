mypy allow-untyped-defs Example use Timer sparse op fuzzers measure kernel performance $ python -m examples sparse op_benchmark numpy np torch torch utils benchmark Timer torch utils benchmark op_fuzzers sparse_unary UnaryOpSparseFuzzer torch utils benchmark op_fuzzers sparse_binary BinaryOpSparseFuzzer operator _MEASURE_TIME = assert_dicts_equal dict_ dict_ Builtin dict comparison will compare numpy arrays e g x = np ones x == x Raises ValueError set dict_ keys = set dict_ keys raise AssertionError dicts must have same keys all np all v = dict_ k k v dict_ items k = dtype raise AssertionError dict values differ keys other than dtype run n stmt fuzzer_cls float_iter = fuzzer_cls seed= dtype=torch float take n double_iter = fuzzer_cls seed= dtype=torch float take n raw_results = i float_values int_values enumerate zip float_iter double_iter strict=True float_tensors float_tensor_params float_params = float_values int_tensors int_tensor_params int_params = int_values assert_dicts_equal float_params int_params assert_dicts_equal float_tensor_params x int_tensor_params x float_measurement int_measurement = Timer stmt globals=tensors blocked_autorange min_run_time=_MEASURE_TIME tensors float_tensors int_tensors descriptions = name float_tensors shape_str = + join f int np log i int np log i == i i str i i float_tensors name shape + sparse_dim = float_tensor_params name sparse_dim sparse_dim_str = str sparse_dim is_coalesced = float_tensor_params name is_coalesced is_coalesced_str = True is_coalesced False descriptions append name shape_str sparse_dim_str is_coalesced_str raw_results append float_measurement int_measurement descriptions print f \r i + n end= print parsed_results name_len shape_len sparse_dim_len is_coalesced_len = float_measurement int_measurement descriptions raw_results t_float = float_measurement median e t_int = int_measurement median e rel_diff = abs t_float - t_int t_float + t_int parsed_results append t_float t_int rel_diff descriptions name shape sparse_dim is_coalesced descriptions name_len = max name_len len name shape_len = max shape_len len shape sparse_dim_len = max sparse_dim_len len sparse_dim is_coalesced_len = max is_coalesced_len len is_coalesced parsed_results sort key=operator itemgetter print f stmt stmt print f diff faster name_len end= print f shape ljust shape_len sparse_dim ljust sparse_dim_len end= print f is_coalesced\n - results spacer parsed_results parsed_results - t_float t_int rel_diff descriptions results time_str = f rel_diff f int t_int t_float float time_str extend ljust len time_str _ descriptions - t_str name shape sparse_dim is_coalesced zip time_str descriptions strict=True name = f name ljust name_len + shape = shape ljust shape_len + sparse_dim = sparse_dim ljust sparse_dim_len print f t_str name shape &#124; sparse_dim &#124; is_coalesced print spacer main run n= stmt= torch sparse sum x dim= fuzzer_cls=UnaryOpSparseFuzzer run n= stmt= torch sparse softmax x dim= fuzzer_cls=UnaryOpSparseFuzzer run n= stmt= x + y fuzzer_cls=BinaryOpSparseFuzzer __name__ == __main__ main