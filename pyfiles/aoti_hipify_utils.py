re torch It good idea directly apply hipify_torch codegen which will vulnerable cases like codecache CudaKernelParamCache In such cases we do need hipify_torch original file name codegen codecache maybe_hipify_code_wrapper source_codes str force_hipify bool = False - str torch version hip None force_hipify source_codes try torch utils hipify hipify_python PYTORCH_MAP PYTORCH_TRIE except ImportError hipify available non-AMD builds source_codes c _repl m re Match str - object PYTORCH_MAP m group We need redefine RE_PYTORCH_PREPROCESSOR here since hipify_torch will apply positive lookbehind =\W pattern avoid matching keyword beginning code line However can happen codegen which will cause pattern match Note lookahead =\W still needed keep hipification idomponent example we need skip replacing getStreamFromExternal getStreamFromExternalMasqueradingAsCUDA RE_PYTORCH_PREPROCESSOR = re compile rf PYTORCH_TRIE export_to_regex =\W source_codes = RE_PYTORCH_PREPROCESSOR sub c _repl source_codes type ignore arg-type source_codes