usr bin env python json os tempfile typing Any unittest main mock TestCase yaml filter_test_configs filter filter_selected_test_configs get_labels mark_unstable_jobs parse_reenabled_issues perform_misc_tasks PREFIX remove_disabled_jobs set_periodic_modes SUPPORTED_PERIODICAL_MODES MOCKED_DISABLED_UNSTABLE_JOBS = pull mock-platform- pytorchbot https github com pytorch pytorch issues pull mock-platform- trunk mock-platform- build pytorchbot https github com pytorch pytorch issues trunk mock-platform- build periodic mock-platform- test pytorchbot https github com pytorch pytorch issues periodic mock-platform- test pull mock-platform- build-and-test pytorchbot https github com pytorch pytorch issues pull mock-platform- build-and-test trunk mock-platform- test backward_compat pytorchbot https github com pytorch pytorch issues trunk mock-platform- test backward_compat periodic mock-platform- build-and-test default pytorchbot https github com pytorch pytorch issues periodic mock-platform- build-and-test default pull mock-platform- test invalid syntax pytorchbot https github com pytorch pytorch issues pull mock-platform- test invalid syntax trunk mock-platform- build dynamo pytorchbot https github com pytorch pytorch issues trunk mock-platform- build dynamo linux-binary-libtorch-cxx -abi libtorch-cpu-shared-with-deps-cxx -abi-test test pytorchbot https github com pytorch pytorch issues linux-binary-libtorch-cxx -abi libtorch-cpu-shared-with-deps-cxx -abi-test test linux-binary-manywheel manywheel-py _ -cuda _ -build pytorchbot https github com pytorch pytorch issues linux-binary-manywheel manywheel-py _ -cuda _ -build MOCKED_PR_INFO = url https api github com repos pytorch pytorch issues repository_url https api github com repos pytorch pytorch labels_url https api github com repos pytorch pytorch issues labels name comments_url https api github com repos pytorch pytorch issues comments events_url https api github com repos pytorch pytorch issues events html_url https github com pytorch pytorch pull id node_id MDExOlB bGxSZXF ZXN MjA ODcwMTUy number title Add matrix_rank user login vishwakftw id node_id MDQ VXNlcjIzNjM MzAy avatar_url https avatars githubusercontent com u v= gravatar_id url https api github com users vishwakftw html_url https github com vishwakftw followers_url https api github com users vishwakftw followers following_url https api github com users vishwakftw following other_user gists_url https api github com users vishwakftw gists gist_id starred_url https api github com users vishwakftw starred owner repo subscriptions_url https api github com users vishwakftw subscriptions organizations_url https api github com users vishwakftw orgs repos_url https api github com users vishwakftw repos events_url https api github com users vishwakftw events privacy received_events_url https api github com users vishwakftw received_events type User site_admin False labels id node_id MDU TGFiZWwxMzkyNTkwMDUx url https api github com repos pytorch pytorch labels open source name open source color ededed default False description None id node_id MDU TGFiZWwxMzkyNTkwMDUx url https api github com repos pytorch pytorch labels open source name foo color ededed default False description None id node_id MDU TGFiZWwxMzkyNTkwMDUx url https api github com repos pytorch pytorch labels open source name color ededed default False description None state closed locked False assignee None assignees milestone None comments created_at - - T Z updated_at - - T Z closed_at - - T Z author_association CONTRIBUTOR active_lock_reason None draft False pull_request url https api github com repos pytorch pytorch pulls html_url https github com pytorch pytorch pull diff_url https github com pytorch pytorch pull diff patch_url https github com pytorch pytorch pull patch merged_at None body - Similar functionality NumPy\r\n- Added doc string\r\n- Added tests\r\n\r\ncc SsnL \r\n\r\nCloses closed_by login vishwakftw id node_id MDQ VXNlcjIzNjM MzAy avatar_url https avatars githubusercontent com u v= gravatar_id url https api github com users vishwakftw html_url https github com vishwakftw followers_url https api github com users vishwakftw followers following_url https api github com users vishwakftw following other_user gists_url https api github com users vishwakftw gists gist_id starred_url https api github com users vishwakftw starred owner repo subscriptions_url https api github com users vishwakftw subscriptions organizations_url https api github com users vishwakftw orgs repos_url https api github com users vishwakftw repos events_url https api github com users vishwakftw events privacy received_events_url https api github com users vishwakftw received_events type User site_admin False reactions url https api github com repos pytorch pytorch issues reactions total_count + - laugh hooray confused heart rocket eyes timeline_url https api github com repos pytorch pytorch issues timeline performed_via_github_app None state_reason None TestConfigFilter TestCase setUp - None os environ GITHUB_TOKEN = GITHUB_TOKEN os getenv GITHUB_OUTPUT del os environ GITHUB_OUTPUT tearDown - None os getenv GITHUB_OUTPUT os remove str os getenv GITHUB_OUTPUT mock patch filter_test_configs download_json test_get_labels mock_download_json Any - None mock_download_json return_value = MOCKED_PR_INFO labels = get_labels pr_number= assertSetEqual open source foo labels mock patch filter_test_configs download_json test_get_labels_failed mock_download_json Any - None mock_download_json return_value = labels = get_labels pr_number= assertFalse labels test_filter - None mocked_labels = f PREFIX cfg ciflow trunk plain-cfg testcases = test_matrix include config default runner linux expected include description Request test-config cfg test matrix doesn t have test_matrix include config default runner linux config plain-cfg expected include description A valid test config label needs start test-config test_matrix include config default runner linux config cfg shard expected include config cfg shard description Found match only keep case testcases filtered_test_matrix = filter yaml safe_load case test_matrix mocked_labels assertEqual case expected json dumps filtered_test_matrix test_filter_with_test_config_label - None mocked_labels = f PREFIX cfg ciflow trunk testcases = test_matrix include config default runner linux expected include description Found valid label PR body filtered test matrix test_matrix include config default runner linux config cfg shard expected include config cfg shard description Found match only keep case testcases filtered_test_matrix = filter yaml safe_load case test_matrix mocked_labels assertEqual case expected json dumps filtered_test_matrix test_filter_selected_test_configs - None testcases = test_matrix include config default selected_test_configs expected include config default description No selected test configs test_matrix include config default selected_test_configs foo expected include description A different test config selected test_matrix include config default selected_test_configs foo bar expected include description A different set test configs selected test_matrix include config default selected_test_configs foo bar default expected include config default description One test config selected test_matrix include config default config bar selected_test_configs foo bar Default expected include config default config bar description Several test configs selected case testcases selected_test_configs = v strip lower v case selected_test_configs split v strip filtered_test_matrix = filter_selected_test_configs yaml safe_load case test_matrix selected_test_configs assertEqual case expected json dumps filtered_test_matrix test_set_periodic_modes - None testcases list dict str str = job_name CI job test_matrix include description Empty test matrix job_name a-ci-job test_matrix include config default runner linux config cfg runner macos description Replicate each periodic mode different config job_name a-ci-cuda -job test_matrix include config default runner linux config cfg runner macos description Replicate each periodic mode different config CUDA job job_name a-ci-rocm-job test_matrix include config default runner linux config cfg runner macos description Replicate each periodic mode different config ROCm job job_name test_matrix include config default runner linux config cfg runner macos description Empty job name test_matrix include config default runner linux config cfg runner macos description Missing job name case testcases job_name = case get job_name None test_matrix = yaml safe_load case test_matrix scheduled_test_matrix = set_periodic_modes test_matrix job_name expected_modes = m m c SUPPORTED_PERIODICAL_MODES items c job_name assertEqual len test_matrix include len expected_modes len scheduled_test_matrix include mock patch filter_test_configs download_json test_remove_disabled_jobs mock_download_json Any - None mock_download_json return_value = MOCKED_DISABLED_UNSTABLE_JOBS testcases = workflow pull job_name invalid job name test_matrix include config default expected include config default description invalid job name workflow pull job_name mock-platform- build test_matrix include config default expected include description disable build test jobs workflow trunk job_name mock-platform- build test_matrix include config default expected include description disable build job workflow periodic job_name mock-platform- test test_matrix include config default expected include description disable test job workflow pull job_name mock-platform- build-and-test test_matrix include config default expected include description disable build-and-test job workflow trunk job_name mock-platform- test test_matrix include config default runner linux config backward_compat expected include config default runner linux description disable test config workflow periodic job_name mock-platform- build-and-test test_matrix include config default runner linux config backward_compat expected include config backward_compat description disable build-and-test config workflow pull job_name mock-platform- test test_matrix include config default config backward_compat expected include config default config backward_compat description include invalid job name disabled issue workflow trunk job_name mock-platform- build test_matrix include config default config backward_compat expected include config default config backward_compat description include invalid combination build test config workflow inductor job_name mock-platform- build test_matrix include config default config backward_compat expected include config default config backward_compat description disabled workflow workflow pull job_name mock-platform- build test_matrix include config default config backward_compat expected include config default config backward_compat description disabled platform workflow linux-binary-libtorch-cxx -abi job_name libtorch-cpu-shared-with-deps-cxx -abi-build build test_matrix include config default expected include description Build job needed when test job has been disabled workflow linux-binary-libtorch-cxx -abi job_name libtorch-cpu-shared-with-deps-cxx -abi-test test test_matrix include config default expected include description The binary test job disabled platform workflow linux-binary-manywheel job_name manywheel-py _ -cuda _ -build build test_matrix include config default expected include description Both binary build test jobs disabled workflow linux-binary-manywheel job_name manywheel-py _ -cuda _ -test test test_matrix include config default expected include description Both binary build test jobs disabled case testcases workflow = case workflow job_name = case job_name test_matrix = yaml safe_load case test_matrix filtered_test_matrix = remove_disabled_jobs workflow job_name test_matrix assertEqual case expected json dumps filtered_test_matrix mock patch filter_test_configs download_json test_mark_unstable_jobs mock_download_json Any - None mock_download_json return_value = MOCKED_DISABLED_UNSTABLE_JOBS testcases = workflow pull job_name invalid job name test_matrix include config default expected include config default description invalid job name workflow pull job_name mock-platform- build test_matrix include config default expected include config default unstable unstable description mark build test jobs unstable workflow trunk job_name mock-platform- build test_matrix include config default expected include config default unstable unstable description mark build job unstable workflow periodic job_name mock-platform- test test_matrix include config default expected include config default unstable unstable description mark test job unstable workflow pull job_name mock-platform- build-and-test test_matrix include config default expected include config default unstable unstable description mark build-and-test job unstable workflow trunk job_name mock-platform- test test_matrix include config default config backward_compat expected include config default config backward_compat unstable unstable description mark test config unstable workflow periodic job_name mock-platform- build-and-test test_matrix include config default config backward_compat expected include config default unstable unstable config backward_compat description mark build-and-test config unstable workflow pull job_name mock-platform- test test_matrix include config default config backward_compat expected include config default config backward_compat description include invalid job name unstable issue workflow trunk job_name mock-platform- build test_matrix include config default config backward_compat expected include config default config backward_compat description include invalid combination build test config workflow inductor job_name mock-platform- build test_matrix include config default config backward_compat expected include config default config backward_compat description target workflow workflow pull job_name mock-platform- build test_matrix include config default config backward_compat expected include config default config backward_compat description target platform workflow linux-binary-libtorch-cxx -abi job_name libtorch-cpu-shared-with-deps-cxx -abi-build build test_matrix include config default expected include config default unstable unstable description Unstable binary build job workflow linux-binary-libtorch-cxx -abi job_name libtorch-cpu-shared-with-deps-cxx -abi-test test test_matrix include config default expected include config default unstable unstable description Unstable binary test job workflow linux-binary-manywheel job_name manywheel-py _ -cuda _ -build build test_matrix include config default expected include config default unstable unstable description Both binary build test jobs unstable workflow linux-binary-manywheel job_name manywheel-py _ -cuda _ -test test test_matrix include config default expected include config default unstable unstable description Both binary build test jobs unstable case testcases workflow = case workflow job_name = case job_name test_matrix = yaml safe_load case test_matrix filtered_test_matrix = mark_unstable_jobs workflow job_name test_matrix assertEqual json loads case expected filtered_test_matrix mock patch subprocess check_output test_perform_misc_tasks mocked_subprocess Any - None _gen_expected_string keep_going bool = False ci_verbose_test_logs bool = False ci_test_showlocals bool = False ci_no_test_timeout bool = False ci_no_td bool = False ci_td_distributed bool = False is_unstable bool = False reenabled_issues str = - str f keep-going= keep_going \n f ci-verbose-test-logs= ci_verbose_test_logs \n f ci-test-showlocals= ci_test_showlocals \n f ci-no-test-timeout= ci_no_test_timeout \n f ci-no-td= ci_no_td \n f ci-td-distributed= ci_td_distributed \n f is-unstable= is_unstable \n f reenabled-issues= reenabled_issues \n mocked_subprocess return_value = b testcases list dict str Any = labels test_matrix include config default job_name A job name expected _gen_expected_string description No keep-going no is-unstable labels keep-going test_matrix include config default job_name A job name expected _gen_expected_string keep_going=True description Has keep-going no is-unstable labels test_matrix include config default job_name A job name pr_body keep-going expected _gen_expected_string keep_going=True description Keep-going PR body labels ci-verbose-test-logs test_matrix include config default job_name A job name pr_body ci-no-test-timeout expected _gen_expected_string ci_verbose_test_logs=True ci_no_test_timeout=True description No pipe logs label no test timeout PR body labels ci-test-showlocals test_matrix include config default job_name A job name expected _gen_expected_string ci_test_showlocals=True description Has ci-test-showlocals labels test_matrix include config default job_name A job name pr_body ci-test-showlocals expected _gen_expected_string ci_test_showlocals=True description ci-test-showlocals body labels ci-no-test-timeout test_matrix include config default job_name A job name pr_body ci-verbose-test-logs expected _gen_expected_string ci_verbose_test_logs=True ci_no_test_timeout=True description No pipe logs PR body no test timeout label same above swapped labels ci-no-td test_matrix include config default job_name A job name pr_body expected _gen_expected_string ci_no_td=True description No pipe logs PR body no test timeout label same above swapped labels test_matrix include config default job_name None expected _gen_expected_string description No job name labels test_matrix include config default job_name macos- -py -arm test default macos-m -stable unstable expected _gen_expected_string is_unstable=True description Unstable job labels test_matrix include config default job_name macos- -py -arm test default macos-m -stable unstable expected _gen_expected_string is_unstable=True description Unstable job labels test_matrix include config unstable unstable config unstable unstable job_name macos- -py -arm build expected _gen_expected_string is_unstable=True description All configs unstable labels test_matrix include config unstable unstable config job_name macos- -py -arm build expected _gen_expected_string is_unstable=False description Only mark some configs unstable labels test_matrix include config default job_name A job name pr_body resolves fixes expected _gen_expected_string reenabled_issues= description Reenable some issues case testcases labels = case labels test_matrix = yaml safe_load case test_matrix job_name = case job_name pr_body = case get pr_body tempfile NamedTemporaryFile delete=False fp os environ GITHUB_OUTPUT = fp name perform_misc_tasks labels test_matrix job_name pr_body open str os getenv GITHUB_OUTPUT fp assertEqual case expected fp read test variations close PR_BODY test_parse_reenabled_issues - None pr_body = closes Close ClOsE closed assertEqual parse_reenabled_issues pr_body test variations fix pr_body = fix FixEd fixes FiXeD assertEqual parse_reenabled_issues pr_body test variations resolve pr_body = resolve resolveS REsolved RESOLVES assertEqual parse_reenabled_issues pr_body test links pr_body = closes https github com pytorch pytorch issues fixes https github com pytorch pytorch issues assertEqual parse_reenabled_issues pr_body test strange spacing pr_body = resolve resolveS Resolved \nRESOLVES Fixed fixes https github com pytorch pytorch issues resolveS assertEqual parse_reenabled_issues pr_body test bad things pr_body = fixes fixeshttps github com pytorch pytorch issues closedhttps githubcom pytorch pytorch issues lint-ignore fix fixes fixing close closes# closing resolve resolves resolving assertEqual parse_reenabled_issues pr_body pr_body = None assertEqual parse_reenabled_issues pr_body __name__ == __main__ main