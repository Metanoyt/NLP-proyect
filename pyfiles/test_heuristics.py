For testing specific heuristics __future__ annotations io json sys unittest pathlib Path typing Any unittest mock REPO_ROOT = Path __file__ resolve parents sys path append str REPO_ROOT tools test heuristics test_interface TestTD tools testing target_determination heuristics filepath file_matches_keyword get_keywords tools testing target_determination heuristics historical_class_failure_correlation HistoricalClassFailurCorrelation tools testing target_determination heuristics interface TestPrioritizations tools testing target_determination heuristics previously_failed_in_pr get_previous_failures tools testing test_run TestRun sys path remove str REPO_ROOT HEURISTIC_CLASS = tools testing target_determination heuristics historical_class_failure_correlation mocked_file contents dict Any Any - io IOBase file_object = io StringIO json dump contents file_object file_object seek file_object gen_historical_class_failures - dict str dict str float file test classA test classA test classB file test classB test classA test classA test classC file test classC test classA test classC test classC ALL_TESTS = test test test test test test test test TestHistoricalClassFailureCorrelation TestTD mock patch HEURISTIC_CLASS + _get_historical_test_class_correlations return_value=gen_historical_class_failures mock patch HEURISTIC_CLASS + query_changed_files return_value= file test_get_prediction_confidence historical_class_failures dict str dict str float changed_files list str - None tests_to_prioritize = ALL_TESTS heuristic = HistoricalClassFailurCorrelation test_prioritizations = heuristic get_prediction_confidence tests_to_prioritize expected = TestPrioritizations tests_to_prioritize TestRun test classA TestRun test classA TestRun test classB TestRun test excluded= classA TestRun test excluded= classA TestRun test TestRun test TestRun test excluded= classB TestRun test TestRun test TestRun test assert_test_scores_almost_equal test_prioritizations _test_scores expected _test_scores TestParsePrevTests TestTD mock patch os path exists return_value=False test_cache_does_not_exist mock_exists Any - None expected_failing_test_files set str = set found_tests = get_previous_failures assertSetEqual expected_failing_test_files found_tests mock patch os path exists return_value=True mock patch builtins open return_value=mocked_file True test_empty_cache mock_exists Any mock_open Any - None expected_failing_test_files set str = set found_tests = get_previous_failures assertSetEqual expected_failing_test_files found_tests mock_open assert_called lastfailed_with_multiple_tests_per_file = test test_car py TestCar test_num True test test_car py TestBar test_num True test test_far py TestFar test_fun_copy True test test_bar py TestBar test_fun_copy True mock patch os path exists return_value=True mock patch builtins open return_value=mocked_file lastfailed_with_multiple_tests_per_file test_dedupes_failing_test_files mock_exists Any mock_open Any - None expected_failing_test_files = test_car test_bar test_far found_tests = get_previous_failures assertSetEqual expected_failing_test_files found_tests TestFilePath TestTD test_get_keywords - None assertEqual get_keywords test test_car py car assertEqual get_keywords test nn test_amp py nn amp assertEqual get_keywords torch nn test_amp py nn amp assertEqual get_keywords torch nn mixed_precision test_something py nn amp something test_match_keywords - None assertTrue file_matches_keyword test quantization test_car py quant assertTrue file_matches_keyword test test_quantization py quant assertTrue file_matches_keyword test nn test_amp py nn assertTrue file_matches_keyword test nn test_amp py amp assertTrue file_matches_keyword test test_onnx py onnx assertFalse file_matches_keyword test test_onnx py nn test_get_keywords_match - None helper test_file str changed_file str - bool any file_matches_keyword test_file x x get_keywords changed_file assertTrue helper test quantization test_car py quantize t py assertFalse helper test onnx test_car py nn t py assertTrue helper test nn test_car py nn t py assertFalse helper test nn test_car py test b py assertTrue helper test test_mixed_precision py torch amp t py assertTrue helper test test_amp py torch mixed_precision t py assertTrue helper test idk other random py torch idk t py __name__ == __main__ unittest main