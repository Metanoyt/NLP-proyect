__future__ annotations collections defaultdict functools lru_cache pathlib Path typing Any TYPE_CHECKING warnings warn tools testing target_determination heuristics interface HeuristicInterface TestPrioritizations tools testing target_determination heuristics utils normalize_ratings query_changed_files tools testing test_run TestRun TYPE_CHECKING collections abc Callable REPO_ROOT = Path __file__ parents keyword_synonyms dict str list str = amp mixed_precision quant quantized quantization quantize decomp decomposition decompositions numpy torch_np numpy_tests ops opinfo hop higher_order_op aot flex_attention autograd inductor dynamo export actually synonyms they interact lot custom_matchers dict str Callable str bool = nn lambda x nn x replace onnx _ c lambda x c x replace c d _ is_valid_keyword keyword str - bool not_keyword = torch test tests util utils func src c ns tools internal keyword == nn keyword not_keyword len keyword lru_cache maxsize= get_keywords file str - list str keywords = folder Path file parts - folder = sanitize_name folder keywords append folder file_name = Path file stem split _ keywords extend sanitize_name x x file_name kw kw keywords is_valid_keyword kw sanitize_name folder_name str - str folder_name = folder_name removeprefix _ syn_rep syns keyword_synonyms items folder_name syns folder_name == syn_rep syn_rep folder_name file_matches_keyword file str keyword str - bool keywords = get_keywords file keyword keywords any syn keywords syn file syn keyword_synonyms get keyword custom_matchers get keyword lambda x keyword x file type ignore no-untyped-call get_freq_dict tests list str changed_files list str - dict str int keyword_frequency dict str int = defaultdict int cf changed_files keywords = get_keywords cf keyword keywords keyword_frequency keyword += test_ratings dict str int = defaultdict int test tests keyword frequency keyword_frequency items file_matches_keyword test keyword test_ratings test += frequency test_ratings Filepath HeuristicInterface Heuristic based folders file path Takes each folder each changed file attempts find matches based those folders __init__ kwargs dict str Any - None super __init__ kwargs get_prediction_confidence tests list str - TestPrioritizations try changed_files = query_changed_files except Exception e warn f Can t query changed test files due e changed_files = test_ratings = get_freq_dict tests changed_files test_ratings = TestRun k float v k v test_ratings items k tests TestPrioritizations tests normalize_ratings test_ratings min_value= __name__ == __main__ Quick thing so you can call heuristic command line sha os sys tools testing discover_tests TESTS git_diff = f git diff -- name-only sys argv sys argv ^ changed_files = os popen git_diff read split \n freq_dict = get_freq_dict TESTS x x changed_files x = x startswith test k v sorted freq_dict items key=lambda x x reverse=False print k v print changed_files