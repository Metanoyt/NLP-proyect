mypy allow-untyped-defs __future__ annotations itertools typing TYPE_CHECKING torch torch _ops TYPE_CHECKING collections abc Callable torch onnx _internal exporter _registration get_onnx_implemented_overloads registry _registration ONNXRegistry - list _registration TorchOp Creates set OperatorBase Callable objects represent ONNX-supported PyTorch operations Args registry The ONNX registry PyTorch Returns A collection OperatorBase Callable objects representing ONNX-supported PyTorch operations registered_ops list _registration TorchOp = onnx_decomp_meta registry functions values assert len onnx_decomp_meta Different OnnxDecompMeta same TorchOp should have same fx_target fx_target = onnx_decomp_meta fx_target registered_ops append fx_target registered_ops create_onnx_friendly_decomposition_table onnx_registered_ops set _registration TorchOp - dict _registration TorchOp Callable This function creates dictionary op overloads their decomposition functions ops do have ONNX symbolic functions If op already has ONNX symbolic function its decomposition function excluded table The decomposition table subset PyTorch s built-in aten-to-aten decomposition Args onnx_registered_ops All ops have ONNX decomposition implemented Returns Dict torch _ops OperatorBase Callable A dictionary maps op overloads their corresponding decomposition functions decomposition_table dict _registration TorchOp Callable = op_overload decomp_fn itertools chain torch export default_decompositions items type ignore attr-defined torch _decomp decomposition_table items type ignore attr-defined Skip decomposition op_overload long op_overload has corresponding ONNX symbolic function NOTE Do skip torch _refs decomps They fine because otherwise model exportable anyways op_overload onnx_registered_ops continue If HOP we filter those out well hasattr op_overload _schema continue NOTE torch _decomp decomposition_table covers more ops than torch export default_decompositions latter more critical torch onnx export op_overload decomposition_table continue decomposition_table op_overload = decomp_fn decomposition_table