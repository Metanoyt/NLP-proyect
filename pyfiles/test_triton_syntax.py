Owner s module inductor torch torch _inductor test_case TestCase torch testing _internal inductor_utils GPU_TYPE HAS_GPU requires_gpu TestTritonSyntacticallyValid TestCase requires_gpu test_triton_sqrt https github com pytorch pytorch issues math torch nn nn newtonschulz G steps int eps= e- assert len G shape == b c = - X = G torch bfloat torch cuda is_bf _supported including_emulation=False torch float X = X norm + eps ensure top singular value = G size G size X = X T _ range steps A = X X T B = b A + c A A X = X + B X G size G size X = X T X torch compile backend= inductor scaled_newton_schulz G steps int shape = G shape dtype = G dtype G = G reshape shape - G = newtonschulz G steps G = G reshape shape type dtype G = G math sqrt max shape G numel G model = nn Sequential nn Linear bias=False nn Linear bias=False device=torch device GPU_TYPE loss = model torch randn device=torch device GPU_TYPE sum loss backward scaled_newton_schulz model weight grad scaled_newton_schulz model weight grad __name__ == __main__ torch _inductor test_case run_tests HAS_GPU run_tests