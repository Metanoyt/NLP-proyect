mypy allow-untyped-defs collections abc Sized typing TypeVar torch utils data datapipes _decorator functional_datapipe torch utils data datapipes datapipe DataChunk MapDataPipe __all__ = BatcherMapDataPipe _T = TypeVar _T functional_datapipe batch BatcherMapDataPipe MapDataPipe DataChunk r Create mini-batches data functional name ` ` batch ` ` An outer dimension will added ` ` batch_size ` ` ` ` drop_last ` ` set ` ` True ` ` ` ` length batch_size ` ` last batch ` ` drop_last ` ` set ` ` False ` ` Args datapipe Iterable DataPipe being batched batch_size The size each batch drop_last Option drop last batch s full Example xdoctest +SKIP torchdata datapipes map SequenceWrapper dp = SequenceWrapper range batch_dp = dp batch batch_size= list batch_dp datapipe MapDataPipe batch_size int drop_last bool __init__ datapipe MapDataPipe _T batch_size int drop_last bool = False wrapper_class type DataChunk = DataChunk - None batch_size = raise AssertionError Batch size required larger than super __init__ datapipe = datapipe batch_size = batch_size drop_last = drop_last wrapper_class = wrapper_class __getitem__ index - DataChunk batch list = indices = range index batch_size index + batch_size try batch extend datapipe i i indices wrapper_class batch except IndexError e drop_last len batch wrapper_class batch raise IndexError f Index index out bound e __len__ - int isinstance datapipe Sized drop_last len datapipe batch_size len datapipe + batch_size - batch_size raise TypeError f type __name__ instance doesn t have valid length