Owner s module inductor torch torch _inductor torch _dynamo utils counters torch _inductor test_case run_tests TestCase torch testing _internal common_utils serialTest torch testing _internal inductor_utils GPU_TYPE requires_gpu TestEinsumtoPointwise torch nn Module __init__ - None super __init__ forward input torch Tensor weights torch Tensor bias torch Tensor input torch Tensor weights torch Tensor bias torch Tensor - torch Tensor output = torch functional einsum bni nio - bno input weights add = output add bias output = torch functional einsum bni bnio - bno input weights add = output + bias add + add TestKernelOptimization TestCase compare_dict_tensors ref_dict res_dict rtol= e- atol= e- len set ref_dict keys = len set res_dict keys False key ref_dict keys key = _orig_mod + key assert key res_dict f key does exist traced module torch allclose ref_dict key res_dict key rtol=rtol atol=atol False True compare_pred module traced input rtol= e- atol= e- ref = module input res = traced input assertEqual ref res rtol=rtol atol=atol compare_parameters module traced rtol= e- atol= e- ref_params = dict module named_parameters res_params = dict traced named_parameters assertTrue compare_dict_tensors ref_params res_params rtol atol compare_gradients module traced rtol= e- atol= e- ref_grad = key param grad key param module named_parameters res_grad = key param grad key param traced named_parameters assertTrue compare_dict_tensors ref_grad res_grad rtol=rtol atol=atol requires_gpu torch _inductor config patch pre_grad_fusion_options= einsum_to_pointwise_pass post_grad_fusion_options= serialTest Needs slightly more memory GPUs test_einsum_to_pointwise counters clear module = TestEinsumtoPointwise GPU_TYPE input = torch randn device=GPU_TYPE requires_grad=True torch randn device=GPU_TYPE requires_grad=True torch randn device=GPU_TYPE requires_grad=True torch randn device=GPU_TYPE requires_grad=True torch randn device=GPU_TYPE requires_grad=True torch randn device=GPU_TYPE requires_grad=True traced = torch compile module ref = module input res = traced input ref sum backward res sum backward compare_pred module traced input compare_parameters module traced compare_gradients module traced assertEqual counters inductor einsum_to_pointwise_pass counters clear __name__ == __main__ run_tests