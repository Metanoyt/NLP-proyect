Owner s oncall quantization copy unittest torch torch _dynamo torchdynamo torch ao quantization pt e graph_utils find_sequential_partitions get_equivalent_types update_equivalent_types_dict torch testing _internal common_utils IS_WINDOWS raise_on_run_directly TestCase TestGraphUtils TestCase unittest skipIf IS_WINDOWS torch compile supported Windows test_conv_bn_conv_relu M torch nn Module __init__ - None super __init__ conv = torch nn Conv d bn = torch nn BatchNorm d conv = torch nn Conv d relu = torch nn ReLU forward x bn_out = bn conv x relu_out = torch nn functional relu bn_out relu conv relu_out m = M eval example_inputs = torch randn program capture m guards = torchdynamo export noqa F m copy deepcopy example_inputs aten_graph=True fused_partitions = find_sequential_partitions m torch nn Conv d torch nn BatchNorm d assertEqual len fused_partitions fused_partitions = find_sequential_partitions m torch nn Conv d torch nn BatchNorm d torch nn ReLU assertEqual len fused_partitions x find_sequential_partitions m torch nn Conv d torch nn BatchNorm d torch nn ReLU torch nn functional conv d assertRaises ValueError x unittest skipIf IS_WINDOWS torch compile supported Windows test_conv_bn_relu M torch nn Module __init__ - None super __init__ bn = torch nn BatchNorm d conv = torch nn Conv d relu = torch nn ReLU forward x bn_out = bn x relu conv bn_out m = M eval example_inputs = torch randn program capture m guards = torchdynamo export noqa F m copy deepcopy example_inputs aten_graph=True fused_partitions = find_sequential_partitions m torch nn Conv d torch nn BatchNorm d assertEqual len fused_partitions fused_partitions = find_sequential_partitions m torch nn BatchNorm d torch nn Conv d assertEqual len fused_partitions fused_partitions = find_sequential_partitions m torch nn BatchNorm d torch nn ReLU assertEqual len fused_partitions unittest skipIf IS_WINDOWS torch compile supported Windows test_customized_equivalet_types_dict M torch nn Module __init__ - None super __init__ conv = torch nn Conv d forward x torch nn functional relu conv x m = M eval example_inputs = torch randn program capture m guards = torchdynamo export noqa F m copy deepcopy example_inputs aten_graph=True customized_equivalent_types = get_equivalent_types customized_equivalent_types append torch nn ReLU torch nn functional relu update_equivalent_types_dict customized_equivalent_types fused_partitions = find_sequential_partitions m torch nn Conv d torch nn ReLU assertEqual len fused_partitions __name__ == __main__ raise_on_run_directly test test_quantization py