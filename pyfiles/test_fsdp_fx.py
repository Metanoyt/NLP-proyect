Owner s oncall distributed torch torch distributed fsdp _trace_utils _ExecOrderTracer torch testing _internal common_device_type instantiate_device_type_tests torch testing _internal common_utils run_tests TestCase Model torch nn Module __init__ - None super __init__ weight = torch nn Parameter torch randn weight = torch nn Parameter torch randn weight_unused = torch nn Parameter torch randn layer = torch nn Linear layer = torch nn Linear bias=False layer = torch nn Sequential torch nn Linear bias=False torch nn ReLU torch nn Linear bias=False relu = torch nn ReLU forward x torch Tensor run_all_layers bool - torch Tensor z = relu layer x z = relu layer z z = z weight run_all_layers z = relu layer z z = z weight Use ` layer ` twice check handling multiplicity saved data structures z = relu layer x z TestSymbolicTracing TestCase test_symbolic_tracing_outputs Tests running ` ` tracer trace ` ` inside ` ` patch_tracer ` ` checking saved data structures model = Model tracer = torch fx Tracer orig_call_module = tracer call_module orig_create_proxy = tracer create_proxy exec_order_tracer = _ExecOrderTracer exec_order_tracer patch_tracer tracer=tracer root_module=model concrete_args = run_all_layers True tracer trace model concrete_args Check tracer methods unchanged after exiting context assertEqual orig_call_module tracer call_module assertEqual orig_create_proxy tracer create_proxy Check ` module_forward_order ` correct_module_forward_order = model model layer model relu model layer model layer model layer model layer model relu model layer model relu model layer model relu exec_info = exec_order_tracer exec_info assertEqual exec_info module_forward_order correct_module_forward_order Check ` module_to_param_usage_infos ` assertEqual exec_info module_to_param_usage_infos model model layer list model layer named_parameters model layer list model layer named_parameters model weight model weight model layer list model layer named_parameters model weight model weight model layer list model layer named_parameters assertEqual exec_info module_to_param_usage_infos model layer model layer list model layer named_parameters assertEqual exec_info module_to_param_usage_infos model layer model layer list model layer named_parameters assertEqual exec_info module_to_param_usage_infos model layer model layer list model layer named_parameters model layer list model layer named_parameters assertEqual exec_info module_to_param_usage_infos model relu Check ` param_forward_order ` correct_param_order = model layer weight model layer bias model layer weight model layer weight model weight model layer weight model weight assertEqual exec_info param_forward_order correct_param_order Check ` visited_params ` assertEqual len exec_info visited_params len exec_info param_forward_order assertEqual exec_info visited_params set exec_info param_forward_order devices = cuda hpu xpu instantiate_device_type_tests TestSymbolicTracing globals only_for=devices allow_xpu=True __name__ == __main__ run_tests