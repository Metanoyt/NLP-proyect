Owner s module inductor sys unittest unittest mock torch torch _inductor runtime hints TRITON_MAX_BLOCK torch _inductor test_case run_tests TestCase torch testing _internal common_utils IS_LINUX torch testing _internal inductor_utils GPU_TYPE HAS_GPU try triton manual except ImportError __name__ == __main__ sys exit raise unittest SkipTest requires triton noqa B torch _inductor config torch _inductor runtime coordinate_descent_tuner CoordescTuner config benchmark_kernel = True config coordinate_descent_tuning = True orig_compare_config = CoordescTuner compare_config mock_compare_config_prefer_larger_XBLOCK func candidate_config best_config best_timing CoordescTuner object XBLOCK candidate_config kwargs assert XBLOCK best_config kwargs candidate_config kwargs XBLOCK best_config kwargs XBLOCK func candidate_config run func so launcher will created False best_timing candidate_config kwargs XBLOCK best_config kwargs XBLOCK func candidate_config True best_timing orig_compare_config func candidate_config best_config best_timing TestCoordinateDescentTuner TestCase test_abs_function The benchmark result simply abs XBLOCK - tuner = CoordescTuner baseline_config = triton Config XBLOCK num_warps= num_stages= func config abs config kwargs XBLOCK - best_config = tuner autotune func baseline_config assertTrue best_config kwargs get XBLOCK == str best_config test_no_neighbors Test case there no available neighbor values field size hint x being limits max XBLOCK we try tuner = CoordescTuner size_hints= x baseline_config = triton Config XBLOCK num_warps= num_stages= func config abs config kwargs XBLOCK - best_config = tuner autotune func baseline_config assertTrue best_config kwargs get XBLOCK == str best_config test_get_neighbour_values tuner = CoordescTuner neighbours = tuner get_neighbour_values num_stages radius= assertEqual set neighbours neighbours = tuner get_neighbour_values num_warps radius= assertEqual set neighbours test_persistent_reduction f x x x sum dim=- keepdim=True mock patch object CoordescTuner compare_config mock_compare_config_prefer_larger_XBLOCK x = torch ones GPU_TYPE expected = f x first call get correct result when cache miss Don t know why yet _ = torch compile f x actual = torch compile f x assertTrue torch allclose expected actual atol= e- rtol= e- f Expected \n expected \nActual \n actual test_value_too_large Simulate reduction size_hints = x y tuner = CoordescTuner size_hints=size_hints max_block = TRITON_MAX_BLOCK assertFalse tuner value_too_large XBLOCK max_block X assertTrue tuner value_too_large XBLOCK max_block X assertFalse tuner value_too_large R _BLOCK max_block R _ assertTrue tuner value_too_large R _BLOCK max_block R _ __name__ == __main__ IS_LINUX HAS_GPU run_tests