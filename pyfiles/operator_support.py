mypy allow-untyped-defs abc typing t torch torch fx torch fx _compatibility compatibility shape_prop TensorMetadata tools_common CALLABLE_NODE_OPS get_node_target __all__ = OperatorSupportBase OperatorSupport create_op_support chain OpSupports any_chain fx Node target typename returned ` get_node_target ` TargetTypeName = str Arguments dtypes given node see ` OperatorSupport ` SupportedArgumentDTypes = t Optional tuple t Sequence t Sequence torch dtype dict str t Sequence torch dtype SupportDict = t Mapping TargetTypeName SupportedArgumentDTypes compatibility is_backward_compatible=False OperatorSupportBase abc ABC Interface determining fx Node supported backend abc abstractmethod is_node_supported submodules t Mapping str torch nn Module node torch fx Node - bool raise NotImplementedError compatibility is_backward_compatible=False OperatorSupport OperatorSupportBase ` _support_dict ` maps node target typename supported inputs dtypes node target typename retrieved using helper function ` get_node_target ` If supported inputs dtypes None means any dtype supported we should see tuple like dtypes name dtypes The first tuple dtypes indicates what dtypes supported inputs node args second dict name dtypes indicates what dtypes supported inputs node kwargs For inputs args we don t want check we can put None there e g None torch float indicates we don t care about type first input args And inputs kwargs listed will checked _support_dict SupportDict __init__ support_dict t Optional SupportDict = None _support_dict = support_dict is_node_supported submodules t Mapping str torch nn Module node torch fx Node - bool Args ` submodules ` mapping module name module This can retrieved calling model named_modules ` node ` Fx node we want determine whether s supported Returns ` is_supported ` whether arg ` node ` supported node op CALLABLE_NODE_OPS True target = get_node_target submodules node Target found _support_dict meaning we don t support op all target _support_dict False The rule target None meaning we accept any dtype _support_dict target None True args_dtypes kwargs_dtypes = _support_dict target type ignore misc Check args dtypes i dtypes enumerate args_dtypes len node args = i break None indicates we don t care about dtype args i dtypes None continue If arg node then we don t check isinstance node args i torch fx Node continue arg_dtype = _get_arg_dtype node args i type ignore arg-type arg_dtype dtypes False Check kwargs dtypes k dtypes kwargs_dtypes items k node kwargs continue If arg node then we don t check isinstance node kwargs k torch fx Node continue kwarg_dtype = _get_arg_dtype node kwargs k type ignore arg-type kwarg_dtype dtypes False True ====================================================================== Functional interfaces utils defining basic operator support logic composing them into more complex ones ====================================================================== IsNodeSupported = t Callable t Mapping str torch nn Module torch fx Node bool compatibility is_backward_compatible=False create_op_support is_node_supported IsNodeSupported - OperatorSupportBase Wraps ` IsNodeSupported ` function into ` OperatorSupportBase ` instance ` IsNodeSupported ` has same call signature ` OperatorSupportBase is_node_supported ` FunctionalOperatorSupport OperatorSupportBase is_node_supported submodules t Mapping str torch nn Module node torch fx Node - bool is_node_supported submodules node FunctionalOperatorSupport compatibility is_backward_compatible=False chain op_support OperatorSupportBase - OperatorSupportBase Combines sequence ` OperatorSupportBase ` instances form single ` OperatorSupportBase ` instance evaluating each input ` OperatorSupportBase ` instance returns False any reports False _chain submods node - bool all x is_node_supported submods node x op_support create_op_support _chain compatibility is_backward_compatible=False any_chain op_support OperatorSupportBase - OperatorSupportBase Combines sequence ` OperatorSupportBase ` instances form single ` OperatorSupportBase ` instance evaluating each input ` OperatorSupportBase ` instance returns True any reports True _any_chain submods node - bool any x is_node_supported submods node x op_support create_op_support _any_chain compatibility is_backward_compatible=False OpSupports A set atomic ` OperatorSupportBase ` instances can combined together form more complex operator support logic classmethod decline_if_input_dtype cls dtype torch dtype - OperatorSupportBase Report node non-supported any its arguments dtype _decline_if_input_dtype submodules t Mapping str torch nn Module node torch fx Node - bool arg node all_input_nodes arg_dtype = _get_arg_dtype arg arg_dtype == dtype False True create_op_support _decline_if_input_dtype classmethod decline_if_node_in_names cls disallow_set set str - OperatorSupportBase If node has name disallow set reported non-supported _decline_if_node_in_names submodules t Mapping str torch nn Module node torch fx Node - bool node name disallow_set create_op_support _decline_if_node_in_names _get_arg_dtype arg torch fx Node - t Any assert isinstance arg torch fx Node tensor_meta = arg meta get tensor_meta type ignore union-attr dtype = tensor_meta dtype isinstance tensor_meta TensorMetadata arg meta type dtype