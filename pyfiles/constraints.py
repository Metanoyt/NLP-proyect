mypy allow-untyped-defs collections abc Callable typing Any Optional r The following constraints implemented - ` ` constraints boolean ` ` - ` ` constraints cat ` ` - ` ` constraints corr_cholesky ` ` - ` ` constraints dependent ` ` - ` ` constraints greater_than lower_bound ` ` - ` ` constraints greater_than_eq lower_bound ` ` - ` ` constraints independent constraint reinterpreted_batch_ndims ` ` - ` ` constraints integer_interval lower_bound upper_bound ` ` - ` ` constraints interval lower_bound upper_bound ` ` - ` ` constraints less_than upper_bound ` ` - ` ` constraints lower_cholesky ` ` - ` ` constraints lower_triangular ` ` - ` ` constraints MixtureSameFamilyConstraint base_constraint ` ` - ` ` constraints multinomial ` ` - ` ` constraints nonnegative ` ` - ` ` constraints nonnegative_integer ` ` - ` ` constraints one_hot ` ` - ` ` constraints positive_integer ` ` - ` ` constraints positive ` ` - ` ` constraints positive_semidefinite ` ` - ` ` constraints positive_definite ` ` - ` ` constraints real_vector ` ` - ` ` constraints real ` ` - ` ` constraints simplex ` ` - ` ` constraints symmetric ` ` - ` ` constraints stack ` ` - ` ` constraints square ` ` - ` ` constraints symmetric ` ` - ` ` constraints unit_interval ` ` torch __all__ = Constraint boolean cat corr_cholesky dependent dependent_property greater_than greater_than_eq independent integer_interval interval half_open_interval is_dependent less_than lower_cholesky lower_triangular MixtureSameFamilyConstraint multinomial nonnegative nonnegative_integer one_hot positive positive_semidefinite positive_definite positive_integer real real_vector simplex square stack symmetric unit_interval Constraint Abstract base constraints A constraint object represents region over which variable valid e g within which variable can optimized Attributes is_discrete bool Whether constrained space discrete Defaults False event_dim int Number rightmost dimensions together define event The meth ` check ` method will remove many dimensions when computing validity is_discrete = False Default continuous event_dim = Default univariate check value Returns byte tensor ` ` sample_shape + batch_shape ` ` indicating whether each event value satisfies constraint raise NotImplementedError __repr__ __class__ __name__ + _Dependent Constraint Placeholder variables whose support depends other variables These variables obey no simple coordinate-wise constraints Args is_discrete bool Optional value ` ` is_discrete ` ` case can computed statically If provided access ` ` is_discrete ` ` attribute will raise NotImplementedError event_dim int Optional value ` ` event_dim ` ` case can computed statically If provided access ` ` event_dim ` ` attribute will raise NotImplementedError __init__ is_discrete=NotImplemented event_dim=NotImplemented _is_discrete = is_discrete _event_dim = event_dim super __init__ property is_discrete - bool type ignore override _is_discrete NotImplemented raise NotImplementedError is_discrete cannot determined statically _is_discrete property event_dim - int type ignore override _event_dim NotImplemented raise NotImplementedError event_dim cannot determined statically _event_dim __call__ is_discrete=NotImplemented event_dim=NotImplemented Support syntax customize static attributes constraints dependent is_discrete=True event_dim= is_discrete NotImplemented is_discrete = _is_discrete event_dim NotImplemented event_dim = _event_dim _Dependent is_discrete=is_discrete event_dim=event_dim check x raise ValueError Cannot determine validity dependent constraint is_dependent constraint Checks ` ` constraint ` ` ` ` _Dependent ` ` object Args constraint A ` ` Constraint ` ` object Returns ` ` bool ` ` True ` ` constraint ` ` can refined type ` ` _Dependent ` ` False otherwise Examples torch torch distributions Bernoulli torch distributions constraints is_dependent dist = Bernoulli probs=torch tensor requires_grad=True constraint = dist arg_constraints probs constraint = dist arg_constraints logits constraint constraint constraint is_dependent constraint continue isinstance constraint _Dependent _DependentProperty property _Dependent Decorator extends property act like ` Dependent ` constraint when called act like property when called object Example Uniform Distribution __init__ low high low = low high = high constraints dependent_property is_discrete=False event_dim= support constraints interval low high Args fn Callable The function decorated is_discrete bool Optional value ` ` is_discrete ` ` case can computed statically If provided access ` ` is_discrete ` ` attribute will raise NotImplementedError event_dim int Optional value ` ` event_dim ` ` case can computed statically If provided access ` ` event_dim ` ` attribute will raise NotImplementedError __init__ fn Optional Callable Any = None is_discrete Optional bool = NotImplemented event_dim Optional int = NotImplemented - None super __init__ fn _is_discrete = is_discrete _event_dim = event_dim __call__ fn Callable Any - _DependentProperty type ignore override Support syntax customize static attributes constraints dependent_property is_discrete=True event_dim= support _DependentProperty fn is_discrete=self _is_discrete event_dim=self _event_dim _IndependentConstraint Constraint Wraps constraint aggregating over ` ` reinterpreted_batch_ndims ` ` -many dims meth ` check ` so event valid only all its independent entries valid __init__ base_constraint reinterpreted_batch_ndims assert isinstance base_constraint Constraint assert isinstance reinterpreted_batch_ndims int assert reinterpreted_batch_ndims = base_constraint = base_constraint reinterpreted_batch_ndims = reinterpreted_batch_ndims super __init__ property is_discrete - bool type ignore override base_constraint is_discrete property event_dim - int type ignore override base_constraint event_dim + reinterpreted_batch_ndims check value result = base_constraint check value result dim reinterpreted_batch_ndims expected = base_constraint event_dim + reinterpreted_batch_ndims raise ValueError f Expected value dim = expected got value dim result = result reshape result shape result dim - reinterpreted_batch_ndims + - result = result all - result __repr__ f __class__ __name__ repr base_constraint reinterpreted_batch_ndims MixtureSameFamilyConstraint Constraint Constraint ` ~torch distribution MixtureSameFamily ` distribution adds back rightmost batch dimension before performing validity check component distribution constraint Args base_constraint The ` ` Constraint ` ` object component distribution ` ~torch distribution MixtureSameFamily ` distribution __init__ base_constraint assert isinstance base_constraint Constraint base_constraint = base_constraint super __init__ property is_discrete - bool type ignore override base_constraint is_discrete property event_dim - int type ignore override base_constraint event_dim check value Check validity ` ` value ` ` possible outcome sampling ` ~torch distribution MixtureSameFamily ` distribution unsqueezed_value = value unsqueeze - - event_dim result = base_constraint check unsqueezed_value value dim event_dim raise ValueError f Expected value dim = event_dim got value dim num_dim_to_keep = value dim - event_dim result = result reshape result shape num_dim_to_keep + - result = result all - result __repr__ f __class__ __name__ repr base_constraint _Boolean Constraint Constrain two values ` ` is_discrete = True check value value == &#124; value == _OneHot Constraint Constrain one-hot vectors is_discrete = True event_dim = check value is_boolean = value == &#124; value == is_normalized = value sum - eq is_boolean all - is_normalized _IntegerInterval Constraint Constrain integer interval ` lower_bound upper_bound ` is_discrete = True __init__ lower_bound upper_bound lower_bound = lower_bound upper_bound = upper_bound super __init__ check value value == lower_bound = value value = upper_bound __repr__ fmt_string = __class__ __name__ fmt_string += f lower_bound= lower_bound upper_bound= upper_bound fmt_string _IntegerLessThan Constraint Constrain integer interval ` -inf upper_bound ` is_discrete = True __init__ upper_bound upper_bound = upper_bound super __init__ check value value == value = upper_bound __repr__ fmt_string = __class__ __name__ fmt_string += f upper_bound= upper_bound fmt_string _IntegerGreaterThan Constraint Constrain integer interval ` lower_bound inf ` is_discrete = True __init__ lower_bound lower_bound = lower_bound super __init__ check value value == value = lower_bound __repr__ fmt_string = __class__ __name__ fmt_string += f lower_bound= lower_bound fmt_string _Real Constraint Trivially constrain extended real line ` -inf inf ` check value value == value False NANs _GreaterThan Constraint Constrain real half line ` lower_bound inf ` __init__ lower_bound lower_bound = lower_bound super __init__ check value lower_bound value __repr__ fmt_string = __class__ __name__ fmt_string += f lower_bound= lower_bound fmt_string _GreaterThanEq Constraint Constrain real half line ` lower_bound inf ` __init__ lower_bound lower_bound = lower_bound super __init__ check value lower_bound = value __repr__ fmt_string = __class__ __name__ fmt_string += f lower_bound= lower_bound fmt_string _LessThan Constraint Constrain real half line ` -inf upper_bound ` __init__ upper_bound upper_bound = upper_bound super __init__ check value value upper_bound __repr__ fmt_string = __class__ __name__ fmt_string += f upper_bound= upper_bound fmt_string _Interval Constraint Constrain real interval ` lower_bound upper_bound ` __init__ lower_bound upper_bound lower_bound = lower_bound upper_bound = upper_bound super __init__ check value lower_bound = value value = upper_bound __repr__ fmt_string = __class__ __name__ fmt_string += f lower_bound= lower_bound upper_bound= upper_bound fmt_string _HalfOpenInterval Constraint Constrain real interval ` lower_bound upper_bound ` __init__ lower_bound upper_bound lower_bound = lower_bound upper_bound = upper_bound super __init__ check value lower_bound = value value upper_bound __repr__ fmt_string = __class__ __name__ fmt_string += f lower_bound= lower_bound upper_bound= upper_bound fmt_string _Simplex Constraint Constrain unit simplex innermost rightmost dimension Specifically ` x = ` ` x sum - == ` event_dim = check value torch all value = dim=- value sum - - abs e- _Multinomial Constraint Constrain nonnegative integer values summing most upper bound Note due limitations Multinomial distribution currently checks weaker condition ` ` value sum - = upper_bound ` ` In future may strengthened ` ` value sum - == upper_bound ` ` is_discrete = True event_dim = __init__ upper_bound upper_bound = upper_bound check x x = all dim=- x sum dim=- = upper_bound _LowerTriangular Constraint Constrain lower-triangular square matrices event_dim = check value value_tril = value tril value_tril == value view value shape - + - min - _LowerCholesky Constraint Constrain lower-triangular square matrices positive diagonals event_dim = check value value_tril = value tril lower_triangular = value_tril == value view value shape - + - min - positive_diagonal = value diagonal dim =- dim =- min - lower_triangular positive_diagonal _CorrCholesky Constraint Constrain lower-triangular square matrices positive diagonals each row vector being unit length event_dim = check value tol = torch finfo value dtype eps value size - adjustable fudge factor row_norm = torch linalg norm value detach dim=- unit_row_norm = row_norm - abs le tol all dim=- _LowerCholesky check value unit_row_norm _Square Constraint Constrain square matrices event_dim = check value torch full size=value shape - fill_value= value shape - == value shape - dtype=torch bool device=value device _Symmetric _Square Constrain Symmetric square matrices check value square_check = super check value square_check all square_check torch isclose value value mT atol= e- all - all - _PositiveSemidefinite _Symmetric Constrain positive-semidefinite matrices check value sym_check = super check value sym_check all sym_check torch linalg eigvalsh value ge all - _PositiveDefinite _Symmetric Constrain positive-definite matrices check value sym_check = super check value sym_check all sym_check torch linalg cholesky_ex value info eq _Cat Constraint Constraint functor applies sequence constraints ` cseq ` submatrices dimension ` dim ` each size ` lengths dim ` way compatible func ` torch cat ` __init__ cseq dim= lengths=None assert all isinstance c Constraint c cseq cseq = list cseq lengths None lengths = len cseq lengths = list lengths assert len lengths == len cseq dim = dim super __init__ property is_discrete - bool type ignore override any c is_discrete c cseq property event_dim - int type ignore override max c event_dim c cseq check value assert -value dim = dim value dim checks = start = constr length zip cseq lengths v = value narrow dim start length checks append constr check v start = start + length avoid += jit compat torch cat checks dim _Stack Constraint Constraint functor applies sequence constraints ` cseq ` submatrices dimension ` dim ` way compatible func ` torch stack ` __init__ cseq dim= assert all isinstance c Constraint c cseq cseq = list cseq dim = dim super __init__ property is_discrete - bool type ignore override any c is_discrete c cseq property event_dim - int type ignore override dim = max c event_dim c cseq dim + dim dim += dim check value assert -value dim = dim value dim vs = value select dim i i range value size dim torch stack constr check v v constr zip vs cseq dim Public interface dependent = _Dependent dependent_property = _DependentProperty independent = _IndependentConstraint boolean = _Boolean one_hot = _OneHot nonnegative_integer = _IntegerGreaterThan positive_integer = _IntegerGreaterThan integer_interval = _IntegerInterval real = _Real real_vector = independent real positive = _GreaterThan nonnegative = _GreaterThanEq greater_than = _GreaterThan greater_than_eq = _GreaterThanEq less_than = _LessThan multinomial = _Multinomial unit_interval = _Interval interval = _Interval half_open_interval = _HalfOpenInterval simplex = _Simplex lower_triangular = _LowerTriangular lower_cholesky = _LowerCholesky corr_cholesky = _CorrCholesky square = _Square symmetric = _Symmetric positive_semidefinite = _PositiveSemidefinite positive_definite = _PositiveDefinite cat = _Cat stack = _Stack