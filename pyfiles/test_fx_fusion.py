Owner s module inductor typing Any Callable torch torch _inductor fx_passes pre_grad linear_permute_fusion linear_transpose permute_linear_fusion permute_matmul_fusion sink_cat_after_pointwise transpose_linear transpose_matmul torch _inductor test_case run_tests TestCase torch fx passes shape_prop ShapeProp PassFunc = Callable torch fx GraphModule Any torch fx GraphModule chain_passes passes PassFunc - PassFunc parent_pass module torch fx GraphModule input Any - torch fx GraphModule pass_ passes isinstance module torch fx GraphModule ShapeProp module propagate input module = pass_ module module parent_pass count_call module torch fx GraphModule op str target_op Any - int sum n op == op n target == target_op n module graph nodes count_call_function module torch fx GraphModule target_op Any - int count_call module call_function target_op count_call_method module torch fx GraphModule target_op Any - int count_call module call_method target_op TestFxFusion TestCase test_sink_cat_after_pointwise test_kwarg x y torch cat x y dim=- view - view tanh test_arg x y torch cat x y - view - view tanh test_arg x y torch cat x y view - view tanh test_kwarg x y torch cat tensors= x y dim= tanh test_kwarg x y torch cat tensors= x y dim= view tanh trace_func = chain_passes torch fx symbolic_trace sink_cat_after_pointwise inputs = torch randn torch randn f test_kwarg test_arg test_arg test_kwarg test_kwarg traced = trace_func f inputs torch testing assert_close f inputs traced inputs assertEqual count_call_method traced tanh test_linear_permute_fusion TestModule torch nn Module __init__ k int n int has_bias bool super __init__ weight = torch nn Parameter torch randn n k has_bias = has_bias has_bias bias = torch nn Parameter torch randn n forward input torch Tensor has_bias = torch nn functional linear input weight bias = torch nn functional linear input weight b = permute b m k n = trace_func = chain_passes torch fx symbolic_trace linear_permute_fusion has_bias True False module = TestModule k n has_bias eval input = torch randn m k traced = trace_func module input num_linear = count_call_function traced torch nn functional linear num_linear_transpose = count_call_function traced linear_transpose assertEqual num_linear assertEqual num_linear_transpose torch testing assert_close module input traced input test_permute_linear_fusion TestModule torch nn Module __init__ k int n int has_bias bool super __init__ weight = torch nn Parameter torch randn n k has_bias = has_bias has_bias bias = torch nn Parameter torch randn n forward input torch Tensor input = input permute has_bias torch nn functional linear input weight bias torch nn functional linear input weight m k n = trace_func = chain_passes torch fx symbolic_trace permute_linear_fusion has_bias True False module = TestModule k n has_bias eval input = torch randn k m traced = trace_func module input num_linear = count_call_function traced torch nn functional linear num_transpose_linear = count_call_function traced transpose_linear assertEqual num_linear assertEqual num_transpose_linear torch testing assert_close module input traced input test_permute_bmm_fusion TestModule torch nn Module __init__ batch int k int n int super __init__ other = torch randn batch k n forward input torch Tensor input = input permute output = torch bmm input other output batch m k n = trace_func = chain_passes torch fx symbolic_trace permute_matmul_fusion module = TestModule batch k n eval input = torch randn batch k m traced = trace_func module input num_bmm = count_call_function traced torch bmm num_transpose_matmul = count_call_function traced transpose_matmul assertEqual num_bmm assertEqual num_transpose_matmul torch testing assert_close module input traced input __name__ == __main__ run_tests