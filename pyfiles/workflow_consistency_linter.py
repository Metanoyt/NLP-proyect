Checks consistency jobs between different GitHub workflows Any job specific ` sync-tag ` must match all other jobs same ` sync-tag ` __future__ annotations argparse itertools json collections defaultdict enum Enum pathlib Path typing Any NamedTuple TYPE_CHECKING yaml dump load REPO_ROOT = Path __file__ resolve parent parent parent parent TYPE_CHECKING collections abc Iterable Safely load fast C Yaml loader dumper they available try yaml CSafeLoader Loader except ImportError yaml SafeLoader Loader type ignore assignment misc LintSeverity str Enum ERROR = error WARNING = warning ADVICE = advice DISABLED = disabled LintMessage NamedTuple path str &#124; None line int &#124; None char int &#124; None code str severity LintSeverity name str original str &#124; None replacement str &#124; None description str &#124; None glob_yamls path Path - Iterable Path itertools chain path glob yml path glob yaml load_yaml path Path - Any open path f load f Loader is_workflow yaml Any - bool yaml get jobs None print_lint_message path Path job dict str Any sync_tag str baseline_path Path baseline_job_id str - None job_id = next iter job keys open path f lines = f readlines i line enumerate lines f job_id line line_number = i + lint_message = LintMessage path=str path pyrefly ignore unbound-name line=line_number char=None code= WORKFLOWSYNC severity=LintSeverity ERROR name= workflow-inconsistency original=None replacement=None description=f Job doesn t match other job baseline_job_id file baseline_path sync-tag sync_tag print json dumps lint_message _asdict flush=True get_jobs_with_sync_tag job dict str Any - tuple str str dict str Any &#124; None sync_tag = job get get sync-tag sync_tag None None remove field which we allow different between jobs since you might have different triggering conditions pull vs trunk say job del job same true test-matrix test-matrix job get del job test-matrix sync_tag job_id job __name__ == __main__ parser = argparse ArgumentParser description= workflow consistency linter fromfile_prefix_chars= parser add_argument filenames nargs= + help= paths lint args = parser parse_args Go through all files aggregating jobs same sync tag tag_to_jobs = defaultdict list path REPO_ROOT glob github workflows path is_file path suffix yml yaml continue workflow = load_yaml path is_workflow workflow continue clean_path = path relative_to REPO_ROOT jobs = workflow get jobs job_id job jobs items res = get_jobs_with_sync_tag job res None continue sync_tag job_id job_dict = res tag_to_jobs sync_tag append clean_path job_id job_dict Check files passed arguments path args filenames workflow = load_yaml Path path jobs = workflow jobs job_id job jobs items res = get_jobs_with_sync_tag job res None continue sync_tag job_id job_dict = res job_str = dump job_dict For each sync tag check all jobs have same code baseline_path baseline_job_id baseline_dict tag_to_jobs sync_tag baseline_str = dump baseline_dict job_id = baseline_job_id job_str = baseline_str print_lint_message path job_dict sync_tag baseline_path baseline_job_id