Owner s module PrivateUse numpy np torch torch _C torch testing _internal common_utils run_tests TestCase torch utils backend_registration _setup_privateuseone_for_python_backend _setup_privateuseone_for_python_backend npy aten = torch ops aten NOTE From https github com albanD subclass_zoo blob main new_device py using torch library instead ` __torch_dispatch__ ` MyDeviceTensor torch Tensor staticmethod __new__ cls size dtype raw_data=None requires_grad=False Use meta Tensor here used wrapper res = torch _C _acc create_empty_tensor size dtype res __class__ = MyDeviceTensor res __init__ size dtype raw_data=None requires_grad=False Store any provided user raw_data raw_data = raw_data __repr__ MyDeviceTensor + str raw_data __str__ = __repr__ wrap arr shape dtype hard code float tests MyDeviceTensor shape dtype arr unwrap arr arr raw_data Add some ops torch library impl aten add Tensor privateuseone add t t out = unwrap t + unwrap t wrap out out shape torch float torch library impl aten mul Tensor privateuseone mul t t If unsure what should result s properties you can use super_fn can useful type promotion out = unwrap t unwrap t wrap out out shape torch float torch library impl aten detach privateuseone detach out = unwrap wrap out out shape torch float torch library impl aten empty_strided privateuseone empty_strided size stride dtype=None layout=None device=None pin_memory=None out = np empty size wrap out out shape torch float torch library impl aten _copy_from privateuseone _copy_from b device type == npy npy_data = unwrap npy_data = numpy b raw_data = npy_data torch library impl aten view privateuseone _view b ans = unwrap wrap ans shape dtype torch library impl aten empty memory_format privateuseone empty_memory_format size dtype=None layout=None device=None pin_memory=None memory_format=None ans = np empty size wrap ans ans shape torch float torch library impl aten sum privateuseone sum_int_list args kwargs ans = unwrap args sum wrap ans ans shape torch float torch library impl aten ones_like privateuseone ones_like dtype=None layout=None device=None pin_memory=None memory_format=None ans = np ones_like unwrap wrap ans ans shape torch float torch library impl aten expand privateuseone expand size implicit=False ans = np broadcast_to raw_data size wrap ans ans shape torch float torch library impl aten as_strided privateuseone as_strided size stride storage_offset=None ans = np lib stride_tricks as_strided raw_data size stride wrap ans ans shape torch float PrivateUse BackendTest TestCase classmethod setupClass cls pass test_accessing_is_pinned a_cpu = torch randn Assert don t throw _ = a_cpu is_pinned test_backend_simple a_cpu = torch randn b_cpu = torch randn Assert don t throw = a_cpu privateuseone b = b_cpu privateuseone requires_grad = True b requires_grad = True c = + b sum c backward assertTrue np allclose grad raw_data np ones __name__ == __main__ run_tests