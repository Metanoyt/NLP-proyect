__future__ annotations argparse concurrent futures json logging os re subprocess time enum Enum typing NamedTuple LINTER_CODE = CMAKE LintSeverity str Enum ERROR = error WARNING = warning ADVICE = advice DISABLED = disabled LintMessage NamedTuple path str &#124; None line int &#124; None char int &#124; None code str severity LintSeverity name str original str &#124; None replacement str &#124; None description str &#124; None CMakeLists txt Lines should = characters long linelength RESULTS_RE re Pattern str = re compile r mx ^ P file P line \d+ \s P message \s P code \ \ $ run_command args list str - subprocess CompletedProcess bytes logging debug $ s join args start_time = time monotonic try subprocess run args capture_output=True finally end_time = time monotonic logging debug took dms end_time - start_time check_file filename str config str - list LintMessage try proc = run_command cmakelint f -- config= config filename except OSError err LintMessage path=None line=None char=None code=LINTER_CODE severity=LintSeverity ERROR name= command-failed original=None replacement=None description= f Failed due err __class__ __name__ \n err stdout = str proc stdout utf- strip LintMessage path=match file name=match code description=match message line=int match line char=None code=LINTER_CODE severity=LintSeverity ERROR original=None replacement=None match RESULTS_RE finditer stdout __name__ == __main__ parser = argparse ArgumentParser description= cmakelint runner fromfile_prefix_chars= parser add_argument -- config required=True help= location cmakelint config parser add_argument filenames nargs= + help= paths lint args = parser parse_args concurrent futures ThreadPoolExecutor max_workers=os cpu_count thread_name_prefix= Thread executor futures = executor submit check_file filename args config filename filename args filenames future concurrent futures as_completed futures try lint_message future result print json dumps lint_message _asdict flush=True except Exception logging critical Failed s futures future raise