Owner s module onnx unittest pytorch_test_common model_defs dcgan _netD _netG bsz imgsz nz weights_init model_defs emb_seq EmbeddingNetwork EmbeddingNetwork model_defs mnist MNIST model_defs op_test ConcatNet DummyNet FakeQuantNet PermuteNet PReluNet model_defs squeezenet SqueezeNet model_defs srresnet SRResNet model_defs super_resolution SuperResolutionNet pytorch_test_common skipIfUnsupportedMinOpsetVersion skipScriptTest torchvision models shufflenet_v _x _ torchvision models alexnet alexnet torchvision models densenet densenet torchvision models googlenet googlenet torchvision models inception inception_v torchvision models mnasnet mnasnet _ torchvision models mobilenet mobilenet_v torchvision models resnet resnet torchvision models segmentation deeplabv _resnet fcn_resnet torchvision models vgg vgg vgg _bn vgg vgg _bn torchvision models video mc _ r plus d_ r d_ verify verify torch torch ao quantization torch autograd Variable torch onnx OperatorExportTypes torch testing _internal common_utils torch testing _internal common_utils skipIfNoLapack torch cuda is_available toC x x cuda toC x x BATCH_SIZE = TestModels pytorch_test_common ExportTestCase opset_version = Caffe doesn t support default keep_initializers_as_inputs = False exportTest model inputs rtol= e- atol= e- kwargs caffe python onnx backend backend torch onnx select_model_mode_for_export model torch onnx TrainingMode EVAL graph = torch onnx utils _trace model inputs OperatorExportTypes ONNX torch _C _jit_pass_lint graph verify model inputs backend rtol=rtol atol=atol opset_version=self opset_version test_ops x = Variable torch randn BATCH_SIZE fill_ exportTest toC DummyNet toC x test_prelu x = Variable torch randn BATCH_SIZE fill_ exportTest PReluNet x skipScriptTest test_concat input_a = Variable torch randn BATCH_SIZE input_b = Variable torch randn BATCH_SIZE inputs = toC input_a toC input_b exportTest toC ConcatNet inputs test_permute x = Variable torch randn BATCH_SIZE exportTest PermuteNet x skipScriptTest test_embedding_sequential_ x = Variable torch randint BATCH_SIZE exportTest EmbeddingNetwork x skipScriptTest test_embedding_sequential_ x = Variable torch randint BATCH_SIZE exportTest EmbeddingNetwork x unittest skip This model takes too much memory test_srresnet x = Variable torch randn fill_ exportTest toC SRResNet rescale_factor= n_filters= n_blocks= toC x skipIfNoLapack test_super_resolution x = Variable torch randn BATCH_SIZE fill_ exportTest toC SuperResolutionNet upscale_factor= toC x atol= e- test_alexnet x = Variable torch randn BATCH_SIZE fill_ exportTest toC alexnet toC x test_mnist x = Variable torch randn BATCH_SIZE fill_ exportTest toC MNIST toC x unittest skip This model takes too much memory test_vgg VGG -layer model configuration D x = Variable torch randn BATCH_SIZE fill_ exportTest toC vgg toC x unittest skip This model takes too much memory test_vgg _bn VGG -layer model configuration D batch normalization x = Variable torch randn BATCH_SIZE fill_ exportTest toC vgg _bn toC x unittest skip This model takes too much memory test_vgg VGG -layer model configuration E x = Variable torch randn BATCH_SIZE fill_ exportTest toC vgg toC x unittest skip This model takes too much memory test_vgg _bn VGG -layer model configuration E batch normalization x = Variable torch randn BATCH_SIZE fill_ exportTest toC vgg _bn toC x test_resnet ResNet model x = Variable torch randn BATCH_SIZE fill_ exportTest toC resnet toC x atol= e- This test numerically unstable Sporadic single element mismatch occurs occasionally test_inception x = Variable torch randn BATCH_SIZE exportTest toC inception_v toC x acceptable_error_percentage= test_squeezenet SqueezeNet AlexNet-level accuracy x fewer parameters MB model size x = Variable torch randn BATCH_SIZE fill_ sqnet_v _ = SqueezeNet version= exportTest toC sqnet_v _ toC x SqueezeNet has x less computation slightly fewer params than SqueezeNet without sacrificing accuracy x = Variable torch randn BATCH_SIZE fill_ sqnet_v _ = SqueezeNet version= exportTest toC sqnet_v _ toC x test_densenet Densenet- model x = Variable torch randn BATCH_SIZE fill_ exportTest toC densenet toC x rtol= e- atol= e- skipScriptTest test_dcgan_netD netD = _netD netD apply weights_init input = Variable torch empty bsz imgsz imgsz normal_ exportTest toC netD toC input skipScriptTest test_dcgan_netG netG = _netG netG apply weights_init input = Variable torch empty bsz nz normal_ exportTest toC netG toC input skipIfUnsupportedMinOpsetVersion test_fake_quant x = Variable torch randn BATCH_SIZE fill_ exportTest toC FakeQuantNet toC x skipIfUnsupportedMinOpsetVersion test_qat_resnet_pertensor Quantize ResNet model x = Variable torch randn BATCH_SIZE fill_ qat_resnet = resnet Use per tensor weight Per channel support will come opset qat_resnet qconfig = quantization QConfig activation=quantization default_fake_quant weight=quantization default_fake_quant quantization prepare_qat qat_resnet inplace=True qat_resnet apply torch ao quantization enable_observer qat_resnet apply torch ao quantization enable_fake_quant _ = qat_resnet x module qat_resnet modules isinstance module quantization FakeQuantize module calculate_qparams qat_resnet apply torch ao quantization disable_observer exportTest toC qat_resnet toC x skipIfUnsupportedMinOpsetVersion test_qat_resnet_per_channel Quantize ResNet model x = torch randn BATCH_SIZE fill_ qat_resnet = resnet qat_resnet qconfig = quantization QConfig activation=quantization default_fake_quant weight=quantization default_per_channel_weight_fake_quant quantization prepare_qat qat_resnet inplace=True qat_resnet apply torch ao quantization enable_observer qat_resnet apply torch ao quantization enable_fake_quant _ = qat_resnet x module qat_resnet modules isinstance module quantization FakeQuantize module calculate_qparams qat_resnet apply torch ao quantization disable_observer exportTest toC qat_resnet toC x skipScriptTest skip_before_opset_version= reason= None type outputs test_googlenet x = Variable torch randn BATCH_SIZE fill_ exportTest toC googlenet toC x rtol= e- atol= e- test_mnasnet x = Variable torch randn BATCH_SIZE fill_ exportTest toC mnasnet _ toC x rtol= e- atol= e- test_mobilenet x = Variable torch randn BATCH_SIZE fill_ exportTest toC mobilenet_v toC x rtol= e- atol= e- skipScriptTest prim_data test_shufflenet x = Variable torch randn BATCH_SIZE fill_ exportTest toC shufflenet_v _x _ toC x rtol= e- atol= e- skipIfUnsupportedMinOpsetVersion test_fcn x = Variable torch randn BATCH_SIZE fill_ exportTest toC fcn_resnet weights=None weights_backbone=None toC x rtol= e- atol= e- skipIfUnsupportedMinOpsetVersion test_deeplab x = Variable torch randn BATCH_SIZE fill_ exportTest toC deeplabv _resnet weights=None weights_backbone=None toC x rtol= e- atol= e- test_r d_ _video x = Variable torch randn fill_ exportTest toC r d_ toC x rtol= e- atol= e- test_mc _ _video x = Variable torch randn fill_ exportTest toC mc _ toC x rtol= e- atol= e- test_r plus d_ _video x = Variable torch randn fill_ exportTest toC r plus d_ toC x rtol= e- atol= e- __name__ == __main__ common_utils run_tests