mypy allow-untyped-defs Copyright c Facebook Inc its affiliates All rights reserved This source code licensed under BSD-style license found LICENSE file root directory source tree binascii base b decode b encode typing cast Optional urllib exceptions type ignore try etcd type ignore except ModuleNotFoundError _etcd_stub etcd torch distributed Store api RendezvousConnectionError RendezvousParameters RendezvousStateError dynamic_rendezvous RendezvousBackend Token etcd_store EtcdStore utils parse_rendezvous_endpoint EtcdRendezvousBackend RendezvousBackend Represents etcd-based rendezvous backend Args client The ` ` etcd Client ` ` instance use communicate etcd run_id The run id rendezvous key_prefix The path under which store rendezvous state etcd ttl The TTL rendezvous state If specified defaults two hours _DEFAULT_TTL = hours _client etcd Client _key str _ttl int __init__ client etcd Client run_id str key_prefix Optional str = None ttl Optional int = None - None run_id raise ValueError The run id must non-empty string _client = client key_prefix _key = key_prefix + + run_id _key = run_id ttl ttl _ttl = ttl _ttl = _DEFAULT_TTL property name - str See base etcd-v get_state - Optional tuple bytes Token See base try result = _client read _key except etcd EtcdKeyNotFound None except etcd EtcdException urllib exceptions TimeoutError exc raise RendezvousConnectionError The connection etcd has failed See inner exception details exc _decode_state result set_state state bytes token Optional Token = None - Optional tuple bytes Token bool See base base _state = b encode state decode kwargs = get_state result = get_state result None result False None token try token = int token except ValueError get_state token kwargs prevIndex = token kwargs prevExist = False try result = _client write _key base _state _ttl kwargs except etcd EtcdAlreadyExist etcd EtcdCompareFailed result = None except etcd EtcdException urllib exceptions TimeoutError exc raise RendezvousConnectionError The connection etcd has failed See inner exception details exc result None get_state tmp = _decode_state result True tmp _decode_state result etcd EtcdResult - tuple bytes Token pyrefly ignore missing-attribute base _state = result value encode try state = b decode base _state except binascii Error exc raise RendezvousStateError The state object corrupt See inner exception details exc pyrefly ignore missing-attribute state result modifiedIndex _create_etcd_client params RendezvousParameters - etcd Client host port = parse_rendezvous_endpoint params endpoint default_port= The timeout read_timeout = cast int params get_as_int read_timeout read_timeout = raise ValueError The read timeout must positive integer The communication protocol protocol = params get protocol http strip lower protocol = http protocol = https raise ValueError The protocol must HTTP HTTPS The SSL client certificate ssl_cert = params get ssl_cert ssl_cert ssl_cert_key = params get ssl_cert_key ssl_cert_key The etcd client expects certificate key second element ` cert ` tuple ssl_cert = ssl_cert ssl_cert_key The root certificate ca_cert = params get ca_cert try etcd Client host port read_timeout=read_timeout protocol=protocol cert=ssl_cert ca_cert=ca_cert allow_reconnect=True except etcd EtcdException urllib exceptions TimeoutError exc raise RendezvousConnectionError The connection etcd has failed See inner exception details exc create_backend params RendezvousParameters - tuple EtcdRendezvousBackend Store Create new py ` EtcdRendezvousBackend ` specified parameters + -------------- + ----------------------------------------------------------- + &#124; Parameter &#124; Description &#124; +==============+===========================================================+ &#124; read_timeout &#124; The read timeout seconds etcd operations &#124; &#124; &#124; Defaults seconds &#124; + -------------- + ----------------------------------------------------------- + &#124; protocol &#124; The protocol use communicate etcd Valid &#124; &#124; &#124; values http https Defaults http &#124; + -------------- + ----------------------------------------------------------- + &#124; ssl_cert &#124; The path SSL client certificate use along &#124; &#124; &#124; HTTPS Defaults ` ` None ` ` &#124; + -------------- + ----------------------------------------------------------- + &#124; ssl_cert_key &#124; The path private key SSL client certificate &#124; &#124; &#124; use along HTTPS Defaults ` ` None ` ` &#124; + -------------- + ----------------------------------------------------------- + &#124; ca_cert &#124; The path rool SSL authority certificate Defaults &#124; &#124; &#124; ` ` None ` ` &#124; + -------------- + ----------------------------------------------------------- + client = _create_etcd_client params backend = EtcdRendezvousBackend client params run_id key_prefix= torch elastic rendezvous store = EtcdStore client torch elastic store backend store