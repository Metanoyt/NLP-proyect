itertools random sys pathlib Path typing Any sys path append str Path __file__ absolute parents benchmark_runner BenchmarkRunner type ignore import-not-found benchmark_utils type ignore import-not-found fits_in_memory get_mm_tensors get_random_between_pow set_precision torch torch _inductor utils fresh_cache BenchmarkRunnerMM BenchmarkRunner type ignore misc no-any-unimported BenchmarkRunner mm __init__ - None super __init__ mm create_input - tuple Any dtype = random choices torch float torch float torch bfloat set_precision dtype m k n = get_m_k_n dtype m k n dtype run_benchmark m int k int n int dtype Any - Any given shape test all possible combinations transpose_left transpose_right transpose_left transpose_right itertools product False True repeat= print f m m k k n n transpose_left transpose_left transpose_right transpose_right dtype dtype b = get_mm_tensors m k n transpose_left transpose_right dtype_left=dtype dtype_right=dtype fresh_cache mixed_mm A Any B Any - Any torch mm A B cf = torch compile mixed_mm mode= max-autotune-no-cudagraphs cf b torch compiler reset random_multiple_of_ min_num int = max_num int = - int generates random number ran_pow between min_num max_num - returns random multiple between ^ran_pow ^ ran_pow + ran_pow = random randint min_num max_num - start = ran_pow end = ran_pow + random_multiple = random randint start end random_multiple get_distr_type - str choose random multiple between ^ ^ choose random power between ^ ^ choose random number between choose random number between ^i ^ i+ i random choices mult_ pow uniform uniform-between-pow get_random_dim - int distr_type = get_distr_type distr_type == mult_ random_multiple_of_ min_num= max_num= distr_type == pow int random randint distr_type == uniform-between-pow TODO AlnisM make mypy work torchgen _autoheuristic int get_random_between_pow min_power = max_power = distr_type == uniform random randint print f random_type distr_type supported sys exit get_m_k_n dtype Any - tuple int int int numel_max = repeat until tensors fit memory while True m = get_random_dim k = get_random_dim n = get_random_dim m k = numel_max m n = numel_max k n = numel_max autotuning will happen tensors large continue fits_in_memory dtype m k n m k n __name__ == __main__ runner = BenchmarkRunnerMM runner run