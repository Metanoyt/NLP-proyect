mypy allow-untyped-defs torch functorch experimental control_flow cond CondBranchNestedFunction torch nn Module The branch functions ` true_fn ` ` false_fn ` passed cond must follow these rules - both branches must take same args which must also match branch args passed cond - both branches must single tensor - returned tensor must have same tensor metadata e g shape dtype - branch function can free function nested function lambda methods - branch function can have closure variables - no inplace mutations inputs global variables This example demonstrates using nested function cond NOTE If ` pred ` test dim batch size will specialized forward x true_fn x inner_true_fn y x + y inner_true_fn x false_fn x inner_false_fn y x - y inner_false_fn x cond x shape true_fn false_fn x example_args = torch randn tags = torch cond torch dynamic-shape model = CondBranchNestedFunction