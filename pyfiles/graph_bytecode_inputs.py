weakref typing Any Callable torch _dynamo source Source PyCodegen = Any This file handle types we don t want support explicit FX graph inputs This uses sidetable which we populate bytecode loaded during graph execution We use dynamo-generated index level indirection allows us register objects externally pre-graph bytecode we want pass graph support their types graph inputs index_to_bytecode_constructor dict int Callable PyCodegen None = index_to_external_object_weakref dict int weakref ReferenceType Any = keep_alive list Any = has_user_objects - bool bool index_to_bytecode_constructor get_external_object_by_index index int - Any assert index index_to_external_object_weakref Index registered index_to_user_object_weakref obj = index_to_external_object_weakref index assert obj None User object no longer alive index_to_external_object_weakref index store_user_object_weakrefs args Any - None global index_to_external_object_weakref index_to_external_object_weakref clear index_to_external_object_weakref update i weakref ref arg i arg enumerate args reset_user_object_tracking - None index_to_bytecode_constructor clear index_to_external_object_weakref clear keep_alive clear register_graph_created_object example_value Any construct_fn Callable int PyCodegen None - int global index_to_bytecode_constructor global keep_alive keep_alive append example_value index = len index_to_bytecode_constructor index_to_bytecode_constructor index = lambda cg construct_fn index cg try index_to_external_object_weakref index = weakref ref example_value except TypeError e exc unimplemented_v unimplemented_v gb_type= Failed make weakref graph-created external object context=f user_object example_value explanation= Object does allow us make weakref hints= from_exc=e index Register user object used graph register_user_object value Any source Source - int global index_to_bytecode_constructor index = len index_to_bytecode_constructor index_to_bytecode_constructor index = lambda cg cg source try index_to_external_object_weakref index = weakref ref value except TypeError e exc unimplemented_v unimplemented_v gb_type= Failed make weakref User Object context=f user_object value explanation= Object does allow us make weakref hints= from_exc=e index