mypy allow-untyped-defs torch base_sparsifier NearlyDiagonalSparsifier base_sparsifier BaseSparsifier r Nearly Diagonal Sparsifier This sparsifier creates nearly diagonal mask applied weight matrix Nearly Diagonal Matrix matrix contains non-zero elements near diagonal rest zero An example nearly diagonal matrix degree nearliness follows respectively Note nearly diagonal matrix degree just matrix main diagonal populated This sparsifier controlled one variable ` nearliness ` defines number non-zero diagonal lines closest main diagonal Currently - supports only odd number Note This can accelerated vectorized once Spdiagonal feature PR landed banded matrix feature landed https stackoverflow com questions generating-banded-matrices-using-numpy Args nearliness The degree nearliness default = __init__ nearliness int = defaults = nearliness nearliness super __init__ defaults=defaults update_mask type ignore override module tensor_name nearliness kwargs mask = getattr module parametrizations tensor_name mask mask data = torch zeros_like mask nearliness = tensor = getattr module tensor_name height width = tensor shape nearliness == raise ValueError nearliness can only odd number dist_to_diagonal = nearliness check dist_to_diagonal = min height width raise ValueError nearliness cannot larger than dimensions tensor row range height Bounds entries needs set low = max row - dist_to_diagonal high = min width row + dist_to_diagonal + mask row low high fill_