Checks files make sure there no imports disallowed third party libraries __future__ annotations argparse json os sys token enum Enum pathlib Path typing NamedTuple TYPE_CHECKING _PARENT = Path __file__ parent absolute _PATH = Path p absolute p sys path TYPE_CHECKING _PARENT _PATH _linter _linter LintSeverity str Enum ERROR = error WARNING = warning ADVICE = advice DISABLED = disabled LintMessage NamedTuple path str &#124; None line int &#124; None char int &#124; None code str severity LintSeverity name str original str &#124; None replacement str &#124; None description str &#124; None LINTER_CODE = IMPORT_LINTER CURRENT_FILE_NAME = os path basename __file__ _MODULE_NAME_ALLOW_LIST set str = set Add builtin modules python _MODULE_NAME_ALLOW_LIST update sys stdlib_module_names Add allowed third party libraries Please avoid updating unless you understand risks -- see ` _ERROR_MESSAGE ` why _MODULE_NAME_ALLOW_LIST update sympy einops libfb torch tvm _pytest tabulate optree typing_extensions triton functorch torchrec numpy torch_xla _ERROR_MESSAGE = Please do third-party modules PyTorch unless they re explicit requirements PyTorch Imports third-party library may have side effects other unintentional behavior If you re just checking module exists use sys modules get torchrec like check_file filepath str - list LintMessage path = Path filepath file = _linter PythonFile import_linter path lint_messages = line_number line_of_tokens enumerate file token_lines Skip indents idx = tok line_of_tokens tok type == token INDENT idx += break Look either foo foo idx + len line_of_tokens tok = line_of_tokens idx tok = line_of_tokens idx + tok type == token NAME tok string tok type == token NAME module_name = tok string module_name _MODULE_NAME_ALLOW_LIST msg = LintMessage path=filepath line=line_number char=None code= IMPORT severity=LintSeverity ERROR name= Disallowed original=None replacement=None description=_ERROR_MESSAGE lint_messages append msg lint_messages __name__ == __main__ parser = argparse ArgumentParser description= native functions linter fromfile_prefix_chars= parser add_argument filepaths nargs= + help= paths files lint args = parser parse_args Check all files all_lint_messages = filepath args filepaths lint_messages = check_file filepath all_lint_messages extend lint_messages Print out lint messages lint_message all_lint_messages print json dumps lint_message _asdict flush=True