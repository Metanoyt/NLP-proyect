Owner s module dynamo unittest torch torch _dynamo test_case torch _dynamo testing torch testing _internal common_utils IS_FBCODE MutationExportTests torch _dynamo test_case TestCase check_failure_on_export mod args assertRaises AssertionError torch _dynamo export mod args check_same_with_export mod arg real_result = mod arg graph _ = torch _dynamo export mod arg result = graph arg assertEqual result real_result test_module_attribute_mutation_violation_positive_ Mutating attribute Tensor type Foo torch nn Module __init__ - None super __init__ = torch randn forward x = torch float x sum + sum check_same_with_export Foo torch randn test_module_attribute_mutation_violation_negative_ Mutating attribute Tensor type inside __init__ forward Foo torch nn Module __init__ - None super __init__ = torch randn forward x x sum + torch float sum check_same_with_export Foo torch randn test_module_attribute_mutation_violation_negative_ Mutating attribute Tensor type inside __init__ twice Foo torch nn Module __init__ - None super __init__ = torch randn = torch float forward x x sum + sum check_same_with_export Foo torch randn test_module_attribute_mutation_violation_negative_ Mutating local variable inside forward Foo torch nn Module __init__ - None super __init__ = torch randn forward x b = b = b x sum + sum + b check_same_with_export Foo torch randn unittest skipIf IS_FBCODE Broken fbcode test_module_attribute_mutation_violation_negative_ Mutating attribute Tensor type But exporting using eager mode well dynamo optimize mode Foo torch nn Module __init__ - None super __init__ = torch randn forward x = torch float x sum + sum mod = Foo arg = torch randn real_result = mod arg opt_mod = torch compile mod backend= eager fullgraph=True assertEqual opt_mod arg real_result __name__ == __main__ torch _dynamo test_case run_tests run_tests