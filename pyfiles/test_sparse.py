Owner s oncall jit io unittest torch torch testing _internal common_utils IS_WINDOWS raise_on_run_directly TEST_MKL torch testing _internal jit_utils JitTestCase TestSparse JitTestCase test_freeze_sparse_coo SparseTensorModule torch nn Module __init__ - None super __init__ = torch rand to_sparse b = torch rand to_sparse forward x x + + b x = torch rand to_sparse m = SparseTensorModule unfrozen_result = m forward x m eval frozen = torch jit freeze torch jit script m frozen_result = frozen forward x assertEqual unfrozen_result frozen_result buffer = io BytesIO torch jit save frozen buffer buffer seek loaded_model = torch jit load buffer loaded_result = loaded_model forward x assertEqual unfrozen_result loaded_result test_serialize_sparse_coo SparseTensorModule torch nn Module __init__ - None super __init__ = torch rand to_sparse b = torch rand to_sparse forward x x + + b x = torch rand to_sparse m = SparseTensorModule expected_result = m forward x buffer = io BytesIO torch jit save torch jit script m buffer buffer seek loaded_model = torch jit load buffer loaded_result = loaded_model forward x assertEqual expected_result loaded_result unittest skipIf IS_WINDOWS TEST_MKL Need MKL run CSR matmul test_freeze_sparse_csr SparseTensorModule torch nn Module __init__ - None super __init__ = torch rand to_sparse_csr b = torch rand to_sparse_csr forward x x matmul matmul b x = torch rand to_sparse_csr m = SparseTensorModule unfrozen_result = m forward x m eval frozen = torch jit freeze torch jit script m frozen_result = frozen forward x assertEqual unfrozen_result to_dense frozen_result to_dense buffer = io BytesIO torch jit save frozen buffer buffer seek loaded_model = torch jit load buffer loaded_result = loaded_model forward x assertEqual unfrozen_result to_dense loaded_result to_dense unittest skipIf IS_WINDOWS TEST_MKL Need MKL run CSR matmul test_serialize_sparse_csr SparseTensorModule torch nn Module __init__ - None super __init__ = torch rand to_sparse_csr b = torch rand to_sparse_csr forward x x matmul matmul b x = torch rand to_sparse_csr m = SparseTensorModule expected_result = m forward x buffer = io BytesIO torch jit save torch jit script m buffer buffer seek loaded_model = torch jit load buffer loaded_result = loaded_model forward x assertEqual expected_result to_dense loaded_result to_dense __name__ == __main__ raise_on_run_directly test test_jit py