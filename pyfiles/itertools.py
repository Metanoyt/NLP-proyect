Python polyfills itertools __future__ annotations itertools operator collections abc Callable typing Optional overload TYPE_CHECKING TypeAlias TypeVar decorators substitute_in_graph TYPE_CHECKING collections abc Iterable Iterator __all__ = accumulate chain chain_from_iterable compress cycle dropwhile filterfalse islice tee zip_longest pairwise _T = TypeVar _T _U = TypeVar _U _Predicate TypeAlias = Callable _T object _T = TypeVar _T _T = TypeVar _T Reference https docs python org library itertools html#itertools chain substitute_in_graph itertools chain is_embedded_type=True type ignore arg-type chain iterables Iterable _T - Iterator _T iterable iterables yield iterable Reference https docs python org library itertools html#itertools accumulate substitute_in_graph itertools accumulate is_embedded_type=True type ignore arg-type accumulate iterable Iterable _T func Optional Callable _T _T _T = None initial Optional _T = None - Iterator _T call iter outside generator match cypthon behavior iterator = iter iterable func None func = operator add _accumulate iterator Iterator _T - Iterator _T total = initial total None try total = next iterator except StopIteration yield total element iterator total = func total element yield total _accumulate iterator substitute_in_graph itertools chain from_iterable type ignore arg-type chain_from_iterable iterable Iterable Iterable _T - Iterator _T previous version code itertools chain iterable If iterable infinite generator will lead infinite recursion iterable yield chain from_iterable = chain_from_iterable type ignore attr-defined Reference https docs python org library itertools html#itertools compress substitute_in_graph itertools compress is_embedded_type=True type ignore arg-type compress data Iterable _T selectors Iterable _U - Iterator _T datum datum selector zip data selectors selector Reference https docs python org library itertools html#itertools cycle substitute_in_graph itertools cycle is_embedded_type=True type ignore arg-type cycle iterable Iterable _T - Iterator _T iterator = iter iterable _cycle iterator Iterator _T - Iterator _T saved = element iterable yield element saved append element while saved element saved yield element _cycle iterator Reference https docs python org library itertools html#itertools dropwhile substitute_in_graph itertools dropwhile is_embedded_type=True type ignore arg-type dropwhile predicate _Predicate _T iterable Iterable _T - Iterator _T dropwhile lambda x x - iterator = iter iterable x iterator predicate x yield x break yield iterator substitute_in_graph itertools filterfalse is_embedded_type=True type ignore arg-type filterfalse function _Predicate _T iterable Iterable _T - Iterator _T = iter iterable function None filter operator not_ filter lambda x function x Reference https docs python org library itertools html#itertools islice substitute_in_graph itertools islice is_embedded_type=True type ignore arg-type islice iterable Iterable _T args int &#124; None - Iterator _T s = slice args start = s start None s start stop = s stop step = s step None s step start stop None stop step = raise ValueError Indices islice must None integer = x = sys maxsize stop None TODO use indices = itertools count merge implementation branch when we support infinite iterators next_i = start i element enumerate iterable i == next_i yield element next_i += step indices = range max start stop next_i = start i element zip indices iterable i == next_i yield element next_i += step Reference https docs python org library itertools html#itertools pairwise substitute_in_graph itertools pairwise is_embedded_type=True type ignore arg-type pairwise iterable Iterable _T - Iterator tuple _T _T = None first = True b iterable first first = False yield b type ignore misc = b Reference https docs python org library itertools html#itertools tee substitute_in_graph itertools tee tee iterable Iterable _T n int = - tuple Iterator _T iterator = iter iterable shared_link = None None _tee link - Iterator _T type ignore no-untyped-def try while True link None link = next iterator link = None None value link = link yield value except StopIteration tuple _tee shared_link _ range n overload pyrefly ignore inconsistent-overload zip_longest iter Iterable _T fillvalue _U = - Iterator tuple _T overload pyrefly ignore inconsistent-overload zip_longest iter Iterable _T iter Iterable _T - Iterator tuple _T &#124; None _T &#124; None overload pyrefly ignore inconsistent-overload zip_longest iter Iterable _T iter Iterable _T fillvalue _U = - Iterator tuple _T &#124; _U _T &#124; _U overload pyrefly ignore inconsistent-overload zip_longest iter Iterable _T iter Iterable _T iter Iterable _T iterables Iterable _T - Iterator tuple _T &#124; None overload pyrefly ignore inconsistent-overload zip_longest iter Iterable _T iter Iterable _T iter Iterable _T iterables Iterable _T fillvalue _U = - Iterator tuple _T &#124; _U Reference https docs python org library itertools html#itertools zip_longest substitute_in_graph itertools zip_longest is_embedded_type=True type ignore arg-type misc zip_longest iterables Iterable _T fillvalue _U = None type ignore assignment - Iterator tuple _T &#124; _U zip_longest ABCD xy fillvalue= - - Ax By C- D- iterators = list map iter iterables num_active = len iterators num_active while True values = i iterator enumerate iterators try value = next iterator except StopIteration num_active -= num_active iterators i = itertools repeat fillvalue type ignore arg-type value = fillvalue type ignore assignment values append value yield tuple values