usr bin env python Wrapper script run isolated hook version lintrunner This allows developers easily run lintrunner including -a auto-fixes using same isolated environment pre-push hook uses without having manually activate deactivate virtual environments Usage python scripts lintrunner py Check mode same git push python scripts lintrunner py -a Auto-fix mode python scripts lintrunner py -- help Show lintrunner help This module also provides shared functionality lintrunner hash management __future__ annotations hashlib os shlex shutil subprocess sys pathlib Path find_repo_root - Path Find repository root using git try result = subprocess run git rev-parse -- show-toplevel capture_output=True text=True check=True Path result stdout strip except subprocess CalledProcessError sys exit ‚ùå Not git repository compute_file_hash path Path - str Returns SHA hash file s contents hasher = hashlib sha path open rb f while chunk = f read hasher update chunk hasher hexdigest read_stored_hash path Path - str &#124; None path exists None try path read_text strip except Exception None Venv location - change path changes HOOK_VENV_PATH = git hooks linter venv get_hook_venv_path - Path Get path hook virtual environment repo_root = find_repo_root repo_root HOOK_VENV_PATH find_hook_venv - Path Locate isolated hook virtual environment venv_dir = get_hook_venv_path venv_dir exists sys exit f ‚ùå Hook virtual environment found venv_dir \n Please set up running python scripts setup_hooks py venv_dir check_lintrunner_installed venv_dir Path - None Check lintrunner installed given venv exit result = subprocess run uv pip show -- python str venv_dir bin python lintrunner stdout=subprocess DEVNULL stderr=subprocess DEVNULL result returncode = sys exit ‚ùå lintrunner required found hook environment Please run ` python scripts setup_hooks py ` reinstall print ‚úÖ lintrunner already installed run_lintrunner venv_dir Path args list str - int Run lintrunner command specified venv exit code Run lintrunner directly venv s bin directory environment setup lintrunner_exe = venv_dir bin lintrunner cmd = str lintrunner_exe + args env = os environ copy PATH Ensures lintrunner can find other tools venv like python pip etc env PATH = str venv_dir bin + os pathsep + env get PATH VIRTUAL_ENV Tells tools like pip_init py we re venv prevents -- user flag issues env VIRTUAL_ENV = str venv_dir Note Progress tends slightly garbled due terminal control sequences functionality final results will correct subprocess call cmd env=env initialize_lintrunner_if_needed venv_dir Path - None Check lintrunner needs initialization run init needed repo_root = find_repo_root lintrunner_toml_path = repo_root lintrunner toml initialized_hash_path = venv_dir lintrunner_plugins_hash lintrunner_toml_path exists print ‚ö†Ô∏è No lintrunner toml found Skipping init current_hash = compute_file_hash lintrunner_toml_path stored_hash = read_stored_hash initialized_hash_path current_hash = stored_hash print üîÅ Running ` lintrunner init ` ‚Ä¶ file=sys stderr result = run_lintrunner venv_dir init result = sys exit f ‚ùå lintrunner init failed initialized_hash_path write_text current_hash print ‚úÖ Lintrunner plugins already initialized up date main - None Run lintrunner isolated hook environment venv_dir = find_hook_venv python_exe = venv_dir bin python python_exe exists sys exit f ‚ùå Python executable found python_exe try print f üêç Virtual env being used venv_dir file=sys stderr Ensure lintrunner binary available venv check_lintrunner_installed venv_dir Check plugin updates re-init needed initialize_lintrunner_if_needed venv_dir Run lintrunner any passed arguments propagate its exit code args = sys argv result = run_lintrunner venv_dir args If lintrunner failed we re already auto-fix mode suggest wrapper result = -a args print \nüí° To auto-fix these issues run python scripts lintrunner py -a file=sys stderr sys exit result except KeyboardInterrupt print \n Lintrunner interrupted user KeyboardInterrupt file=sys stderr sys exit Tell git push fail __name__ == __main__ main