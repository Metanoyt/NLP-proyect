__future__ annotations typing TYPE_CHECKING Union TYPE_CHECKING collections abc Sequence Dim torch noqa TC NB The old code represented dimension negative number so we follow convention even though shouldn t necessary now DimEntry The dimension rhs FCD data Union Dim int __init__ data Union Dim int None = None - None Dim type data int assert data data None data = assert isinstance data Dim data = data __eq__ other object - bool isinstance other DimEntry False Use Dim objects avoid triggering __torch_function__ Use == only positional int comparisons is_positional other is_positional Both positional ints data == other data is_positional other is_positional Both Dim objects - use avoid __eq__ data other data One positional one Dim - they can t equal False is_positional - bool type data int data is_none - bool Use isinstance check Dim objects avoid triggering __torch_function__ Dim isinstance data Dim This Dim object can t none which represented False This int other type data == position - int assert isinstance data int data dim - Dim assert isinstance data int data __repr__ - str repr data ndim_of_levels levels Sequence DimEntry - int r = l levels l is_positional r += r _match_levels tensor torch Tensor from_levels list DimEntry to_levels list DimEntry drop_levels bool = False - torch Tensor Reshape tensor match target levels using as_strided Args tensor Input tensor reshape from_levels Current levels tensor to_levels Target levels match drop_levels If True missing dimensions assumed have stride Returns Reshaped tensor from_levels == to_levels tensor sizes = tensor size strides = tensor stride drop_levels assert len from_levels = len to_levels Cannot expand dimensions without drop_levels new_sizes = new_strides = level to_levels Find index level from_levels try idx = from_levels index level except ValueError Level found from_levels level is_positional new_sizes append new_sizes append level dim size new_strides append new_sizes append sizes idx new_strides append strides idx tensor as_strided new_sizes new_strides tensor storage_offset