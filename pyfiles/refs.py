mypy ignore-errors torch testing _internal opinfo core BinaryUfuncInfo OpInfo ReductionOpInfo UnaryUfuncInfo NOTE Python References Python References emulate existing PyTorch operations can ultimately expressed terms primitive operations torch _prims These references experimental See https dev-discuss pytorch org t tracing-with-primitives-update- additional context Python Reference OpInfos should added python_ref_db list below Tests can opt-into running these references including list Sequence they pass ops decorator When Python Reference OpInfo constructed pointer existing OpInfo must provided using torch_opinfo_name kwarg The existing OpInfo name no variant will found inherit Instead just inheriting existing OpInfo s metadata Python Reference OpInfos inherit existing OpInfo s construction arguments These arguments can overridden adding kwargs constructor _find_referenced_opinfo referenced_name variant_name op_db=None Finds OpInfo given name has no variant name NOTE searching global op_db doesn t work when OpInfos split into different modules otherwise op_db will fully constructed yet So instead local op_db must passed explicitly op_db None torch testing _internal common_methods_invocations op_db opinfo op_db opinfo name == referenced_name opinfo variant_test_name == variant_name opinfo _inherit_constructor_args name op inherited overrides inherits metadata common_kwargs = name name op op aliases None TODO add check alias coverage method_variant None inplace_variant None TODO add check inplace coverage supports_scripting False Acquires inherited kwargs kwargs = inherited copy Fixes metadata kwargs kwargs kwargs update kwargs kwargs del kwargs kwargs kwargs del kwargs __class__ kwargs del kwargs __class__ skips kwargs del kwargs skips decorators kwargs del kwargs decorators Overrides metadata kwargs update common_kwargs kwargs update overrides At moment no prims support autograd so we must run autograd tests e g when testing dtype support Once we start writing autograd formulas prims can removed kwargs supports_autograd = False kwargs supports_gradgrad = False kwargs supports_fwgrad_bwgrad = False kwargs supports_inplace_autograd = False kwargs supports_forward_ad = False kwargs PythonRefInfo OpInfo An OpInfo Python reference OpInfo base operation __init__ name stringname callable Python reference op=None function variant operation populated torch name None op_db=None The database opinfos search parent opinfo torch_opinfo_name string name corresponding torch opinfo torch_opinfo_variant_name= variant name corresponding torch opinfo validate_view_consistency=True kwargs additional kwargs override kwargs inherited torch opinfo torch_opinfo_name = torch_opinfo_name torch_opinfo_variant_name = torch_opinfo_variant_name torch_opinfo = _find_referenced_opinfo torch_opinfo_name torch_opinfo_variant_name op_db=op_db validate_view_consistency = validate_view_consistency assert isinstance torch_opinfo OpInfo inherited = torch_opinfo _original_opinfo_args ukwargs = _inherit_constructor_args name op inherited kwargs super __init__ ukwargs ReductionPythonRefInfo ReductionOpInfo An OpInfo Python reference elementwise unary operation __init__ name stringname callable Python reference op=None function variant operation populated torch name None op_db=None The database opinfos search parent opinfo torch_opinfo_name string name corresponding torch opinfo torch_opinfo_variant_name= variant name corresponding torch opinfo kwargs additional kwargs override kwargs inherited torch opinfo torch_opinfo_name = torch_opinfo_name torch_opinfo_variant_name = torch_opinfo_variant_name torch_opinfo = _find_referenced_opinfo torch_opinfo_name torch_opinfo_variant_name op_db=op_db assert isinstance torch_opinfo ReductionOpInfo inherited = torch_opinfo _original_reduction_args ukwargs = _inherit_constructor_args name op inherited kwargs See https github com pytorch pytorch issues validate_view_consistency = False super __init__ ukwargs ElementwiseUnaryPythonRefInfo UnaryUfuncInfo An OpInfo Python reference elementwise unary operation __init__ name stringname callable Python reference op=None function variant operation populated torch name None op_db=None The database opinfos search parent opinfo torch_opinfo_name string name corresponding torch opinfo torch_opinfo_variant_name= variant name corresponding torch opinfo validate_view_consistency=True kwargs additional kwargs override kwargs inherited torch opinfo torch_opinfo_name = torch_opinfo_name torch_opinfo_variant_name = torch_opinfo_variant_name torch_opinfo = _find_referenced_opinfo torch_opinfo_name torch_opinfo_variant_name op_db=op_db validate_view_consistency = validate_view_consistency assert isinstance torch_opinfo UnaryUfuncInfo inherited = torch_opinfo _original_unary_ufunc_args ukwargs = _inherit_constructor_args name op inherited kwargs super __init__ ukwargs ElementwiseBinaryPythonRefInfo BinaryUfuncInfo An OpInfo Python reference elementwise binary operation __init__ name stringname callable Python reference op=None function variant operation populated torch name None op_db=None The database opinfos search parent opinfo torch_opinfo_name string name corresponding torch opinfo torch_opinfo_variant_name= variant name corresponding torch opinfo kwargs additional kwargs override kwargs inherited torch opinfo torch_opinfo_name = torch_opinfo_name torch_opinfo_variant_name = torch_opinfo_variant_name torch_opinfo = _find_referenced_opinfo torch_opinfo_name torch_opinfo_variant_name op_db=op_db assert isinstance torch_opinfo BinaryUfuncInfo inherited = torch_opinfo _original_binary_ufunc_args ukwargs = _inherit_constructor_args name op inherited kwargs super __init__ ukwargs