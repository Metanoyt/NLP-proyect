importlib inspect pkgutil collections defaultdict typing Any Optional torch _inductor autoheuristic autoheuristic_utils AHContext AHMetadata Choice torch _inductor autoheuristic learnedheuristic_interface LearnedHeuristic find_and_instantiate_subclasses package_name str base_class Any - list LearnedHeuristic instances = package = importlib import_module package_name _ module_name _ pkgutil walk_packages package __path__ package __name__ + try module_basename = module_name split - module_basename startswith _ learned heuristics start underscore continue module = importlib import_module module_name look classes subclasses base_class _name obj inspect getmembers module inspect isclass obj issubclass obj base_class obj = base_class instance = obj instances append instance except Exception e print f Error processing module module_name e instances LearnedHeuristicController Class finds instantiates all learned heuristics It also provides way get decision learned heuristic existing_heuristics dict str list LearnedHeuristic = defaultdict list A dictionary stores all learned heuristics each optimization The key optimization name value list LearnedHeuristic objects heuristics_initialized bool = False A flag indicates whether learned heuristics have been initialized Set true when get_decision function called first time __init__ metadata AHMetadata context AHContext - None metadata = metadata context = context get_heuristics name str - list LearnedHeuristic Returns list learned heuristics given optimization name LearnedHeuristicController heuristics_initialized learned heuristics generated into following package learned_heuristics_package = torch _inductor autoheuristic artifacts learned heuristics have type LearnedHeuristic base_class = LearnedHeuristic found_heuristics = find_and_instantiate_subclasses learned_heuristics_package base_class learned_heuristic found_heuristics opt_name = learned_heuristic get_name LearnedHeuristicController existing_heuristics opt_name append learned_heuristic LearnedHeuristicController heuristics_initialized = True LearnedHeuristicController existing_heuristics name get_decision - Optional Choice Returns decision made learned heuristic None no heuristic found heuristic unsure which choice make heuristics = get_heuristics metadata name heuristic heuristics heuristic check_precondition metadata context heuristic get_decision context metadata choices None get_decisions_ranked top_k int - Optional list Choice heuristics = get_heuristics metadata name heuristic heuristics heuristic check_precondition metadata context choices = heuristic get_decisions_ranked context choices None None avail_choices = choice choice choices choice metadata choices avail_choices top_k None