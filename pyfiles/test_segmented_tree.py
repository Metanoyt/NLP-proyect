Owner s module inductor hypothesis given strategies st torch _inductor codegen segmented_tree SegmentedTree torch _inductor test_case run_tests TestCase Helper functions operations max_op b max b add_op b + b Naive implementations reference naive_range_max arr start end max arr start end + naive_range_update arr start end value i range start end + arr i += value Strategies hypothesis testing positive_integers = st lists st integers min_value= max_value= min_size= max_size= valid_range_indices array_length st tuples st integers min_value= max_value=array_length - st integers min_value= max_value=array_length - map lambda x min x max x update_values = st integers min_value= max_value= TestSegmentedTree TestCase Basic construction initialization tests test_basic_construction values = tree = SegmentedTree values add_op max_op assert tree summarize_range == test_empty_array assertRaises ValueError SegmentedTree add_op max_op Property-based tests given values=positive_integers test_max_query_matches_naive values tree = SegmentedTree values add_op max_op start range len values end range start len values expected = naive_range_max values start end actual = tree summarize_range start end assert actual == expected f Range start end expected expected got actual given values=positive_integers range_indices=st data update_value=update_values test_range_update values range_indices update_value Create copy naive implementation naive_values = values copy Create segment tree tree = SegmentedTree values add_op max_op Get valid range indices start end = range_indices draw valid_range_indices len values Apply updates tree update_range start end update_value naive_range_update naive_values start end update_value Verify all possible ranges i range len values j range i len values expected = naive_range_max naive_values i j actual = tree summarize_range i j assert actual == expected f After update range i j expected expected got actual given values=positive_integers range_data=st data test_multiple_operations values range_data Create copy naive implementation naive_values = values copy tree = SegmentedTree values add_op max_op Perform multiple operations num_operations = _ range num_operations Randomly choose between query update operation_type = range_data draw st sampled_from query update start end = range_data draw valid_range_indices len values operation_type == query expected = naive_range_max naive_values start end actual = tree summarize_range start end assert actual == expected f Range query start end expected expected got actual update update_value = range_data draw update_values tree update_range start end update_value naive_range_update naive_values start end update_value test_single_element_ranges values = tree = SegmentedTree values add_op max_op i range len values assert tree summarize_range i i == values i f Single element range index i failed test_full_array_range values = tree = SegmentedTree values add_op max_op Test querying entire array assert tree summarize_range len values - == max values Update entire array test again update_value = tree update_range len values - update_value expected = max v + update_value v values assert tree summarize_range len values - == expected test_boundary_conditions values = tree = SegmentedTree values add_op max_op Test first element assert tree summarize_range == values Test last element assert tree summarize_range len values - len values - == values - Test first two elements assert tree summarize_range == max values Test last two elements assert tree summarize_range len values - len values - == max values - test_invalid_ranges values = tree = SegmentedTree values add_op max_op Test start end assertRaises ValueError tree summarize_range assertRaises ValueError tree update_range test_out_of_bounds values = tree = SegmentedTree values add_op max_op Test negative indices assertRaises ValueError tree summarize_range - assertRaises ValueError tree summarize_range - Test indices = n assertRaises ValueError tree summarize_range len values assertRaises ValueError tree summarize_range len values len values + Test update out bounds indices assertRaises ValueError tree update_range - assertRaises ValueError tree update_range len values test_overlapping_updates values = naive_values = values copy tree = SegmentedTree values add_op max_op Apply overlapping updates tree update_range Update naive_range_update naive_values tree update_range Update naive_range_update naive_values Verify all possible ranges i range len values j range i len values expected = naive_range_max naive_values i j actual = tree summarize_range i j assert actual == expected f After overlapping updates range i j expected expected got actual test_sequential_updates_and_queries values = naive_values = values copy tree = SegmentedTree values add_op max_op Sequence operations operations = update Update range + query Query range update Update range + query Query range update Update entire array + query Query entire array query Query range op operations op == update _ start end value = op tree update_range start end value naive_range_update naive_values start end value Verify tree state after update i range len values j range i len values expected = naive_range_max naive_values i j actual = tree summarize_range i j assert actual == expected f After update start end value query i j expected expected got actual query _ start end = op expected = naive_range_max naive_values start end assert tree summarize_range start end == expected f Query start end expected expected got tree summarize_range start end __name__ == __main__ run_tests