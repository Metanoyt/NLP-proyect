mypy allow-untyped-defs torch torch fx experimental proxy_tensor ProxyTorchDispatchMode torch overrides TorchFunctionMode AutogradStateOpsFailSafeguard TorchFunctionMode Detect grad state ops during exporting graph fail process raising error avoid unexpected behavior Those grad mode ops could ` torch no_grad ` ` torch enable_grad ` ` torch set_grad_enabled ` Export predispatch mode exempted __torch_function__ func types args= kwargs=None kwargs = kwargs unsupported_grad_mode_ops = torch _C _set_grad_enabled It s only enabled while tracing confirming torch dispatch mode any active PROXY This allow autograd ops out tracing current_state = torch _C is_grad_enabled func unsupported_grad_mode_ops assert len args == changed_state = args mode = torch _C _get_dispatch_mode torch _C _TorchDispatchModeKey PROXY Intend check s pre_dispatch mode It s allowed use autograd ops pre_dispatch mode e g ` torch no_grad ` mode isinstance mode ProxyTorchDispatchMode mode pre_dispatch changed_state = current_state raise RuntimeError f Encountered autograd state manager op func trying change global autograd state while exporting This unsafe because we don t capture op torch export today hence we can t reflect user intention soundly You can fix adding torch no_grad context around export call func args kwargs