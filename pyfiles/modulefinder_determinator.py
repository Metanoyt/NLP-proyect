__future__ annotations modulefinder os sys warnings pathlib Path typing Any REPO_ROOT = Path __file__ resolve parents These tests slow enough s worth calculating whether patch touched any related files first This list manually generated every run -- determine-from we use another generated list based one previous test stats TARGET_DET_LIST = test_autograd py slow so does belong here But note you try add back will run into https bugs python org issue because imports files under test autograd test_binary_ufuncs test_cpp_extensions_aot_ninja test_cpp_extensions_aot_no_ninja test_cpp_extensions_jit test_cpp_extensions_stream_and_event test_cpp_extensions_mtia_backend test_cuda test_cuda_primary_ctx test_dataloader test_determination test_futures test_jit test_jit_legacy test_jit_profiling test_linalg test_multiprocessing test_nn test_numpy_interop test_optim test_overrides test_pruning_op test_quantization test_reductions test_serialization test_shape_ops test_sort_and_select test_tensorboard test_testing test_torch test_utils test_view_ops _DEP_MODULES_CACHE dict str set str = should_run_test target_det_list list str test str touched_files list str options Any - bool test = parse_test_module test Some tests faster execute than determine test target_det_list options verbose print_to_stderr f Running test without determination True HACK no_ninja real module test endswith _no_ninja test = test - len _no_ninja test endswith _ninja test = test - len _ninja dep_modules = get_dep_modules test touched_file touched_files file_type = test_impact_of_file touched_file file_type == NONE continue file_type == CI Force all tests run any change made CI configurations log_test_reason file_type touched_file test options True file_type == UNKNOWN Assume uncategorized source files can affect every test log_test_reason file_type touched_file test options True file_type TORCH CAFFE TEST parts = os path splitext touched_file split os sep touched_module = join parts test path does have test namespace touched_module startswith test touched_module = touched_module split test touched_module dep_modules touched_module == test replace log_test_reason file_type touched_file test options True If nothing has determined test has run don t run test options verbose print_to_stderr f Determination skipping test False test_impact_of_file filename str - str Determine what impact file has test runs Possible values TORCH - torch python code CAFFE - caffe python code TEST - torch test code UNKNOWN - may affect all tests NONE - known have no effect test outcome CI - CI configuration files parts = filename split os sep parts jenkins circleci ci CI parts docs scripts CODEOWNERS README md NONE parts == torch parts - endswith py parts - endswith pyi TORCH parts == caffe parts - endswith py parts - endswith pyi CAFFE parts == test parts - endswith py parts - endswith pyi TEST UNKNOWN log_test_reason file_type str filename str test str options Any - None options verbose print_to_stderr f Determination found file_type file filename -- running test get_dep_modules test str - set str Cache results case repetition test _DEP_MODULES_CACHE _DEP_MODULES_CACHE test test_location = REPO_ROOT test f test py HACK some platforms default ascii so we can t just run_script finder = modulefinder ModuleFinder Ideally exclude all third party modules speed up calculation excludes= scipy numpy numba multiprocessing sklearn setuptools hypothesis llvmlite joblib email importlib unittest urllib json collections Modules below excluded because they hitting https bugs python org issue Trigger AttributeError NoneType object has no attribute is_package mpl_toolkits google onnx Triggers RecursionError mypy warnings catch_warnings warnings simplefilter ignore finder run_script str test_location dep_modules = set finder modules keys _DEP_MODULES_CACHE test = dep_modules dep_modules parse_test_module test str - str test split maxsplit= print_to_stderr message str - None print message file=sys stderr