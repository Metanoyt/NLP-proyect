__future__ generator_stop ======= BEGIN Dynamo patch ======= Owner s module dynamo ruff noqa flake noqa Test copied https raw githubusercontent com python cpython refs tags v Lib test test_generator_stop py sys torch torch _dynamo test_case unittest torch _dynamo test_case CPythonTestCase torch testing _internal common_utils run_tests __TestCase = CPythonTestCase redirect statements sys importlib abc redirect_imports = test mapping_tests test typinganndata test test_grammar test test_math test test_iter test typinganndata ann_module RedirectImportFinder importlib abc MetaPathFinder find_spec fullname path target=None Check problematic one fullname redirect_imports try Attempt standalone module name = fullname removeprefix test r = importlib import_module name Redirect module sys modules sys modules fullname = r Return module spec found module importlib util find_spec name except ImportError None None Add custom finder sys meta_path sys meta_path insert RedirectImportFinder ======= END DYNAMO PATCH ======= unittest TestPEP __TestCase test_stopiteration_wrapping f raise StopIteration g yield f assertRaisesRegex RuntimeError generator raised StopIteration next g test_stopiteration_wrapping_context f raise StopIteration g yield f try next g except RuntimeError exc assertIs type exc __cause__ StopIteration assertIs type exc __context__ StopIteration assertTrue exc __suppress_context__ fail __cause__ __context__ __suppress_context__ properly set __name__ == __main__ run_tests