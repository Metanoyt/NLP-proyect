getpass os re tempfile collections abc Generator contextlib contextmanager torch _environment is_fbcode Factoring out file without torch dependencies cache_dir - str cache_dir = os environ get TORCHINDUCTOR_CACHE_DIR cache_dir None os environ TORCHINDUCTOR_CACHE_DIR = cache_dir = default_cache_dir os makedirs cache_dir exist_ok=True cache_dir default_cache_dir - str sanitized_username = re sub r \\ &#124; _ getpass getuser os path join tempfile gettempdir is_fbcode var tmp torchinductor_ + sanitized_username triton_cache_dir device int - str directory = os getenv TRITON_CACHE_DIR None directory os path join cache_dir triton str device contextmanager temporary_cache_dir directory str - Generator None None None torch _inductor utils clear_caches original = os environ get TORCHINDUCTOR_CACHE_DIR os environ TORCHINDUCTOR_CACHE_DIR = directory try clear_caches yield finally clear_caches original None del os environ TORCHINDUCTOR_CACHE_DIR os environ TORCHINDUCTOR_CACHE_DIR = original