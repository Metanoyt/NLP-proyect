collections abc Callable typing Any TypeVar typing_extensions ParamSpec torch torch nn functional F _P = ParamSpec _P _R = TypeVar _R conv_utils conv_args_and_kwargs conv_backward conv_input_for_string_padding conv_picker expanded_weights_impl ExpandedWeight implements_per_sample_grads expanded_weights_utils forward_helper implements_per_sample_grads F conv d implements_per_sample_grads F conv d implements_per_sample_grads F conv d ConvPerSampleGrad torch autograd Function staticmethod pyrefly ignore bad-override forward ctx Any kwarg_names list str conv_fn Callable _P _R expanded_args_and_kwargs Any - torch Tensor expanded_args expanded_kwargs = conv_args_and_kwargs kwarg_names expanded_args_and_kwargs orig_input = expanded_args was_same_padding = expanded_kwargs padding == same isinstance expanded_kwargs padding str padding string we ll do necessary padding slowly using F pad kernel_size = expanded_args shape padding dilation = expanded_kwargs padding expanded_kwargs dilation input = conv_input_for_string_padding conv_fn padding expanded_args dilation kernel_size expanded_args = input expanded_args since we ve already done padding don t need any more expanded_kwargs padding = output = forward_helper conv_fn expanded_args expanded_kwargs input weight = expanded_args batched_dim_size = conv_picker conv_fn input dim = batched_dim_size raise RuntimeError f Expanded Weights only support convolution batched input got conv_fn f unbatched input dim input dim expected input dim batched_dim_size pyrefly ignore invalid-type-var ctx conv_fn = conv_fn ctx batch_size = orig_input shape ctx input_required_grad = orig_input requires_grad ctx orig_input_shape = orig_input shape ctx was_same_padding = was_same_padding ctx stride ctx padding = expanded_kwargs stride expanded_kwargs padding ctx dilation ctx groups = expanded_kwargs dilation expanded_kwargs groups isinstance weight ExpandedWeight ctx input = input ctx weight = weight ctx bias = expanded_kwargs bias output staticmethod backward ctx Any grad_outputs Any - Any conv_backward ctx conv_fn ctx grad_outputs