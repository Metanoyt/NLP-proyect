torchvision models quantization resnet resnet torch ao quantization experimental quantization_helper evaluate prepare_data_loaders training_loop training validation dataset full ImageNet dataset data_path = ~ my_imagenet train_batch_size = eval_batch_size = data_loader data_loader_test = prepare_data_loaders data_path criterion = nn CrossEntropyLoss noqa F float_model = resnet pretrained=True float_model eval deepcopy model since we need keep original model around copy model_to_quantize = copy deepcopy float_model model_to_quantize eval Prepare model QAT specified qconfig torch nn Linear prepare_qat_linear qconfig qconfig_dict = object_type torch nn Linear qconfig noqa F prepared_model = prepare_fx copy deepcopy float_model qconfig_dict fuse modules insert observers noqa F training_loop prepared_model criterion data_loader prepared_model eval prepared_model Prepare model uniform activation uniform weight b= k= prepared_model = prepare_qat_linear uniform_qconfig_ bit noqa F top top = evaluate prepared_model criterion data_loader_test print f Model Evaluation accuracy test dataset b= k= top avg f top avg f Prepare model uniform activation uniform weight b= k= prepared_model = prepare_qat_linear uniform_qconfig_ bit noqa F top top = evaluate prepared_model criterion data_loader_test print f Model Evaluation accuracy test dataset b= k= top avg f top avg f Prepare model uniform activation APoT weight b= k= prepared_model = prepare_qat_linear apot_weights_qconfig_ bit noqa F top top = evaluate prepared_model criterion data_loader_test print f Model Evaluation accuracy test dataset b= k= top avg f top avg f Prepare model uniform activation APoT weight b= k= prepared_model = prepare_qat_linear apot_weights_qconfig_ bit noqa F top top = evaluate prepared_model criterion data_loader_test print f Model Evaluation accuracy test dataset b= k= top avg f top avg f Prepare model APoT activation weight b= k= prepared_model = prepare_qat_linear apot_qconfig_ bit noqa F top top = evaluate prepared_model criterion data_loader_test print f Model Evaluation accuracy test dataset b= k= top avg f top avg f Prepare model APoT activation weight b= k= prepared_model = prepare_qat_linear apot_qconfig_ bit noqa F top top = evaluate prepared_model criterion data_loader_test print f Model Evaluation accuracy test dataset b= k= top avg f top avg f