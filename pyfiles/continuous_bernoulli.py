mypy allow-untyped-defs math typing Optional Union torch torch Tensor torch distributions constraints torch distributions exp_family ExponentialFamily torch distributions utils broadcast_all clamp_probs lazy_property logits_to_probs probs_to_logits torch nn functional binary_cross_entropy_with_logits torch types _Number _size Number __all__ = ContinuousBernoulli ContinuousBernoulli ExponentialFamily r Creates continuous Bernoulli distribution parameterized attr ` probs ` attr ` logits ` both The distribution supported parameterized probs logits real-valued Note unlike Bernoulli probs does correspond probability logits does correspond log-odds same names used due similarity Bernoulli See more details Example xdoctest +IGNORE_WANT non-deterministic m = ContinuousBernoulli torch tensor m sample tensor Args probs Number Tensor valued parameters logits Number Tensor real valued parameters whose sigmoid matches probs The continuous Bernoulli fixing pervasive error variational autoencoders Loaiza-Ganem G Cunningham JP NeurIPS https arxiv org abs pyrefly ignore bad-override arg_constraints = probs constraints unit_interval logits constraints real support = constraints unit_interval _mean_carrier_measure = has_rsample = True __init__ probs Optional Union Tensor Number = None logits Optional Union Tensor Number = None lims tuple float float = validate_args Optional bool = None - None probs None == logits None raise ValueError Either ` probs ` ` logits ` must specified both probs None is_scalar = isinstance probs _Number pyrefly ignore read-only probs = broadcast_all probs validate probs here necessary later clamped numerical stability close later otherwise clamped probs would always pass validate_args None arg_constraints probs check probs all raise ValueError The parameter probs has invalid values pyrefly ignore read-only probs = clamp_probs probs assert logits None helps mypy is_scalar = isinstance logits _Number pyrefly ignore read-only logits = broadcast_all logits _param = probs probs None logits is_scalar batch_shape = torch Size batch_shape = _param size _lims = lims super __init__ batch_shape validate_args=validate_args expand batch_shape _instance=None new = _get_checked_instance ContinuousBernoulli _instance new _lims = _lims batch_shape = torch Size batch_shape probs __dict__ new probs = probs expand batch_shape new _param = new probs logits __dict__ new logits = logits expand batch_shape new _param = new logits super ContinuousBernoulli new __init__ batch_shape validate_args=False new _validate_args = _validate_args new _new args kwargs _param new args kwargs _outside_unstable_region torch max torch le probs _lims torch gt probs _lims _cut_probs torch where _outside_unstable_region probs _lims torch ones_like probs _cont_bern_log_norm computes log normalizing constant function probs parameter cut_probs = _cut_probs cut_probs_below_half = torch where torch le cut_probs cut_probs torch zeros_like cut_probs cut_probs_above_half = torch where torch ge cut_probs cut_probs torch ones_like cut_probs log_norm = torch log torch abs torch log p -cut_probs - torch log cut_probs - torch where torch le cut_probs torch log p - cut_probs_below_half torch log cut_probs_above_half - x = torch pow probs - taylor = math log + + x x torch where _outside_unstable_region log_norm taylor property mean - Tensor cut_probs = _cut_probs mus = cut_probs cut_probs - + torch log p -cut_probs - torch log cut_probs x = probs - taylor = + + torch pow x x torch where _outside_unstable_region mus taylor property stddev - Tensor torch sqrt variance property variance - Tensor cut_probs = _cut_probs vars = cut_probs cut_probs - torch pow - cut_probs + torch pow torch log p -cut_probs - torch log cut_probs x = torch pow probs - taylor = - - x x torch where _outside_unstable_region vars taylor lazy_property logits - Tensor probs_to_logits probs is_binary=True lazy_property probs - Tensor clamp_probs logits_to_probs logits is_binary=True property param_shape - torch Size _param size sample sample_shape=torch Size shape = _extended_shape sample_shape u = torch rand shape dtype=self probs dtype device=self probs device torch no_grad icdf u rsample sample_shape _size = torch Size - Tensor shape = _extended_shape sample_shape u = torch rand shape dtype=self probs dtype device=self probs device icdf u log_prob value _validate_args _validate_sample value logits value = broadcast_all logits value -binary_cross_entropy_with_logits logits value reduction= none + _cont_bern_log_norm cdf value _validate_args _validate_sample value cut_probs = _cut_probs cdfs = torch pow cut_probs value torch pow - cut_probs - value + cut_probs - cut_probs - unbounded_cdfs = torch where _outside_unstable_region cdfs value torch where torch le value torch zeros_like value torch where torch ge value torch ones_like value unbounded_cdfs icdf value cut_probs = _cut_probs torch where _outside_unstable_region torch log p -cut_probs + value cut_probs - - torch log p -cut_probs torch log cut_probs - torch log p -cut_probs value entropy log_probs = torch log p -self probs log_probs = torch log probs mean log_probs - log_probs - _cont_bern_log_norm - log_probs property _natural_params - tuple Tensor logits pyrefly ignore bad-override _log_normalizer x computes log normalizing constant function natural parameter out_unst_reg = torch max torch le x _lims - torch gt x _lims - cut_nat_params = torch where out_unst_reg x _lims - torch ones_like x log_norm = torch log torch abs torch special expm cut_nat_params - torch log torch abs cut_nat_params taylor = x + torch pow x - torch pow x torch where out_unst_reg log_norm taylor