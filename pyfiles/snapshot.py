mypy allow-untyped-defs torch utils data datapipes _hook_iterator _SnapshotState torch utils data datapipes datapipe IterDataPipe torch utils data graph_settings apply_random_seed TODO Caveats Caller either ReadingService DataLoader must pass initial RNG ` in_batch_shuffle ` ` bucketbatch ` compatible because they currently lack option ` set_seed ` _simple_graph_snapshot_restoration datapipe IterDataPipe n_iterations int rng=None - None r Fast-forward given DataPipe its parents ` ` n_iterations ` ` re-doing computations restore snapshot For instance applying function final DataPipe graph will restore snapshot via fast-forward every DataPipe within graph After you deserialize DataPipe you can use its ` _number_of_samples_yielded ` attribute input function forward DataPipe A DataPipe cannot restored twice row unless there iteration started between restoration attempts Note This simplest least efficient way fast-forward DataPipe Usage other fast-forwarding methods custom ones necessary recommended Args datapipe IterDataPipe fast-forwarded n_iterations number iterations fast-forward rng ` ` Optional torch Generator ` ` If ` ` None ` ` RNG will used shuffling The generator should its ` initial ` state first passed into ` ` DataLoader ` ` ` ` ReadingService ` ` datapipe _snapshot_state == _SnapshotState Restored raise RuntimeError Snapshot restoration cannot applied You can only restore simple snapshot graph your graph has been restored For snapshot restoration function we want DataPipe its initial state prior simple fast-forwarding Therefore we need call ` reset ` twice because ` SnapshotState ` ` Restored ` first reset will actually reset datapipe reset This ensures ` SnapshotState ` ` Iterating ` point even ` Restored ` pyrefly ignore bad-argument-type apply_random_seed datapipe rng remainder = n_iterations = iter datapipe This always reset DataPipe hasn t already while remainder try next remainder -= except StopIteration e raise RuntimeError f Fast-forward datapipe n_iterations iterations exceeds number samples available e datapipe _fast_forward_iterator = While DataPipe has ` _fast_forward_iterator ` ` next ` will get result there instead elsewhere This will prevent DataPipe resetting ` iter ` call If another DataPipe consuming won t have start over again datapipe _snapshot_state = _SnapshotState Restored