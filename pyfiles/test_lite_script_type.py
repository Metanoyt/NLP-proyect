Owner s oncall mobile io unittest collections namedtuple typing NamedTuple torch torch utils bundled_inputs torch jit mobile _load_for_lite_interpreter torch testing _internal common_utils run_tests TestCase TestLiteScriptModule TestCase test_typing_namedtuple myNamedTuple = NamedTuple noqa UP myNamedTuple list torch Tensor MyTestModule torch nn Module forward torch Tensor p = myNamedTuple p sample_input = torch tensor script_module = torch jit script MyTestModule script_module_result = script_module sample_input buffer = io BytesIO script_module _save_to_buffer_for_lite_interpreter _save_mobile_debug_info=True buffer seek mobile_module = _load_for_lite_interpreter buffer Error here mobile_module_result = mobile_module sample_input torch testing assert_close script_module_result mobile_module_result unittest skip T test_typing_dict_with_namedtuple Foo NamedTuple id torch Tensor Bar torch nn Module __init__ - None super __init__ foo = Foo torch tensor forward torch Tensor foo = Foo re dict str Foo = re test = Foo foo re test The corresponding bytecode __torch__ ___torch_mangle_ Bar forward instructions STOREN DROPR DICT_CONSTRUCT STORE LOAD LOADC MOVE NAMED_TUPLE_CONSTRUCT OP MOVE LOADC DICT_INDEX LOADC TUPLE_INDEX RET operators aten _set_item str constants test types Dict str __torch__ Foo NamedTuple id Tensor __torch__ Foo NamedTuple id Tensor register_size arguments name type __torch__ ___torch_mangle_ Bar default_value None name type Tensor default_value None returns name type Tensor default_value None sample_input = torch tensor script_module = torch jit script Bar script_module_result = script_module sample_input buffer_mobile = io BytesIO script_module _save_to_buffer_for_lite_interpreter buffer_mobile seek mobile_module = _load_for_lite_interpreter buffer_mobile mobile_module_result = mobile_module sample_input torch testing assert_close script_module_result mobile_module_result test_typing_namedtuple_custom_classtype Foo NamedTuple id torch Tensor Bar torch nn Module __init__ - None super __init__ foo = Foo torch tensor forward torch Tensor foo = Foo foo sample_input = torch tensor script_module = torch jit script Bar script_module_result = script_module sample_input buffer_mobile = io BytesIO script_module _save_to_buffer_for_lite_interpreter buffer_mobile seek mobile_module = _load_for_lite_interpreter buffer_mobile mobile_module_result = mobile_module sample_input torch testing assert_close script_module_result mobile_module_result test_return_collections_namedtuple myNamedTuple = namedtuple myNamedTuple MyTestModule torch nn Module forward torch Tensor myNamedTuple sample_input = torch Tensor script_module = torch jit script MyTestModule script_module_result = script_module sample_input buffer_mobile = io BytesIO script_module _save_to_buffer_for_lite_interpreter buffer_mobile seek mobile_module = _load_for_lite_interpreter buffer_mobile mobile_module_result = mobile_module sample_input torch testing assert_close script_module_result mobile_module_result test_nest_typing_namedtuple_custom_classtype Baz NamedTuple di torch Tensor Foo NamedTuple id torch Tensor baz Baz Bar torch nn Module __init__ - None super __init__ foo = Foo torch tensor Baz torch tensor forward torch Tensor foo = Foo Baz torch tensor foo sample_input = torch tensor script_module = torch jit script Bar script_module_result = script_module sample_input buffer_mobile = io BytesIO script_module _save_to_buffer_for_lite_interpreter buffer_mobile seek mobile_module = _load_for_lite_interpreter buffer_mobile mobile_module_result = mobile_module sample_input torch testing assert_close script_module_result baz di mobile_module_result baz di __name__ == __main__ run_tests