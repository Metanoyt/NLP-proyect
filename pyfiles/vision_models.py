typing cast torchvision_models models utils check_for_functorch extract_weights GetterReturnType load_weights torch torch Tensor has_functorch = check_for_functorch get_resnet device torch device - GetterReturnType N = model = models resnet pretrained=False has_functorch functorch experimental replace_all_batch_norm_modules_ replace_all_batch_norm_modules_ model criterion = torch nn CrossEntropyLoss model device params names = extract_weights model inputs = torch rand N device=device labels = torch rand N device=device mul long forward new_params Tensor - Tensor load_weights model names new_params out = model inputs loss = criterion out labels loss forward params get_fcn_resnet device torch device - GetterReturnType N = criterion = torch nn MSELoss model = models fcn_resnet pretrained=False pretrained_backbone=False has_functorch functorch experimental replace_all_batch_norm_modules_ replace_all_batch_norm_modules_ model disable dropout consistency checking model eval model device params names = extract_weights model inputs = torch rand N device=device Given model has classes labels = torch rand N device=device forward new_params Tensor - Tensor load_weights model names new_params out = model inputs out loss = criterion out labels loss forward params get_detr device torch device - GetterReturnType All values below CLI defaults https github com facebookresearch detr N = num_classes = hidden_dim = nheads = num_encoder_layers = num_decoder_layers = model = models DETR num_classes=num_classes hidden_dim=hidden_dim nheads=nheads num_encoder_layers=num_encoder_layers num_decoder_layers=num_decoder_layers has_functorch functorch experimental replace_all_batch_norm_modules_ replace_all_batch_norm_modules_ model losses = labels boxes cardinality eos_coef = bbox_loss_coef = giou_loss_coef = weight_dict = loss_ce loss_bbox bbox_loss_coef loss_giou giou_loss_coef matcher = models HungarianMatcher criterion = models SetCriterion num_classes=num_classes matcher=matcher weight_dict=weight_dict eos_coef=eos_coef losses=losses model = model device criterion = criterion device params names = extract_weights model inputs = torch rand N device=device labels = idx range N targets = n_targets int = int torch randint size= item label = torch randint size= n_targets device=device targets labels = label boxes = torch randint size= n_targets device=device t range n_targets boxes t boxes t boxes t boxes t = boxes t boxes t boxes t boxes t boxes t boxes t = boxes t boxes t targets boxes = boxes float labels append targets forward new_params Tensor - Tensor load_weights model names new_params out = model inputs loss = criterion out labels weight_dict = criterion weight_dict final_loss = cast Tensor sum loss k weight_dict k k loss keys k weight_dict final_loss forward params