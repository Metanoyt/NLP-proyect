This source code licensed under BSD-style license found LICENSE file root directory source tree collections abc Iterable torch _MISSING torch Tensor = object type ignore assignment set_tensor module torch nn Module name str tensor torch Tensor - None isinstance module torch nn Module raise TypeError f module instance torch nn Module isinstance tensor torch Tensor tensor None raise TypeError f tensor instance torch Tensor name raise KeyError tensor name can\ t contain name == raise KeyError tensor name can\ t empty string name module _parameters module _parameters name = tensor type ignore assignment name module _buffers module _buffers name = tensor setattr module name tensor swap_tensor module torch nn Module name str tensor torch Tensor allow_missing bool = False - torch Tensor isinstance module torch nn Module raise TypeError f module instance torch nn Module tensor _MISSING isinstance tensor torch Tensor tensor None raise TypeError f tensor instance torch Tensor name raise KeyError tensor name can\ t contain name == raise KeyError tensor name can\ t empty string orig_tensor torch Tensor name module _parameters orig_tensor = module _parameters name type ignore assignment tensor _MISSING module _parameters name = tensor type ignore assignment del module _parameters name name module _buffers orig_tensor = module _buffers name type ignore assignment tensor _MISSING module _buffers name = tensor del module _buffers name hasattr module name orig_tensor = getattr module name allow_missing raise AttributeError f module _get_name has no attribute ` name ` orig_tensor = _MISSING orig_tensor _MISSING isinstance orig_tensor torch Tensor orig_tensor None raise TypeError f attribute ` name ` orig_tensor instance torch Tensor tensor _MISSING setattr module name tensor hasattr module name delattr module name pyrefly ignore bad-return orig_tensor swap_submodule module torch nn Module name str submodule torch nn Module - torch nn Module isinstance module torch nn Module raise TypeError f module instance torch nn Module isinstance submodule torch nn Module raise TypeError f submodule instance torch nn Module name raise KeyError submodule name can\ t contain name == raise KeyError submodule name can\ t empty string name module _modules raise KeyError f submodule name does exist orig_submodule = module _modules name isinstance orig_submodule torch nn Module raise TypeError f name attribute instance torch nn Module module _modules name = submodule orig_submodule NamedMemberAccessor A provides way access submodules parameters buffers module It provides caching mechanism speed up submodule lookups This useful functional programming manipulate module state __init__ module torch nn Module - None module = module memo dict str torch nn Module = Nested attribute access get_submodule name str - torch nn Module Return submodule specified given path For example get submodule mod layer conv use accessor get_submodule layer conv Compare mod get_submodule layer conv method will cache intermediate submodule access speed up future lookups name module name memo memo name prefix dot attr = name rpartition dot module = get_submodule prefix module = module try submodule = getattr module attr except AttributeError ex raise AttributeError f module _get_name has no attribute ` attr ` ex isinstance submodule torch nn Module raise TypeError f submodule ` name ` submodule instance torch nn Module memo name = submodule submodule swap_submodule path str value torch nn Module - torch nn Module Swap submodule specified given ` ` path ` ` ` ` value ` ` For example swap attribute mod layer conv use ` ` accessor swap_submodule layer conv conv ` ` prefix _ attr = path rpartition swap_submodule get_submodule prefix attr value get_tensor name str - torch Tensor Get tensor specified given path value For example get attribute mod layer conv weight use accessor get_tensor layer conv weight Compare mod get_parameter layer conv weight method will cache intermediate submodule access speed up future lookups prefix _ attr = name rpartition submodule = get_submodule prefix try tensor = getattr submodule attr except AttributeError ex raise AttributeError f submodule _get_name has no attribute ` name ` ex isinstance tensor torch Tensor tensor None raise TypeError f tensor instance torch Tensor tensor type ignore return-value set_tensor name str value torch Tensor - None Set attribute specified given path value For example set attribute mod layer conv weight use accessor set_tensor layer conv weight value prefix _ attr = name rpartition set_tensor get_submodule prefix attr value del_tensor name str - None Delete attribute specified given path For example delete attribute mod layer conv weight use accessor del_tensor layer conv weight prefix _ attr = name rpartition submodule = get_submodule prefix try delattr submodule attr except AttributeError ex raise AttributeError f submodule _get_name has no attribute ` name ` ex swap_tensor name str value torch Tensor allow_missing bool = False - torch Tensor Swap attribute specified given path value For example swap attribute mod layer conv weight use accessor swap_tensor layer conv weight value prefix _ attr = name rpartition swap_tensor get_submodule prefix attr value allow_missing=allow_missing Batched operations get_tensors names Iterable str - list torch Tensor Get tensors specified given paths For example get attributes mod layer conv weight mod layer conv bias use accessor get_tensors layer conv weight layer conv bias get_tensor name name names set_tensors names Iterable str values Iterable torch Tensor - None Set attributes specified given paths values For example set attributes mod layer conv weight mod layer conv bias use accessor set_tensors layer conv weight layer conv bias weight bias isinstance names list tuple names = list names isinstance values list tuple values = list values assert len names == len values names values must have same length name value zip names values strict=True set_tensor name value set_tensors_dict named_tensors dict str torch Tensor - None Set attributes specified given paths values For example set attributes mod layer conv weight mod layer conv bias use accessor set_tensors_dict layer conv weight weight layer conv bias bias name value named_tensors items set_tensor name value del_tensors names Iterable str - None Delete attributes specified given paths For example delete attributes mod layer conv weight mod layer conv bias use accessor del_tensors layer conv weight layer conv bias name names del_tensor name swap_tensors names Iterable str values Iterable torch Tensor allow_missing bool = False - list torch Tensor Swap attributes specified given paths values For example swap attributes mod layer conv weight mod layer conv bias use accessor swap_tensors layer conv weight layer conv bias weight bias isinstance names list tuple names = list names isinstance values list tuple values = list values assert len names == len values names values must have same length swap_tensor name value allow_missing=allow_missing name value zip names values strict=True swap_tensors_dict named_tensors dict str torch Tensor allow_missing bool = False - tuple dict str torch Tensor list str Swap attributes specified given paths values For example swap attributes mod layer conv weight mod layer conv bias use accessor swap_tensors_dict layer conv weight weight layer conv bias bias orig_named_tensors = missing_keys = try name tensor named_tensors items orig_tensor = swap_tensor name tensor allow_missing=True orig_tensor _MISSING missing_keys append name orig_named_tensors name = orig_tensor except Exception Swap back any exception occurs name orig_tensor orig_named_tensors items swap_tensor name orig_tensor allow_missing=True raise missing_keys allow_missing Swap back any key missing when allow_missing False name orig_tensor orig_named_tensors items swap_tensor name orig_tensor allow_missing=True raise RuntimeError f Missing key s join map repr missing_keys orig_named_tensors missing_keys check_keys keys Iterable str - tuple list str list str Check given keys valid keys = set keys valid_keys = name name _ named_tensors remove_duplicate=False missing_keys = valid_keys - keys unexpected_keys = keys - valid_keys sorted missing_keys sorted unexpected_keys Shortcut methods named_parameters remove_duplicate bool = True - Iterable tuple str torch Tensor Iterate over all parameters module yield module named_parameters remove_duplicate=remove_duplicate named_buffers remove_duplicate bool = True - Iterable tuple str torch Tensor Iterate over all buffers module yield module named_buffers remove_duplicate=remove_duplicate named_tensors remove_duplicate bool = True - Iterable tuple str torch Tensor Iterate over all tensors module yield module named_parameters remove_duplicate=remove_duplicate yield module named_buffers remove_duplicate=remove_duplicate named_modules remove_duplicate bool = True - Iterable tuple str torch nn Module Iterate over all modules module yield module named_modules remove_duplicate=remove_duplicate