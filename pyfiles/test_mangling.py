Owner s oncall package deploy io BytesIO torch package PackageExporter PackageImporter torch package _mangling demangle get_mangle_prefix is_mangled PackageMangler torch testing _internal common_utils run_tests try common PackageTestCase except ImportError Support case where we run file directly common PackageTestCase TestMangling PackageTestCase test_unique_manglers Each mangler instance should generate unique mangled name given input = PackageMangler b = PackageMangler assertNotEqual mangle foo bar b mangle foo bar test_mangler_is_consistent Mangling same name twice should produce same result = PackageMangler assertEqual mangle abc mangle abc test_roundtrip_mangling = PackageMangler assertEqual foo demangle mangle foo test_is_mangled = PackageMangler b = PackageMangler assertTrue is_mangled mangle foo bar assertTrue is_mangled b mangle foo bar assertFalse is_mangled foo bar assertFalse is_mangled demangle mangle foo bar test_demangler_multiple_manglers PackageDemangler should able demangle name generated any PackageMangler = PackageMangler b = PackageMangler assertEqual foo bar demangle mangle foo bar assertEqual bar foo demangle b mangle bar foo test_mangle_empty_errors = PackageMangler assertRaises AssertionError mangle test_demangle_base Demangling mangle parent directly should currently empty string = PackageMangler mangled = mangle foo mangle_parent = mangled partition assertEqual demangle mangle_parent test_mangle_prefix = PackageMangler mangled = mangle foo bar mangle_prefix = get_mangle_prefix mangled assertEqual mangle_prefix + + foo bar mangled test_unique_module_names package_a subpackage obj = package_a subpackage PackageASubpackageObject obj = package_a PackageAObject obj f = BytesIO PackageExporter f pe pe intern pe save_pickle obj obj pkl obj f seek importer = PackageImporter f loaded = importer load_pickle obj obj pkl f seek importer = PackageImporter f loaded = importer load_pickle obj obj pkl Modules loaded packages should shadow names modules See mangling md more info assertNotEqual type obj __module__ type loaded __module__ assertNotEqual type loaded __module__ type loaded __module__ test_package_mangler = PackageMangler b = PackageMangler a_mangled = mangle foo bar Since ` ` mangled string should demangle properly assertEqual demangle a_mangled foo bar Since ` b ` did mangle string demangling should leave alone assertEqual b demangle a_mangled a_mangled __name__ == __main__ run_tests