Owner s oncall jit unittest numpy np torch torch testing FileCheck torch testing _internal common_utils IS_MACOS raise_on_run_directly torch testing _internal jit_utils JitTestCase TestPythonIr JitTestCase test_param_strides trace_me arg arg t = torch zeros traced = torch jit trace trace_me t value = list traced graph param_node outputs real_strides = list t stride type_strides = value type strides assertEqual real_strides type_strides test_permute_inputs_binding torch jit script foo i j k pass g = foo graph idxs = i inp enumerate g inputs inp setDebugName f inp i idxs append i permuted_idxs = list np random permutation idxs g permuteInputs permuted_idxs i inp enumerate g inputs assertEqual f inp permuted_idxs i inp debugName unittest skipIf IS_MACOS Failing MacOS only test_python_ir_utils torch jit script foo inp x = inp + y = x z = y y z add_node = foo graph findNode aten add div_node = foo graph findNode aten div foo graph insert_point_guard add_node foo graph insert_point_guard div_node foo graph insertConstant goodbye foo graph insertConstant hello foo graph insert_point_guard foo graph findNode aten mul foo graph insertConstant hello FileCheck check hello check goodbye check hello run foo graph assertTrue add_node matches add_node schema assertFalse add_node matches div_node schema test_python_ir_utils_graph torch jit script unrolled_mul x torch Tensor y int out = x _ range y - out = out + x out torch jit script foo x x g = foo graph muls = g findAllNodes aten mul scalar_muls = filter lambda x x matches aten mul Tensor Scalar other - Tensor muls mul_constant_int = filter lambda x isinstance list x inputs toIValue int scalar_muls mul mul_constant_int g insert_point_guard mul outputs = g insertGraph unrolled_mul graph list mul inputs assert len outputs == len list mul outputs new_out old_out zip outputs g outputs old_out replaceAllUsesWith new_out mul destroy FileCheck check_not aten mul check aten add run foo graph assertEqual foo torch ones torch ones __name__ == __main__ raise_on_run_directly test test_jit py