Copyright c Meta Platforms Inc affiliates collections defaultdict torch torch export unflatten _ModuleFrame _SubmoduleEntry _outline_submodules orig_graph torch fx Graph - torch fx GraphModule Create empty GraphModule hold outlined modules new_module = torch fx GraphModule torch nn Module torch fx Graph seen_nodes dict str torch fx Node = seen_modules dict int list _SubmoduleEntry = defaultdict list seen_attrs dict str set str = defaultdict set created_modules dict str torch nn Module = _ModuleFrame orig_graph tuple orig_graph nodes seen_nodes seen_modules seen_attrs created_modules None None module=new_module run_outer new_module graph lint new_module recompile new_module