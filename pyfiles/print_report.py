__future__ annotations os subprocess typing IO oss utils get_pytorch_folder util setting SUMMARY_FOLDER_DIR TestList TestStatusType CoverageItem = tuple str float int int key_by_percentage x CoverageItem - float x key_by_name x CoverageItem - str x is_intrested_file file_path str interested_folders list str - bool cuda file_path False aten gen_aten file_path aten aten_ file_path False folder interested_folders folder file_path True False is_this_type_of_tests target_name str test_set_by_type set str - bool tests divided into three types success partial success fail collect coverage test test_set_by_type target_name test True False print_test_by_type tests TestList test_set_by_type set str type_name str summary_file IO str - None print Tests + type_name + collect coverage file=summary_file test tests is_this_type_of_tests test name test_set_by_type print test target_pattern file=summary_file print file=summary_file print_test_condition tests TestList tests_type TestStatusType interested_folders list str coverage_only list str summary_file IO str summary_type str - None print_test_by_type tests tests_type success fully success summary_file print_test_by_type tests tests_type partial partially success summary_file print_test_by_type tests tests_type fail failed summary_file print \n\nCoverage Collected Over Interested Folders \n interested_folders file=summary_file print \n\nCoverage Compilation Flags Only Apply To \n coverage_only file=summary_file print \n\n ---------------------------------- + summary_type + ---------------------------------- file=summary_file line_oriented_report tests TestList tests_type TestStatusType interested_folders list str coverage_only list str covered_lines dict str set int uncovered_lines dict str set int - None open os path join SUMMARY_FOLDER_DIR line_summary w+ report_file print_test_condition tests tests_type interested_folders coverage_only report_file LINE SUMMARY file_name covered_lines covered = covered_lines file_name uncovered = uncovered_lines file_name print f file_name \n covered lines sorted covered \n unconvered lines sorted uncovered file=report_file print_file_summary covered_summary int total_summary int summary_file IO str - float print summary first try coverage_percentage = covered_summary total_summary except ZeroDivisionError coverage_percentage = print f SUMMARY\ncovered covered_summary \nuncovered total_summary \npercentage coverage_percentage f \n\n file=summary_file coverage_percentage == print Coverage Please check json profiles valid coverage_percentage print_file_oriented_report tests_type TestStatusType coverage list CoverageItem covered_summary int total_summary int summary_file IO str tests TestList interested_folders list str coverage_only list str - None coverage_percentage = print_file_summary covered_summary total_summary summary_file print test condition interested folder tests successful failed print_test_condition tests tests_type interested_folders coverage_only summary_file FILE SUMMARY print each file s information item coverage print item ljust str item + rjust str item rjust str item rjust file=summary_file print f summary percentage coverage_percentage f file_oriented_report tests TestList tests_type TestStatusType interested_folders list str coverage_only list str covered_lines dict str set int uncovered_lines dict str set int - None open os path join SUMMARY_FOLDER_DIR file_summary w+ summary_file covered_summary = total_summary = coverage = file_name covered_lines get coverage number file covered_count = len covered_lines file_name total_count = covered_count + len uncovered_lines file_name try percentage = round covered_count total_count except ZeroDivisionError percentage = store information list sorted coverage append file_name percentage covered_count total_count update summary covered_summary = covered_summary + covered_count total_summary = total_summary + total_count sort coverage sort key=key_by_name coverage sort key=key_by_percentage print print_file_oriented_report tests_type coverage covered_summary total_summary summary_file tests interested_folders coverage_only get_html_ignored_pattern - list str usr anaconda third_party html_oriented_report - None use lcov generate coverage report build_folder = os path join get_pytorch_folder build coverage_info_file = os path join SUMMARY_FOLDER_DIR coverage info generate coverage report -- coverage info build folder subprocess check_call lcov -- capture -- directory build_folder -- output-file coverage_info_file remove files unrelated cmd_array = lcov -- remove coverage_info_file + get_html_ignored_pattern + -- output-file coverage_info_file subprocess check_call lcov -- remove coverage_info_file -- output-file coverage_info_file cmd_array generate beautiful html page subprocess check_call genhtml coverage_info_file -- output-directory os path join SUMMARY_FOLDER_DIR html_report