mypy ignore-errors Wrapper mimic parts np random API surface NumPy has strict guarantees reproducibility etc here we don t give any Q default dtype float numpy __future__ annotations functools math sqrt typing Optional torch _dtypes_impl _util _normalizations array_or_scalar ArrayLike normalizer __all__ = seed random_sample sample random rand randn normal choice randint shuffle uniform use_numpy_random local avoid ref cycles torch _dynamo config config config use_numpy_random_stream deco_stream func functools wraps func inner args kwds use_numpy_random func args kwds numpy _ndarray ndarray f = getattr numpy random func __name__ numpy funcs accept numpy ndarrays unwrap args = tuple arg tensor numpy isinstance arg ndarray arg arg args kwds = key val tensor numpy isinstance val ndarray val key val kwds items value = f args kwds ` value ` can either numpy ndarray python scalar None isinstance value numpy ndarray value = ndarray torch as_tensor value value inner deco_stream seed seed=None seed None torch random manual_seed seed deco_stream random_sample size=None size None size = dtype = _dtypes_impl default_dtypes float_dtype values = torch empty size dtype=dtype uniform_ array_or_scalar values return_scalar=size == rand size size == size = None random_sample size sample = random_sample random = random_sample deco_stream uniform low= high= size=None size None size = dtype = _dtypes_impl default_dtypes float_dtype values = torch empty size dtype=dtype uniform_ low high array_or_scalar values return_scalar=size == deco_stream randn size dtype = _dtypes_impl default_dtypes float_dtype values = torch randn size dtype=dtype array_or_scalar values return_scalar=size == deco_stream normal loc= scale= size=None size None size = dtype = _dtypes_impl default_dtypes float_dtype values = torch empty size dtype=dtype normal_ loc scale array_or_scalar values return_scalar=size == deco_stream shuffle x no normalizer because we do cast e g lists tensors _ndarray ndarray isinstance x torch Tensor tensor = x isinstance x ndarray tensor = x tensor raise NotImplementedError We do random shuffle lists in-place perm = torch randperm tensor shape xp = tensor perm tensor copy_ xp deco_stream randint low high=None size=None size None size = isinstance size tuple list size = size high None low high = low values = torch randint low high size=size array_or_scalar values int return_scalar=size == deco_stream normalizer choice ArrayLike size=None replace=True p Optional ArrayLike = None https stackoverflow com questions random-choice-with-pytorch numel == = torch arange TODO check dtype integer -- cf np random choice which raises number draws size None num_el = _util is_sequence size num_el = el size num_el = el num_el = size prepare probabilities p None p = torch ones_like shape cf https github com numpy numpy blob main numpy random mtrand pyx#L atol = sqrt torch finfo p dtype eps abs p sum - atol raise ValueError probabilities do sum actually sample indices = torch multinomial p num_el replacement=replace _util is_sequence size indices = indices reshape size samples = indices samples