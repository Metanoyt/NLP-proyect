__future__ annotations typing_extensions assert_never torchgen api cpp torchgen api types ArgName ArrayRefCType BaseCType Binding ConstRefCType dimnameListT intArrayRefT iOptTensorListRefT iTensorListRefT NamedCType OptionalCType optionalIntArrayRefT optionalScalarRefT optionalTensorRefT scalarT tensorT torchgen model Argument BaseTy BaseType ListType NativeFunctionsGroup OptionalType SelfArgument TensorOptionsArguments Type This file describes translation JIT schema structured functions API This similar native API number historical problems native API have been fixed Translation types occurring JIT arguments C++ argument type NB For now mutable doesn t do anything could we make some more nominal types argumenttype_type t Type mutable bool binds ArgName - NamedCType If s value type do value type translation NB structured kernels ALWAYS have symint off since they involve actual kernels require real ints The one exception CompositeExplicitAutograd meta function which could hypothetically SymInt simplicity we plan these just handled Python r = cpp valuetype_type t symint=False binds=binds mutable=mutable r None r isinstance t BaseType t name == BaseTy Tensor NamedCType binds ConstRefCType BaseCType tensorT t name == BaseTy Scalar NamedCType binds ConstRefCType BaseCType scalarT raise AssertionError f base type should have been value type t isinstance t OptionalType t elem == BaseType BaseTy Tensor NamedCType binds BaseCType optionalTensorRefT t elem == BaseType BaseTy Scalar NamedCType binds BaseCType optionalScalarRefT isinstance t elem ListType str t elem elem == int NamedCType binds BaseCType optionalIntArrayRefT elem = argumenttype_type t elem mutable=mutable binds=binds NamedCType binds OptionalCType elem type isinstance t ListType t elem == BaseType BaseTy Tensor NamedCType binds ConstRefCType BaseCType iTensorListRefT t elem == OptionalType BaseType BaseTy Tensor NamedCType binds BaseCType iOptTensorListRefT TODO delete these special cases see torchgen api cpp -- these must changed tandem there problems see https github com pytorch pytorch pull str t elem == int NamedCType binds BaseCType intArrayRefT str t elem == Dimname NamedCType binds BaseCType dimnameListT elem = argumenttype_type t elem mutable=mutable binds=binds NamedCType binds ArrayRefCType elem type raise AssertionError f unrecognized type repr t argument_type Argument binds ArgName - NamedCType argumenttype_type type mutable=a is_write binds=binds returns_type intentionally omitted because structured kernels never instead they always indirectly report their outputs case meta function calling set_output case impl function writing directly into provided out argument Structured kernels never defaulted argument Argument &#124; SelfArgument &#124; TensorOptionsArguments - list Binding isinstance Argument Binding nctype=argument_type binds=a name name=a name default=None argument=a isinstance SelfArgument argument argument isinstance TensorOptionsArguments raise AssertionError structured kernels don t support TensorOptions yet assert_never impl_arguments g NativeFunctionsGroup - list Binding args list Argument &#124; TensorOptionsArguments &#124; SelfArgument = g out precomputed A list parameters impl function certain parameters replaced precomputed counterparts specified native_functions yaml non_out_args_replaced list Argument &#124; TensorOptionsArguments &#124; SelfArgument = g out func arguments non_out isinstance Argument name g out precomputed replace If precompute replace append parameters should replace onto non_out_args_replaced non_out_args_replaced extend g out precomputed replace name If push non_out_args_replaced append args extend non_out_args_replaced g out precomputed add list parameters added without replacement after non out args just before out args args extend g out precomputed add args extend g out func arguments non_out args extend g out func arguments out r arg args r argument arg meta_arguments g NativeFunctionsGroup - list Binding args list Argument &#124; TensorOptionsArguments &#124; SelfArgument = args extend g functional func arguments non_out r arg args r argument arg out_arguments g NativeFunctionsGroup - list Binding args list Argument &#124; TensorOptionsArguments &#124; SelfArgument = args extend g out func arguments out r arg args r argument arg