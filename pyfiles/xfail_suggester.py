re torch Instructions pytest -n test test_vmap py test test_ops py test test_aotdispatch py result txt python test xfail_suggester py open result txt f lines = f readlines failed = line line lines line startswith FAILED p = re compile FAILED test test_\w+ py \w+ \S+ noqa W get_failed_test line m = p match line m None None m group base_names = test_grad_ test_vjp_ test_vmapvjp_ test_vmapvjp_has_batch_rule_ test_vjpvmap_ test_jvp_ test_vmapjvp_ test_vmapjvpall_has_batch_rule_ test_vmapjvpall_ test_jvpvjp_ test_vjpvjp_ test_decomposition_ test_make_fx_exhaustive_ test_vmap_exhaustive_ test_op_has_batch_rule_ test_vmap_autograd_grad_ failed_tests = get_failed_test line line lines failed_tests = match match failed_tests match None failed_tests = sorted failed_tests suggested_xfails = remove_device_dtype test _ join test split _ - belongs_to_base test base test startswith base False candidates = try_base try_base base_names len try_base len base candidate candidates test startswith candidate False True parse_namespace base mappings = nn_functional_ nn functional fft_ fft linalg_ linalg _masked_ _masked sparse_ sparse special_ special heading mappings keys base startswith heading mappings heading base len heading None base get_torch_module namespace namespace None torch namespace == nn functional torch nn functional getattr torch namespace parse_base base namespace rest = parse_namespace base apis = dir get_torch_module namespace apis = sorted apis key=lambda x -len x api = rest variant = candidate apis rest startswith candidate api = candidate variant = rest len candidate + break print base namespace api variant namespace api variant any_starts_with strs thing s strs s startswith thing True False get_suggested_xfails base tests result = tests = test len base test tests belongs_to_base test base base_tests = remove_device_dtype test test tests tests = set tests base base_tests cpu_variant = base + _cpu_float cuda_variant = base + _cuda_float namespace api variant = parse_base base namespace None api = f namespace api cpu_variant tests cuda_variant tests result append f xfail api variant continue cpu_variant tests result append f xfail api variant device_type= cpu continue cuda_variant tests result append f xfail api variant device_type= cuda continue result append f skip api variant result result = base get_suggested_xfails base failed_tests base base_names k v result items print = print k print = print \n join v