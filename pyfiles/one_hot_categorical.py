mypy allow-untyped-defs typing Optional torch torch Tensor torch distributions constraints torch distributions categorical Categorical torch distributions distribution Distribution torch types _size __all__ = OneHotCategorical OneHotCategoricalStraightThrough OneHotCategorical Distribution r Creates one-hot categorical distribution parameterized attr ` probs ` attr ` logits ` Samples one-hot coded vectors size ` ` probs size - ` ` note The ` probs ` argument must non-negative finite have non-zero sum will normalized sum along last dimension attr ` probs ` will normalized value The ` logits ` argument will interpreted unnormalized log probabilities can therefore any real number It will likewise normalized so resulting probabilities sum along last dimension attr ` logits ` will normalized value See also func ` torch distributions Categorical ` specifications attr ` probs ` attr ` logits ` Example xdoctest +IGNORE_WANT non-deterministic m = OneHotCategorical torch tensor m sample equal probability tensor Args probs Tensor event probabilities logits Tensor event log probabilities unnormalized pyrefly ignore bad-override arg_constraints = probs constraints simplex logits constraints real_vector support = constraints one_hot has_enumerate_support = True __init__ probs Optional Tensor = None logits Optional Tensor = None validate_args Optional bool = None - None _categorical = Categorical probs logits batch_shape = _categorical batch_shape event_shape = _categorical param_shape - super __init__ batch_shape event_shape validate_args=validate_args expand batch_shape _instance=None new = _get_checked_instance OneHotCategorical _instance batch_shape = torch Size batch_shape new _categorical = _categorical expand batch_shape super OneHotCategorical new __init__ batch_shape event_shape validate_args=False new _validate_args = _validate_args new _new args kwargs _categorical _new args kwargs property _param - Tensor _categorical _param property probs - Tensor _categorical probs property logits - Tensor _categorical logits property mean - Tensor _categorical probs property mode - Tensor probs = _categorical probs mode = probs argmax dim=- torch nn functional one_hot mode num_classes=probs shape - probs property variance - Tensor _categorical probs - _categorical probs property param_shape - torch Size _categorical param_shape sample sample_shape=torch Size sample_shape = torch Size sample_shape probs = _categorical probs num_events = _categorical _num_events indices = _categorical sample sample_shape torch nn functional one_hot indices num_events probs log_prob value _validate_args _validate_sample value indices = value max - _categorical log_prob indices entropy _categorical entropy enumerate_support expand=True n = event_shape values = torch eye n dtype=self _param dtype device=self _param device values = values view n + len batch_shape + n expand values = values expand n + batch_shape + n values OneHotCategoricalStraightThrough OneHotCategorical r Creates reparameterizable ` OneHotCategorical ` distribution based straight- through gradient estimator Estimating Propagating Gradients Through Stochastic Neurons Conditional Computation Bengio et al has_rsample = True rsample sample_shape _size = torch Size - Tensor samples = sample sample_shape probs = _categorical probs cached via lazy_property samples + probs - probs detach