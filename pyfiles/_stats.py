NOTE PLEASE KEEP THIS FILE FREE OF TORCH DEPS IT SHOULD BE IMPORTABLE ANYWHERE IF YOU FEEL AN OVERWHELMING URGE TO ADD A TORCH DEP MAKE A TRAMPOLINE FILE A LA torch _dynamo utils AND SCRUB AWAY TORCH NOTIONS THERE collections functools collections OrderedDict collections abc Callable typing TypeVar typing_extensions ParamSpec simple_call_counter OrderedDict str int = collections OrderedDict _P = ParamSpec _P _R = TypeVar _R count_label label str - None prev = simple_call_counter setdefault label simple_call_counter label = prev + count fn Callable _P _R - Callable _P _R functools wraps fn wrapper args _P args kwargs _P kwargs - _R fn __qualname__ simple_call_counter simple_call_counter fn __qualname__ = simple_call_counter fn __qualname__ = simple_call_counter fn __qualname__ + fn args kwargs wrapper