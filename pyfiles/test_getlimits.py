Owner s module dynamo Test functions limits module functools warnings unittest expectedFailure xfail skipIf numpy pytest raises assert_raises torch testing _internal common_utils instantiate_parametrized_tests parametrize run_tests subtest TEST_WITH_TORCHDYNAMO TestCase xpassIfTorchDynamo_np TEST_WITH_TORCHDYNAMO numpy np numpy double finfo half iinfo single numpy testing assert_ assert_equal torch _numpy np torch _numpy double finfo half iinfo single torch _numpy testing assert_ assert_equal skip = functools partial skipIf True ################################################## skip reason= torch finfo singleton Why demanding TestPythonFloat TestCase test_singleton ftype = finfo float ftype = finfo float assert_equal id ftype id ftype skip reason= torch finfo singleton Why demanding TestHalf TestCase test_singleton ftype = finfo half ftype = finfo half assert_equal id ftype id ftype skip reason= torch finfo singleton Why demanding TestSingle TestCase test_singleton ftype = finfo single ftype = finfo single assert_equal id ftype id ftype skip reason= torch finfo singleton Why demanding TestDouble TestCase test_singleton ftype = finfo double ftype = finfo double assert_equal id ftype id ftype TestFinfo TestCase skipIf numpy __version__ reason= smallest_normal new test_basic dts = list zip f f f c c np float np float np float np complex np complex dt dt dts attr bits eps max min resolution tiny smallest_normal assert_equal getattr finfo dt attr getattr finfo dt attr attr assert_raises TypeError ValueError finfo i skip reason= Some these attributes implemented vs NP versions test_basic_missing dt = np float attr epsneg iexp machep maxexp minexp negep nexp nmant precision smallest_subnormal getattr finfo dt attr instantiate_parametrized_tests TestIinfo TestCase test_basic dts = list zip i i i i u u u u np int np int np int np int np uint dt dt dts attr bits min max assert_equal getattr iinfo dt attr getattr iinfo dt attr attr assert_raises TypeError ValueError iinfo f parametrize T np uint xfail unsupported add uint subtest np uint decorators= TEST_WITH_TORCHDYNAMO xfail subtest np uint decorators= TEST_WITH_TORCHDYNAMO xfail subtest np uint decorators= TEST_WITH_TORCHDYNAMO xfail test_unsigned_max T max_calculated = T - T assert_equal iinfo T max max_calculated TestRepr TestCase test_iinfo_repr expected = iinfo min=- max= dtype=int assert_equal repr np iinfo np int expected skipIf TEST_WITH_TORCHDYNAMO reason= repr differs test_finfo_repr repr_f = repr np finfo np float assert finfo resolution= e- min=- e+ repr_f assert dtype=float repr_f assert_ma_equal discovered ma_like Check MachAr-like objects same calculated MachAr instances key value discovered __dict__ items assert_equal value getattr ma_like key hasattr value shape assert_equal value shape getattr ma_like key shape assert_equal value dtype getattr ma_like key dtype TestMisc TestCase skip reason= Instantiate i f info dtypes test_instances iinfo finfo skip reason= MachAr no implemented does need test_known_types Test we correctly compiling parameters known types ftype ma_like np float _float_ma np float _float_ma np float _float_ma assert_ma_equal _discovered_machar ftype ma_like Suppress warning broken discovery double double PPC ld_ma = _discovered_machar np longdouble bytes = np dtype np longdouble itemsize ld_ma ld_ma maxexp == bytes -bit extended precision assert_ma_equal ld_ma _float_ma ld_ma ld_ma maxexp == bytes == IEE -bit assert_ma_equal ld_ma _float_ma skip reason= MachAr no implemented does need test_subnormal_warning Test subnormal zero warning being raised ld_ma = _discovered_machar np longdouble bytes = np dtype np longdouble itemsize warnings catch_warnings record=True w warnings simplefilter always ld_ma ld_ma maxexp == bytes -bit extended precision ld_ma smallest_subnormal assert len w == ld_ma ld_ma maxexp == bytes == IEE -bit ld_ma smallest_subnormal assert len w == Double double ld_ma smallest_subnormal This test may fail some platforms assert len w == xpassIfTorchDynamo_np reason= None nmant minexp maxexp implemented test_plausible_finfo Assert finfo returns reasonable results all types ftype np float np float np float np longdouble + np complex np complex no complex torch _numpy + np clongdouble hasattr np clongdouble info = np finfo ftype assert_ info nmant assert_ info minexp - assert_ info maxexp __name__ == __main__ run_tests