mypy allow-untyped-defs math numbers Number Real torch torch inf nan torch distributions constraints Distribution torch distributions utils broadcast_all __all__ = GeneralizedPareto GeneralizedPareto Distribution r Creates Generalized Pareto distribution parameterized attr ` loc ` attr ` scale ` attr ` concentration ` The Generalized Pareto distribution family continuous probability distributions real line Special cases include Exponential when attr ` loc ` = attr ` concentration ` = Pareto when attr ` concentration ` attr ` loc ` = attr ` scale ` attr ` concentration ` Uniform when attr ` concentration ` = - This distribution often used model tails other distributions This implementation based implementation TensorFlow Probability Example xdoctest +IGNORE_WANT non-deterministic m = GeneralizedPareto torch tensor torch tensor torch tensor m sample sample Generalized Pareto distribution loc= scale= concentration= tensor Args loc float Tensor Location parameter distribution scale float Tensor Scale parameter distribution concentration float Tensor Concentration parameter distribution pyrefly ignore bad-override arg_constraints = loc constraints real scale constraints positive concentration constraints real has_rsample = True __init__ loc scale concentration validate_args=None loc scale concentration = broadcast_all loc scale concentration isinstance loc Number isinstance scale Number isinstance concentration Number batch_shape = torch Size batch_shape = loc size super __init__ batch_shape validate_args=validate_args expand batch_shape _instance=None new = _get_checked_instance GeneralizedPareto _instance batch_shape = torch Size batch_shape new loc = loc expand batch_shape new scale = scale expand batch_shape new concentration = concentration expand batch_shape super GeneralizedPareto new __init__ batch_shape validate_args=False new _validate_args = _validate_args new rsample sample_shape=torch Size shape = _extended_shape sample_shape u = torch rand shape dtype=self loc dtype device=self loc device icdf u log_prob value _validate_args _validate_sample value z = _z value eq_zero = torch isclose concentration torch tensor safe_conc = torch where eq_zero torch ones_like concentration concentration y = safe_conc + torch ones_like z where_nonzero = torch where y == y y torch log p safe_conc z log_scale = math log scale isinstance scale Real scale log -log_scale - torch where eq_zero z where_nonzero log_survival_function value _validate_args _validate_sample value z = _z value eq_zero = torch isclose concentration torch tensor safe_conc = torch where eq_zero torch ones_like concentration concentration where_nonzero = -torch log p safe_conc z safe_conc torch where eq_zero -z where_nonzero log_cdf value torch log p -torch exp log_survival_function value cdf value torch exp log_cdf value icdf value loc = loc scale = scale concentration = concentration eq_zero = torch isclose concentration torch zeros_like concentration safe_conc = torch where eq_zero torch ones_like concentration concentration logu = torch log p -value where_nonzero = loc + scale safe_conc torch expm -safe_conc logu where_zero = loc - scale logu torch where eq_zero where_zero where_nonzero _z x x - loc scale property mean concentration = concentration valid = concentration safe_conc = torch where valid concentration result = loc + scale - safe_conc torch where valid result nan property variance concentration = concentration valid = concentration safe_conc = torch where valid concentration pyrefly ignore unsupported-operation result = scale - safe_conc - safe_conc torch where valid result nan entropy ans = torch log scale + concentration + torch broadcast_to ans _batch_shape property mode loc constraints dependent_property is_discrete=False event_dim= pyrefly ignore bad-override support lower = loc upper = torch where concentration lower - scale concentration inf constraints interval lower upper