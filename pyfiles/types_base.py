Where should I add new type ` types_base py ` vs ` types py ` This file defines data model classes torchgen typing system well some base types such int _t ` types py ` defines ATen Tensor type some c types along signatures use these types The difference between these two files ` types_base py ` should implementation-agnostic meaning shouldn t contain any type definition tight specific C++ library e g ATen so can easily reused we want generate code another C++ library Add new types ` types py ` these types ATen c related Add new types ` types_base py ` they basic attached ATen c __future__ annotations abc ABC abstractmethod dataclasses dataclass enum auto Enum typing TYPE_CHECKING Union TYPE_CHECKING torchgen model Argument SelfArgument TensorOptionsArguments An ArgName just str name argument schema some special circumstances we may add little extra context The Enum SpecialArgName covers all these cases grep their construction sites see when they can occur SpecialArgName Enum possibly_redundant_memory_format = auto ArgName = Union str SpecialArgName This shouldn t created directly instead use create one singletons below dataclass frozen=True BaseCppType ns str &#124; None name str __str__ - str ns None ns == name f ns name The set all non-templated valid fully-qualified names C++ types used codegen Templated types get their own dataclass mainly make namespace parsing easier byteT = BaseCppType uint _t charT = BaseCppType int _t shortT = BaseCppType int _t It would more symmetric called intT easy mix up JIT int which int _t C++ so we intentionally don t define intT make obvious when you ve stuffed up int T = BaseCppType int _t longT = BaseCppType int _t doubleT = BaseCppType double floatT = BaseCppType float boolT = BaseCppType bool voidT = BaseCppType void CType ABC abstractmethod cpp_type strip_ref bool = False - str raise NotImplementedError abstractmethod remove_const_ref - CType dataclass frozen=True BaseCType CType type BaseCppType cpp_type strip_ref bool = False - str str type remove_const_ref - CType dataclass frozen=True ConstRefCType CType elem CType cpp_type strip_ref bool = False - str strip_ref elem cpp_type strip_ref=strip_ref f const elem cpp_type remove_const_ref - CType elem remove_const_ref dataclass frozen=True VectorCType CType elem CType cpp_type strip_ref bool = False - str Do pass ` strip_ref ` recursively f std vector elem cpp_type remove_const_ref - CType VectorCType elem remove_const_ref dataclass frozen=True ArrayCType CType elem CType size int cpp_type strip_ref bool = False - str Do pass ` strip_ref ` recursively f std array elem cpp_type size remove_const_ref - CType ArrayCType elem remove_const_ref size dataclass frozen=True TupleCType CType elems list CType cpp_type strip_ref bool = False - str Do pass ` strip_ref ` recursively f std tuple join e cpp_type e elems remove_const_ref - CType TupleCType e remove_const_ref e elems dataclass frozen=True MutRefCType CType elem CType cpp_type strip_ref bool = False - str strip_ref elem cpp_type strip_ref=strip_ref f elem cpp_type remove_const_ref - CType elem remove_const_ref A NamedCType short Named C++ semantic type A NamedCType represents C++ type plus semantic information about what represents For example consider argument bool pin_memory its normal C++ type bool its C++ semantic type also keeps track represents pin_memory you can t just use random other boolean context where you need pin_memory dataclass frozen=True NamedCType name ArgName type CType cpp_type strip_ref bool = False - str type cpp_type strip_ref=strip_ref remove_const_ref - NamedCType NamedCType name type remove_const_ref with_name name str - NamedCType NamedCType name type A binding represents any C++ binding site formal parameter We don t distinguish between binding sites different APIs instead all important distinctions encoded CType which you can use figure out given Binding appropriate use another context See torchgen api translate dataclass frozen=True Binding name str nctype NamedCType argument Argument &#124; TensorOptionsArguments &#124; SelfArgument TODO maybe don t represent default here default str &#124; None = None rename name str - Binding Binding name=name nctype=self nctype argument=self argument default=self default property type - str nctype cpp_type no_default - Binding Binding name=self name nctype=self nctype default=None argument=self argument decl func_ptr_cast bool = False - str mb_default = default None mb_default = f = default casting only needs know type func_ptr_cast f type f type name mb_default defn - str f type name with_name name str - Binding Binding name=name nctype=self nctype argument=self argument default=self default An Expr C++ expression It has C++ string representing its syntax well CType saying what provides dataclass frozen=True Expr expr str type NamedCType