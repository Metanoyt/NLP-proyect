typing Optional torch torchfuzz operators base Operator torchfuzz tensor_fuzzer Spec TensorSpec GatherOperator Operator Operator gathering values along axis specified dim using indices __init__ super __init__ gather property torch_op_name - Optional str Return torch operation name torch gather can_produce output_spec Spec - bool Gather can produce tensors various shapes -dimensional tensors isinstance output_spec TensorSpec False gather requires least one dimension len output_spec size fuzz_inputs_specs output_spec Spec num_inputs int = - list Spec Generate input specs gather operation torch gather input dim index returns tensor - output shape == index shape - output i j k = input i j index i j k dim= example isinstance output_spec TensorSpec raise ValueError GatherOperator can only produce TensorSpec outputs The output shape matches index shape output_size = output_spec size dim = Gather along dimension simplicity Input tensor - create shape matches output except gather dimension which can any size = max indices + For simplicity make input larger gather dimension len output_size == Output D input_size = output_size + input_stride = len output_size == Output D make input D first dim larger input_size = output_size + output_size input_stride = output_size Contiguous For higher dimensions input_size = tuple s + i == dim s i s enumerate output_size Contiguous stride input_stride = tuple int torch tensor input_size i + prod item i len input_size - i range len input_size input_tensor_spec = TensorSpec size=input_size stride=input_stride dtype=output_spec dtype Index tensor - same shape output long dtype index_spec = TensorSpec size=output_size stride=tuple int torch tensor output_size i + prod item i len output_size - i range len output_size dtype=torch long input_tensor_spec index_spec codegen output_name str input_names list str output_spec Spec - str Generate code gather Creates appropriate indices gather input tensor len input_names = raise ValueError GatherOperator requires exactly two inputs isinstance output_spec TensorSpec raise ValueError GatherOperator requires TensorSpec output Determine dimension dim = Gather along dimension simplicity Generate code creates valid indices within input tensor s dimension f _input_size_ output_name = input_names size dim \n f _index_ output_name = torch randint _input_size_ output_name output_spec size device= input_names device \n f output_name = torch gather input_names dim _index_ output_name