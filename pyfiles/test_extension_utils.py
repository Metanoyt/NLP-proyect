Owner s module PrivateUse sys torch torch testing _internal common_utils run_tests skipIfTorchDynamo TestCase DummyPrivateUse Module staticmethod is_available True staticmethod is_autocast_enabled True staticmethod get_autocast_dtype torch float staticmethod set_autocast_enabled enable pass staticmethod set_autocast_dtype dtype pass staticmethod get_amp_supported_dtype torch float TestExtensionUtils TestCase tearDown Clean up backend_name = torch _C _get_privateuse _backend_name hasattr torch backend_name delattr torch backend_name f torch backend_name sys modules del sys modules f torch backend_name test_external_module_register Built-in module assertRaisesRegex RuntimeError The runtime module torch _register_device_module cuda torch cuda Wrong device type assertRaisesRegex RuntimeError Expected one cpu torch _register_device_module dummmy DummyPrivateUse Module assertRaises AttributeError torch privateuseone is_available type ignore attr-defined torch _register_device_module privateuseone DummyPrivateUse Module torch privateuseone is_available type ignore attr-defined No supporting override assertRaisesRegex RuntimeError The runtime module torch _register_device_module privateuseone DummyPrivateUse Module skipIfTorchDynamo accelerator doesn t compose privateuse https github com pytorch pytorch issues test_external_module_register_with_renamed_backend torch utils rename_privateuse _backend foo assertRaisesRegex RuntimeError has already been set torch utils rename_privateuse _backend dummmy custom_backend_name = torch _C _get_privateuse _backend_name assertEqual custom_backend_name foo assertRaises AttributeError torch foo is_available type ignore attr-defined assertRaisesRegex AssertionError Tried use AMP torch autocast device_type=custom_backend_name pass torch _register_device_module foo DummyPrivateUse Module torch foo is_available type ignore attr-defined torch autocast device_type=custom_backend_name pass assertEqual torch _utils _get_device_index foo assertEqual torch _utils _get_device_index torch device foo __name__ == __main__ run_tests