argparse pt_wrapper_module WrapperModule SimpleAddModule add_tensors_loop SimpleAddModule utils benchmark_module BenchmarkConfig ModuleConfig ms_to_us Framework overhead benchmark script Benchmark framework overhead Currently supported ops add As now runs only forward pass Supports both graph mode eager mode In graph mode module traced via JIT tracing Debug option prints traced graph graph_mode enabled Graph can saved via save option Saved directory where benchmark run Example build run To run PT benchmark buck run mode opt path-to-framework_overhead_benchmark framework_overhead_benchmark -- -- add-op -- graph-mode -- eager-mode Runs both graph mode eager mode buck run mode opt path-to-framework_overhead_benchmark framework_overhead_benchmark -- -- add-op -- graph-mode Runs only graph mode SUPPORTED_OPS = add_op parse_op_args op op_list = op split noqa F print_results result print =================================== key value result items print f key latency per iter us ms_to_us value print =================================== benchmark_simple_fn args config module_config module_type result Benchmarks PyTorch traceable function specified config Instantiates wrapper object wraps object module_type runs forward method using benchmark_module Args config contains number warmup benchmark iterations module_config module_config which contains op number parameters op takes whether graph mode enabled module_type Type module wrapped e g SimpleAddModule add op result dictionary instance populated benchmark result latency per iter print f Benchmarking module_type __name__ f_name = module_config pt_fn __name__ + Num Operands= + str module_config num_params graph_mode_str = Graph mode + + str module_config graph_mode result_key = join f_name graph_mode_str module = WrapperModule module_type module_config args debug args save latency_per_iter_ms = benchmark_module config module args use_throughput_benchmark result result_key = latency_per_iter_ms main parser = argparse ArgumentParser parser add_argument -- op default= add_op dest= op type=str parser add_argument -- use-throughput-benchmark -- use_throughput_benchmark default=False dest= use_throughput_benchmark action= store_true parser add_argument -- debug default=False dest= debug action= store_true parser add_argument -- save default=False dest= save action= store_true parser add_argument -- eager-mode -- eager_mode default=False dest= eager_mode action= store_true parser add_argument -- num-warmup-iters -- num_warmup_iters type=int default= parser add_argument -- num-iters -- num_iters type=int default= args = parser parse_args args op SUPPORTED_OPS print f Op args op supported Supported ops SUPPORTED_OPS num_warmup_iters = args num_warmup_iters num_iters = args num_iters config = BenchmarkConfig num_warmup_iters num_iters graph_mode = True args eager_mode graph_mode = False result = args op == add_op num_params = module_config = ModuleConfig add_tensors_loop None num_params graph_mode benchmark_simple_fn args config module_config SimpleAddModule result print_results result __name__ == __main__ main