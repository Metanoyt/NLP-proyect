======= BEGIN Dynamo patch ======= Owner s module dynamo ruff noqa flake noqa Test copied https raw githubusercontent com python cpython refs tags v Lib test test_operator py sys torch torch _dynamo test_case unittest torch _dynamo test_case CPythonTestCase torch testing _internal common_utils run_tests __TestCase = CPythonTestCase ======= END DYNAMO PATCH ======= unittest inspect pickle sys decimal Decimal fractions Fraction test support test support import_helper py_operator = import_helper import_fresh_module operator blocked= _operator c_operator = import_helper import_fresh_module operator fresh= _operator Seq __init__ lst lst = lst __len__ len lst __getitem__ i lst i __add__ other lst + other lst __mul__ other lst other __rmul__ other other lst Seq object __init__ lst lst = lst __len__ len lst __getitem__ i lst i __add__ other lst + other lst __mul__ other lst other __rmul__ other other lst BadIterable __iter__ raise ZeroDivisionError OperatorTestCase test___all__ operator = module actual_all = set operator __all__ computed_all = set name vars operator name startswith __ continue value = getattr operator name value __module__ operator _operator computed_all add name assertSetEqual computed_all actual_all test_lt operator = module assertRaises TypeError operator lt assertRaises TypeError operator lt j j assertFalse operator lt assertFalse operator lt assertFalse operator lt assertFalse operator lt assertTrue operator lt assertTrue operator lt test_le operator = module assertRaises TypeError operator le assertRaises TypeError operator le j j assertFalse operator le assertFalse operator le assertTrue operator le assertTrue operator le assertTrue operator le assertTrue operator le test_eq operator = module torch _dynamo error_on_graph_break False C object __eq__ other raise SyntaxError assertRaises TypeError operator eq assertRaises SyntaxError operator eq C C assertFalse operator eq assertFalse operator eq assertTrue operator eq assertTrue operator eq assertFalse operator eq assertFalse operator eq test_ne operator = module torch _dynamo error_on_graph_break False C object __ne__ other raise SyntaxError assertRaises TypeError operator ne assertRaises SyntaxError operator ne C C assertTrue operator ne assertTrue operator ne assertFalse operator ne assertFalse operator ne assertTrue operator ne assertTrue operator ne test_ge operator = module assertRaises TypeError operator ge assertRaises TypeError operator ge j j assertTrue operator ge assertTrue operator ge assertTrue operator ge assertTrue operator ge assertFalse operator ge assertFalse operator ge test_gt operator = module assertRaises TypeError operator gt assertRaises TypeError operator gt j j assertTrue operator gt assertTrue operator gt assertFalse operator gt assertFalse operator gt assertFalse operator gt assertFalse operator gt test_abs operator = module assertRaises TypeError operator abs assertRaises TypeError operator abs None assertEqual operator abs - assertEqual operator abs test_add operator = module assertRaises TypeError operator add assertRaises TypeError operator add None None assertEqual operator add test_bitwise_and operator = module assertRaises TypeError operator and_ assertRaises TypeError operator and_ None None assertEqual operator and_ xf xa xa test_concat operator = module assertRaises TypeError operator concat assertRaises TypeError operator concat None None assertEqual operator concat py thon python assertEqual operator concat assertEqual operator concat Seq Seq assertEqual operator concat Seq Seq assertRaises TypeError operator concat test_countOf operator = module assertRaises TypeError operator countOf assertRaises TypeError operator countOf None None assertRaises ZeroDivisionError operator countOf BadIterable assertEqual operator countOf assertEqual operator countOf == nan = float nan assertEqual operator countOf nan nan nan == assertEqual operator countOf test_delitem operator = module = assertRaises TypeError operator delitem assertRaises TypeError operator delitem None assertIsNone operator delitem assertEqual test_floordiv operator = module assertRaises TypeError operator floordiv assertRaises TypeError operator floordiv None None assertEqual operator floordiv test_truediv operator = module assertRaises TypeError operator truediv assertRaises TypeError operator truediv None None assertEqual operator truediv test_getitem operator = module = range assertRaises TypeError operator getitem assertRaises TypeError operator getitem None assertEqual operator getitem test_indexOf operator = module assertRaises TypeError operator indexOf assertRaises TypeError operator indexOf None None assertRaises ZeroDivisionError operator indexOf BadIterable assertEqual operator indexOf assertRaises ValueError operator indexOf nan = float nan assertEqual operator indexOf nan nan nan assertEqual operator indexOf = iter leave iterator exactly position after match assertEqual operator indexOf assertEqual next v test_invert operator = module assertRaises TypeError operator invert assertRaises TypeError operator invert None assertEqual operator inv - test_lshift operator = module assertRaises TypeError operator lshift assertRaises TypeError operator lshift None assertEqual operator lshift assertEqual operator lshift assertRaises ValueError operator lshift - test_mod operator = module assertRaises TypeError operator mod assertRaises TypeError operator mod None assertEqual operator mod test_mul operator = module assertRaises TypeError operator mul assertRaises TypeError operator mul None None assertEqual operator mul test_matmul operator = module assertRaises TypeError operator matmul assertRaises TypeError operator matmul torch _dynamo error_on_graph_break False M __matmul__ other other - assertEqual M test_neg operator = module assertRaises TypeError operator neg assertRaises TypeError operator neg None assertEqual operator neg - assertEqual operator neg - assertEqual operator neg assertEqual operator neg - test_bitwise_or operator = module assertRaises TypeError operator or_ assertRaises TypeError operator or_ None None assertEqual operator or_ xa x xf test_pos operator = module assertRaises TypeError operator pos assertRaises TypeError operator pos None assertEqual operator pos assertEqual operator pos - - assertEqual operator pos assertEqual operator pos - test_pow operator = module assertRaises TypeError operator pow assertRaises TypeError operator pow None None assertEqual operator pow assertRaises TypeError operator pow assertRaises TypeError operator pow test_rshift operator = module assertRaises TypeError operator rshift assertRaises TypeError operator rshift None assertEqual operator rshift assertEqual operator rshift assertRaises ValueError operator rshift - test_contains operator = module assertRaises TypeError operator contains assertRaises TypeError operator contains None None assertRaises ZeroDivisionError operator contains BadIterable assertTrue operator contains range assertFalse operator contains range test_setitem operator = module = list range assertRaises TypeError operator setitem assertRaises TypeError operator setitem None None assertIsNone operator setitem assertEqual assertRaises IndexError operator setitem test_sub operator = module assertRaises TypeError operator sub assertRaises TypeError operator sub None None assertEqual operator sub test_truth operator = module torch _dynamo error_on_graph_break False C object __bool__ raise SyntaxError assertRaises TypeError operator truth assertRaises SyntaxError operator truth C assertTrue operator truth assertTrue operator truth assertFalse operator truth assertFalse operator truth test_bitwise_xor operator = module assertRaises TypeError operator xor assertRaises TypeError operator xor None None assertEqual operator xor xb xc x test_is operator = module = b = xyzpdq c = + b assertRaises TypeError operator is_ assertTrue operator is_ b assertFalse operator is_ c test_is_not operator = module = b = xyzpdq c = + b assertRaises TypeError operator is_not assertFalse operator is_not b assertTrue operator is_not c test_attrgetter operator = module torch _dynamo error_on_graph_break False A pass = A name = arthur f = operator attrgetter name assertEqual f arthur assertRaises TypeError f assertRaises TypeError f dent assertRaises TypeError f surname= dent f = operator attrgetter rank assertRaises AttributeError f assertRaises TypeError operator attrgetter assertRaises TypeError operator attrgetter multiple gets record = A record x = X record y = Y record z = Z assertEqual operator attrgetter x z y record X Z Y assertRaises TypeError operator attrgetter x y torch _dynamo error_on_graph_break False C object __getattr__ name raise SyntaxError assertRaises SyntaxError operator attrgetter foo C recursive gets = A name = arthur child = A child name = thomas f = operator attrgetter child name assertEqual f thomas assertRaises AttributeError f child f = operator attrgetter name child name assertEqual f arthur thomas f = operator attrgetter name child name child child name assertRaises AttributeError f f = operator attrgetter child assertRaises AttributeError f f = operator attrgetter child assertRaises AttributeError f child child = A child child name = johnson f = operator attrgetter child child name assertEqual f johnson f = operator attrgetter name child name child child name assertEqual f arthur thomas johnson test_itemgetter operator = module = ABCDE f = operator itemgetter assertEqual f C assertRaises TypeError f assertRaises TypeError f assertRaises TypeError f size= f = operator itemgetter assertRaises IndexError f torch _dynamo error_on_graph_break False C object __getitem__ name raise SyntaxError assertRaises SyntaxError operator itemgetter C f = operator itemgetter name assertRaises TypeError f assertRaises TypeError operator itemgetter d = dict key= val f = operator itemgetter key assertEqual f d val f = operator itemgetter nonkey assertRaises KeyError f d example used docs inventory = apple banana pear orange getcount = operator itemgetter assertEqual list map getcount inventory assertEqual sorted inventory key=getcount orange banana apple pear multiple gets data = list map str range assertEqual operator itemgetter data assertRaises TypeError operator itemgetter x data interesting indices t = tuple abcde assertEqual operator itemgetter - t e assertEqual operator itemgetter slice t c d interesting sequences torch _dynamo error_on_graph_break False T tuple Tuple subclass pass assertEqual operator itemgetter T abc assertEqual operator itemgetter b c assertEqual operator itemgetter range test_methodcaller operator = module assertRaises TypeError operator methodcaller assertRaises TypeError operator methodcaller torch _dynamo error_on_graph_break False A foo args kwds args + args bar f= f baz args kwds kwds name kwds = A f = operator methodcaller foo assertRaises IndexError f f = operator methodcaller foo assertEqual f assertRaises TypeError f assertRaises TypeError f assertRaises TypeError f spam= f = operator methodcaller bar assertEqual f assertRaises TypeError f f = operator methodcaller bar f= assertEqual f f = operator methodcaller baz name= spam self= eggs assertEqual f spam eggs test_inplace operator = module torch _dynamo error_on_graph_break False C object __iadd__ other iadd __iand__ other iand __ifloordiv__ other ifloordiv __ilshift__ other ilshift __imod__ other imod __imul__ other imul __imatmul__ other imatmul __ior__ other ior __ipow__ other ipow __irshift__ other irshift __isub__ other isub __itruediv__ other itruediv __ixor__ other ixor __getitem__ other so C sequence c = C assertEqual operator iadd c iadd assertEqual operator iand c iand assertEqual operator ifloordiv c ifloordiv assertEqual operator ilshift c ilshift assertEqual operator imod c imod assertEqual operator imul c imul assertEqual operator imatmul c imatmul assertEqual operator ior c ior assertEqual operator ipow c ipow assertEqual operator irshift c irshift assertEqual operator isub c isub assertEqual operator itruediv c itruediv assertEqual operator ixor c ixor assertEqual operator iconcat c c iadd test_iconcat_without_getitem operator = module msg = int object can t concatenated assertRaisesRegex TypeError msg operator iconcat test_index operator = module torch _dynamo error_on_graph_break False X __index__ assertEqual operator index X assertEqual operator index assertEqual operator index assertEqual operator index assertRaises AttributeError TypeError operator index assertRaises AttributeError TypeError operator index Fraction assertRaises AttributeError TypeError operator index Decimal assertRaises AttributeError TypeError operator index None test_not_ operator = module torch _dynamo error_on_graph_break False C __bool__ raise SyntaxError assertRaises TypeError operator not_ assertRaises SyntaxError operator not_ C assertFalse operator not_ assertFalse operator not_ assertTrue operator not_ assertTrue operator not_ test_length_hint operator = module torch _dynamo error_on_graph_break False X object __init__ value value = value __length_hint__ type value type raise value value assertEqual operator length_hint assertEqual operator length_hint iter assertEqual operator length_hint X assertEqual operator length_hint X NotImplemented assertEqual operator length_hint X TypeError assertRaises TypeError operator length_hint X abc assertRaises ValueError operator length_hint X - assertRaises LookupError operator length_hint X LookupError torch _dynamo error_on_graph_break False Y pass msg = str object cannot interpreted integer assertRaisesRegex TypeError msg operator length_hint X abc assertEqual operator length_hint Y test_call operator = module func args kwargs args kwargs assertEqual operator call func assertEqual operator call func assertEqual operator call func a= obj= obj assertEqual operator call func a= obj= obj test_dunder_is_original operator = module names = name name dir operator name startswith _ name names orig = getattr operator name dunder = getattr operator __ + name strip _ + __ None dunder assertIs dunder orig support requires_docstrings test_attrgetter_signature operator = module sig = inspect signature operator attrgetter assertEqual str sig attr attrs sig = inspect signature operator attrgetter x z y assertEqual str sig obj support requires_docstrings test_itemgetter_signature operator = module sig = inspect signature operator itemgetter assertEqual str sig item items sig = inspect signature operator itemgetter assertEqual str sig obj support requires_docstrings test_methodcaller_signature operator = module sig = inspect signature operator methodcaller assertEqual str sig name args kwargs sig = inspect signature operator methodcaller foo y= assertEqual str sig obj PyOperatorTestCase OperatorTestCase __TestCase module = py_operator unittest skipUnless c_operator requires _operator COperatorTestCase OperatorTestCase __TestCase module = c_operator OperatorPickleTestCase copy obj proto support swap_item sys modules operator module pickled = pickle dumps obj proto support swap_item sys modules operator module pickle loads pickled test_attrgetter attrgetter = module attrgetter torch _dynamo error_on_graph_break False A pass = A x = X y = Y z = Z t = A t u = A t u v = V proto range pickle HIGHEST_PROTOCOL + subTest proto=proto f = attrgetter x f = copy f proto assertEqual repr f repr f assertEqual f f multiple gets f = attrgetter x y z f = copy f proto assertEqual repr f repr f assertEqual f f recursive gets f = attrgetter t u v f = copy f proto assertEqual repr f repr f assertEqual f f test_itemgetter itemgetter = module itemgetter = ABCDE proto range pickle HIGHEST_PROTOCOL + subTest proto=proto f = itemgetter f = copy f proto assertEqual repr f repr f assertEqual f f multiple gets f = itemgetter f = copy f proto assertEqual repr f repr f assertEqual f f test_methodcaller methodcaller = module methodcaller torch _dynamo error_on_graph_break False A foo args kwds args + args bar f= f baz args kwds kwds name kwds = A proto range pickle HIGHEST_PROTOCOL + subTest proto=proto f = methodcaller bar f = copy f proto assertEqual repr f repr f assertEqual f f positional args f = methodcaller foo f = copy f proto assertEqual repr f repr f assertEqual f f keyword args f = methodcaller bar f= f = copy f proto assertEqual repr f repr f assertEqual f f f = methodcaller baz self= eggs name= spam f = copy f proto Can t test repr consistently multiple keyword args assertEqual f f PyPyOperatorPickleTestCase OperatorPickleTestCase __TestCase module = py_operator module = py_operator unittest skipUnless c_operator requires _operator PyCOperatorPickleTestCase OperatorPickleTestCase __TestCase module = py_operator module = c_operator unittest skipUnless c_operator requires _operator CPyOperatorPickleTestCase OperatorPickleTestCase __TestCase module = c_operator module = py_operator unittest skipUnless c_operator requires _operator CCOperatorPickleTestCase OperatorPickleTestCase __TestCase module = c_operator module = c_operator __name__ == __main__ run_tests