Owner s oncall jit os sys typing Any Dict List torch torch testing _internal common_utils raise_on_run_directly torch testing _internal jit_utils JitTestCase Make helper files test importable pytorch_test_dir = os path dirname os path dirname os path realpath __file__ sys path append pytorch_test_dir TestModuleAPIs JitTestCase test_default_state_dict_methods Tests default state dict methods automatically available DefaultStateDictModule torch nn Module __init__ - None super __init__ conv = torch nn Conv d fc = torch nn Linear forward x x = conv x x = fc x x m = torch jit script DefaultStateDictModule m = torch jit script DefaultStateDictModule state_dict = m state_dict m load_state_dict state_dict test_customized_state_dict_methods Tests customized state dict methods effect CustomStateDictModule torch nn Module __init__ - None super __init__ conv = torch nn Conv d fc = torch nn Linear customized_save_state_dict_called bool = False customized_load_state_dict_called bool = False forward x x = conv x x = fc x x torch jit export _save_to_state_dict destination Dict str torch Tensor prefix str keep_vars bool customized_save_state_dict_called = True dummy torch ones torch jit export _load_from_state_dict state_dict Dict str torch Tensor prefix str local_metadata Any strict bool missing_keys List str unexpected_keys List str error_msgs List str customized_load_state_dict_called = True m = torch jit script CustomStateDictModule assertFalse m customized_save_state_dict_called state_dict = m state_dict assertTrue m customized_save_state_dict_called m = torch jit script CustomStateDictModule assertFalse m customized_load_state_dict_called m load_state_dict state_dict assertTrue m customized_load_state_dict_called test_submodule_customized_state_dict_methods Tests customized state dict methods submodules effect CustomStateDictModule torch nn Module __init__ - None super __init__ conv = torch nn Conv d fc = torch nn Linear customized_save_state_dict_called bool = False customized_load_state_dict_called bool = False forward x x = conv x x = fc x x torch jit export _save_to_state_dict destination Dict str torch Tensor prefix str keep_vars bool customized_save_state_dict_called = True dummy torch ones torch jit export _load_from_state_dict state_dict Dict str torch Tensor prefix str local_metadata Any strict bool missing_keys List str unexpected_keys List str error_msgs List str customized_load_state_dict_called = True ParentModule torch nn Module __init__ - None super __init__ sub = CustomStateDictModule forward x sub x m = torch jit script ParentModule assertFalse m sub customized_save_state_dict_called state_dict = m state_dict assertTrue m sub customized_save_state_dict_called m = torch jit script ParentModule assertFalse m sub customized_load_state_dict_called m load_state_dict state_dict assertTrue m sub customized_load_state_dict_called __name__ == __main__ raise_on_run_directly test test_jit py