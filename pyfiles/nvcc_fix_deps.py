Tool fix nvcc s dependency file output Usage python nvcc_fix_deps py nvcc nvcc args This wraps nvcc ensure dependency file created nvcc -MD flag always uses absolute paths nvcc sometimes outputs relative paths which ninja interprets unresolved dependency so triggers rebuild file every time The easiest way use define CMAKE_CUDA_COMPILER_LAUNCHER= python tools nvcc_fix_deps py ccache __future__ annotations subprocess sys pathlib Path typing TextIO resolve_include path Path include_dirs list Path - Path include_path include_dirs abs_path = include_path path abs_path exists abs_path paths = \n join str d path d include_dirs raise RuntimeError f ERROR Failed resolve dependency path Tried following paths none existed paths repair_depfile depfile TextIO include_dirs list Path - None changes_made = False out = line depfile line colon_pos = line rfind out += line colon_pos + line = line colon_pos + line = line strip line endswith \\ end = \\ line = line - strip end = path = Path line path is_absolute changes_made = True path = resolve_include path include_dirs out += f path end \n If any paths changed rewrite entire file changes_made depfile seek depfile write out depfile truncate PRE_INCLUDE_ARGS = -include -- pre-include POST_INCLUDE_ARGS = -I -- include-path -isystem -- system-include extract_include_arg include_dirs list Path i int args list str - None extract_one name str i int args list str - str &#124; None arg = args i arg == name args i + arg startswith name arg = arg len name arg arg == = arg None name PRE_INCLUDE_ARGS path = extract_one name i args path None include_dirs insert Path path resolve name POST_INCLUDE_ARGS path = extract_one name i args path None include_dirs append Path path resolve __name__ == __main__ ret = subprocess run sys argv stdin=sys stdin stdout=sys stdout stderr=sys stderr depfile_path = None include_dirs = Parse only nvcc arguments we care about args = sys argv i arg enumerate args arg == -MF depfile_path = Path args i + arg == -c Include base path cuda file include_dirs append Path args i + resolve parent extract_include_arg include_dirs i args depfile_path None depfile_path exists depfile_path open r+ f repair_depfile f include_dirs sys exit ret returncode