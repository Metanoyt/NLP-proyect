Copyright c Meta Platforms Inc affiliates All rights reserved This source code licensed under BSD-style license found LICENSE file root directory source tree torch torch _higher_order_ops auto_functionalize auto_functionalized auto_functionalized_v torch _inductor fx_passes post_grad decompose_auto_functionalized torch export ExportedProgram torch fx Graph remove_self_clone graph Graph - None node graph nodes node target torch ops aten copy_ default node args == node args node replace_all_uses_with node args graph erase_node node unsafe_remove_auto_functionalized_pass ep ExportedProgram - ExportedProgram This pass removes instances higher order op auto_functionalized modifies calling EP inplace have original mutator op This pass doesn t perform safety checks make sure inplace mutation safe ep graph_module _set_replace_hook ep graph_signature get_replace_hook module ep graph_module modules isinstance module torch fx GraphModule continue node ep graph nodes node op == call_function node target auto_functionalized node op == call_function node target auto_functionalized_v func = node args assert isinstance func torch _ops OpOverload re-inplace everything node meta only_clone_these_tensors = decompose_auto_functionalized ep graph remove_self_clone ep graph ep graph eliminate_dead_code ep