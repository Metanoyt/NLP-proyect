Owner s oncall jit torch torch _lazy metrics metrics torch _lazy ts_backend torch testing _internal common_utils run_tests skipIfTorchDynamo TestCase torch _lazy ts_backend init LazyGeneratorTest TestCase test_generator Test generators being inserted into TorchScript graph setting different seeds before each call generate_tensor resulting tensor same generate_tensor g = torch Generator g manual_seed t = torch tensor t uniform_ generator=g g = torch Generator g manual_seed t = torch tensor t normal_ generator=g t t torch manual_seed torch device cpu cpu_t cpu_t = generate_tensor torch manual_seed torch device lazy lazy_t lazy_t = generate_tensor torch _lazy mark_step assert torch allclose cpu_t lazy_t cpu f Expected cpu_t got lazy_t cpu assert torch allclose cpu_t lazy_t cpu f Expected cpu_t got lazy_t cpu skipIfTorchDynamo Torch Dynamo does support torch Generator type test_generator_causes_multiple_compiles Test inserting generators different seed caused recompile generate_tensor seed t = torch tensor g = torch Generator g manual_seed seed t uniform_ - generator=g t metrics reset torch device lazy t = generate_tensor torch _lazy mark_step uncached_compile = metrics counter_value UncachedCompile assert uncached_compile == f Expected uncached compiles got uncached_compile t = generate_tensor torch _lazy mark_step uncached_compile = metrics counter_value UncachedCompile assert uncached_compile == f Expected uncached compiles got uncached_compile t = generate_tensor noqa F torch _lazy mark_step uncached_compile = metrics counter_value UncachedCompile assert uncached_compile == f Expected uncached compiles got uncached_compile cached_compile = metrics counter_value CachedCompile assert cached_compile == f Expected cached compile got cached_compile metrics reset latest_graph = torch _C _lazy_ts_backend _get_latest_computation_graph assert torch Generator device= cpu seed= latest_graph assert aten uniform latest_graph __name__ == __main__ run_tests