os unittest datetime datetime unittest mock MagicMock patch os environ GITHUB_TOKEN = test_token delete_old_branches delete_old_tags patch delete_old_branches delete_branch patch gitutils GitRepo _run_git TestDeleteTag unittest TestCase test_delete_tag mock_run_git MagicMock mock_delete_tag MagicMock - None tag ciflow branch ciflow commitsha abcdef abcdef trunk abcdef abcdef mock_run_git side_effect = tag str int datetime now timestamp - days ago delete_old_tags mock_delete_tag assert_called_once mock_delete_tag reset_mock Don t delete tag old enough mock_run_git side_effect = tag str int datetime now timestamp - days ago delete_old_tags mock_delete_tag assert_not_called test_do_not_delete_tag mock_run_git MagicMock mock_delete_tag MagicMock - None tag ciflow doesntseemtomatch trunk doesntseemtomatch doesntseemtomatch mock_run_git side_effect = tag str int datetime now timestamp - days ago delete_old_tags mock_delete_tag assert_not_called __name__ == __main__ unittest main