argparse sys pathlib Path pytest_caching_utils download_pytest_cache GithubRepo PRIdentifier upload_pytest_cache TEMP_DIR = tmp backup location case one isn t provided parse_args - argparse Namespace parser = argparse ArgumentParser description= Upload job s pytest cache S mode = parser add_mutually_exclusive_group required=True mode add_argument -- upload action= store_true help= Upload pytest cache S mode add_argument -- download action= store_true help= Download pytest cache S merging any local cache parser add_argument -- cache_dir required=True help= Path folder pytest uses its cache parser add_argument -- pr_identifier required=True help= A unique PR identifier parser add_argument -- job_identifier required=True help= A unique job identifier should same all runs job parser add_argument -- sha required= -- upload sys argv help= SHA commit Only required upload parser add_argument -- test_config required= -- upload sys argv help= The test config Only required upload parser add_argument -- shard required= -- upload sys argv help= The shard id Only required upload parser add_argument -- repo required=False help= The github repository we re running format owner repo-name parser add_argument -- temp_dir required=False help= Directory store temp files parser add_argument -- bucket required=False help= The S bucket upload cache args = parser parse_args args main - None args = parse_args pr_identifier = PRIdentifier args pr_identifier print f PR identifier ` args pr_identifier ` ` pr_identifier ` repo = GithubRepo from_string args repo cache_dir = Path args cache_dir args temp_dir temp_dir = Path args temp_dir temp_dir = Path TEMP_DIR args upload print f Uploading cache args args verify cache dir exists cache_dir exists print f The pytest cache dir ` cache_dir ` does exist Skipping upload upload_pytest_cache pr_identifier=pr_identifier repo=repo job_identifier=args job_identifier sha=args sha test_config=args test_config shard=args shard cache_dir=cache_dir bucket=args bucket temp_dir=temp_dir args download print f Downloading cache args args download_pytest_cache pr_identifier=pr_identifier repo=repo job_identifier=args job_identifier dest_cache_dir=cache_dir bucket=args bucket temp_dir=temp_dir __name__ == __main__ main