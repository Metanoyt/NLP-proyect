usr bin env python argparse os subprocess pathlib Path common get_testcases is_failure is_passing_skipped_test is_unexpected_success key open_test_results download_reports download_reports Usage update_failures py path dynamo_test_failures py path test commit_sha Best-effort updates xfail skip files under test directory parsing test reports You ll need provide commit_sha latest commit PR which we will pull CI test results Instructions - On your PR add keep-going label ensure all tests failing opposed CI stopping first failure You may need restart your test jobs force-pushing your branch CI pick up keep-going label - Wait all tests finish running - Find full SHA your commit run command This script requires ` gh ` cli You ll need install then authenticate via ` gh auth login ` before using script https docs github com en github-cli github-cli quickstart patch_file filename test_dir unexpected_successes new_xfails new_skips unexpected_skips failures_directory = os path join test_dir dynamo_expected_failures skips_directory = os path join test_dir dynamo_skips dynamo_expected_failures = set os listdir failures_directory dynamo_skips = set os listdir skips_directory These hand written skips extra_dynamo_skips = set open filename f start = False text f readlines text = text strip start text == break extra_dynamo_skips add text strip text == extra_dynamo_skips = start = True format testcase classname = testcase attrib classname name = testcase attrib name f classname name formatted_unexpected_successes = f format test test unexpected_successes values formatted_unexpected_skips = f format test test unexpected_skips values formatted_new_xfails = f format test test new_xfails values formatted_new_skips = f format test test new_skips values remove_file path name file = os path join path name cmd = git rm file subprocess run cmd add_file path name file = os path join path name open file w fp pass cmd = git add file subprocess run cmd covered_unexpected_successes = set dynamo_expected_failures test dynamo_expected_failures test formatted_unexpected_successes covered_unexpected_successes add test remove_file failures_directory test test formatted_new_xfails add_file failures_directory test leftover_unexpected_successes = formatted_unexpected_successes - covered_unexpected_successes len leftover_unexpected_successes print WARNING we unable remove these f len leftover_unexpected_successes expectedFailures stuff leftover_unexpected_successes print stuff dynamo_skips test dynamo_skips test formatted_unexpected_skips remove_file skips_directory test test extra_dynamo_skips test formatted_unexpected_skips print f WARNING test dynamo_test_failures py needs removed manually test formatted_new_skips add_file skips_directory test get_intersection_and_outside a_dict b_dict = set a_dict keys b = set b_dict keys intersection = intersection b outside = union b - intersection build_dict keys result = k keys k a_dict result k = a_dict k result k = b_dict k result build_dict intersection build_dict outside update filename test_dir py _dir py _dir also_remove_skips read_test_results directory xmls = open_test_results directory testcases = get_testcases xmls unexpected_successes = key test test test testcases is_unexpected_success test failures = key test test test testcases is_failure test passing_skipped_tests = key test test test testcases is_passing_skipped_test test unexpected_successes failures passing_skipped_tests py _unexpected_successes py _failures py _passing_skipped_tests = read_test_results py _dir py _unexpected_successes py _failures py _passing_skipped_tests = read_test_results py _dir unexpected_successes = py _unexpected_successes py _unexpected_successes _ skips = get_intersection_and_outside py _unexpected_successes py _unexpected_successes xfails more_skips = get_intersection_and_outside py _failures py _failures also_remove_skips unexpected_skips _ = get_intersection_and_outside py _passing_skipped_tests py _passing_skipped_tests unexpected_skips = all_skips = skips more_skips print f Discovered len unexpected_successes new unexpected successes f len xfails new xfails len all_skips new skips len unexpected_skips new unexpected skips patch_file filename test_dir unexpected_successes xfails all_skips unexpected_skips __name__ == __main__ parser = argparse ArgumentParser prog= update_dynamo_test_failures description= Read logs update dynamo_test_failures file dynamo_test_failures path parser add_argument filename nargs= default=str Path __file__ absolute parents torch testing _internal dynamo_test_failures py help= Optional path dynamo_test_failures py test path parser add_argument test_dir nargs= default=str Path __file__ absolute parents test help= Optional path test folder parser add_argument commit help= The commit sha latest commit PR which we will pull CI test results e g e f aeeba c c f d b parser add_argument -- also-remove-skips help= Also attempt remove skips WARNING does guard against test flakiness action= store_true args = parser parse_args assert Path args filename exists args filename assert Path args test_dir exists args test_dir dynamo dynamo = download_reports args commit dynamo dynamo update args filename args test_dir dynamo dynamo args also_remove_skips