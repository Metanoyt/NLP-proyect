Owner s oncall quantization torch torch ao nn intrinsic nni torch ao nn qat nnqat torch ao nn quantized reference nnqr torch testing _internal common_quantization QuantizationTestCase torch ao quantization backend_config BackendConfig BackendPatternConfig DTypeConfig DTypeWithConstraints ObservationType torch ao quantization fuser_method_mappings _sequential_wrapper torch ao quantization fx quantize_handler _default_root_node_getter TestBackendConfig QuantizationTestCase ============= DTypeConfig ============= dtype_config = DTypeConfig input_dtype=torch quint output_dtype=torch quint weight_dtype=torch qint bias_dtype=torch float dtype_config = DTypeConfig input_dtype=torch float output_dtype=torch float is_dynamic=True activation_dtype_with_constraints = DTypeWithConstraints dtype=torch quint quant_min_lower_bound= quant_max_upper_bound= scale_min_lower_bound= - weight_dtype_with_constraints = DTypeWithConstraints dtype=torch qint quant_min_lower_bound=- quant_max_upper_bound= scale_min_lower_bound= - dtype_config = DTypeConfig input_dtype=activation_dtype_with_constraints output_dtype=activation_dtype_with_constraints weight_dtype=weight_dtype_with_constraints dtype_config_dict _legacy = input_dtype torch quint output_dtype torch quint weight_dtype torch qint bias_dtype torch float dtype_config_dict _legacy = input_dtype torch float output_dtype torch float is_dynamic True dtype_config_dict = input_dtype DTypeWithConstraints dtype=torch quint output_dtype DTypeWithConstraints torch quint weight_dtype DTypeWithConstraints torch qint bias_dtype torch float dtype_config_dict = input_dtype DTypeWithConstraints dtype=torch float output_dtype DTypeWithConstraints dtype=torch float is_dynamic True dtype_config_dict = input_dtype activation_dtype_with_constraints output_dtype activation_dtype_with_constraints weight_dtype weight_dtype_with_constraints test_dtype_config_from_dict assertEqual DTypeConfig from_dict dtype_config_dict _legacy dtype_config assertEqual DTypeConfig from_dict dtype_config_dict _legacy dtype_config assertEqual DTypeConfig from_dict dtype_config_dict dtype_config assertEqual DTypeConfig from_dict dtype_config_dict dtype_config assertEqual DTypeConfig from_dict dtype_config_dict dtype_config test_dtype_config_to_dict assertEqual dtype_config to_dict dtype_config_dict assertEqual dtype_config to_dict dtype_config_dict assertEqual dtype_config to_dict dtype_config_dict ====================== BackendPatternConfig ====================== _fuser_method = _sequential_wrapper nni LinearReLU _num_tensor_args_to_observation_type = ObservationType OUTPUT_USE_DIFFERENT_OBSERVER_AS_INPUT ObservationType OUTPUT_SHARE_OBSERVER_WITH_INPUT ObservationType OUTPUT_USE_DIFFERENT_OBSERVER_AS_INPUT _input_type_to_index = bias input weight _extra_inputs_getter p torch rand _get_backend_op_config BackendPatternConfig torch nn Linear torch nn ReLU \ set_observation_type ObservationType OUTPUT_USE_DIFFERENT_OBSERVER_AS_INPUT \ add_dtype_config dtype_config \ add_dtype_config dtype_config \ set_root_module torch nn Linear \ set_qat_module nnqat Linear \ set_reference_quantized_module nnqr Linear \ set_fused_module nni LinearReLU \ set_fuser_method _fuser_method _get_backend_op_config BackendPatternConfig torch add \ add_dtype_config dtype_config \ _set_root_node_getter _default_root_node_getter \ _set_extra_inputs_getter _extra_inputs_getter \ _set_num_tensor_args_to_observation_type _num_tensor_args_to_observation_type \ _set_input_type_to_index _input_type_to_index _get_backend_pattern_config_dict pattern torch nn Linear torch nn ReLU observation_type ObservationType OUTPUT_USE_DIFFERENT_OBSERVER_AS_INPUT dtype_configs dtype_config_dict dtype_config_dict root_module torch nn Linear qat_module nnqat Linear reference_quantized_module_for_root nnqr Linear fused_module nni LinearReLU fuser_method _fuser_method _get_backend_pattern_config_dict pattern torch add observation_type ObservationType OUTPUT_USE_DIFFERENT_OBSERVER_AS_INPUT dtype_configs dtype_config_dict root_node_getter _default_root_node_getter extra_inputs_getter _extra_inputs_getter num_tensor_args_to_observation_type _num_tensor_args_to_observation_type input_type_to_index _input_type_to_index test_backend_op_config_set_observation_type conf = BackendPatternConfig torch nn Linear assertEqual conf observation_type ObservationType OUTPUT_USE_DIFFERENT_OBSERVER_AS_INPUT conf set_observation_type ObservationType OUTPUT_SHARE_OBSERVER_WITH_INPUT assertEqual conf observation_type ObservationType OUTPUT_SHARE_OBSERVER_WITH_INPUT test_backend_op_config_add_dtype_config conf = BackendPatternConfig torch nn Linear assertEqual len conf dtype_configs conf add_dtype_config dtype_config conf add_dtype_config dtype_config assertEqual len conf dtype_configs assertEqual conf dtype_configs dtype_config assertEqual conf dtype_configs dtype_config test_backend_op_config_set_root_module conf = BackendPatternConfig nni LinearReLU assertTrue conf root_module None conf set_root_module torch nn Linear assertEqual conf root_module torch nn Linear test_backend_op_config_set_qat_module conf = BackendPatternConfig torch nn Linear assertTrue conf qat_module None conf set_qat_module nnqat Linear assertEqual conf qat_module nnqat Linear test_backend_op_config_set_reference_quantized_module conf = BackendPatternConfig torch nn Linear assertTrue conf reference_quantized_module None conf set_reference_quantized_module nnqr Linear assertEqual conf reference_quantized_module nnqr Linear test_backend_op_config_set_fused_module conf = BackendPatternConfig torch nn Linear torch nn ReLU assertTrue conf fused_module None conf set_fused_module nni LinearReLU assertEqual conf fused_module nni LinearReLU test_backend_op_config_set_fuser_method conf = BackendPatternConfig torch nn Linear torch nn ReLU assertTrue conf fuser_method None conf set_fuser_method _fuser_method assertEqual conf fuser_method _fuser_method test_backend_op_config_set_root_node_getter conf = BackendPatternConfig torch nn Linear torch nn ReLU assertTrue conf _root_node_getter None conf _set_root_node_getter _default_root_node_getter assertEqual conf _root_node_getter _default_root_node_getter test_backend_op_config_set_extra_inputs_getter conf = BackendPatternConfig torch nn Linear assertTrue conf _extra_inputs_getter None conf _set_extra_inputs_getter _extra_inputs_getter assertEqual conf _extra_inputs_getter _extra_inputs_getter test_backend_op_config_set_num_tensor_args_to_observation_type conf = BackendPatternConfig torch add assertEqual len conf _num_tensor_args_to_observation_type conf _set_num_tensor_args_to_observation_type _num_tensor_args_to_observation_type assertEqual conf _num_tensor_args_to_observation_type _num_tensor_args_to_observation_type test_backend_op_config_set_input_type_to_index conf = BackendPatternConfig torch addmm assertEqual len conf _input_type_to_index conf _set_input_type_to_index _input_type_to_index assertEqual conf _input_type_to_index _input_type_to_index test_backend_op_config_from_dict conf_dict = _get_backend_pattern_config_dict conf = BackendPatternConfig from_dict conf_dict assertEqual conf pattern torch nn Linear torch nn ReLU assertEqual conf observation_type ObservationType OUTPUT_USE_DIFFERENT_OBSERVER_AS_INPUT assertEqual conf root_module torch nn Linear assertEqual conf qat_module nnqat Linear assertEqual conf reference_quantized_module nnqr Linear assertEqual conf fused_module nni LinearReLU assertEqual conf fuser_method _fuser_method assertTrue conf _root_node_getter None assertTrue conf _extra_inputs_getter None assertEqual len conf _num_tensor_args_to_observation_type assertEqual len conf _input_type_to_index Test temporary internal keys conf_dict = _get_backend_pattern_config_dict conf = BackendPatternConfig from_dict conf_dict assertEqual conf pattern torch add assertEqual conf observation_type ObservationType OUTPUT_USE_DIFFERENT_OBSERVER_AS_INPUT assertTrue conf root_module None assertTrue conf qat_module None assertTrue conf reference_quantized_module None assertTrue conf fused_module None assertTrue conf fuser_method None assertEqual conf _root_node_getter _default_root_node_getter assertEqual conf _extra_inputs_getter _extra_inputs_getter assertEqual conf _num_tensor_args_to_observation_type _num_tensor_args_to_observation_type assertEqual conf _input_type_to_index _input_type_to_index test_backend_op_config_to_dict conf = _get_backend_op_config conf = _get_backend_op_config conf_dict = _get_backend_pattern_config_dict conf_dict = _get_backend_pattern_config_dict assertEqual conf to_dict conf_dict assertEqual conf to_dict conf_dict =============== BackendConfig =============== test_backend_config_set_name conf = BackendConfig name assertEqual conf name name conf set_name name assertEqual conf name name test_backend_config_set_backend_pattern_config conf = BackendConfig name assertEqual len conf configs backend_op_config = _get_backend_op_config backend_op_config = _get_backend_op_config conf set_backend_pattern_config backend_op_config assertEqual conf _pattern_complex_format_to_config torch nn ReLU torch nn Linear backend_op_config conf set_backend_pattern_config backend_op_config assertEqual conf _pattern_complex_format_to_config torch nn ReLU torch nn Linear backend_op_config torch add backend_op_config test_backend_config_from_dict op_dict = _get_backend_pattern_config_dict op_dict = _get_backend_pattern_config_dict conf_dict = name name configs op_dict op_dict conf = BackendConfig from_dict conf_dict assertEqual conf name name assertEqual len conf configs key = torch nn ReLU torch nn Linear key = torch add assertTrue key conf _pattern_complex_format_to_config assertTrue key conf _pattern_complex_format_to_config assertEqual conf _pattern_complex_format_to_config key to_dict op_dict assertEqual conf _pattern_complex_format_to_config key to_dict op_dict test_backend_config_to_dict op = _get_backend_op_config op = _get_backend_op_config op_dict = _get_backend_pattern_config_dict op_dict = _get_backend_pattern_config_dict conf = BackendConfig name set_backend_pattern_config op set_backend_pattern_config op conf_dict = name name configs op_dict op_dict assertEqual conf to_dict conf_dict __name__ == __main__ raise RuntimeError This _test file meant run directly use \n\n \tpython _test _test_quantization py TESTNAME\n\n instead