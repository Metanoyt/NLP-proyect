mypy allow-untyped-defs torch fx experimental migrate_gradual_types operation op_add op_div op_eq op_gt op_lt op_mod op_mul op_neq op_sub torch fx tensor_type Dyn TensorType Constraint pass Conj Constraint __init__ conjuncts param conjuncts Conjunction constraints conjucts = conjuncts __eq__ other isinstance other Conj conjucts == other conjucts conjucts == other conjucts False __repr__ f And conjucts Disj Constraint __init__ disjuncts param disjuncts Disjunction constraints disjuncts = disjuncts __eq__ other isinstance other Disj disjuncts == other disjuncts disjuncts == other disjuncts False __repr__ f Or disjuncts Prod Constraint __init__ products param products lists dimensions multiply products = products __eq__ other isinstance other Prod products == other products products == other products False __repr__ f Product products T Constraint True __init__ - None pass __eq__ other isinstance other T __repr__ True F Constraint False __init__ - None pass __eq__ other isinstance other F __repr__ False BinaryConstraint Constraint Represents all binary operations __init__ lhs rhs op param lhs lhs constraint param rhs rhs constraint param op string representing operation lhs = lhs rhs = rhs op = op __eq__ other isinstance other BinaryConstraint lhs == other lhs rhs == other rhs op == other op False __repr__ f lhs op rhs BinConstraintT BinaryConstraint Binary constraints about tensors __init__ lhs rhs op assert isinstance lhs TVar TensorType int lhs == Dyn isinstance rhs TVar TensorType int rhs == Dyn super __init__ lhs rhs op __eq__ other super __eq__ other BinConstraintD BinaryConstraint Binary constraints about dimensions __init__ lhs rhs op assert is_algebraic_expression lhs is_dim lhs is_bool_expr lhs assert is_algebraic_expression rhs is_dim rhs is_bool_expr rhs super __init__ lhs rhs op __eq__ other super __eq__ other TGreatestUpperBound Constraint Greatest Upper bound tensors dynamic type __init__ res rhs rhs param res tensor variable stores result output param rhs tensor tensor variable param rhs tensor tensor variabke res = res rhs = rhs rhs = rhs __repr__ f res = rhs \u rhs __eq__ other isinstance other TGreatestUpperBound res == other res rhs == other rhs rhs == other rhs False DGreatestUpperBound Constraint Greatest Upper bound dimensions __init__ res rhs rhs param res Dimension variable store result param rhs dimension variable param rhs dimension variable assert is_dim res assert is_dim rhs assert is_dim rhs res = res rhs = rhs rhs = rhs __repr__ f res = rhs \u rhs __eq__ other isinstance other DGreatestUpperBound res == other res rhs == other rhs rhs == other rhs False CanReshape Constraint can_reshape constraint __init__ src target param src tensor variable param target tensor src = src target = target __repr__ f can-reshape src target __eq__ other isinstance other CanReshape src == other src target == other target False IndexSelect Constraint __init__ tensor_size input_var dim_replace index output Args input_var input index_select tensor_size tensor size we considering dim_replace dimension output index index location dimensions replace input output variable store result assert isinstance input_var TVar assert isinstance output TVar assert isinstance dim_replace DVar dim_replace == Dyn assert isinstance index int input_var = input_var tensor_size = tensor_size dim_replace = dim_replace index = index output = output __repr__ f output = f IndexSelect input_var f tensor_size tensor_size f dim_replace f index __eq__ other isinstance other IndexSelect tensor_size == other tensor_size dim_replace == other dim_replace index == other index output == other output input_var == other input_var False Transpose Constraint __init__ tensor_size input_var index index output Args tensor_size current tensor size input_var variable hold input index dimension index dimension output output stores result assert isinstance input_var TVar assert isinstance output TVar assert isinstance index int assert isinstance index int input_var = input_var tensor_size = tensor_size index = index index = index output = output __repr__ f output = f Transpose input_var f tensor_size tensor_size f index f index __eq__ other isinstance other Transpose tensor_size == other tensor_size index == other index index == other index output == other output input_var == other input_var False GetItem Constraint __init__ tensor_size index res input_var Constraint getting item given tensor size param tensor_size actual number param index actual number representing index param res dimension variable carry item we get param input_var tensor variable which we will get item assert isinstance res DVar res = res tensor_size = tensor_size index = index input_var = input_var __repr__ f res = GetItem input_var tensor_size tensor_size index __eq__ other isinstance other GetItem res == other res tensor_size == other tensor_size index == other index input_var == other input_var False GetItemTensor Constraint __init__ tensor_size index_tuple res input_var Constraint getting item given tensor size However when argument tuple we will expect tensor param tensor_size actual number representing rank param index_tuple tuple indexing param res tensor variable carry item we get param input_var tensor variable which we will get item assert isinstance res TVar res = res tensor_size = tensor_size index_tuple = index_tuple input_var = input_var __repr__ f res = GetItemT input_var tensor_size tensor_size index_tuple __eq__ other isinstance other GetItemTensor res == other res tensor_size == other tensor_size index_tuple == other index_tuple input_var == other input_var False CalcConv Constraint __init__ conv_result input_var c_out kernel padding stride dilation matching_constraint_vars param conv_result convolution result param input_var input convolution param c_out output channel type param kernel kernel tuple conv_result = conv_result input_var = input_var c_out = c_out kernel = kernel padding = padding stride = stride dilation = dilation matching_constraint = matching_constraint_vars __repr__ f conv_result = f calc-conv input_var f c_out kernel f padding stride f dilation __eq__ other isinstance other CalcConv conv_result == other conv_result input_var == other input_var c_out == other c_out kernel == other kernel padding == other padding stride == other stride dilation == other dilation matching_constraint == other matching_constraint False CalcMaxPool Constraint __init__ maxpool_result input_var kernel padding stride dilation matching_constraint_vars param maxpool_result result maxpool param input_var input convolution param kernel kernel tuple maxpool_result = maxpool_result input_var = input_var kernel = kernel padding = padding stride = stride dilation = dilation matching_constraint = matching_constraint_vars __repr__ f maxpool_result = f calc-maxpool input_var f kernel f padding stride f dilation __eq__ other isinstance other CalcMaxPool maxpool_result == other maxpool_result input_var == other input_var kernel == other kernel padding == other padding stride == other stride dilation == other dilation matching_constraint == other matching_constraint False ApplyBroadcasting Constraint __init__ res res input input param res resulting tensor param res resulting tensor param input tensor variable param input tensor variable res = res res = res input = input input = input __eq__ other isinstance other ApplyBroadcasting res == other res res == other res input == other input input == other input False __repr__ f res res = f apply-broadcasting input f input CalcProduct Constraint Given correct dimensions calculate product flatten accounting Dyn __init__ start end flattened dims_to_flatten param start start index param end end index param flattened variable store product param dims_to_flatten type which we will flatten assert isinstance dims_to_flatten list assert isinstance flattened TVar assert isinstance start int assert isinstance end int start = start end = end dims_to_flatten = dims_to_flatten flattened = flattened __eq__ other isinstance other CalcProduct start == other start end == other end dims_to_flatten == other dims_to_flatten flattened == other flattened False __repr__ f flattened = CalcProduct start end dims_to_flatten TVar Tensor variable no tensor constructor __init__ tvar param tvar tensor variable tvar = tvar __repr__ f TV tvar __eq__ other isinstance other TVar tvar == other tvar False DVar Dimension variable __init__ c param c character number c = c __repr__ f DV c __eq__ other isinstance other DVar c == other c False BVar Boolean variable __init__ c param c character number c = c __repr__ f BV c __eq__ other isinstance other BVar c == other c False is_algebraic_expression constraint isinstance constraint BinConstraintD constraint op op_add op_sub op_div op_mul op_mod isinstance constraint Prod is_bool_expr constraint isinstance constraint BinConstraintD constraint op op_gt op_lt op_neq op_eq isinstance constraint BVar Conj Disj is_dim d isinstance d DVar int d == Dyn