Owner s oncall jit contextlib os sys unittest torch Make helper files test importable pytorch_test_dir = os path dirname os path dirname os path realpath __file__ sys path append pytorch_test_dir torch testing _internal common_utils IS_FBCODE set_default_dtype suppress_warnings torch testing _internal jit_metaprogramming_utils get_all_nn_module_tests get_nn_functional_compiled_fn_and_inputs get_nn_functional_tests get_nn_mod_test_name try_get_nn_module_compiled_mod_and_inputs torch testing _internal jit_utils enable_profiling_mode JitTestCase num_ifs_loops graph graph_str = str graph only look body graph graph_body = graph_str graph_str find graph_body count prim Loop + graph_body count prim If num_non_tensor_nodes block num_non_tensor = node block nodes kind = node kind GetAttr don t provide useful signal here since they non-optimizable except freezing Constant executed bailouts should separate tests don t provide useful signal here kind == prim Constant prim Bailout kind GetAttr kind continue b node blocks num_non_tensor += num_non_tensor_nodes b tensor_out = False out node outputs Tensor str out type tensor_out = True break num_non_tensor += int tensor_out num_non_tensor TestComplexity JitTestCase setUp super setUp grad_enabled = torch is_grad_enabled torch set_grad_enabled False _stack = contextlib ExitStack _stack enter_context set_default_dtype torch double tearDown _stack close torch set_grad_enabled grad_enabled super tearDown suppress_warnings test_generated_functional_tests enable_profiling_mode stats = Name Ifs Loops non-tensor ops test get_nn_functional_tests test_name = test fn inputs = get_nn_functional_compiled_fn_and_inputs test _ range fn inputs g = torch jit last_executed_optimized_graph stats append test_name num_ifs_loops g num_non_tensor_nodes g line stats print line suppress_warnings unittest skipIf IS_FBCODE Causes RecursionError fbcode test_nn_module_tests enable_profiling_mode stats = Name Ifs Loops non-tensor ops test get_all_nn_module_tests out = try_get_nn_module_compiled_mod_and_inputs test out continue mod inputs = out test_name = get_nn_mod_test_name test _ range mod inputs g = torch jit last_executed_optimized_graph stats append test_name num_ifs_loops g num_non_tensor_nodes g line stats print line __name__ == __main__ raise RuntimeError This test currently used should enabled discover_tests py required