Owner s module functorch unittest mock MagicMock patch torch _functorch _activation_checkpointing ac_logging_utils create_activation_checkpointing_logging_structure_payload create_joint_graph_edges create_joint_graph_node_information create_structured_trace_for_min_cut_info torch fx Graph Node torch testing _internal common_utils run_tests TestCase TestAcLogging TestCase setUp - None graph MagicMock = MagicMock spec=Graph node MagicMock = MagicMock spec=Node node MagicMock = MagicMock spec=Node node name = node node target = target node meta = tensor_meta MagicMock shape= stack_trace trace node all_input_nodes = node name = node node target = target node meta = tensor_meta None stack_trace trace node all_input_nodes = node graph nodes = node node all_recomputable_banned_nodes list Node = node saved_node_idxs list int = recomputable_node_idxs list int = expected_runtime int = memories_banned_nodes list int = normalized_memories_banned_nodes list float = runtimes_banned_nodes list int = min_cut_saved_values list Node = node test_create_joint_graph_node_information - None recomputable_node_info dict str int = node expected_output dict str dict = node index name node is_recomputable_candidate True target target shape input_arguments stack_trace trace recomputable_candidate_info recomputable_node_idx node index name node is_recomputable_candidate False target target shape input_arguments node stack_trace trace result = create_joint_graph_node_information graph recomputable_node_info assertEqual result expected_output test_create_joint_graph_edges - None expected_edges list tuple str str = node node result = create_joint_graph_edges graph assertEqual result expected_edges test_create_activation_checkpointing_logging_structure_payload - None input_joint_graph_node_information dict str dict = node index name node is_recomputable_candidate True target target shape input_arguments stack_trace trace recomputable_candidate_info recomputable_node_idx joint_graph_edges list tuple str str = node node expected_payload dict str any = Joint Graph Size Joint Graph Edges Total Edges joint_graph_edges Joint Graph Node Information input_joint_graph_node_information Recomputable Banned Nodes Order node Expected Runtime expected_runtime Knapsack Saved Nodes saved_node_idxs Knapsack Recomputed Nodes recomputable_node_idxs Knapsack Input Memories normalized_memories_banned_nodes Absolute Memories memories_banned_nodes Knapsack Input Runtimes runtimes_banned_nodes Min Cut Solution Saved Values node result = create_activation_checkpointing_logging_structure_payload joint_graph=self graph joint_graph_node_information=input_joint_graph_node_information joint_graph_edges=joint_graph_edges all_recomputable_banned_nodes=self all_recomputable_banned_nodes expected_runtime=self expected_runtime saved_node_idxs=self saved_node_idxs recomputable_node_idxs=self recomputable_node_idxs memories_banned_nodes=self memories_banned_nodes normalized_memories_banned_nodes=self normalized_memories_banned_nodes runtimes_banned_nodes=self runtimes_banned_nodes min_cut_saved_values=self min_cut_saved_values assertEqual result expected_payload patch torch _functorch _activation_checkpointing ac_logging_utils trace_structured patch json dumps return_value= mocked_payload test_create_structured_trace_for_min_cut_info mock_json_dumps MagicMock mock_trace_structured MagicMock - None create_structured_trace_for_min_cut_info joint_graph=self graph all_recomputable_banned_nodes=self all_recomputable_banned_nodes saved_node_idxs=self saved_node_idxs recomputable_node_idxs=self recomputable_node_idxs expected_runtime=self expected_runtime memories_banned_nodes=self memories_banned_nodes normalized_memories_banned_nodes=self normalized_memories_banned_nodes runtimes_banned_nodes=self runtimes_banned_nodes min_cut_saved_values=self min_cut_saved_values assertEqual mock_trace_structured call_count metadata_fn_result = mock_trace_structured call_args metadata_fn payload_fn_result = mock_trace_structured call_args payload_fn assertEqual metadata_fn_result name min_cut_information encoding json assertEqual payload_fn_result mocked_payload mock_json_dumps assert_called_once __name__ == __main__ run_tests