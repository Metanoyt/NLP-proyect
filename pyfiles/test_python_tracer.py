Owner s oncall profiler json subprocess sys time torch profiler profile ProfilerActivity torch testing _internal common_utils run_tests skipIfPythonVersionMismatch TemporaryFileName TestCase TestPythonTracer TestCase skipIfPythonVersionMismatch lambda major minor micro major == minor == test_method_with_c_function A method_with_c_function = classmethod repr get_key x A method_with_c_function time sleep len x names = Alice Bob profile activities= ProfilerActivity CPU ProfilerActivity CUDA with_stack=True prof sorted names key=get_key TemporaryFileName mode= w+ fname prof export_chrome_trace fname open fname f events = json load f traceEvents found = False event events event get cat == python_function event get name == built-in function sorted duration = event get dur duration = found = True break assertTrue found skipIfPythonVersionMismatch lambda major minor micro major == minor == test_monitoring_callback vi = sys version_info sys monitoring profile activities= ProfilerActivity CPU ProfilerActivity CUDA with_stack=True name = monitoring get_tool vi micro assertEqual name PyTorch Profiler assertEqual name None name = monitoring get_tool assertEqual name None test_unexpected_c_return_events code = threading time torch threading Event Lock lock = Lock lock acquire event = Event event = Event event = Event run event set event wait lock acquire event set threading Thread target=run start torch profiler profile activities= torch profiler ProfilerActivity CPU with_stack=True event wait event set time sleep torch profiler profile activities= torch profiler ProfilerActivity CPU with_stack=True lock release event wait result = subprocess run sys executable -c code capture_output=True text=True check=True assertFalse Python replay stack empty during pop operation result stderr __name__ == __main__ run_tests