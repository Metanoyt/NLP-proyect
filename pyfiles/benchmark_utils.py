random typing Any torch transpose_tensors p_transpose_both float = - tuple bool bool transpose_both = random choices True False p_transpose_both - p_transpose_both transpose_both True True transpose_left = True False transpose_right = False True no_transpose = False False random choices transpose_left transpose_right no_transpose fits_in_memory dtype Any m int k int n int - Any threshold_memory = torch cuda get_device_properties total_memory dividing because we otherwise sometimes run out memory I assume because inductor creates copies tensors benchmarking dtype itemsize m k + k n + m n threshold_memory get_mm_tensors m int k int n int transpose_left bool transpose_right bool dtype_left Any dtype_right Any - tuple Any Any transpose_left = torch randn k m dtype=dtype_left t = torch randn m k dtype=dtype_left transpose_right b = torch randn n k dtype=dtype_right t b = torch randn k n dtype=dtype_right b set_precision dtype Any p_float _prec_highest float = - None dtype == torch float precisions = high highest weights = - p_float _prec_highest p_float _prec_highest precision = random choices precisions weights precision = high torch set_float _matmul_precision precision get_random_between_pow min_power int max_power int - int i = random randint min_power max_power - lower = i + upper = i + - assert lower = upper lower must greater than upper random randint lower upper