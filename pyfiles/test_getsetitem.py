Owner s module functorch torch functorch dim Dim DimList dims Tensor torch testing _internal common_utils run_tests TestCase TestGetSetItem TestCase Comprehensive tests first-class dimension indexing operations setUp Set up common test fixtures batch height width = dims test_basic_dim_indexing Test basic indexing single Dim tensor = torch randn x y z = dims Test indexing each dim result = tensor x assertIsInstance result Tensor result = tensor y assertIsInstance result Tensor result = tensor z assertIsInstance result Tensor test_multiple_dim_indexing Test indexing multiple Dims tensor = torch randn x y z = dims Test multiple dims one indexing operation result = tensor x y assertIsInstance result Tensor result = tensor x y z assertIsInstance result Tensor test_mixed_indexing Test mixing Dims regular indexing tensor = torch randn x y z = dims Mix dim slice result = tensor x assertIsInstance result Tensor result = tensor y assertIsInstance result Tensor Mix dim integer result = tensor x assertIsInstance result Tensor result = tensor y assertIsInstance result Tensor test_ellipsis_indexing Test indexing ellipsis tensor = torch randn x y z w = dims Test ellipsis dims result = tensor x assertIsInstance result Tensor result = tensor y assertIsInstance result Tensor result = tensor x y assertIsInstance result Tensor test_none_indexing Test indexing None newaxis tensor = torch randn x y = dims Test None dims result = tensor x None y assertIsInstance result Tensor result = tensor None x assertIsInstance result Tensor test_slice_indexing Test indexing slices mixed dims tensor = torch randn x y z = dims Test various slice patterns dims result = tensor x assertIsInstance result Tensor result = tensor y assertIsInstance result Tensor result = tensor x z assertIsInstance result Tensor test_tensor_indexing Test indexing tensor indices tensor = torch randn x y z = dims Create index tensors idx = torch tensor Test tensor indexing dims result = tensor x idx assertIsInstance result Tensor result = tensor idx y assertIsInstance result Tensor test_boolean_indexing Test boolean indexing dims tensor = torch randn x y = dims Create boolean mask mask = torch tensor True False True False True Test boolean indexing result = tensor x mask assertIsInstance result Tensor test_dim_pack_indexing Test indexing dimension packs tuples lists dims tensor = torch randn Need D tensor dims Create dims dim pack b = dims Test dim pack indexing - using separate dimensions result = tensor b assertIsInstance result Tensor test_unbound_dim_binding Test automatic binding unbound dimensions during indexing tensor = torch randn x = Dim x unbound y = Dim y unbound Should automatically bind dimensions result = tensor x y assertIsInstance result Tensor assertEqual x size assertEqual y size test_dimlist_indexing Test indexing DimList objects tensor = torch randn Create bound dimlist dl = DimList dims Test dimlist indexing result = tensor dl assertIsInstance result Tensor test_unbound_dimlist_indexing Test indexing unbound DimList tensor = torch randn Create unbound dimlist dl = DimList Should bind remaining dimensions result = tensor dl assertIsInstance result Tensor test_repeated_dim_usage Test using same dim multiple times indexing tensor = torch randn x y z = dims This should trigger advanced indexing repeated dims result = tensor x x assertIsInstance result Tensor test_complex_mixed_indexing Test complex combinations different indexing types tensor = torch randn b c d e = dims Complex mixed indexing idx = torch tensor result = tensor None idx assertIsInstance result Tensor Use mask correct shape correct_mask = torch tensor True False True False False True True result = tensor correct_mask assertIsInstance result torch Tensor test_edge_cases Test edge cases boundary conditions x y z = dims Single dimension tensor vec = torch randn = Dim result = vec assertIsInstance result Tensor assertEqual size Should bind tensor size Empty tensor indexing empty = torch empty result = empty x assertIsInstance result Tensor test_error_conditions Test conditions should raise errors tensor = torch randn x y z = dims Too many indices assertRaises ValueError _ = tensor x y z indices D tensor Multiple unbound dim lists dl = DimList dl = DimList assertRaises Exception Should raise DimensionBindError _ = tensor dl dl Multiple ellipsis assertRaises Exception _ = tensor x test_inferred_dimension_binding Test dimension binding inference dim packs Skip test now requires more complex dim pack functionality test_stride_calculation Test stride calculations work correctly dim packs tensor = torch randn Test basic indexing instead complex dim packs b = dims result = tensor b assertIsInstance result Tensor Test different tensor tensor = torch randn c d e = dims result = tensor c d e assertIsInstance result Tensor test_device_handling_cpu Test indexing behavior CPU tensors CPU tensor cpu_tensor = torch randn x y = dims result_cpu = cpu_tensor x y assertIsInstance result_cpu Tensor assertEqual result_cpu device torch device cpu __name__ == __main__ run_tests