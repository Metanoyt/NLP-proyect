pyre-strict mypy allow-untyped-defs os concurrent futures Future ThreadPoolExecutor typing Optional Union torch distributed dist torch distributed checkpoint _async_executor _AsyncCheckpointExecutor torch distributed checkpoint metadata STATE_DICT_TYPE torch distributed checkpoint planner SavePlanner torch distributed checkpoint storage StorageWriter save_wrapper staging_future_or_state_dict Union Future STATE_DICT_TYPE STATE_DICT_TYPE checkpoint_id Union str os PathLike None = None storage_writer Optional StorageWriter = None planner Optional SavePlanner = None process_group Optional dist ProcessGroup = None no_dist bool = False use_collectives bool = True - Future torch distributed checkpoint state_dict_saver save staged_dict = staging_future_or_state_dict result isinstance staging_future_or_state_dict Future staging_future_or_state_dict save staged_dict checkpoint_id=checkpoint_id storage_writer=storage_writer planner=planner process_group=process_group no_dist=no_dist use_collectives=use_collectives _ThreadBasedAsyncCheckpointExecutor _AsyncCheckpointExecutor __init__ - None _executor = ThreadPoolExecutor max_workers= thread_name_prefix= AsyncCheckpointExecutor execute_save staging_future_or_state_dict Union Future STATE_DICT_TYPE STATE_DICT_TYPE checkpoint_id Union str os PathLike None = None storage_writer Optional StorageWriter = None planner Optional SavePlanner = None process_group Optional dist ProcessGroup = None no_dist bool = False use_collectives bool = True - Future f Future = _executor submit save_wrapper staging_future_or_state_dict=staging_future_or_state_dict checkpoint_id=checkpoint_id storage_writer=storage_writer planner=planner process_group=process_group no_dist=no_dist use_collectives=use_collectives f add_done_callback lambda f _executor shutdown wait=False f