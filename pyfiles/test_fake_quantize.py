Owner s oncall quantization torch unittest torch ao quantization experimental observer APoTObserver torch ao quantization experimental quantizer quantize_APoT dequantize_APoT torch ao quantization experimental fake_quantize APoTFakeQuantize torch ao quantization experimental fake_quantize_function fake_quantize_function forward_helper = fake_quantize_function forward backward = fake_quantize_function backward torch autograd gradcheck TestFakeQuantize unittest TestCase r Tests fake quantize calculate_qparams method comparing result observer calculate_qparams Uses hard-coded values alpha= b= k= test_fake_calc_qparams apot_fake = APoTFakeQuantize b= k= apot_fake activation_post_process min_val = torch tensor apot_fake activation_post_process max_val = torch tensor alpha gamma quantization_levels level_indices = apot_fake calculate_qparams signed=False observer = APoTObserver b= k= observer min_val = torch tensor observer max_val = torch tensor qparams_expected = observer calculate_qparams signed=False assertEqual alpha qparams_expected assertTrue torch equal gamma qparams_expected assertTrue torch equal quantization_levels qparams_expected assertTrue torch equal level_indices qparams_expected r Tests fake quantize forward method comparing result expected quant_dequant_APoT mapping input tensor Uses input tensor random values - APoT observer hard-coded values b= k= test_forward generate tensor size random values between - quantize - dequantize X = torch rand observer = APoTObserver b= k= observer forward X alpha gamma quantization_levels level_indices = observer calculate_qparams signed=False apot_fake = APoTFakeQuantize b= k= apot_fake enable_observer apot_fake enable_fake_quant X_reduced_precision_fp = apot_fake forward torch clone X False get X_expected converting fp - apot - fp simulate quantize - dequantize X_to_apot = quantize_APoT X alpha gamma quantization_levels level_indices X_expected = dequantize_APoT X_to_apot assertTrue torch equal X_reduced_precision_fp X_expected r Tests fake quantize forward method throws error when qparams None test_forward_exception generate tensor size random values between - quantize - dequantize X = torch rand apot_fake = APoTFakeQuantize b= k= disable observer so qparams set qparams all None apot_fake disable_observer apot_fake enable_fake_quant assertRaises Exception apot_fake forward torch clone X False r Tests fake quantize helper backward method using torch autograd gradcheck function test_backward input = torch randn dtype=torch double requires_grad=True observer = APoTObserver b= k= observer input alpha gamma quantization_levels level_indices = observer calculate_qparams signed=False gradcheck fake_quantize_function apply input alpha gamma quantization_levels level_indices atol= e- __name__ == __main__ unittest main