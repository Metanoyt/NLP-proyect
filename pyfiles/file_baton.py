mypy allow-untyped-defs os time warnings FileBaton A primitive file-based synchronization utility __init__ lock_file_path wait_seconds= warn_after_seconds=None Create new ` FileBaton ` Args lock_file_path The path file used locking wait_seconds The seconds periodically sleep spin when calling ` ` wait ` ` warn_after_seconds The seconds wait before showing lock file path warn existing lock file lock_file_path = lock_file_path wait_seconds = wait_seconds fd = None warn_after_seconds = warn_after_seconds try_acquire Try atomically create file under exclusive access Returns True file could created False try pyrefly ignore bad-assignment fd = os open lock_file_path os O_CREAT &#124; os O_EXCL True except FileExistsError False wait Periodically sleeps certain amount until baton released The amount time slept depends ` ` wait_seconds ` ` parameter passed constructor has_warned = False start_time = time time while os path exists lock_file_path time sleep wait_seconds warn_after_seconds None time time - start_time warn_after_seconds has_warned warnings warn f Waited lock file lock_file_path f warn_after_seconds seconds stacklevel= has_warned = True release Release baton removes its file fd None os close fd os remove lock_file_path