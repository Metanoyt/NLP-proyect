mypy allow-untyped-defs Microbenchmarks torch fft module argparse ArgumentParser collections namedtuple collections abc Iterable torch torch fft torch utils benchmark torch utils benchmark op_fuzzers spectral SpectralOpFuzzer _dim_options ndim ndim == None ndim == None ndim == None raise ValueError f Expected ndim range - got ndim run_benchmark name str function object dtype torch dtype seed int device str samples int probability_regular float cuda = device == cuda spectral_fuzzer = SpectralOpFuzzer seed=seed dtype=dtype cuda=cuda probability_regular=probability_regular results = tensors tensor_params params spectral_fuzzer take samples shape = params k params k params k params ndim str_shape = x join f s s shape sub_label = f str_shape tensor_params x is_contiguous discontiguous dim _dim_options params ndim nthreads cuda measurement = benchmark Timer stmt= func x dim=dim globals= func function x tensors x dim dim label=f name _ device sub_label=sub_label description=f dim= dim num_threads=nthreads blocked_autorange min_run_time= measurement metadata = name name device device dim dim shape shape measurement metadata update tensor_params x results append measurement results Benchmark = namedtuple Benchmark name function dtype BENCHMARKS = Benchmark fft_real torch fft fftn torch float Benchmark fft_complex torch fft fftn torch complex Benchmark ifft torch fft ifftn torch complex Benchmark rfft torch fft rfftn torch float Benchmark irfft torch fft irfftn torch complex BENCHMARK_MAP = b name b b BENCHMARKS BENCHMARK_NAMES = b name b BENCHMARKS DEVICE_NAMES = cpu cuda _output_csv file results file write benchmark device num_threads numel shape contiguous dim mean us median us iqr us \n measurement results metadata = measurement metadata device dim shape name numel contiguous = metadata device metadata dim metadata shape metadata name metadata numel metadata is_contiguous isinstance dim Iterable dim_str = - join str d d dim dim_str = str dim shape_str = x join str s s shape print name device measurement task_spec num_threads numel shape_str contiguous dim_str type ignore possibly-undefined measurement mean e measurement median e measurement iqr e sep= file=file __name__ == __main__ parser = ArgumentParser description=__doc__ parser add_argument -- device type=str choices=DEVICE_NAMES nargs= + default=DEVICE_NAMES parser add_argument -- bench type=str choices=BENCHMARK_NAMES nargs= + default=BENCHMARK_NAMES parser add_argument -- seed type=int default= parser add_argument -- samples type=int default= parser add_argument -- probability-regular -- probability_regular type=float default= parser add_argument -o -- output type=str args = parser parse_args num_benchmarks = len args device len args bench i = results = device args device bench BENCHMARK_MAP b b args bench results += run_benchmark name=bench name function=bench function dtype=bench dtype seed=args seed device=device samples=args samples probability_regular=args probability_regular i += print f Completed bench name benchmark device i num_benchmarks args output None open args output w f _output_csv f results compare = benchmark Compare results compare trim_significant_figures compare colorize compare print