Owner s oncall jit torch torch _C torch testing FileCheck torch testing _internal common_utils raise_on_run_directly torch testing _internal jit_utils JitTestCase TestGraphRewritePasses JitTestCase test_fuse_linear FunctionalLinear torch nn Module __init__ weight bias super __init__ weight = weight bias = bias forward x res = torch matmul x weight t bias None res add_ bias res x = torch rand w = torch rand b = torch rand has_bias True False bias = b has_bias None model = torch jit trace FunctionalLinear w bias x node model graph nodes node kind == aten matmul source_range_ = node sourceRange torch _C _jit_pass_fuse_linear model graph node model graph nodes node kind == aten linear source_range_ = node sourceRange FileCheck check aten linear run model graph check_not = aten matmul aten addmm aten add_ aten t cn check_not FileCheck check_not cn run model graph assertTrue source_range_ == source_range_ make sure runs model x check matmuls fused Matmul torch nn Module __init__ weight super __init__ weight = weight forward x torch matmul x weight x = torch rand w = torch rand model = torch jit trace Matmul w x torch _C _jit_pass_fuse_linear model graph check d matmul fused FileCheck check aten matmul run model graph FileCheck check_not aten linear run model graph make sure runs model x __name__ == __main__ raise_on_run_directly test test_jit py