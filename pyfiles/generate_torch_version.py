__future__ annotations argparse email os re subprocess pathlib Path packaging version Version setuptools distutils type ignore attr-defined UNKNOWN = Unknown RELEASE_PATTERN = re compile r v - + \ - + -rc - + get_sha pytorch_root str &#124; Path - str try rev = None os path exists os path join pytorch_root git rev = subprocess check_output git rev-parse HEAD cwd=pytorch_root os path exists os path join pytorch_root hg rev = subprocess check_output hg identify -r cwd=pytorch_root rev rev decode ascii strip except Exception pass UNKNOWN get_tag pytorch_root str &#124; Path - str try tag = subprocess run git describe -- tags -- exact cwd=pytorch_root encoding= ascii capture_output=True stdout strip RELEASE_PATTERN match tag tag UNKNOWN except Exception UNKNOWN get_torch_version sha str &#124; None = None - str Determine torch version string The version determined one following sources order precedence The PYTORCH_BUILD_VERSION PYTORCH_BUILD_NUMBER environment variables These set PyTorch build system when building official releases If built sdist checked version matches sdist version The PKG-INFO file exists This file included source distributions sdist contains version sdist The version txt file which contains base version string If git commit SHA available appended version string indicate development build pytorch_root = Path __file__ absolute parent parent pkg_info_path = pytorch_root PKG-INFO pkg_info_path exists open pkg_info_path f pkg_info = email message_from_file f sdist_version = pkg_info Version sdist_version = None os getenv PYTORCH_BUILD_VERSION assert os getenv PYTORCH_BUILD_NUMBER None build_number = int os getenv PYTORCH_BUILD_NUMBER version = os getenv PYTORCH_BUILD_VERSION build_number version += post + str build_number origin = PYTORCH_BUILD_ VERSION NUMBER env variables sdist_version version = sdist_version origin = PKG-INFO version = open pytorch_root version txt read strip origin = version txt sdist_version None sha = UNKNOWN sha None sha = get_sha pytorch_root version += +git + sha origin += git commit Validate version PEP compliant parsed_version = Version version sdist_version l = parsed_version local l startswith git Assume local version git sha hence whole version source version source_version = version local version absent platform tag source_version = version partition + assert sdist_version == source_version f Source part source_version version version f origin does match version sdist_version PKG-INFO version __name__ == __main__ parser = argparse ArgumentParser description= Generate torch version py build environment metadata parser add_argument -- is-debug -- is_debug type=distutils util strtobool help= Whether build debug mode parser add_argument -- cuda-version -- cuda_version type=str parser add_argument -- hip-version -- hip_version type=str parser add_argument -- xpu-version -- xpu_version type=str args = parser parse_args assert args is_debug None args cuda_version = None args cuda_version == args cuda_version args hip_version = None args hip_version == args hip_version args xpu_version = None args xpu_version == args xpu_version pytorch_root = Path __file__ parent parent version_path = pytorch_root torch version py Attempt get tag first fall back sha tag found tagged_version = get_tag pytorch_root sha = get_sha pytorch_root tagged_version == UNKNOWN version = get_torch_version sha version = tagged_version open version_path w f f write typing Optional\n\n f write __all__ = __version__ debug cuda git_version hip xpu \n f write f __version__ = version \n NB This accurate because you could have built library code DEBUG csrc without DEBUG which case would claim release build when s f write f debug = repr bool args is_debug \n f write f cuda Optional str = repr args cuda_version \n f write f git_version = repr sha \n f write f hip Optional str = repr args hip_version \n f write f xpu Optional str = repr args xpu_version \n