Owner s oncall mobile io itertools product pathlib Path torch torch utils bundled_inputs torch jit mobile _load_for_lite_interpreter torch testing _internal common_utils run_tests TestCase pytorch_test_dir = Path __file__ resolve parents TestLiteScriptModule TestCase _save_load_mobile_module script_module torch jit ScriptModule buffer = io BytesIO script_module _save_to_buffer_for_lite_interpreter _save_mobile_debug_info=True buffer seek mobile_module = _load_for_lite_interpreter buffer mobile_module _try_fn fn args kwargs try fn args kwargs except Exception e e test_versioned_div_tensor noqa F div_tensor_ _ other noqa F is_floating_point other is_floating_point true_divide other divide other rounding_mode= trunc model_path = pytorch_test_dir cpp jit upgrader_models test_versioned_div_tensor_v ptl _load_for_lite_interpreter str model_path jit_module_v = torch jit load str model_path _save_load_mobile_module jit_module_v vals = val_a val_b product vals vals = torch tensor val_a b = torch tensor val_b _helper m fn m_results = _try_fn m b fn_result = _try_fn fn b isinstance m_results Exception assertTrue isinstance fn_result Exception result m_results print result result print fn_result fn_result print result == fn_result assertTrue result eq fn_result assertEqual result fn_result old operator should produce same result applying upgrader torch div op _helper mobile_module_v div_tensor_ _ latest operator should produce same result applying torch div op _helper current_mobile_module torch div __name__ == __main__ run_tests