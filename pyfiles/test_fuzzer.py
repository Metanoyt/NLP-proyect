Owner s module dynamo unittest typing Literal unittest mock MagicMock patch torch torch _dynamo config dynamo_config torch _inductor config inductor_config torch _inductor fuzzer ConfigFuzzer MODULE_DEFAULTS SamplingMethod Status torch _inductor test_case run_tests TestCase torch testing _internal fake_config_module fake_config torch testing _internal common_utils IS_LINUX torch testing _internal inductor_utils GPU_TYPE HAS_GPU create_simple_test_model_cpu test_fn - bool model = torch nn Sequential torch nn Linear torch nn ReLU torch nn Linear x = torch randn model x True test_fn create_simple_test_model_gpu batch_size = seq_length = hidden_size = inp = torch randn batch_size seq_length hidden_size device=GPU_TYPE weight = torch randn hidden_size hidden_size device=GPU_TYPE test_fn - bool matmul_output = inp weight torch nn LayerNorm hidden_size device=GPU_TYPE matmul_output True test_fn TestConfigFuzzer TestCase test_sampling_method_toggle toggle = SamplingMethod dispatch SamplingMethod TOGGLE assertEqual toggle bool False True assertEqual toggle bool True False assertEqual toggle Literal foo bar foo bar assertEqual toggle Literal foo bar bar foo assertTrue bar toggle list Literal foo bar foo assertTrue foo toggle list Literal foo bar bar test_sampling_method_random random = SamplingMethod dispatch SamplingMethod RANDOM samp = random bool False i range assertTrue all samp unittest skipIf HAS_GPU requires gpu test_config_fuzzer_inductor_gpu fuzzer = ConfigFuzzer inductor_config create_simple_test_model_gpu seed= assertIsNotNone fuzzer default fuzzer reproduce max_fusion_size test_config_fuzzer_inductor_cpu fuzzer = ConfigFuzzer inductor_config create_simple_test_model_cpu seed= assertIsNotNone fuzzer default fuzzer reproduce max_fusion_size test_config_fuzzer_bisector_exception key_ = e_bool False e_optional None MyException Exception pass create_key_ myfn fake_config e_bool fake_config e_optional None raise MyException hi True myfn fuzzer = ConfigFuzzer fake_config create_key_ seed= default= results = fuzzer bisect num_attempts= p= assertEqual len results res results assertEqual res key_ test_config_fuzzer_bisector_boolean key_ = e_bool False e_optional None create_key_ myfn fake_config e_bool fake_config e_optional None False True myfn fuzzer = ConfigFuzzer fake_config create_key_ seed= default= num_attempts = results = fuzzer bisect num_attempts=num_attempts p= assertEqual len results num_attempts res results assertEqual res key_ test_config_fuzzer_n_tuple key_ = e_bool False e_optional None create_key_ myfn fake_config e_bool fake_config e_optional None False True myfn fuzzer = ConfigFuzzer fake_config create_key_ seed= default= max_combo = results = fuzzer fuzz_n_tuple max_combinations=max_combo assertEqual results num_ran max_combo assertEqual results lookup tuple key_ keys Status FAILED_RUN_RETURN test_config_fuzzer_inductor_bisect these values just chosen randomly change different ones necessary key_ = split_reductions False compute_all_bounds True create_key_ myfn inductor_config split_reductions inductor_config compute_all_bounds False True myfn fuzzer = ConfigFuzzer inductor_config create_key_ seed= num_attempts = results = fuzzer bisect num_attempts=num_attempts p= assertEqual len results num_attempts res results assertEqual res key_ new_results = fuzzer reproduce results assertEqual len new_results assertEqual set key_ keys j i new_results keys j i - set MODULE_DEFAULTS torch _inductor config keys unittest skipIf IS_LINUX PerfCounters only supported Linux unittest skip Need default values dynamo flags - https github com pytorch pytorch issues test_config_fuzzer_dynamo_bisect these values just chosen randomly change different ones necessary key_ = dead_code_elimination False specialize_int True create_key_ myfn dynamo_config dead_code_elimination dynamo_config specialize_int False True myfn fuzzer = ConfigFuzzer dynamo_config create_key_ seed= num_attempts = results = fuzzer bisect num_attempts=num_attempts p= assertEqual len results num_attempts res results assertEqual res key_ new_results = fuzzer reproduce results assertEqual len new_results assertEqual set key_ keys j i new_results keys j i - set MODULE_DEFAULTS torch _dynamo config keys patch torch compile test_fuzzer_inductor_calling_compile compile create_key_ myfn True myfn fuzzer = ConfigFuzzer inductor_config create_key_ seed= num_attempts = fuzzer bisect num_attempts=num_attempts p= assertEqual compile call_count num_attempts test_fuzzer_running_test create_key_ myfn True myfn fuzzer = ConfigFuzzer inductor_config create_key_ seed= fuzzer test_config = MagicMock return_value=Status PASSED num_attempts = fuzzer bisect num_attempts=num_attempts p= assertEqual fuzzer test_config call_count num_attempts __name__ == __main__ run_tests