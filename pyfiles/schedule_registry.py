Copyright c Meta Platforms Inc affiliates Owner s oncall distributed This file Schedule zoo testing torch distributed pipelining It includes schedules designed purely testing purposes collections abc Callable typing Optional torch distributed pipelining schedules _Action _ComputationType _PipelineScheduleRuntime PipelineScheduleMulti RECV_B RECV_F SEND_B SEND_F torch distributed pipelining stage _PipelineStageBase F = _ComputationType FORWARD B = _ComputationType FULL_BACKWARD W = _ComputationType BACKWARD_WEIGHT I = _ComputationType BACKWARD_INPUT ScheduleVShaped PipelineScheduleMulti n_stages = rank_stages = __init__ stages list _PipelineStageBase n_microbatches int loss_fn Optional Callable = None scale_grads bool = True super __init__ stages=stages n_microbatches=n_microbatches loss_fn=loss_fn scale_grads=scale_grads Go through one microbatch Note whc - might easier work schedules writing them list F then parsing them test infra turn them into actions pipeline_order = _Action F None None _Action F _Action B None None _Action B None _Action F _Action F None None _Action B _Action B None _validate_and_set_stage_mapping pipeline_order ScheduleUnbalanced PipelineScheduleMulti n_stages = rank_stages = __init__ stages list _PipelineStageBase n_microbatches int loss_fn Optional Callable = None scale_grads bool = True super __init__ stages=stages n_microbatches=n_microbatches loss_fn=loss_fn scale_grads=scale_grads pipeline_order = _Action F _Action F None None _Action F _Action B None None _Action B _Action B None None _Action F _Action F None None _Action B _Action B None None _validate_and_set_stage_mapping pipeline_order ScheduleWithW PipelineScheduleMulti n_stages = num_microbatches = rank_stages = __init__ stages list _PipelineStageBase n_microbatches int loss_fn Optional Callable = None enable_zero_bubble bool = True scale_grads bool = True super __init__ stages=stages n_microbatches=n_microbatches loss_fn=loss_fn scale_grads=scale_grads Needs updated part all schedules using W use_full_backward = False Go through two microbatches pipeline_order = _Action F _Action F _Action F _Action F None _Action I _Action W _Action I _Action I _Action W _Action I _Action W _Action W None _Action F _Action F _Action F _Action I _Action F _Action I _Action I _Action W _Action I _Action W _Action W _Action W _validate_and_set_stage_mapping pipeline_order ScheduleWithReorderedB _PipelineScheduleRuntime n_stages = num_microbatches = rank_stages = __init__ stages list _PipelineStageBase n_microbatches int loss_fn Optional Callable = None scale_grads bool = True super __init__ stages=stages n_microbatches=n_microbatches loss_fn=loss_fn scale_grads=scale_grads Go through two microbatches pipeline_order_with_comms = _Action F _Action F _Action SEND_F _Action SEND_F _Action RECV_B _Action RECV_B _Action B _Action B _Action RECV_F _Action RECV_F _Action F _Action F _Action B _Action B _Action SEND_B _Action SEND_B