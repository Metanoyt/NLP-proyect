__future__ annotations dataclasses dataclass typing TYPE_CHECKING torchgen api types types_base Binding CType Expr TYPE_CHECKING collections abc Iterator Sequence torchgen model BackendIndex FunctionSchema NativeFunction NativeFunctionsGroup NativeFunctionsViewGroup dataclass frozen=True CppSignature A CppSignature represents single overload C++ API For any given function schema there may multiple CppSignatures corresponding based how we desugar C++ See also CppSignatureGroup The schema signature derived func FunctionSchema Is C++ signature method i e Tensor my_op method bool Is faithful C++ signature i e following JIT schema convenience API i e potential TensorOptions argument out arguments front faithful bool Is symint C++ signature For BC reasons functions take SymInts still present int _t C++ SymInt variant offered different overload name NB If function RETURNS SymInt ALWAYS false symint bool The set C++ arguments which should have defaults applied them cpp_no_default_args set str Is fallback C++ binding Fallback bindings enabled manual_cpp_binding True alternate non-public API lets manual C++ binding implementers access binding would have been automatically generated fallback_binding bool = False Return unpacked argument structure signature discarding information about which arguments semantically related each other arguments - Sequence Binding cpp arguments func arguments faithful=self faithful symint=self symint method=self method cpp_no_default_args=self cpp_no_default_args name suppress_symint_suffix bool = False - str n = cpp name func faithful_name_for_out_overloads=self faithful symint_overload=False suppress_symint_suffix symint fallback_binding n = f __dispatch_ n n Render C++ declaration signature decl name str &#124; None = None prefix str = is_redispatching_fn bool = False suppress_symint_suffix bool = False - str returns_type = cpp returns_type func returns symint=self symint cpp_type cpp_args = decl arguments is_redispatching_fn cpp_args = c DispatchKeySet dispatchKeySet + cpp_args cpp_args_str = join cpp_args name None name = prefix + name suppress_symint_suffix=suppress_symint_suffix f returns_type name cpp_args_str Render C++ definition signature including body curly braces defn name str &#124; None = None prefix str = is_redispatching_fn bool = False - str returns_type = cpp returns_type func returns symint=self symint cpp_type cpp_args = defn arguments is_redispatching_fn cpp_args = c DispatchKeySet dispatchKeySet + cpp_args cpp_args_str = join cpp_args name None name = prefix + name f returns_type name cpp_args_str ptr_type - str args_types_str = join type arguments f cpp returns_type func returns symint=self symint cpp_type args_types_str Return C++ function type e g something like int bool type - str args_types_str = join type arguments f cpp returns_type func returns symint=self symint cpp_type args_types_str Represents group all CppSignatures associated FunctionSchema Right now s regular user-visible signature well faithful signature which doesn t have grouping dataclass frozen=True CppSignatureGroup func FunctionSchema signature CppSignature faithful_signature CppSignature &#124; None symint_signature CppSignature &#124; None symint_faithful_signature CppSignature &#124; None most_faithful_signature - CppSignature faithful_signature faithful_signature signature signatures symint bool = True - Iterator CppSignature yield signature faithful_signature yield faithful_signature symint symint_signature yield symint_signature symint_faithful_signature yield symint_faithful_signature staticmethod from_native_function f NativeFunction method bool fallback_binding bool = False - CppSignatureGroup func = f func make_sig faithful bool symint bool - CppSignature CppSignature func=func faithful=faithful symint=symint method=method fallback_binding=fallback_binding cpp_no_default_args=f cpp_no_default_args make_sigs symint bool - tuple CppSignature CppSignature &#124; None faithful_signature CppSignature &#124; None = None func arguments tensor_options None len func arguments out faithful_signature = make_sig faithful=True symint=symint signature = make_sig faithful=False symint=symint signature faithful_signature signature faithful_signature = make_sigs symint=False symint_signature CppSignature &#124; None = None symint_faithful_signature CppSignature &#124; None = None func has_symint symint_signature symint_faithful_signature = make_sigs symint=True CppSignatureGroup func=func signature=signature faithful_signature=faithful_signature symint_signature=symint_signature symint_faithful_signature=symint_faithful_signature dataclass frozen=True DispatcherSignature The schema signature derived func FunctionSchema Allows you prepend arbitrary prefix signature name This useful parts codegen generate wrappers around kernels need avoid naming collisions prefix str = symint bool = True arguments - list Binding dispatcher arguments func symint=self symint name - str prefix + dispatcher name func decl name str &#124; None = None - str args_str = join decl arguments name None name = name f returns_type cpp_type name args_str defn name str &#124; None = None is_redispatching_fn bool = False - str args = defn arguments is_redispatching_fn args = c DispatchKeySet dispatchKeySet + args args_str = join args name None name = name f returns_type cpp_type name args_str exprs - list Expr Expr name nctype arguments returns_type - CType dispatcher returns_type func returns symint=self symint ptr_type - str dispatcher_args_types_str = join type arguments f returns_type cpp_type dispatcher_args_types_str Return C++ function type e g something like int bool type - str dispatcher_args_types_str = join type arguments f returns_type cpp_type dispatcher_args_types_str staticmethod from_schema func FunctionSchema prefix str = symint bool = True - DispatcherSignature DispatcherSignature func prefix symint dataclass frozen=True NativeSignature The schema signature derived func FunctionSchema symint bool prefix str = name - str prefix + native name func decl name str &#124; None = None - str args_str = join decl arguments name None name = name f native returns_type func returns symint=self symint cpp_type name args_str defn name str &#124; None = None - str args_str = join defn arguments name None name = name f native returns_type func returns symint=self symint cpp_type name args_str ptr_type - str don t include defaults type signature args_str = join defn arguments f native returns_type func returns symint=self symint cpp_type args_str arguments - list Binding native arguments func symint=self symint returns_type - CType native returns_type func returns symint=self symint dispatcher_exprs - list Expr translate translate arguments dispatcher arguments func method=False dataclass frozen=True ViewInverseSignature g NativeFunctionsViewGroup name - str functionalization reverse_name g view include_namespace=False decl - str return_type = functionalization returns_type g view func decls = decl functionalization op_arguments g view func is_reverse=True f static return_type cpp_type name join decls dataclass frozen=True StructuredImplSignature g NativeFunctionsGroup name str defn name str &#124; None = None - str args_str = join defn arguments f TORCH_IMPL_FUNC name args_str arguments - list Binding structured impl_arguments g Helper functions kernel_signature f NativeFunction backend_index BackendIndex prefix str = - NativeSignature &#124; DispatcherSignature Note External Backends Follow Dispatcher API Kernel signatures in-tree backends follow native API while kernels out-of-tree backends follow dispatcher API See comments ` native py ` details historically there have been some small differences schema convention between them Dispatcher API Any differences require translating between two will results runtime cost so we d like keep differences small possible With external backends we d like enforce they write their kernels schemas match Dispatcher API directly they can meta = backend_index get_kernel f symint = meta None meta supports_symint symint assert f func has_symint f attempted define symint kernel backend_index dispatch_key without SymInt schema backend_index external DispatcherSignature from_schema f func prefix=prefix symint=symint NativeSignature f func prefix=prefix symint=symint Functions only no types torchgen api cpp dispatcher functionalization native structured translate