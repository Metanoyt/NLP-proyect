Owner s module codegen textwrap unittest typing cast expecttest yaml torchgen dest dest torchgen gen gen torchgen gen LineLoader parse_native_yaml_struct torchgen model Annotation BaseOperatorName CustomClassType DispatchKey NativeFunctionsGroup Type TestCodegenModel expecttest TestCase assertParseErrorInline yaml_str str expect str - None es = yaml load yaml_str Loader=LineLoader try parse_native_yaml_struct es set except AssertionError e hack strip out context msg _ = str e split assertExpectedInline \n join textwrap wrap msg expect skip= fail msg= Did raise when expected assertUfuncErrorInline yaml_str str expect str - None parse single structured group out yaml g es = yaml load yaml_str Loader=LineLoader parsed_yaml = parse_native_yaml_struct es set native_functions backend_indices = parsed_yaml native_functions parsed_yaml backend_indices grouped_native_functions = gen get_grouped_native_functions native_functions assert len grouped_native_functions == g = grouped_native_functions assert isinstance g NativeFunctionsGroup assert g out ufunc_inner_loop ufunc codegen per se does some basic sanity tests ufunc generation gen compute_meta_function_declaration g dest compute_native_function_declaration g backend_indices DispatchKey CPU dest compute_native_function_declaration g backend_indices DispatchKey CUDA try real kahuna dest compute_ufunc_cpu g dest compute_ufunc_cpu_kernel g dest compute_ufunc_cuda g except AssertionError e hack strip out context msg _ = str e split assertExpectedInline \n join textwrap wrap msg expect skip= fail msg= Did raise when expected NB indent hardcoded two here so format your yaml accordingly binop_out = func binop out Tensor Tensor other Tensor out - Tensor ti_binop_out = f binop_out structured True structured_inherits TensorIteratorBase ti_binop = func binop Tensor Tensor other - Tensor structured_delegate binop out ti_unop_out = func unop out Tensor Tensor out - Tensor structured True structured_inherits TensorIteratorBase ti_unop = func unop Tensor - Tensor structured_delegate unop out test_nonstructured_ufunc - None yaml_str = f \ - binop_out ufunc_inner_loop Generic binop Bool assertParseErrorInline yaml_str \ ufunc must structured test_overlapping_ufunc_and_dispatch - None yaml_str = f \ - ti_binop_out ufunc_inner_loop Generic binop Bool dispatch CPU binop_cpu assertParseErrorInline yaml_str \ ufunc should have explicit dispatch entry CPU See https github com pytorch pytorch pull #discussion_r unittest expectedFailure test_scalaronly_shadowed - None yaml_str = f \ - ti_binop_out ufunc_inner_loop Generic binop Bool ScalarOnly binop Bool assertParseErrorInline yaml_str \ test_conflicting_ufunc - None yaml_str = f \ - ti_binop_out ufunc_inner_loop Generic binop Bool ScalarOnly binop_scalar Bool - ti_binop assertUfuncErrorInline yaml_str \ ScalarOnly Generic must have same ufunc name test_invalid_cudafunctoronself_for_binary_op - None yaml_str = f \ - ti_unop_out ufunc_inner_loop Generic unop All CUDAFunctorOnSelf unop_self_cuda All - ti_unop assertUfuncErrorInline yaml_str \ cannot use CUDAFunctorOnSelf non-binary function test_parse_custom_class_type - None custom_class_name = namespace_foo class_bar custom_class_name_with_prefix = f __torch__ torch classes custom_class_name custom_class_type = cast CustomClassType Type parse custom_class_name_with_prefix assertTrue isinstance custom_class_type CustomClassType assertEqual custom_class_name custom_class_type class_name assertEqual custom_class_name_with_prefix str custom_class_type TestAnnotation expecttest TestCase test_single_alias_no_write - None = Annotation parse assertEqual alias_set tuple assertFalse is_write assertEqual alias_set_after test_single_alias_is_write - None = Annotation parse assertEqual alias_set tuple assertTrue is_write assertEqual alias_set_after test_single_alias_is_write_to_wildcard - None = Annotation parse - assertEqual alias_set tuple assertTrue is_write assertEqual alias_set_after tuple test_alias_set - None = Annotation parse &#124; b assertEqual alias_set b test_alias_set_is_write_raises_exception - None assertRaisesRegex AssertionError r alias set larger than mutable Annotation parse &#124; b test_single_alias_is_write_to_alias_set - None = Annotation parse - &#124; b assertEqual alias_set tuple assertTrue is_write assertEqual alias_set_after b test_before_and_after_alias_set_larger_than_ _raises_exception - None assertRaisesRegex AssertionError r before alias set after alias set cannot larger than same time Annotation parse &#124; b - c &#124; d TestBaseOperatorName expecttest TestCase test_base_operator_name_with_ns_has_same_attributes_as_the_one_without_ns - None op = aten __lshift__ op_without_ns = __lshift__ op_name = BaseOperatorName parse op op_name_without_ns = BaseOperatorName parse op_without_ns assertEqual op_name base op_name_without_ns base assertEqual op_name inplace op_name_without_ns inplace assertEqual op_name dunder_method op_name_without_ns dunder_method __name__ == __main__ unittest main