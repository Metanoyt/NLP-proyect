math collections abc Iterable Sequence typing Literal NamedTuple Optional Union torch torch _prims prims torch _prims_common utils torch _decomp register_decomposition torch _prims_common DimsType ShapeType TensorLikeType torch _prims_common wrappers _maybe_convert_to_dtype out_wrapper __all__ = Transforms fft fft fftn hfft hfft hfftn rfft rfft rfftn ifft ifft ifftn ihfft ihfft ihfftn irfft irfft irfftn Helpers fftshift ifftshift NormType = Union None Literal forward backward ortho _NORM_VALUES = None forward backward ortho aten = torch _ops ops aten _apply_norm x TensorLikeType norm NormType signal_numel int forward bool - TensorLikeType Apply normalization un-normalized FFT result torch _check norm _NORM_VALUES lambda f Invalid normalization mode norm norm == ortho x math sqrt signal_numel normalize = forward norm None norm == backward forward norm == forward x signal_numel normalize x _promote_type_fft dtype torch dtype require_complex bool device torch device - torch dtype Helper promote dtype one supported FFT primitives dtype is_complex dtype Promote integral default float type dtype is_floating_point dtype = torch get_default_dtype allowed_types = torch float torch float maybe_support_half = device type cuda meta maybe_support_half allowed_types append torch float torch _check dtype allowed_types lambda f Unsupported dtype dtype require_complex dtype = utils corresponding_complex_dtype dtype dtype _maybe_promote_tensor_fft t TensorLikeType require_complex bool = False - TensorLikeType Helper promote tensor dtype supported FFT primitives cur_type = t dtype new_type = _promote_type_fft cur_type require_complex t device _maybe_convert_to_dtype t new_type type ignore return-value _resize_fft_input x TensorLikeType dims tuple int sizes tuple int - TensorLikeType Fixes shape x such x size dims i == sizes i either zero-padding slicing x starting assert len dims == len sizes must_copy = False x_sizes = x shape pad_amount = len x_sizes i range len dims sizes i == - continue x_sizes dims i sizes i must_copy = True pad_idx = len pad_amount - dims i - pad_amount pad_idx = sizes i - x_sizes dims i x_sizes dims i sizes i x = x narrow dims i sizes i torch constant_pad_nd x pad_amount must_copy x _fft_c r func_name str input TensorLikeType n Optional int dim int norm NormType forward bool - TensorLikeType Common code performing any complex real FFT irfft hfft input = _maybe_promote_tensor_fft input require_complex=True dims = utils canonicalize_dim input ndim dim wrap_scalar=False last_dim_size = n n None input shape dim - torch _check last_dim_size = lambda f Invalid number data points last_dim_size specified n None input = _resize_fft_input input dims=dims sizes= last_dim_size + forward input = torch conj input output = prims fft_c r input dim=dims last_dim_size=last_dim_size _apply_norm output norm=norm signal_numel=last_dim_size forward=forward _fft_r c func_name str input TensorLikeType n Optional int dim int norm NormType forward bool onesided bool - TensorLikeType Common code performing any real complex FFT rfft ihfft torch _check input dtype is_complex lambda f func_name expects floating point input tensor got input dtype input = _maybe_promote_tensor_fft input dims = utils canonicalize_dim input ndim dim wrap_scalar=False dim_size = n n None input shape dim torch _check dim_size = lambda f Invalid number data points dim_size specified n None input = _resize_fft_input input dims n ret = prims fft_r c input dim=dims onesided=onesided ret = _apply_norm ret norm dim_size forward ret forward torch conj ret _fft_c c func_name str input TensorLikeType n Optional int dim int norm NormType forward bool - TensorLikeType Common code performing any complex complex FFT fft ifft torch _check input dtype is_complex lambda f func_name expects complex input tensor got input dtype dims = utils canonicalize_dim input ndim dim wrap_scalar=False dim_size = n n None input shape dim torch _check dim_size = lambda f Invalid number data points dim_size specified n None input = _resize_fft_input input dims n ret = prims fft_c c input dim=dims forward=forward _apply_norm ret norm dim_size forward register_decomposition aten fft_fft out_wrapper fft input TensorLikeType n Optional int = None dim int = - norm NormType = None - TensorLikeType input dtype is_complex _fft_c c fft input n dim norm forward=True _fft_r c fft input n dim norm forward=True onesided=False register_decomposition aten fft_ifft out_wrapper ifft input TensorLikeType n Optional int = None dim int = - norm NormType = None - TensorLikeType input dtype is_complex _fft_c c ifft input n dim norm forward=False _fft_r c ifft input n dim norm forward=False onesided=False register_decomposition aten fft_rfft out_wrapper rfft input TensorLikeType n Optional int = None dim int = - norm NormType = None - TensorLikeType _fft_r c rfft input n dim norm forward=True onesided=True register_decomposition aten fft_irfft out_wrapper irfft input TensorLikeType n Optional int = None dim int = - norm NormType = None - TensorLikeType _fft_c r irfft input n dim norm forward=False register_decomposition aten fft_hfft out_wrapper hfft input TensorLikeType n Optional int = None dim int = - norm NormType = None - TensorLikeType _fft_c r hfft input n dim norm forward=True register_decomposition aten fft_ihfft out_wrapper ihfft input TensorLikeType n Optional int = None dim int = - norm NormType = None - TensorLikeType _fft_r c ihfft input n dim norm forward=False onesided=True _ShapeAndDims NamedTuple shape tuple int dims tuple int _canonicalize_fft_shape_and_dim_args input TensorLikeType shape Optional ShapeType dim Optional DimsType - _ShapeAndDims Convert shape dim arguments into canonical form where neither optional input_dim = input ndim input_sizes = input shape dim None isinstance dim Sequence dim = dim ret_dims = utils canonicalize_dims input_dim dim wrap_scalar=False Check dims unique torch _check len set ret_dims == len ret_dims lambda FFT dims must unique shape None isinstance shape Sequence shape = shape Has shape might have dim torch _check dim None len dim == len shape lambda When given dim shape arguments must have same length transform_ndim = len shape torch _check transform_ndim = input_dim lambda f Got shape transform_ndim values input tensor f only has input_dim dimensions If shape given dims defaults last len shape dimensions dim None ret_dims = tuple range input_dim - transform_ndim input_dim Translate any - values shape default length ret_shape = tuple s s = - input_sizes d s d zip shape ret_dims type ignore possibly-undefined dim None No shape no dim ret_dims = tuple range input_dim ret_shape = tuple input_sizes No shape has dim ret_shape = tuple input_sizes d d ret_dims type ignore possibly-undefined n ret_shape torch _check n lambda f Invalid number data points n specified _ShapeAndDims shape=ret_shape dims=ret_dims type ignore possibly-undefined _prod xs Iterable int - int Compute product list prod = x xs prod = x prod _fftn_c c function_name str input TensorLikeType shape tuple int dim tuple int norm NormType forward bool - TensorLikeType Common code n-dimensional complex complex FFTs fftn ifftn torch _check input dtype is_complex lambda f function_name expects complex input tensor f got input dtype x = _resize_fft_input input dim shape output = prims fft_c c x dim=dim forward=forward _apply_norm output norm=norm signal_numel=_prod shape forward=forward register_decomposition aten fft_fftn out_wrapper fftn input TensorLikeType s Optional ShapeType = None dim Optional DimsType = None norm NormType = None - TensorLikeType shape dim = _canonicalize_fft_shape_and_dim_args input s dim x = _maybe_promote_tensor_fft input require_complex=True _fftn_c c fftn x shape dim norm forward=True register_decomposition aten fft_ifftn out_wrapper ifftn input TensorLikeType s Optional ShapeType = None dim Optional DimsType = None norm NormType = None - TensorLikeType shape dim = _canonicalize_fft_shape_and_dim_args input s dim x = _maybe_promote_tensor_fft input require_complex=True _fftn_c c ifftn x shape dim norm forward=False register_decomposition aten fft_rfftn out_wrapper rfftn input TensorLikeType s Optional ShapeType = None dim Optional DimsType = None norm NormType = None - TensorLikeType torch _check input dtype is_complex lambda f rfftn expects real-valued input tensor got input dtype shape dim = _canonicalize_fft_shape_and_dim_args input s dim input = _maybe_promote_tensor_fft input require_complex=False input = _resize_fft_input input dim shape out = prims fft_r c input dim=dim onesided=True _apply_norm out norm=norm signal_numel=_prod shape forward=True register_decomposition aten fft_ihfftn out_wrapper ihfftn input TensorLikeType s Optional ShapeType = None dim Optional DimsType = None norm NormType = None - TensorLikeType torch _check input dtype is_complex lambda f ihfftn expects real-valued input tensor got input dtype shape dim = _canonicalize_fft_shape_and_dim_args input s dim torch _check len shape lambda ihfftn must transform least one axis input = _maybe_promote_tensor_fft input require_complex=False input = _resize_fft_input input dim shape tmp = prims fft_r c input dim=dim - onesided=True len dim == tmp = _apply_norm tmp norm=norm signal_numel=shape forward=False prims conj tmp tmp = prims conj_physical tmp tmp = prims fft_c c tmp dim=dim - forward=False _apply_norm tmp norm=norm signal_numel=_prod shape forward=False _CanonicalizeC rReturn NamedTuple shape tuple int dim tuple int last_dim_size int _canonicalize_fft_c r_shape_and_dim_args fname str input TensorLikeType s Optional ShapeType dim Optional DimsType - _CanonicalizeC rReturn Canonicalize shape dim arguments n-dimensional c r transforms well calculating last_dim_size which shape dim - output shape dim = _canonicalize_fft_shape_and_dim_args input s dim torch _check len shape lambda f fname must transform least one axis s None s - == - last_dim_size = input shape dim - - last_dim_size = shape - torch _check last_dim_size = lambda f Invalid number data points last_dim_size specified shape_list = list shape shape_list - = last_dim_size + _CanonicalizeC rReturn shape=tuple shape_list dim=dim last_dim_size=last_dim_size register_decomposition aten fft_irfftn out_wrapper irfftn input TensorLikeType s Optional ShapeType = None dim Optional DimsType = None norm NormType = None - TensorLikeType shape dim last_dim_size = _canonicalize_fft_c r_shape_and_dim_args irfftn input s dim input = _maybe_promote_tensor_fft input require_complex=True input = _resize_fft_input input dim shape out = prims fft_c r input dim=dim last_dim_size=last_dim_size _apply_norm out norm _prod out shape d d dim forward=False register_decomposition aten fft_hfftn out_wrapper hfftn input TensorLikeType s Optional ShapeType = None dim Optional DimsType = None norm NormType = None - TensorLikeType shape dim last_dim_size = _canonicalize_fft_c r_shape_and_dim_args hfftn input s dim input = _maybe_promote_tensor_fft input require_complex=True input = _resize_fft_input input dim shape tmp = prims fft_c c input dim=dim - forward=True len dim input tmp = _apply_norm tmp norm _prod shape - forward=True tmp = prims conj_physical tmp out = prims fft_c r tmp dim=dim - last_dim_size=last_dim_size _apply_norm out norm last_dim_size forward=True register_decomposition aten fft_fft out_wrapper fft input TensorLikeType s Optional ShapeType = None dim Optional DimsType = - - norm NormType = None - TensorLikeType torch fft fftn input s=s dim=dim norm=norm register_decomposition aten fft_ifft out_wrapper ifft input TensorLikeType s Optional ShapeType = None dim Optional DimsType = - - norm NormType = None - TensorLikeType torch fft ifftn input s=s dim=dim norm=norm register_decomposition aten fft_rfft out_wrapper rfft input TensorLikeType s Optional ShapeType = None dim Optional DimsType = - - norm NormType = None - TensorLikeType torch fft rfftn input s=s dim=dim norm=norm register_decomposition aten fft_irfft out_wrapper irfft input TensorLikeType s Optional ShapeType = None dim Optional DimsType = - - norm NormType = None - TensorLikeType torch fft irfftn input s=s dim=dim norm=norm register_decomposition aten fft_hfft out_wrapper hfft input TensorLikeType s Optional ShapeType = None dim Optional DimsType = - - norm NormType = None - TensorLikeType torch fft hfftn input s=s dim=dim norm=norm register_decomposition aten fft_ihfft out_wrapper ihfft input TensorLikeType s Optional ShapeType = None dim Optional DimsType = - - norm NormType = None - TensorLikeType torch fft ihfftn input s=s dim=dim norm=norm _default_alldims dim Optional DimsType x TensorLikeType - list int Convert Optional DimsType simple list defaulting all dimensions dim None list range x ndim isinstance dim Sequence dim list dim register_decomposition aten fft_fftshift fftshift input TensorLikeType dim Optional DimsType = None - TensorLikeType dims = _default_alldims dim input shift = input shape d d dims torch roll input shift dims register_decomposition aten fft_ifftshift ifftshift input TensorLikeType dim Optional DimsType = None - TensorLikeType dims = _default_alldims dim input shift = input shape d + d dims torch roll input shift dims