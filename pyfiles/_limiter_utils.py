collections typing Optional torch _FreeEventQueue This tracks all pending frees corresponding inflight all-gathers The queueing pattern iterative enqueues single dequeue per iteration once limit ` ` _max_num_inflight_all_gathers ` ` reached __init__ - None _queue collections deque torch Event = collections deque _max_num_inflight_all_gathers = empirically chosen enqueue free_event torch Event - None Enqueues free event _queue append free_event dequeue_if_needed - Optional torch Event Dequeues single event limit reached len _queue = _max_num_inflight_all_gathers _dequeue None _dequeue - Optional torch Event Dequeues free event possible _queue event = _queue popleft event None