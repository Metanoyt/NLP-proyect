Owner s module dynamo collections contextlib torch torch _inductor test_case TestDequeReconstruct torch _inductor test_case TestCase UNSET = object contextlib contextmanager set_deque_in_globals value prev = globals pop deque UNSET assert deque globals try value UNSET globals deque = value yield finally prev UNSET globals pop deque None assert deque globals globals deque = prev test_deque_reconstruct_not_in_globals set_deque_in_globals UNSET torch compile backend= eager fullgraph=True func x collections deque x x + x + maxlen= x = torch randn out = func x assertIsInstance out collections deque assertEqual out maxlen assertEqual out collections deque x + x + maxlen= test_deque_reconstruct_in_globals set_deque_in_globals collections deque This does emit NameError dummy = deque maxlen= noqa F assertIsInstance dummy collections deque assertEqual list dummy torch compile backend= eager fullgraph=True func x collections deque x x + x + maxlen= x = torch randn out = func x assertIsInstance out collections deque assertEqual out maxlen assertEqual out collections deque x + x + maxlen= test_deque_reconstruct_shallows_globals set_deque_in_globals None This does emit NameError assertIsNone deque noqa F torch compile backend= eager fullgraph=True func x collections deque x x + x + maxlen= x = torch randn out = func x assertIsInstance out collections deque assertEqual out maxlen assertEqual out collections deque x + x + maxlen= __name__ == __main__ torch _dynamo test_case run_tests run_tests