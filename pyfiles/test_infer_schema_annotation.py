Owner s module pt -dispatcher __future__ annotations typing typing Optional Union torch torch Tensor types torch testing _internal common_utils run_tests TestCase typing TYPE_CHECKING collections abc Sequence mutates_args = TestInferSchemaWithAnnotation TestCase test_tensor foo_op x torch Tensor - torch Tensor x clone result = torch library infer_schema foo_op mutates_args=mutates_args assertEqual result Tensor x - Tensor foo_op_ x torch Tensor y torch Tensor - torch Tensor x clone + y result = torch library infer_schema foo_op_ mutates_args=mutates_args assertEqual result Tensor x Tensor y - Tensor test_native_types foo_op x int - int x result = torch library infer_schema foo_op mutates_args=mutates_args assertEqual result SymInt x - SymInt foo_op_ x bool - bool x result = torch library infer_schema foo_op_ mutates_args=mutates_args assertEqual result bool x - bool foo_op_ x str - int result = torch library infer_schema foo_op_ mutates_args=mutates_args assertEqual result str x - SymInt foo_op_ x float - float x result = torch library infer_schema foo_op_ mutates_args=mutates_args assertEqual result float x - float test_torch_types foo_op_ x torch types Number - torch types Number x result = torch library infer_schema foo_op_ mutates_args=mutates_args assertEqual result Scalar x - Scalar foo_op_ x torch dtype - int result = torch library infer_schema foo_op_ mutates_args=mutates_args assertEqual result ScalarType x - SymInt foo_op_ x torch device - int result = torch library infer_schema foo_op_ mutates_args=mutates_args assertEqual result Device x - SymInt test_type_variants foo_op_ x typing Optional int - int result = torch library infer_schema foo_op_ mutates_args=mutates_args assertEqual result SymInt x - SymInt foo_op_ x typing Sequence int - int result = torch library infer_schema foo_op_ mutates_args=mutates_args assertEqual result SymInt x - SymInt foo_op_ x list int - int result = torch library infer_schema foo_op_ mutates_args=mutates_args assertEqual result SymInt x - SymInt foo_op_ x typing Optional typing Sequence int - int result = torch library infer_schema foo_op_ mutates_args=mutates_args assertEqual result SymInt x - SymInt foo_op_ x typing Optional list int - int result = torch library infer_schema foo_op_ mutates_args=mutates_args assertEqual result SymInt x - SymInt foo_op_ x typing Union int float bool - types Number x result = torch library infer_schema foo_op_ mutates_args=mutates_args assertEqual result Scalar x - Scalar foo_op_ x typing Union int bool float - types Number x result = torch library infer_schema foo_op_ mutates_args=mutates_args assertEqual result Scalar x - Scalar test_no_library_prefix foo_op x Tensor - Tensor x clone result = torch library infer_schema foo_op mutates_args=mutates_args assertEqual result Tensor x - Tensor foo_op_ x Tensor - torch Tensor x clone result = torch library infer_schema foo_op_ mutates_args=mutates_args assertEqual result Tensor x - Tensor foo_op_ x torch Tensor - Tensor x clone result = torch library infer_schema foo_op_ mutates_args=mutates_args assertEqual result Tensor x - Tensor foo_op_ x list int - types Number x result = torch library infer_schema foo_op_ mutates_args=mutates_args assertEqual result SymInt x - Scalar foo_op_ x Optional int - int result = torch library infer_schema foo_op_ mutates_args=mutates_args assertEqual result SymInt x - SymInt foo_op_ x Sequence int - int result = torch library infer_schema foo_op_ mutates_args=mutates_args assertEqual result SymInt x - SymInt foo_op_ x list int - int result = torch library infer_schema foo_op_ mutates_args=mutates_args assertEqual result SymInt x - SymInt foo_op_ x Optional Sequence int - int result = torch library infer_schema foo_op_ mutates_args=mutates_args assertEqual result SymInt x - SymInt foo_op_ x Optional list int - int result = torch library infer_schema foo_op_ mutates_args=mutates_args assertEqual result SymInt x - SymInt foo_op_ x Union int float bool - types Number x result = torch library infer_schema foo_op_ mutates_args=mutates_args assertEqual result Scalar x - Scalar foo_op_ x Union int bool float - types Number x result = torch library infer_schema foo_op_ mutates_args=mutates_args assertEqual result Scalar x - Scalar test_unsupported_annotation assertRaisesRegex ValueError r Unsupported type annotation D It type foo_op x D - Tensor noqa F torch Tensor x torch library infer_schema foo_op mutates_args=mutates_args assertRaisesRegex ValueError r Unsupported type annotation E It type foo_op_ x Tensor - E noqa F x torch library infer_schema foo_op_ mutates_args=mutates_args __name__ == __main__ run_tests