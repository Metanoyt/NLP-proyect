usr bin env python pathlib Path unittest main SkipTest TestCase gitutils _shasum are_ghstack_branches_in_sync GitRepo patterns_to_regex PeekableIterator retries_decorator BASE_DIR = Path __file__ parent TestPeekableIterator TestCase test_iterator input_ str = abcdef - None iter_ = PeekableIterator input_ idx c enumerate iter_ assertEqual c input_ idx test_is_iterable - None collections abc Iterator iter_ = PeekableIterator assertTrue isinstance iter_ Iterator test_peek input_ str = abcdef - None iter_ = PeekableIterator input_ idx c enumerate iter_ idx + len input_ assertEqual iter_ peek input_ idx + assertTrue iter_ peek None TestPattern TestCase test_double_asterisks - None allowed_patterns = aten src ATen native LinearAlgebra patterns_re = patterns_to_regex allowed_patterns fnames = aten src ATen native LinearAlgebra cpp aten src ATen native cpu LinearAlgebraKernel cpp filename fnames assertTrue patterns_re match filename TestRetriesDecorator TestCase test_simple - None retries_decorator foo x int y int - int x + y assertEqual foo test_fails - None retries_decorator rc= foo x int y int - int x + y assertEqual foo TestGitRepo TestCase setUp - None repo_dir = BASE_DIR absolute parent parent repo_dir git is_dir raise SkipTest Can t find git directory make sure run test real repo checkout repo = GitRepo str repo_dir _skip_if_ref_does_not_exist ref str - None Skip test ref missing stale branches deleted time try repo show_ref ref except RuntimeError e raise SkipTest f Can t find head ref ref due str e e test_compute_diff - None diff = repo diff HEAD sha = _shasum diff assertEqual len sha test_ghstack_branches_in_sync - None head_ref = gh SS-JIA head _skip_if_ref_does_not_exist head_ref assertTrue are_ghstack_branches_in_sync repo head_ref test_ghstack_branches_not_in_sync - None head_ref = gh clee head _skip_if_ref_does_not_exist head_ref assertFalse are_ghstack_branches_in_sync repo head_ref __name__ == __main__ main