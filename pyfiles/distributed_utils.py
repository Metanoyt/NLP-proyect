mypy allow-untyped-defs contextlib contextmanager datetime timedelta functools partial wraps torch distributed dist torch distributed distributed_c d c d MockProcessGroup dist ProcessGroup __init__ rank world super __init__ rank world getBackendName mock_process_group create_mock_pg prefix_store rank world_size timeout MockProcessGroup rank world_size dist Backend register_backend mock_process_group create_mock_pg mock_init_dist rank world_size WARNING Kids don t try home cute pile hacks depends small mountain c d internals assert dist is_initialized store = dist HashStore Trick _store_based_barrier into believing everyone already checked-in Zero group index store add f c d STORE_BASED_BARRIER_PREFIX world_size - dist init_process_group backend= mock_process_group rank=rank world_size=world_size store=store group_name= fake timeout=timedelta seconds= contextmanager with_dist rank= world_size= Context manager initializer c d fake process group mock_init_dist rank=rank world_size=world_size try yield finally dist destroy_process_group with_fake_comms func=None rank= world_size= Function wrapper inits fake process group designed testing Right now only querying world size available func None partial with_fake_comms rank=rank world_size=world_size wraps func wrapper args kwargs with_dist rank world_size func args kwargs wrapper