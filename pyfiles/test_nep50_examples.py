Owner s module dynamo Test examples NEP itertools unittest skipIf skipif SkipTest try numpy _np v = _np __version__ split HAVE_NUMPY = int v = int v = except ImportError HAVE_NUMPY = False torch _numpy tnp torch _numpy noqa F array bool_ complex complex float float inf int int int uint torch _numpy testing assert_allclose torch testing _internal common_utils instantiate_parametrized_tests parametrize run_tests TestCase uint = uint can anything here see below numpy array uint uint int float float inf numpy testing assert_allclose numpy np np _set_promotion_state weak pytest raises assert_raises unchanged = None expression old result new_result examples = uint + int uint array uint + int array uint array int array uint + array int array uint array int array float + float array float array float array float + array float array float array float array uint + array uint unchanged array uint + array uint unchanged array uint + array uint unchanged array uint + array uint Exception uint + int Exception uint + int uint RuntimeWarning float + e float e float inf RuntimeWarning T array float + e- == array True unchanged array float == float array True array False array float + e- == array False array True array float + array float unchanged array float + int array float array float j + array complex array + j complex array + j complex float + j array + j complex array + j complex int + j array + j complex unchanged additional examples NEP text int + int int int + j complex + j unchanged float + j complex + j complex + j bool_ True + int unchanged True + uint uint unchanged skipif HAVE_NUMPY reason= NumPy found instantiate_parametrized_tests TestNEP Table TestCase parametrize example examples test_nep _exceptions example old new = examples example new Exception assert_raises OverflowError eval example result = eval example new unchanged new = old assert_allclose result new atol= e- assert result dtype == new dtype ### Directly compare numpy ### weaks = True j non_weaks = tnp asarray True tnp uint tnp int tnp int tnp int tnp float tnp float tnp complex tnp complex HAVE_NUMPY dtypes = None _np bool_ _np uint _np int _np int _np int _np float _np float _np complex _np complex dtypes = None ufunc name array dtype corners = true_divide bool_ uint int int int int divide bool_ uint int int int int arctan bool_ uint int int int int copysign bool_ uint int int int int heaviside bool_ uint int int int int ldexp bool_ uint int int int int power uint nextafter float skipif HAVE_NUMPY reason= NumPy found instantiate_parametrized_tests TestCompareToNumpy TestCase parametrize scalar array dtype itertools product weaks non_weaks dtypes test_direct_compare scalar array dtype compare NumPy w NEP try state = _np _get_promotion_state _np _set_promotion_state weak dtype None kwargs = dtype dtype try result_numpy = _np add scalar array tensor numpy kwargs except Exception kwargs = dtype None kwargs = dtype getattr tnp dtype __name__ result = tnp add scalar array kwargs tensor numpy assert result dtype == result_numpy dtype assert result == result_numpy finally _np _set_promotion_state state parametrize name tnp _ufuncs _binary parametrize scalar array itertools product weaks non_weaks test_compare_ufuncs name scalar array name corners array dtype name corners name tnp asarray scalar dtype name corners name raise SkipTest f name dtype=array dtype try state = _np _get_promotion_state _np _set_promotion_state weak name matmul modf divmod ldexp ufunc = getattr tnp name ufunc_numpy = getattr _np name try result = ufunc scalar array except RuntimeError RuntimeError bitwise_xor_cpu implemented ComplexDouble etc result = None try result_numpy = ufunc_numpy scalar array tensor numpy except TypeError TypeError ufunc hypot supported input types result_numpy = None result None result_numpy None assert result tensor numpy dtype == result_numpy dtype finally _np _set_promotion_state state __name__ == __main__ run_tests