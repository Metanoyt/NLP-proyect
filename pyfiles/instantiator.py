usr bin python mypy allow-untyped-defs importlib abc importlib util sys torch torch distributed nn jit templates remote_module_template get_remote_module_template _FILE_PREFIX = _remote_module_ get_arg_return_types_from_interface module_interface assert getattr module_interface __torch_script_interface__ False Expect TorchScript interface decorated torch jit interface qualified_name = torch _jit_internal _qualified_name module_interface cu = torch jit _state _python_cu module_interface_c = cu get_interface qualified_name assert forward module_interface_c getMethodNames f Expect forward interface methods while has module_interface_c getMethodNames method_schema = module_interface_c getMethod forward arg_str_list = arg_type_str_list = assert method_schema None argument method_schema arguments arg_str_list append argument name argument has_default_value default_value_str = f = argument default_value default_value_str = arg_type_str = f argument name argument type default_value_str arg_type_str_list append arg_type_str arg_str_list = arg_str_list Remove args_str = join arg_str_list arg_type_str_list = arg_type_str_list Remove arg_types_str = join arg_type_str_list assert len method_schema returns == argument = method_schema returns return_type_str = str argument type args_str arg_types_str return_type_str _StringLoader importlib abc SourceLoader __init__ data data = data get_source fullname data get_data path data encode utf- get_filename fullname fullname _do_instantiate_remote_module_template generated_module_name str_dict enable_moving_cpu_tensors_to_cuda generated_module_name sys modules sys modules generated_module_name loader = _StringLoader get_remote_module_template enable_moving_cpu_tensors_to_cuda format str_dict spec = importlib util spec_from_loader generated_module_name loader origin= torch-git assert spec None module = importlib util module_from_spec spec sys modules generated_module_name = module loader exec_module module module instantiate_scriptable_remote_module_template module_interface_cls enable_moving_cpu_tensors_to_cuda=True getattr module_interface_cls __torch_script_interface__ False raise ValueError f module_interface_cls module_interface_cls must type object decorated torch jit interface Generate template instance name module_interface_cls_name = torch _jit_internal _qualified_name module_interface_cls replace _ generated_module_name = f _FILE_PREFIX module_interface_cls_name Generate type annotation strs assign_module_interface_cls_str = f module_interface_cls __module__ f module_interface_cls __name__ module_interface_cls args_str arg_types_str return_type_str = get_arg_return_types_from_interface module_interface_cls kwargs_str = arrow_and_return_type_str = f - return_type_str arrow_and_future_return_type_str = f - Future return_type_str str_dict = dict assign_module_interface_cls=assign_module_interface_cls_str arg_types=arg_types_str arrow_and_return_type=arrow_and_return_type_str arrow_and_future_return_type=arrow_and_future_return_type_str args=args_str kwargs=kwargs_str jit_script_decorator= torch jit script _do_instantiate_remote_module_template generated_module_name str_dict enable_moving_cpu_tensors_to_cuda instantiate_non_scriptable_remote_module_template generated_module_name = f _FILE_PREFIX non_scriptable str_dict = dict assign_module_interface_cls= module_interface_cls = None args= args kwargs= kwargs arg_types= args kwargs arrow_and_return_type= arrow_and_future_return_type= jit_script_decorator= For non-scriptable template always enable moving CPU tensors cuda device because there no syntax limitation extra handling caused script _do_instantiate_remote_module_template generated_module_name str_dict True