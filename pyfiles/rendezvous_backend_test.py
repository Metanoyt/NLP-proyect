Owner s oncall r p Copyright c Facebook Inc its affiliates All rights reserved This source code licensed under BSD-style license found LICENSE file root directory source tree abc ABC abstractmethod collections abc Callable typing Any cast Optional torch distributed elastic rendezvous RendezvousStateError torch distributed elastic rendezvous dynamic_rendezvous RendezvousBackend Token RendezvousBackendTestMixin ABC _backend RendezvousBackend Type hints assertEqual Callable assertNotEqual Callable assertIsNone Callable assertIsNotNone Callable assertRaises Callable abstractmethod _corrupt_state - None Corrupts state stored backend _set_state state bytes token Optional Any = None - tuple bytes Token bool result = _backend set_state state token assertIsNotNone result cast tuple bytes Token bool result test_get_state_returns_backend_state - None _backend set_state b x result = _backend get_state assertIsNotNone result state token = cast tuple bytes Token result assertEqual b x state assertIsNotNone token test_get_state_returns_none_if_backend_state_does_not_exist - None result = _backend get_state assertIsNone result test_get_state_raises_error_if_backend_state_is_corrupt - None _corrupt_state assertRaises RendezvousStateError _backend get_state test_set_state_sets_backend_state_if_it_does_not_exist - None state token has_set = _set_state b x assertEqual b x state assertIsNotNone token assertTrue has_set test_set_state_sets_backend_state_if_token_is_current - None _ token has_set = _set_state b x state token has_set = _set_state b y token assertEqual b y state assertNotEqual token token assertTrue has_set assertTrue has_set test_set_state_returns_current_backend_state_if_token_is_old - None _ token _ = _set_state b x state token _ = _set_state b y token state token has_set = _set_state b z token assertEqual state state assertEqual token token assertFalse has_set test_set_state_returns_current_backend_state_if_token_is_none - None state token _ = _set_state b x state token has_set = _set_state b y assertEqual state state assertEqual token token assertFalse has_set test_set_state_returns_current_backend_state_if_token_is_invalid - None state token _ = _set_state b x state token has_set = _set_state b y token= invalid assertEqual state state assertEqual token token assertFalse has_set