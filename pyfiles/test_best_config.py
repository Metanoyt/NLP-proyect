Owner s module inductor glob json os sys tempfile unittest torch torch _inductor config torch testing _internal common_utils IS_LINUX torch testing _internal inductor_utils GPU_TYPE HAS_GPU try triton noqa F except ImportError e __name__ == __main__ sys exit raise unittest SkipTest requires triton e torch _inductor test_case run_tests TestCase trivial_kernel x torch sin x + torch cos x TestKernelBestConfig TestCase device_type = GPU_TYPE classmethod setUpClass cls Save original configuration environment variables cls original_compile_threads = config compile_threads cls original_max_autotune = config max_autotune cls original_inductor_env = os environ get TORCHINDUCTOR_CACHE_DIR cls original_triton_env = os environ get TRITON_CACHE_DIR super setUpClass classmethod tearDownClass cls Restore original configuration environment variables os environ TORCHINDUCTOR_CACHE_DIR = cls original_inductor_env os environ TRITON_CACHE_DIR = cls original_triton_env config compile_threads = cls original_compile_threads config max_autotune = cls original_max_autotune super tearDownClass test_best_config_has_triton_cache_key tempfile TemporaryDirectory tmpdir os environ TORCHINDUCTOR_CACHE_DIR = tmpdir triton_cache_dir = os path join tmpdir triton_cache os environ TRITON_CACHE_DIR = triton_cache_dir config compile_threads = config max_autotune = True compiled_fn = torch compile trivial_kernel x = torch randn device=GPU_TYPE compiled_fn x Search best_config files inductor cache directory best_config_files = glob glob os path join tmpdir best_config recursive=True assertGreater len best_config_files f No best_config files found tmpdir Directory contents os listdir tmpdir Validate each best_config file contains real triton_cache_hash corresponding Triton cache directory exists file_path best_config_files open file_path f data = json load f assertIn triton_cache_hash data f Missing triton_cache_hash os path basename file_path cache_hash = data triton_cache_hash expected_path = os path join triton_cache_dir cache_hash assertTrue os path exists expected_path f Triton cache directory missing expected_path __name__ == __main__ IS_LINUX HAS_GPU run_tests