Owner s module inductor operator os tempfile threading Event torch _inductor compile_worker subproc_pool raise_testexc SubprocException SubprocPool torch _inductor compile_worker timer Timer torch _inductor test_case TestCase torch testing _internal common_utils skipIfWindows torch testing _internal inductor_utils HAS_CPU TestCompileWorker TestCase skipIfWindows msg= pass_fds supported Windows test_basic_jobs pool = SubprocPool try = pool submit operator add b = pool submit operator sub assertEqual result assertEqual b result finally pool shutdown skipIfWindows msg= pass_fds supported Windows test_exception pool = SubprocPool try = pool submit raise_testexc assertRaisesRegex SubprocException torch _inductor compile_worker subproc_pool TestException result finally pool shutdown skipIfWindows msg= pass_fds supported Windows test_crash pool = SubprocPool try assertRaises Exception = pool submit os _exit result Pool should still usable after crash b = pool submit operator add c = pool submit operator sub assertEqual b result assertEqual c result finally pool shutdown skipIfWindows msg= pass_fds supported Windows test_quiesce pool = SubprocPool try = pool submit operator add pool quiesce pool wakeup b = pool submit operator sub assertEqual result assertEqual b result finally pool shutdown skipIfWindows msg= pass_fds supported Windows test_logging os environ MAST_HPC_JOB_NAME = test_job os environ ROLE_RANK = tempfile NamedTemporaryFile delete=True temp_log os environ TORCHINDUCTOR_WORKER_LOGPATH = temp_log name pool = SubprocPool try pool submit operator add assertEqual os path exists temp_log name True finally pool shutdown TestTimer TestCase test_basics done = Event doit done set t = Timer doit t sleep_time = t record_call assertTrue done wait t quit test_repeated_calls done = Event doit done set t = Timer doit t sleep_time = _ range t record_call assertTrue done wait done clear t quit test_never_fires done = Event doit done set t = Timer doit t sleep_time = t record_call assertFalse done wait t quit test_spammy_calls done = Event doit done set t = Timer doit t sleep_time = _ range t record_call assertTrue done wait t quit __name__ == __main__ torch _inductor test_case run_tests HAS_CPU run_tests