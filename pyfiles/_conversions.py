mypy allow-untyped-defs torch torch _prims_common utils Utilities should come BEFORE torch _decomp register_decomposition torch _prims_common TensorLikeType torch _prims_common wrappers out_wrapper torch _refs _broadcast_shapes Data conversion references Note module breaks usual _refs torch naming scheme where _refs foo bar ref torch foo bar The following definitions part _refs __init__ py avoid name clashes Python builtin types like int __all__ = dtypes bfloat bool byte cdouble cfloat chalf char double float half int long short misc complex polar _make_conversion_method name str dtype torch dtype fn TensorLikeType memory_format torch memory_format = torch preserve_format - TensorLikeType dtype memory_format=memory_format type ignore call-overload fn __name__ = name fn bfloat = _make_conversion_method bfloat torch bfloat bool = _make_conversion_method bool torch bool byte = _make_conversion_method byte torch uint cdouble = _make_conversion_method cdouble torch cdouble cfloat = _make_conversion_method cfloat torch cfloat chalf = _make_conversion_method chalf torch complex char = _make_conversion_method char torch int double = _make_conversion_method double torch double float = _make_conversion_method float torch float half = _make_conversion_method half torch half int = _make_conversion_method int torch int long = _make_conversion_method long torch long short = _make_conversion_method short torch short register_decomposition torch _ops ops aten complex Note complex has type promotion tests disabled due different semantics exact_dtype compat complex_check_dtype core out_wrapper exact_dtype=True complex real TensorLikeType imag TensorLikeType - TensorLikeType allowed_dtypes = torch float torch float torch float torch _check real dtype allowed_dtypes imag dtype allowed_dtypes lambda f Expected both inputs Half Float Double tensors got f real dtype imag dtype torch _check real dtype == imag dtype lambda f Expected object scalar type real dtype got f scalar type imag dtype second argument result_dtype = utils corresponding_complex_dtype real dtype type ignore arg-type common_shape = _broadcast_shapes real shape imag shape result = real new_empty common_shape dtype=result_dtype layout=real layout device=real device pin_memory=real is_pinned NYI result real = real result imag = imag result register_decomposition torch _ops ops aten polar Note polar has type promotion tests disabled due different semantics exact_dtype compat complex_check_dtype core out_wrapper exact_dtype=True polar abs TensorLikeType angle TensorLikeType - TensorLikeType result = torch complex abs angle result real = abs torch cos angle result imag = abs torch sin angle result