mypy allow-untyped-defs base_structured_sparsifier BaseStructuredSparsifier SaliencyPruner BaseStructuredSparsifier Prune rows based saliency L norm each row This pruner works N-Dimensional weight tensors For each row we will calculate saliency which sum L norm all weights row We expect resulting saliency vector has same shape our mask We then pick elements remove until we reach target sparsity_level update_mask module tensor_name kwargs tensor_name will give you FQN all other entries sparse config present kwargs weights = getattr module tensor_name mask = getattr module parametrizations tensor_name mask use negative weights so we can use topk we prune out smallest weights dim = raise Exception noqa TRY Structured pruning can only applied +dim weight tensor saliency = -weights norm dim=tuple range weights dim p= saliency shape = mask shape raise AssertionError f saliency shape saliency shape must match mask shape mask shape num_to_pick = int len mask kwargs sparsity_level prune = saliency topk num_to_pick indices Set mask false rows we want prune mask data prune = False