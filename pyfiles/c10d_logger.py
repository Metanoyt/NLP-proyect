usr bin env python mypy allow-untyped-defs Copyright c Facebook Inc its affiliates All rights reserved This source code licensed under BSD-style license found LICENSE file root directory source tree functools logging collections abc Callable typing Any TypeVar typing_extensions ParamSpec torch torch distributed dist torch distributed logging_handlers _log_handlers torch monitor _WaitCounter __all__ list str = _DEFAULT_DESTINATION = default _get_or_create_logger destination str = _DEFAULT_DESTINATION - logging Logger logging_handler log_handler_name = _get_logging_handler destination logger = logging getLogger f c d- log_handler_name logger setLevel logging DEBUG formatter = logging Formatter asctime s filename s lineno s levelname s p processName s t threadName s message s logging_handler setFormatter formatter logger propagate = False logger addHandler logging_handler logger _get_logging_handler destination str = _DEFAULT_DESTINATION - tuple logging Handler str log_handler = _log_handlers destination log_handler_name = f type log_handler __name__ - destination log_handler log_handler_name pyrefly ignore unknown-name global _c d_logger _c d_logger = _get_or_create_logger _get_msg_dict func_name args kwargs - dict str Any dist is_initialized group = kwargs get group kwargs get process_group msg_dict = func_name f func_name pg_name f dist _get_process_group_name kwargs get pg type ignore arg-type backend f dist get_backend group world_size f dist get_world_size group_size f dist get_world_size group global_rank f dist get_rank local_rank f dist get_rank group msg_dict backend == nccl nccl_version = torch cuda nccl version msg_dict nccl_version = join str v v nccl_version msg_dict = func_name f func_name msg_dict _T = TypeVar _T _P = ParamSpec _P _exception_logger func Callable _P _T - Callable _P _T functools wraps func wrapper args _P args kwargs _P kwargs - _T try func args kwargs except Exception error msg_dict = _get_msg_dict func __name__ args kwargs msg_dict error = f error _c d_logger debug msg_dict raise wrapper _time_logger func Callable _P _T - Callable _P _T functools wraps func wrapper args _P args kwargs _P kwargs - _T _WaitCounter f pytorch wait_counter c d func __name__ guard func_return = func args kwargs func_return wrapper