Owner s oncall jit os sys enum Enum typing Any List torch torch testing FileCheck Make helper files test importable pytorch_test_dir = os path dirname os path dirname os path realpath __file__ sys path append pytorch_test_dir torch testing _internal common_utils raise_on_run_directly torch testing _internal jit_utils JitTestCase make_global TestEnum JitTestCase test_enum_value_types IntEnum Enum FOO = BAR = FloatEnum Enum FOO = BAR = StringEnum Enum FOO = foo foo bar BAR = bar foo bar make_global IntEnum FloatEnum StringEnum torch jit script supported_enum_types IntEnum b FloatEnum c StringEnum name b name c name FileCheck check IntEnum check FloatEnum check StringEnum run str supported_enum_types graph TensorEnum Enum FOO = torch tensor BAR = torch tensor make_global TensorEnum unsupported_enum_types TensorEnum name TODO rewrite code so highlight empty assertRaisesRegexWithHighlight RuntimeError Cannot create Enum value type Tensor torch jit script unsupported_enum_types test_enum_comp Color Enum RED = GREEN = make_global Color torch jit script enum_comp x Color y Color - bool x == y FileCheck check aten eq run str enum_comp graph assertEqual enum_comp Color RED Color RED True assertEqual enum_comp Color RED Color GREEN False test_enum_comp_diff_classes Foo Enum ITEM = ITEM = Bar Enum ITEM = ITEM = make_global Foo Bar torch jit script enum_comp x Foo - bool x == Bar ITEM FileCheck check prim Constant check_same Bar ITEM check aten eq run str enum_comp graph assertEqual enum_comp Foo ITEM False test_heterogenous_value_type_enum_error Color Enum RED = GREEN = green make_global Color enum_comp x Color y Color - bool x == y TODO rewrite code so highlight empty assertRaisesRegexWithHighlight RuntimeError Could unify type list torch jit script enum_comp test_enum_name Color Enum RED = GREEN = make_global Color torch jit script enum_name x Color - str x name FileCheck check Color check_next prim EnumName check_next run str enum_name graph assertEqual enum_name Color RED Color RED name assertEqual enum_name Color GREEN Color GREEN name test_enum_value Color Enum RED = GREEN = make_global Color torch jit script enum_value x Color - int x value FileCheck check Color check_next prim EnumValue check_next run str enum_value graph assertEqual enum_value Color RED Color RED value assertEqual enum_value Color GREEN Color GREEN value test_enum_as_const Color Enum RED = GREEN = make_global Color torch jit script enum_const x Color - bool x == Color RED FileCheck check prim Constant value=__torch__ jit test_enum Color RED check_next aten eq check_next run str enum_const graph assertEqual enum_const Color RED True assertEqual enum_const Color GREEN False test_non_existent_enum_value Color Enum RED = GREEN = make_global Color enum_const x Color - bool x == Color PURPLE True False assertRaisesRegexWithHighlight RuntimeError has no attribute PURPLE Color PURPLE torch jit script enum_const test_enum_ivalue_type Color Enum RED = GREEN = make_global Color torch jit script is_color_enum x Any isinstance x Color FileCheck check prim isinstance types= Enum __torch__ jit test_enum Color check_next run str is_color_enum graph assertEqual is_color_enum Color RED True assertEqual is_color_enum Color GREEN True assertEqual is_color_enum False test_closed_over_enum_constant Color Enum RED = GREEN = = Color torch jit script closed_over_aliased_type RED value FileCheck check prim Constant value= format RED value check_next run str closed_over_aliased_type graph assertEqual closed_over_aliased_type Color RED value b = Color RED torch jit script closed_over_aliased_value b value FileCheck check prim Constant value= format b value check_next run str closed_over_aliased_value graph assertEqual closed_over_aliased_value Color RED value test_enum_as_module_attribute Color Enum RED = GREEN = TestModule torch nn Module __init__ e Color super __init__ e = e forward e value m = TestModule Color RED scripted = torch jit script m FileCheck check TestModule check_next Color check_same prim GetAttr name= e check_next prim EnumValue check_next run str scripted graph assertEqual scripted Color RED value test_string_enum_as_module_attribute Color Enum RED = red GREEN = green TestModule torch nn Module __init__ e Color super __init__ e = e forward e name e value make_global Color m = TestModule Color RED scripted = torch jit script m assertEqual scripted Color RED name Color RED value test_enum_return Color Enum RED = GREEN = make_global Color torch jit script return_enum cond bool cond Color RED Color GREEN assertEqual return_enum True Color RED assertEqual return_enum False Color GREEN test_enum_module_return Color Enum RED = GREEN = TestModule torch nn Module __init__ e Color super __init__ e = e forward e make_global Color m = TestModule Color RED scripted = torch jit script m FileCheck check TestModule check_next Color check_same prim GetAttr name= e check_next run str scripted graph assertEqual scripted Color RED test_enum_iterate Color Enum RED = GREEN = BLUE = iterate_enum x Color res List int = e Color e = x res append e value res make_global Color scripted = torch jit script iterate_enum FileCheck check Enum __torch__ jit test_enum Color check_same Color RED check_same Color GREEN check_same Color BLUE run str scripted graph PURPLE always appears last because we follow Python s Enum definition order assertEqual scripted Color RED Color GREEN value Color BLUE value assertEqual scripted Color GREEN Color RED value Color BLUE value Tests explicitly repeatedly scripting Enum permitted test_enum_explicit_script torch jit script Color Enum RED = GREEN = torch jit script Color Regression test https github com pytorch pytorch issues test_typed_enum Color int Enum RED = GREEN = torch jit script is_red x Color - bool x == Color RED __name__ == __main__ raise_on_run_directly test test_jit py