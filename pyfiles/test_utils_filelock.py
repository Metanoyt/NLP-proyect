Owner s module unknown concurrent futures tempfile time torch testing _internal common_utils run_tests skipIfWindows TestCase torch utils _filelock FileLock TestFileLock TestCase test_no_crash _ p = tempfile mkstemp FileLock p pass skipIfWindows msg= Windows doesn t support multiple files being opened once easily test_sequencing tempfile NamedTemporaryFile ofd p = ofd name test_thread i FileLock p + lock start = time time open p fd fd write str i end = time time start end concurrent futures ThreadPoolExecutor max_workers= executor futures = executor submit test_thread i i range times = f futures times append f result open p fd assertEqual set fd read i start end enumerate times j newstart newend enumerate times i == j continue Times should never intersect assertFalse newstart start newstart end assertFalse newend start newstart end __name__ == __main__ run_tests