torch torch export Dim custom op loads aot-compiled model AOTI_CUSTOM_OP_LIB = libaoti_custom_class so torch classes load_library AOTI_CUSTOM_OP_LIB TensorSerializer torch nn Module __init__ data super __init__ key data setattr key data key SimpleModule torch nn Module simple module compiled __init__ - None super __init__ fc = torch nn Linear relu = torch nn ReLU forward x = fc x b = relu b MyAOTIModule torch nn Module wrapper nn Module instantiates its forward method MyAOTIClass __init__ lib_path device super __init__ aoti_custom_op = torch classes aoti MyAOTIClass lib_path device forward x outputs = aoti_custom_op forward x tuple outputs make_script_module lib_path device inputs m = MyAOTIModule lib_path device sanity check m inputs torch jit trace m inputs compile_model device data module = SimpleModule device x = torch randn device=device inputs = x make batch dimension batch_dim = Dim batch min= max= dynamic_shapes = x batch_dim torch no_grad aot-compile module into so pointed lib_path lib_path = torch _export aot_compile module inputs dynamic_shapes=dynamic_shapes script_module = make_script_module lib_path device inputs aoti_script_model = f script_model_ device pt script_module save aoti_script_model save sample inputs ref output torch no_grad ref_output = module inputs data update f inputs_ device list inputs f outputs_ device ref_output main data = device cpu cuda torch cuda is_available cpu compile_model device data torch jit script TensorSerializer data save script_data pt __name__ == __main__ main