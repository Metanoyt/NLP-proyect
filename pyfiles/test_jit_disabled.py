Owner s oncall jit sys os contextlib subprocess torch testing _internal common_utils TestCase run_tests TemporaryFileName contextlib contextmanager _jit_disabled cur_env = os environ get PYTORCH_JIT os environ PYTORCH_JIT = try yield finally os environ PYTORCH_JIT = cur_env TestJitDisabled TestCase These tests separate rest JIT tests because we need run new subprocess ` torch ` correct environment variables set compare_enabled_disabled src Runs script ` src ` PYTORCH_JIT enabled disabled compares their stdout equality Write ` src ` out temporary so our source inspection logic works correctly TemporaryFileName fname open fname w f f write src _jit_disabled out_disabled = subprocess check_output sys executable fname out_enabled = subprocess check_output sys executable fname assertEqual out_disabled out_enabled test_attribute _program_string = torch Foo torch jit ScriptModule __init__ x super __init__ x = torch jit Attribute x torch Tensor forward input input s = Foo torch ones print s x compare_enabled_disabled _program_string test_script_module_construction _program_string = torch AModule torch jit ScriptModule torch jit script_method forward input pass AModule print Didn t throw exception compare_enabled_disabled _program_string test_recursive_script _program_string = torch AModule torch nn Module forward input pass sm = torch jit script AModule print Didn t throw exception compare_enabled_disabled _program_string __name__ == __main__ run_tests