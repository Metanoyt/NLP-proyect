Owner s module inductor unittest sympy torch torch _dynamo test_case TestCase torch _inductor codegen cuda cutlass_utils torch_dtype_to_cutlass_type try_import_cutlass torch _inductor ir ComputedBuffer FixedLayout PermuteView Pointwise torch _inductor scheduler BaseSchedulerNode torch _inductor utils OrderedSet torch testing _internal common_cuda SM OrLater torch testing _internal inductor_utils HAS_CPU HAS_CUDA_AND_TRITON MockGraphHandler try_import_cutlass cutlass_library cutlass_lib cutlass_library EpilogueScheduleType LayoutType = cutlass_lib LayoutType DataType = cutlass_lib DataType cutlass_cppgen backend evt ir tensor Tensor CutlassTensor torch _inductor codegen cuda cutlass_lib_extensions evt_extensions _render_argument_type _trace trace BIAS_CODE = example_epilogue accum C aux bias F = accum + C + aux E = relu F + bias D = E + F D F TYPE_C = DataType f M = N = BIAS = CutlassTensor shape= M element=TYPE_C layout_tag=LayoutType RowMajor EXAMPLE_TENSORS = accum CutlassTensor element=DataType f shape= M N layout_tag=LayoutType RowMajor bias BIAS beta TODO mlazos support scalars alpha TODO mlazos support scalars D CutlassTensor element=DataType f shape= M N layout_tag=LayoutType RowMajor C CutlassTensor element=DataType f shape= M N layout_tag=LayoutType RowMajor F CutlassTensor element=DataType f shape= M N layout_tag=LayoutType RowMajor aux CutlassTensor element=DataType f shape= M N layout_tag=LayoutType RowMajor MockTileDescription threadblock_shape = _create_mock_buffer_name_map example_tensors name_to_buffer = name tensor example_tensors items isinstance tensor CutlassTensor name_to_buffer name = MockComputedBuffer name None torch float tensor shape tensor stride name_to_buffer MockSchedulerNode BaseSchedulerNode __init__ node last_usage=None node = node last_usage = last_usage OrderedSet MockComputedBuffer ComputedBuffer __init__ name inner_fn dtype size strides=None name = name ranges = sympy Integer x x size data = Pointwise device=None dtype=dtype inner_fn=inner_fn ranges=ranges layout = FixedLayout None dtype ranges strides get_name name num_reads Needed inline ComputedBuffer TestCutlassEVT TestCase unittest skipIf SM OrLater need sm_ unittest skipIf try_import_cutlass requires cutlass test_py_codegen_accumulator_return torch _inductor codegen cuda cutlass_python_evt CutlassEVTCodegen torch _inductor virtualized V size = buf = MockComputedBuffer buf None torch float size buf = MockComputedBuffer buf None torch float size buf = MockComputedBuffer buf None torch float size buf acc buf external inner_fn_buf index tmp = buf make_loader index tmp = buf make_loader index tmp = buf make_loader index tmp tmp + tmp inner_fn_buf index tmp = buf make_loader index tmp = buf make_loader index tmp + tmp buf = MockComputedBuffer buf inner_fn_buf torch float size buf = MockComputedBuffer buf inner_fn_buf torch float size V set_graph_handler MockGraphHandler buf buf buf buf buf buf buf buf buf buf reads writes renames code = CutlassEVTCodegen ir_to_evt_python_code buf MockSchedulerNode buf MockSchedulerNode buf last_usage=OrderedSet buf OrderedSet assertExpectedInline reads buf buf assertExpectedInline writes buf buf buf assertExpectedInline renames accum buf tmp_ buf buf buf buf buf tmp_ buf D buf assertExpectedInline code \ fn accum buf buf tmp_ = accum tmp_ = tmp_ buf tmp_ = tmp_ + buf D = tmp_ + tmp_ tmp_ tmp_ D unittest skipIf SM OrLater need sm_ unittest skipIf try_import_cutlass requires cutlass test_py_codegen_disjoint_read_indexing torch _inductor codegen cuda cutlass_python_evt CutlassEVTCodegen torch _inductor virtualized V size = buf = MockComputedBuffer buf None torch float size permuted_buf_ = PermuteView create buf buf = MockComputedBuffer buf None torch float size buf = MockComputedBuffer buf None torch float size buf acc buf external inner_fn_buf index tmp = permuted_buf_ make_loader index tmp = buf make_loader index tmp = buf make_loader index tmp tmp + tmp inner_fn_buf index tmp = buf make_loader index tmp = buf make_loader index tmp + tmp buf = MockComputedBuffer buf inner_fn_buf torch float size buf = MockComputedBuffer buf inner_fn_buf torch float size V set_graph_handler MockGraphHandler buf buf buf buf buf buf buf buf buf buf result = None try CutlassEVTCodegen ir_to_evt_python_code buf MockSchedulerNode buf MockSchedulerNode buf OrderedSet except NotImplementedError e result = e assertExpectedInline str result Unsupported indexing buf index i + i + i \ index strides layout stride unittest skipIf SM OrLater need sm_ unittest skipIf try_import_cutlass requires cutlass test_py_codegen_broadcasting torch _inductor codegen cuda cutlass_python_evt CutlassEVTCodegen torch _inductor virtualized V size = buf = MockComputedBuffer buf None torch float size buf = MockComputedBuffer buf None torch float size buf = MockComputedBuffer buf None torch float size buf acc buf external inner_fn_buf index tmp = buf make_loader index tmp = buf make_loader index tmp = buf make_loader index tmp tmp + tmp inner_fn_buf index tmp = buf make_loader index tmp = buf make_loader index tmp + tmp tmp buf = MockComputedBuffer buf inner_fn_buf torch float size buf = MockComputedBuffer buf inner_fn_buf torch float broadcast V set_graph_handler MockGraphHandler buf buf buf buf buf buf buf buf buf buf reads writes renames code = CutlassEVTCodegen ir_to_evt_python_code buf MockSchedulerNode buf MockSchedulerNode buf last_usage=OrderedSet buf OrderedSet assertExpectedInline reads buf buf assertExpectedInline writes buf buf buf assertExpectedInline renames accum buf tmp_ buf buf buf buf buf tmp_ buf D buf assertExpectedInline code \ fn accum buf buf tmp_ = accum tmp_ = tmp_ buf tmp_ = tmp_ + buf tmp_ = tmp_ tmp_ D = tmp_ + tmp_ tmp_ tmp_ D unittest skipIf SM OrLater need sm_ unittest skipIf try_import_cutlass requires cutlass test_py_codegen torch _inductor codegen cuda cutlass_python_evt CutlassEVTCodegen torch _inductor virtualized V size = buf = MockComputedBuffer buf None torch float size buf = MockComputedBuffer buf None torch float size buf = MockComputedBuffer buf None torch float size buf acc buf external inner_fn_buf index tmp = buf make_loader index tmp = buf make_loader index tmp = buf make_loader index tmp tmp + tmp inner_fn_buf index tmp = buf make_loader index tmp = buf make_loader index tmp + tmp buf = MockComputedBuffer buf inner_fn_buf torch float size buf = MockComputedBuffer buf inner_fn_buf torch float size V set_graph_handler MockGraphHandler buf buf buf buf buf buf buf buf buf buf reads writes renames code = CutlassEVTCodegen ir_to_evt_python_code buf MockSchedulerNode buf MockSchedulerNode buf OrderedSet buf assertExpectedInline reads buf buf assertExpectedInline writes buf buf assertExpectedInline renames accum buf buf buf buf buf tmp_ buf D buf assertExpectedInline code \ fn accum buf buf tmp_ = accum buf tmp_ = tmp_ + buf D = accum + tmp_ tmp_ D unittest skipIf SM OrLater need sm_ unittest skipIf try_import_cutlass requires cutlass test_example_tensor_creation torch _inductor codegen cuda cutlass_lib_extensions evt_extensions create_example_tensors torch _inductor virtualized V V set_graph_handler MockGraphHandler row_major_buf = MockComputedBuffer buf None torch float col_major_buf = MockComputedBuffer buf None torch float buffer_renames = buf buf buf buf acc buf name_to_buffer = buf row_major_buf buf col_major_buf result = create_example_tensors buffer_renames name_to_buffer lambda x int x assertEqual result acc shape assertEqual result acc stride assertEqual result acc element torch_dtype_to_cutlass_type torch float assertEqual result buf shape assertEqual result buf stride assertEqual result buf element torch_dtype_to_cutlass_type torch float unittest skipIf SM OrLater need sm_ unittest skipIf try_import_cutlass requires cutlass test_evt_argument_codegen torch _inductor codegen cuda cuda_env get_cuda_arch cuda_arch = int get_cuda_arch type ignore arg-type epilogue_functor = _trace BIAS_CODE EXAMPLE_TENSORS cuda_arch assertExpectedInline _render_argument_type epilogue_functor _create_mock_buffer_name_map EXAMPLE_TENSORS lambda x int x \ thread F compute_ compute_ accum C compute_ ptr_aux float ptr_ + ptr_ _offset null_default float dAux _ _ aux compute_ ptr_aux float ptr_ + ptr_ _offset dAux _ _ F ptr_col float ptr_ + ptr_ _offset null_default float dCol bias compute_ compute_ compute_ unittest skipIf SM OrLater need sm_ unittest skipIf try_import_cutlass requires cutlass test_evt_argument_codegen_return_accumulator torch _inductor codegen cuda cuda_env get_cuda_arch code = fn accum bias E = accum D = E + bias D E example_tensors = accum CutlassTensor element=DataType f shape= M N layout_tag=LayoutType RowMajor bias BIAS beta TODO mlazos support scalars alpha TODO mlazos support scalars D CutlassTensor element=DataType f shape= M N layout_tag=LayoutType RowMajor E CutlassTensor element=DataType f shape= M N layout_tag=LayoutType RowMajor cuda_arch = int get_cuda_arch type ignore arg-type epilogue_functor = _trace code example_tensors cuda_arch assertExpectedInline _render_argument_type epilogue_functor _create_mock_buffer_name_map example_tensors lambda x int x \ thread E accum ptr_aux float ptr_ + ptr_ _offset dAux _ _ E ptr_col float ptr_ + ptr_ _offset null_default float dCol bias compute_ unittest skipIf SM OrLater need sm_ unittest skipIf try_import_cutlass requires cutlass test_evt_codegen _ _ code _ = trace BIAS_CODE EXAMPLE_TENSORS DataType f DataType f MockTileDescription EpilogueScheduleType ScheduleAuto _create_mock_buffer_name_map EXAMPLE_TENSORS lambda x x static shapes assertExpectedInline code \ using EpilogueDescriptor = cutlass epilogue collective detail EpilogueDescriptor cute Shape _ _ _ cutlass epilogue collective EpilogueTileAuto float float cutlass epilogue collective EpilogueScheduleAuto using ElementC = float using StrideC = cute Stride int _t cute Int cute Int using TensorC = cutlass epilogue fusion Sm SrcFetch float using Accum = cutlass epilogue fusion Sm AccFetch using AuxDescriptor = cutlass epilogue collective detail AuxLoadDescriptor EpilogueDescriptor \ cute Stride int _t cute Int cute Int float using Aux = cutlass epilogue fusion Sm AuxLoad AuxDescriptor Stages typename AuxDescriptor EpilogueTile float cute Stride int _t cute Int cute Int typename AuxDescriptor SmemLayoutAtom \ typename AuxDescriptor CopyOpS R using Bias = cutlass epilogue fusion Sm ColBroadcast Stages typename EpilogueDescriptor TileShape float float cute Stride cute Int cute Int cute Int using Compute = cutlass epilogue fusion Sm Compute cutlass plus float float cutlass FloatRoundStyle round_to_nearest using EVTCompute = cutlass epilogue fusion Sm EVT Compute Accum TensorC using Compute = cutlass epilogue fusion Sm Compute cutlass plus float float cutlass FloatRoundStyle round_to_nearest using EVTCompute = cutlass epilogue fusion Sm EVT Compute EVTCompute Aux using FDescriptor = cutlass epilogue collective detail AuxStoreDescriptor EpilogueDescriptor cute Stride int _t cute Int cute Int float using F = cutlass epilogue fusion Sm AuxStore FDescriptor Stages typename FDescriptor EpilogueTile float cutlass FloatRoundStyle round_to_nearest cute Stride int _t cute Int \ cute Int typename FDescriptor SmemLayoutAtom typename FDescriptor CopyOpR S using EVTF = cutlass epilogue fusion Sm EVT F EVTCompute using Compute = cutlass epilogue fusion Sm Compute cutlass epilogue thread ReLu float float cutlass FloatRoundStyle round_to_nearest using Compute = cutlass epilogue fusion Sm Compute cutlass plus float float cutlass FloatRoundStyle round_to_nearest using Compute = cutlass epilogue fusion Sm Compute cutlass plus float float cutlass FloatRoundStyle round_to_nearest using DagCompute = cutlass epilogue fusion Sm TopologicalVisitor float cute tuple cute seq cute seq cute seq cute seq cute seq EVTF Bias Compute Compute Compute using ElementD = float using StrideD = cute Stride int _t cute Int cute Int __name__ == __main__ torch _dynamo test_case run_tests HAS_CPU HAS_CUDA_AND_TRITON run_tests needs= filelock