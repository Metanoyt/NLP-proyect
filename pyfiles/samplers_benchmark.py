usr bin env python time collections abc Iterable Iterator typing Union numpy np tabulate tabulate torch utils data BatchSampler Sampler SequentialSampler NewBatchSampler Sampler list int Alternative implementation BatchSampler benchmarking purposes __init__ sampler Union Sampler int Iterable int batch_size int drop_last bool - None isinstance batch_size int isinstance batch_size bool batch_size = raise ValueError f batch_size should positive integer value got batch_size= batch_size isinstance drop_last bool raise ValueError f drop_last should boolean value got drop_last= drop_last sampler = sampler batch_size = batch_size drop_last = drop_last __iter__ - Iterator list int drop_last sampler_iter = iter sampler while True try batch = next sampler_iter _ range batch_size yield batch except StopIteration break batch = batch_size idx_in_batch = idx sampler batch idx_in_batch = idx idx_in_batch += idx_in_batch == batch_size yield batch idx_in_batch = batch = batch_size idx_in_batch yield batch idx_in_batch __len__ - int Can only called sampler has __len__ implemented drop_last len sampler batch_size type ignore arg-type len sampler + batch_size - batch_size type ignore arg-type main Run benchmark specified parameters DATA_SIZE = AVG_TIMES = BATCH_SIZES = DROP_LAST_OPTIONS = True False results = Set up samplers here ensure right args passed baselineSampler = BatchSampler testSampler = NewBatchSampler batch_size BATCH_SIZES drop_last DROP_LAST_OPTIONS print f Benchmarking batch_size= batch_size drop_last= drop_last Benchmark baselineSampler original_times = _ range AVG_TIMES start = time perf_counter _ baselineSampler sampler=SequentialSampler range DATA_SIZE batch_size=batch_size drop_last=drop_last pass end = time perf_counter original_times append end - start time sleep original_avg = float np mean original_times Benchmark testSampler new_times = _ range AVG_TIMES start = time perf_counter _ testSampler sampler=SequentialSampler range DATA_SIZE batch_size=batch_size drop_last=drop_last pass end = time perf_counter new_times append end - start time sleep Small delay reduce system load new_avg = float np mean new_times Calculate speedup original_avg new_avg speedup = original_avg - new_avg original_avg speedup_str = f speedup f speedup_str = N A print f Speedup speedup_str \n results append batch_size drop_last f original_avg f f new_avg f speedup_str Print results table headers = Batch Size Drop Last Original s New s Speedup print \nBenchmark Results print tabulate results headers=headers tablefmt= grid __name__ == __main__ main