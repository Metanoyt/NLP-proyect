usr bin env python Checks all symbols torch header_only_apis txt tested cpp test file ensure header-only-ness The cpp test file must built without linking libtorch argparse json re enum Enum pathlib Path typing NamedTuple Union LINTER_CODE = HEADER_ONLY_LINTER LintSeverity str Enum ERROR = error WARNING = warning ADVICE = advice DISABLED = disabled LintMessage NamedTuple path Union str None line Union int None char Union int None code str severity LintSeverity name str original Union str None replacement Union str None description Union str None CPP_TEST_GLOBS = test cpp aoti_abi_check cpp REPO_ROOT = Path __file__ parents find_matched_symbols symbols_regex re Pattern str test_globs list str = CPP_TEST_GLOBS - set str Goes through all lines starting cpp files accumulates list matches symbols_regex Note we expect symbols_regex sorted reverse alphabetical order allow superset regexes get matched matched_symbols = set check noncommented out lines test files cpp_test_glob test_globs test_file REPO_ROOT glob cpp_test_glob open test_file tf test_file_line tf test_file_line = test_file_line strip test_file_line startswith test_file_line == continue matches = re findall symbols_regex test_file_line m matches m = matched_symbols add m matched_symbols check_file filename str test_globs list str = CPP_TEST_GLOBS - list LintMessage Goes through header_only_apis txt file verifies all symbols within file can found tested appropriately independent cpp file Note we expect CPP_TEST_GLOBS passed test_globs -- only reason argument all ease testing lint_messages list LintMessage = symbols dict str int = symbol - lineno open filename f idx line enumerate f commented out lines should skipped symbol = line strip symbol symbol == continue symbols can fact duplicated come different headers we aware flaw using simple string matching symbols symbol = idx + Why reverse keys To allow superset regexes get matched first find_matched_symbols For example we want Float _e m fnuz match before Float _e m Otherwise both Float _e m fnuz Float _e m will match Float _e m symbols_regex = re compile &#124; join sorted symbols keys reverse=True matched_symbols = find_matched_symbols symbols_regex test_globs s lineno symbols items s matched_symbols lint_messages append LintMessage path=filename line=lineno char=None code=LINTER_CODE severity=LintSeverity ERROR name= untested-symbol original=None replacement=None description= f s has been included header-only API tested any CPP_TEST_GLOBS which f contains CPP_TEST_GLOBS \n Please add cpp test using symbol without linking anything verify symbol fact header-only If you already have test s found please add cpp file CPP_TEST_GLOBS tools linters adapters header_only_linter py lint_messages __name__ == __main__ parser = argparse ArgumentParser description= header only APIs linter fromfile_prefix_chars= args = parser parse_args lint_message check_file str REPO_ROOT + torch header_only_apis txt CPP_TEST_GLOBS print json dumps lint_message _asdict flush=True