Owner s module dynamo functools math operator sys warnings fractions Fraction unittest expectedFailure xfail skipIf skipif hypothesis hypothesis strategies st numpy pytest hypothesis extra numpy arrays pytest raises assert_raises torch torch testing _internal common_utils instantiate_parametrized_tests parametrize run_tests skipIfTorchDynamo subtest TEST_WITH_TORCHDYNAMO TestCase xpassIfTorchDynamo_np skip = functools partial skipif True HAS_REFCOUNT = True IS_WASM = False IS_PYPY = False string FIXME make torch _numpy These commented they imported some tests pass wrong reasons numpy lib digitize piecewise trapz select trim_zeros interp FIXME broken numpy + int numpy __version__ numpy lib delete extract insert msort place setxor d unwrap vectorize If we going trace through these we should use NumPy If testing eager mode we use torch _numpy TEST_WITH_TORCHDYNAMO numpy np numpy angle bartlett blackman corrcoef cov diff digitize flipud gradient hamming hanning i interp kaiser meshgrid sinc trapz trim_zeros unique numpy core numeric normalize_axis_tuple numpy random rand numpy testing assert_ assert_allclose assert_almost_equal assert_array_almost_equal assert_array_equal assert_equal assert_raises_regex assert_warns suppress_warnings torch _numpy np torch _numpy angle bartlett blackman corrcoef cov diff flipud gradient hamming hanning i kaiser meshgrid sinc unique torch _numpy _util normalize_axis_tuple torch _numpy random rand torch _numpy testing assert_ assert_allclose assert_almost_equal assert_array_almost_equal assert_array_equal assert_equal assert_raises_regex assert_warns suppress_warnings get_mat n data = np arange n data = np add outer data data data = data None + data None data _make_complex real imag Like real + j imag behaves expected when imag contains non-finite values ret = np zeros np broadcast real imag shape np complex ret real = real ret imag = imag ret TestRot TestCase test_basic assert_raises ValueError np rot np ones assert_raises ValueError RuntimeError np rot np ones axes= assert_raises ValueError np rot np ones axes= assert_raises ValueError np rot np ones axes= assert_raises ValueError np rot np ones axes= - = b = b = b = b = k range - assert_equal np rot k=k b k range - assert_equal np rot k=k b k range - assert_equal np rot k=k b k range assert_equal np rot k=k b assert_equal np rot np rot axes= axes= assert_equal np rot k= axes= np rot k=- axes= test_axes = np ones assert_equal np rot shape assert_equal np rot axes= np rot axes= - assert_equal np rot axes= np rot axes= - - test_rotation_axes = np arange reshape a_rot _ = a_rot _ = a_rot _ = a_rot _ = assert_equal np rot axes= a_rot _ assert_equal np rot axes= a_rot _ assert_equal np rot axes= a_rot _ k range assert_equal np rot k=k axes= np rot a_rot _ k=k - axes= TestFlip TestCase test_axes assert_raises np AxisError np flip np ones axis= assert_raises np AxisError np flip np ones axis= assert_raises np AxisError np flip np ones axis=- assert_raises np AxisError np flip np ones axis= skip reason= no - indexing test_basic_lr = get_mat b = - assert_equal np flip b = b = assert_equal np flip b skip reason= no - indexing test_basic_ud = get_mat b = - assert_equal np flip b = b = assert_equal np flip b test_ d_swap_axis = np array b = np array assert_equal np flip b test_ d_swap_axis = np array b = np array assert_equal np flip b test_ d_swap_axis = np array b = np array assert_equal np flip b test_ d = np arange reshape i range ndim assert_equal np flip i np flipud swapaxes i swapaxes i test_default_axis = np array b = np array assert_equal np flip b test_multiple_axes = np array assert_equal np flip axis= b = np array assert_equal np flip axis= b c = np array assert_equal np flip axis= c TestAny TestCase test_basic y = y = y = assert_ np any y assert_ np any y assert_ np any y test_nd y = assert_ np any y assert_array_equal np any y axis= assert_array_equal np any y axis= TestAll TestCase test_basic y = y = y = assert_ np all y assert_ np all y assert_ np all y assert_ np all ~np array y test_nd y = assert_ np all y assert_array_equal np all y axis= assert_array_equal np all y axis= TestCopy TestCase test_basic = np array a_copy = np copy assert_array_equal a_copy a_copy = assert_equal assert_equal a_copy xpassIfTorchDynamo_np reason= order= F implemented test_order It turns out people rely np copy preserving order default changing broke scikit-learn github com scikit-learn scikit-learn commit cf c = np array assert_ flags c_contiguous assert_ flags f_contiguous a_fort = np array order= F assert_ a_fort flags c_contiguous assert_ a_fort flags f_contiguous a_copy = np copy assert_ a_copy flags c_contiguous assert_ a_copy flags f_contiguous a_fort_copy = np copy a_fort assert_ a_fort_copy flags c_contiguous assert_ a_fort_copy flags f_contiguous instantiate_parametrized_tests TestAverage TestCase test_basic y = np array assert_ np average y axis= == y = np array assert_ np average y axis= == y = assert_ np average y axis= == y = np ones y = y = assert_almost_equal y mean np average y assert_almost_equal y mean np average y y = rand assert_almost_equal y mean np average y assert_almost_equal y mean np average y skip reason= NP_VER fails CI parametrize x axis expected_avg weights expected_wavg expected_wsum None test_basic_keepdims x axis expected_avg weights expected_wavg expected_wsum avg = np average x axis=axis keepdims=True assert avg shape == np shape expected_avg assert_array_equal avg expected_avg wavg = np average x axis=axis weights=weights keepdims=True assert wavg shape == np shape expected_wavg assert_array_equal wavg expected_wavg wavg wsum = np average x axis=axis weights=weights returned=True keepdims=True assert wavg shape == np shape expected_wavg assert_array_equal wavg expected_wavg assert wsum shape == np shape expected_wsum assert_array_equal wsum expected_wsum skip reason= NP_VER fails CI test_weights y = np arange w = np arange actual = np average y weights=w desired = np arange sum np arange sum assert_almost_equal actual desired y = np array w = actual = np average y weights=w axis= desired = np array assert_almost_equal actual desired w = actual = np average y weights=w axis= desired = np array assert_almost_equal actual desired This should raise error Can we test assert_equal average y weights=w D Case w = desired = np array assert_array_equal np average y weights=w axis= desired assert_equal np average y weights=w y = rand astype np float w = rand astype np float assert_ np average y weights=w dtype == np result_type y w test weights ` keepdims=False ` ` keepdims=True ` x = np array reshape w = np array reshape actual = np average x weights=w axis= keepdims=False desired = np array assert_array_equal actual desired actual = np average x weights=w axis= keepdims=True desired = np array assert_array_equal actual desired test_returned y = np array No weights avg scl = np average y returned=True assert_equal scl avg scl = np average y returned=True assert_array_equal scl np array avg scl = np average y returned=True assert_array_equal scl np array With weights w = avg scl = np average y weights=w axis= returned=True assert_array_equal scl np array w = avg scl = np average y weights=w axis= returned=True assert_array_equal scl np array w = avg scl = np average y weights=w axis= returned=True assert_array_equal scl np array test_upcasting typs = i i f i f f f i f f f f f f f wt rt typs = np array dtype=at w = np array dtype=wt assert_equal np average weights=w dtype np dtype rt skip reason= support Fraction objects test_average_class_without_dtype see gh- = np array Fraction Fraction assert_equal np average Fraction xfail reason= TODO implement TestSelect TestCase choices = np array np array np array conditions = np array False False False np array False True False np array False False True _select cond values default= output = m range len cond output += V m V C zip values cond C m default output test_basic choices = choices conditions = conditions assert_array_equal select conditions choices default= _select conditions choices default= assert_equal len choices assert_equal len conditions test_broadcasting conditions = np array True np array False True False choices = np arange reshape assert_array_equal select conditions choices np ones default can broadcast too assert_equal select True default= shape test_return_dtype assert_equal select conditions choices j dtype np complex But conditions need stronger then scalar default scalar choices = choice astype np int choice choices assert_equal select conditions choices dtype np int d = np array np nan m = np isnan d assert_equal select m d np nan test_deprecated_empty assert_raises ValueError select j assert_raises ValueError select test_non_bool_deprecation choices = choices conditions = conditions conditions = conditions astype np int_ assert_raises TypeError select conditions choices conditions = conditions astype np uint assert_raises TypeError select conditions choices assert_raises TypeError select conditions choices test_many_arguments This used limited NPY_MAXARGS == conditions = np array False choices = np array select conditions choices xpassIfTorchDynamo_np reason= TODO implement instantiate_parametrized_tests TestInsert TestCase test_basic = assert_equal insert assert_equal insert assert_equal insert assert_equal insert assert_equal insert - assert_equal insert slice - None - assert_equal insert - b = np array dtype=np float assert_equal insert b b assert_equal insert b b Bools will treated differently future assert_equal insert np array True warnings catch_warnings record=True w warnings filterwarnings always FutureWarning assert_equal insert np array True assert_ w category FutureWarning test_multidim = r = assert_equal insert assert_equal insert axis= r assert_equal insert axis= r assert_equal insert axis= = np array b = np arange repeat reshape c = np concatenate np arange repeat reshape T axis= assert_equal insert axis= b assert_equal insert axis= c scalars behave differently case exactly opposite assert_equal insert axis= b assert_equal insert axis= c = np arange reshape assert_equal insert axis= assert_equal insert axis= negative axis value = np arange reshape assert_equal insert axis=- insert axis= assert_equal insert axis=- insert axis= invalid axis value assert_raises np AxisError insert axis= assert_raises np AxisError insert axis=- negative axis value = np arange reshape assert_equal insert axis=- insert axis= assert_equal insert axis=- insert axis= test_ d = np array pytest raises np AxisError insert axis= pytest raises TypeError insert axis= nonsense test_index_array_copied x = np array np insert x assert_equal x np array test_index_floats pytest raises IndexError np insert np array pytest raises IndexError np insert np array dtype=float skip reason= NP_VER fails CI parametrize idx - test_index_out_of_bounds idx pytest raises IndexError match= out bounds np insert idx TestAmax TestCase test_basic = - - assert_equal np amax b = assert_equal np amax b axis= assert_equal np amax b axis= TestAmin TestCase test_basic = - - assert_equal np amin - b = assert_equal np amin b axis= assert_equal np amin b axis= TestPtp TestCase test_basic = np array - - assert_equal ptp axis= b = np array assert_equal b ptp axis= assert_equal b ptp axis=- assert_equal b ptp axis= keepdims=True assert_equal b ptp axis= keepdims=True TestCumsum TestCase test_basic ba = ba = ctype np int np uint np int np int np float np float np complex np complex = np array ba ctype = np array ba ctype tgt = np array ctype assert_array_equal np cumsum axis= tgt tgt = np array ctype assert_array_equal np cumsum axis= tgt tgt = np array ctype assert_array_equal np cumsum axis= tgt TestProd TestCase test_basic ba = ba = ctype np int np int np float np float np complex np complex = np array ba ctype = np array ba ctype ctype b assert_raises ArithmeticError np prod assert_raises ArithmeticError np prod assert_equal prod axis= assert_array_equal prod axis= np array ctype assert_array_equal prod axis=- np array ctype TestCumprod TestCase test_basic ba = ba = ctype np int np int np float np float np complex np complex = np array ba ctype = np array ba ctype ctype b assert_raises ArithmeticError np cumprod assert_raises ArithmeticError np cumprod assert_raises ArithmeticError np cumprod assert_array_equal np cumprod axis=- np array ctype assert_array_equal np cumprod axis= np array ctype assert_array_equal np cumprod axis=- np array ctype TestDiff TestCase test_basic x = out = np array out = np array - - out = np array assert_array_equal diff x out assert_array_equal diff x n= out assert_array_equal diff x n= out x = - - out = np array - assert_almost_equal diff x out x = True True False False out = np array False True False out = np array True True assert_array_equal diff x out assert_array_equal diff x n= out test_axis x = np zeros x = exp = np ones exp = - assert_array_equal diff x np zeros assert_array_equal diff x axis=- np zeros assert_array_equal diff x axis= np zeros assert_array_equal diff x axis= exp assert_array_equal diff x axis=- exp assert_raises np AxisError diff x axis= assert_raises np AxisError diff x axis=- x = np array np float assert_raises ValueError diff x test_nd x = rand out = x - x - out = out - out - out = x - x - out = out - out - assert_array_equal diff x out assert_array_equal diff x n= out assert_array_equal diff x axis= out assert_array_equal diff x n= axis= out test_n x = list range assert_raises ValueError diff x n=- output = diff x n=n n range expected_output = assert_ diff x n= x n expected out enumerate zip expected_output output start= assert_ type out np ndarray assert_array_equal out expected assert_equal out dtype np int_ assert_equal len out max len x - n test_prepend x = np arange + assert_array_equal diff x prepend= np ones assert_array_equal diff x prepend= np ones assert_array_equal np cumsum np diff x prepend= x assert_array_equal diff x prepend= - np ones x = np arange reshape result = np diff x axis= prepend= expected = assert_array_equal result expected result = np diff x axis= prepend= assert_array_equal result expected result = np diff x axis= prepend= expected = assert_array_equal result expected result = np diff x axis= prepend= assert_array_equal result expected assert_raises ValueError RuntimeError np diff x prepend=np zeros assert_raises np AxisError diff x prepend= axis= test_append x = np arange result = diff x append= expected = - assert_array_equal result expected result = diff x append= assert_array_equal result expected result = diff x append= expected = expected + assert_array_equal result expected x = np arange reshape result = np diff x axis= append= expected = - - assert_array_equal result expected result = np diff x axis= append= assert_array_equal result expected result = np diff x axis= append= expected = - - assert_array_equal result expected result = np diff x axis= append= assert_array_equal result expected assert_raises ValueError RuntimeError np diff x append=np zeros assert_raises np AxisError diff x append= axis= xpassIfTorchDynamo_np reason= TODO implement instantiate_parametrized_tests TestDelete TestCase setUp = np arange nd_a = np arange repeat reshape _check_inverse_of_slicing indices a_del = delete indices nd_a_del = delete nd_a indices axis= msg = f Delete failed obj indices r assert_array_equal setxor d a_del indices err_msg=msg xor = setxor d nd_a_del nd_a indices assert_array_equal xor nd_a err_msg=msg test_slices lims = - - steps = - - start lims stop lims step steps s = slice start stop step _check_inverse_of_slicing s test_fancy _check_inverse_of_slicing np array pytest raises IndexError delete pytest raises IndexError delete - _check_inverse_of_slicing - _check_inverse_of_slicing True False False True False legal indexing these would change dimension pytest raises ValueError delete True pytest raises ValueError delete False enough items pytest raises ValueError delete False test_single _check_inverse_of_slicing _check_inverse_of_slicing - test_ d = np array pytest raises np AxisError delete axis= pytest raises TypeError delete axis= nonsense test_array_order_preserve See gh- k = np arange reshape order= F m = delete k slice None axis= k Fortran ordered m should have same ordering k NOT become C ordered assert_equal m flags c_contiguous k flags c_contiguous assert_equal m flags f_contiguous k flags f_contiguous test_index_floats pytest raises IndexError np delete np array pytest raises IndexError np delete np array dtype=float parametrize indexer subtest np array name= array subtest name= test_single_item_array indexer a_del_int = delete a_del = delete indexer assert_equal a_del_int a_del nd_a_del_int = delete nd_a axis= nd_a_del = delete nd_a np array axis= assert_equal nd_a_del_int nd_a_del test_single_item_array_non_int Special handling integer arrays must affect non-integer ones If ` False ` cast ` ` would delete element res = delete np ones np array False assert_array_equal res np ones Test more complicated axis case gh- x = np ones false_mask = np array False dtype=bool true_mask = np array True dtype=bool res = delete x false_mask axis=- assert_array_equal res x res = delete x true_mask axis=- assert_array_equal res x instantiate_parametrized_tests TestGradient TestCase test_basic v = x = np array v dx = np array np array assert_array_equal gradient x dx assert_array_equal gradient v dx test_args dx = np cumsum np ones dx_uneven = f_ d = np arange reshape distances must scalars have size equal gradient axis gradient np arange gradient np arange np array gradient np arange dx dy set equal dx because scalar gradient f_ d gradient f_ d np array gradient f_ d dx_uneven dx_uneven mix between even uneven spaces mix between scalar vector gradient f_ d dx D axis specified gradient f_ d dx axis= d coordinate arguments yet allowed assert_raises_regex ValueError scalars d gradient f_ d np stack dx axis=- test_badargs f_ d = np arange reshape x = np cumsum np ones wrong sizes assert_raises ValueError gradient f_ d x np ones assert_raises ValueError gradient f_ d np ones assert_raises ValueError gradient f_ d np ones np ones wrong number arguments assert_raises TypeError gradient f_ d x assert_raises TypeError gradient f_ d x axis= assert_raises TypeError gradient f_ d x x x assert_raises TypeError gradient f_ d assert_raises TypeError gradient f_ d x x axis= assert_raises TypeError gradient f_ d axis= torch _dynamo config patch use_numpy_random_stream=True test_second_order_accurate Testing relative numerical error less example problem This corresponds second order accurate finite differences all interior boundary points x = np linspace dx = x - x y = x + x + x analytical = x + x + num_error = np abs np gradient y dx edge_order= analytical - assert_ np all num_error item True test unevenly spaced np random seed x = np sort np random random y = x + x + x analytical = x + x + num_error = np abs np gradient y x edge_order= analytical - assert_ np all num_error item True test_spacing f = np array f = np tile f + f reshape - x_uneven = np array x_even = np arange fdx_even_ord = np tile fdx_even_ord = np tile - fdx_uneven_ord = np tile fdx_uneven_ord = np tile - evenly spaced edge_order exp_res fdx_even_ord fdx_even_ord res = gradient f axis= edge_order=edge_order res = gradient f x_even x_even axis= edge_order=edge_order res = gradient f x_even x_even axis=None edge_order=edge_order assert_array_equal res res assert_array_equal res res assert_almost_equal res exp_res T assert_almost_equal res exp_res res = gradient f axis= edge_order=edge_order res = gradient f x_even axis= edge_order=edge_order assert_ res shape == res shape assert_almost_equal res exp_res T res = gradient f axis= edge_order=edge_order res = gradient f x_even axis= edge_order=edge_order assert_ res shape == res shape assert_array_equal res exp_res unevenly spaced edge_order exp_res fdx_uneven_ord fdx_uneven_ord res = gradient f x_uneven x_uneven axis= edge_order=edge_order res = gradient f x_uneven x_uneven axis=None edge_order=edge_order assert_array_equal res res assert_almost_equal res exp_res T assert_almost_equal res exp_res res = gradient f x_uneven axis= edge_order=edge_order assert_almost_equal res exp_res T res = gradient f x_uneven axis= edge_order=edge_order assert_almost_equal res exp_res mixed res = gradient f x_even x_uneven axis= edge_order= res = gradient f x_uneven x_even axis= edge_order= assert_array_equal res res assert_array_equal res res assert_almost_equal res fdx_even_ord T assert_almost_equal res fdx_uneven_ord res = gradient f x_even x_uneven axis= edge_order= res = gradient f x_uneven x_even axis= edge_order= assert_array_equal res res assert_array_equal res res assert_almost_equal res fdx_even_ord T assert_almost_equal res fdx_uneven_ord test_specific_axes Testing gradient can work given axis only v = x = np array v dx = np array np array assert_array_equal gradient x axis= dx assert_array_equal gradient x axis= dx assert_array_equal gradient x axis=- dx assert_array_equal gradient x axis= dx dx test axis=None which means all axes assert_almost_equal gradient x axis=None dx dx same no axis keyword given assert_almost_equal gradient x axis=None gradient x test vararg order assert_array_equal gradient x axis= dx dx test maximal number varargs assert_raises TypeError gradient x axis= assert_raises np AxisError gradient x axis= assert_raises np AxisError gradient x axis=- assert_raises TypeError gradient x axis= test_inexact_dtypes dt np float np float np float dtypes should promoted different way what diff does x = np array dtype=dt assert_equal gradient x dtype np diff x dtype test_values needs least points edge_order == gradient np arange edge_order= needs least points edge_order == gradient np arange edge_order= assert_raises ValueError gradient np arange edge_order= assert_raises ValueError gradient np arange edge_order= assert_raises ValueError gradient np arange edge_order= assert_raises ValueError gradient np arange edge_order= assert_raises ValueError gradient np arange edge_order= parametrize f_dtype np uint test_f_decreasing_unsigned_int f_dtype f = np array dtype=f_dtype g = gradient f assert_array_equal g - len f parametrize f_dtype np int np int np int np int test_f_signed_int_big_jump f_dtype maxint = np iinfo f_dtype max x = np array f = np array - maxint dtype=f_dtype dfdx = gradient f x assert_array_equal dfdx maxint + parametrize x_dtype np uint test_x_decreasing_unsigned x_dtype x = np array dtype=x_dtype f = np array dfdx = gradient f x assert_array_equal dfdx - len x parametrize x_dtype np int np int np int np int test_x_signed_int_big_jump x_dtype minint = np iinfo x_dtype min maxint = np iinfo x_dtype max x = np array - maxint dtype=x_dtype f = np array minint dfdx = gradient f x assert_array_equal dfdx TestAngle TestCase test_basic x = + j np sqrt + j np sqrt j - - j - j - + j y = angle x yo = np arctan np arctan np pi np pi -np pi -np arctan np pi - np arctan z = angle x deg=True zo = np array yo np pi assert_array_almost_equal y yo assert_array_almost_equal z zo xpassIfTorchDynamo_np instantiate_parametrized_tests TestTrimZeros TestCase = np array b = astype float c = astype complex d = astype object values attr_names = b c d getattr name name attr_names test_basic slc = np s_ - arr values res = trim_zeros arr assert_array_equal res arr slc test_leading_skip slc = np s_ - arr values res = trim_zeros arr trim= b assert_array_equal res arr slc test_trailing_skip slc = np s_ arr values res = trim_zeros arr trim= F assert_array_equal res arr slc test_all_zero _arr values arr = np zeros_like _arr dtype=_arr dtype res = trim_zeros arr trim= B assert len res == res = trim_zeros arr trim= f assert len res == test_size_zero arr = np zeros res = trim_zeros arr assert_array_equal arr res parametrize arr np array np array FIXME np array test_overflow arr slc = np s_ res = trim_zeros arr assert_array_equal res arr slc test_no_trim arr = np array None None res = trim_zeros arr assert_array_equal arr res test_list_to_list res = trim_zeros tolist assert isinstance res list xpassIfTorchDynamo_np reason= TODO implement TestExtins TestCase test_basic = np array b = extract assert_array_equal b test_place Make sure non-np ndarray objects raise error instead doing nothing assert_raises TypeError place True False = np array place assert_array_equal place np zeros assert_array_equal np arange place assert_array_equal assert_raises_regex ValueError Cannot insert empty array lambda place See Issue = np array place assert_array_equal test_both = rand mask = ac = copy c = extract mask place mask place mask c assert_array_equal ac _foo _foo used some tests TestVectorize _foo x y= y math floor x _foo x y= z= y math floor x + z skip reason= vectorize implemented TestVectorize TestCase test_simple addsubtract b b - b + b f = vectorize addsubtract r = f assert_array_equal r test_scalar addsubtract b b - b + b f = vectorize addsubtract r = f assert_array_equal r test_large x = np linspace - f = vectorize lambda x x y = f x assert_array_equal y x test_ufunc f = vectorize math cos args = np array np pi np pi np pi np pi r = f args r = np cos args assert_array_almost_equal r r test_keywords foo b= + b f = vectorize foo args = np array r = f args r = np array assert_array_equal r r r = f args r = np array assert_array_equal r r test_keywords_with_otypes_order gh- The second call f would crash ` ValueError invalid number arguments ` f = vectorize _foo otypes= float We re testing caching ufuncs vectorize so order these function calls important part test r = f np arange r = f np arange assert_array_equal r r test_keywords_with_otypes_order gh- The second call f would crash ` ValueError non-broadcastable output operand shape doesn t match broadcast shape ` f = vectorize _foo otypes= float We re testing caching ufuncs vectorize so order these function calls important part test r = f np arange r = f np arange assert_array_equal r r test_keywords_with_otypes_order gh- The third call f would crash ` ValueError invalid number arguments ` f = vectorize _foo otypes= float We re testing caching ufuncs vectorize so order these function calls important part test r = f np arange r = f np arange y= r = f np arange assert_array_equal r r assert_array_equal r r test_keywords_with_otypes_several_kwd_args gh- Make sure different uses keyword arguments don t break vectorized function f = vectorize _foo otypes= float We re testing caching ufuncs vectorize so order these function calls important part test r = f z= r = f y=- r = f assert_equal r _foo z= assert_equal r _foo y=- assert_equal r _foo test_keywords_with_otypes_several_kwd_args gh- Make sure different uses keyword arguments don t break vectorized function f = vectorize _foo otypes= float We re testing caching ufuncs vectorize so order these function calls important part test r = f z= x= y=- r = f assert_equal r _foo z= x= y=- assert_equal r _foo test_keywords_no_func_code This needs test function has keywords no func_code attribute since otherwise vectorize will inspect func_code random try vectorize random randrange Should succeed except Exception raise AssertionError noqa B test_keywords _ticket_ Test kwarg support enhancement ticket foo b= + b f = vectorize foo args = np array r = f a=args r = np array assert_array_equal r r r = f b= a=args assert_array_equal r r r = f args b= r = np array assert_array_equal r r test_keywords _ticket_ Test excluded mixed positional kwargs ticket mypolyval x p _p = list p res = _p pop while _p res = res x + _p pop res vpolyval = np vectorize mypolyval excluded= p ans = assert_array_equal ans vpolyval x= p= assert_array_equal ans vpolyval p= assert_array_equal ans vpolyval test_keywords _ticket_ Test vectorizing function no positional args vectorize f kw res = _k kw res = kw _k res assert_array_equal f a= b= test_keywords _ticket_ Test vectorizing function no kwargs args vectorize f v np prod v assert_array_equal f test_coverage _ticket_ foo f = vectorize foo assert_array_equal f test_assigning_docstring foo x Original documentation x f = vectorize foo assert_equal f __doc__ foo __doc__ doc = Provided documentation f = vectorize foo doc=doc assert_equal f __doc__ doc test_UnboundMethod_ticket_ Regression test issue Foo b = bar b assert_array_equal vectorize Foo bar np arange np arange assert_array_equal vectorize Foo bar Foo np arange np arange test_execution_order_ticket_ Regression test dependence execution order issue f = vectorize lambda x x res = f np arange res b = f np arange f = vectorize lambda x x res b = f np arange res = f np arange assert_equal res res assert_equal res b res b test_string_ticket_ Test vectorization over strings issue f = np vectorize lambda x x s = string digits assert_equal s f s test_cache Ensure vectorized func called exactly once per argument _calls = vectorize f x _calls += x f cache = True x = np arange assert_array_equal f x x x assert_equal _calls len x test_otypes f = np vectorize lambda x x f otypes = i x = np arange assert_array_equal f x x test_signature_mean_last mean mean f = vectorize mean signature= n - r = f assert_array_equal r test_signature_center center - mean f = vectorize center signature= n - n r = f assert_array_equal r - - test_signature_two_outputs f = vectorize lambda x x x signature= - r = f assert_ isinstance r tuple len r == assert_array_equal r assert_array_equal r test_signature_outer f = vectorize np outer signature= b - b r = f assert_array_equal r r = f assert_array_equal r r = f assert_array_equal r r = f assert_array_equal r test_signature_computed_size f = vectorize lambda x x - signature= n - m r = f assert_array_equal r r = f assert_array_equal r test_signature_excluded foo b= + b f = vectorize foo signature= - excluded= b assert_array_equal f assert_array_equal f b= test_signature_otypes f = vectorize lambda x x signature= n - n otypes= float r = f assert_equal r dtype np dtype float assert_array_equal r test_signature_invalid_inputs f = vectorize operator add signature= n n - n assert_raises_regex TypeError wrong number positional f assert_raises_regex ValueError does have enough dimensions f assert_raises_regex ValueError inconsistent size core dimension f f = vectorize operator add signature= - assert_raises_regex TypeError wrong number positional f test_signature_invalid_outputs f = vectorize lambda x x - signature= n - n assert_raises_regex ValueError inconsistent size core dimension f f = vectorize lambda x x signature= - assert_raises_regex ValueError wrong number outputs f f = vectorize lambda x x x signature= - assert_raises_regex ValueError wrong number outputs f test_size_zero_output see issue f = np vectorize lambda x x x = np zeros dtype=int assert_raises_regex ValueError otypes f x f otypes = i assert_array_equal f x x f = np vectorize lambda x x signature= - assert_raises_regex ValueError otypes f x f = np vectorize lambda x x signature= - otypes= i assert_array_equal f x x f = np vectorize lambda x x signature= n - n otypes= i assert_array_equal f x x f = np vectorize lambda x x signature= n - n assert_array_equal f x T x T f = np vectorize lambda x x signature= - n otypes= i assert_raises_regex ValueError new output dimensions f x xpassIfTorchDynamo_np reason= TODO implement TestDigitize TestCase test_forward x = np arange - bins = np arange - assert_array_equal digitize x bins np arange test_reverse x = np arange - - bins = np arange - - assert_array_equal digitize x bins np arange test_random x = rand bin = np linspace x min x max assert_ np all digitize x bin = test_right_basic x = bins = default_answer = assert_array_equal digitize x bins default_answer right_answer = assert_array_equal digitize x bins True right_answer test_right_open x = np arange - bins = np arange - assert_array_equal digitize x bins True np arange test_right_open_reverse x = np arange - - bins = np arange - - assert_array_equal digitize x bins True np arange test_right_open_random x = rand bins = np linspace x min x max assert_ np all digitize x bins True = test_monotonic x = - bins = assert_array_equal digitize x bins False assert_array_equal digitize x bins True bins = assert_array_equal digitize x bins False assert_array_equal digitize x bins True bins = assert_array_equal digitize x bins False assert_array_equal digitize x bins True bins = assert_raises ValueError digitize x bins bins = assert_raises ValueError digitize x bins test_casting_error x = + j bins = assert_raises TypeError digitize x bins x bins = bins x assert_raises TypeError digitize x bins test_large_integers_increasing gh- x = loses precision float assert_equal np digitize x x - x + xfail gh- np core multiarray _monoticity loses precision test_large_integers_decreasing gh- x = loses precision float assert_equal np digitize x x + x - skip reason= TODO implement here unwrap numpy TestUnwrap TestCase test_simple check unwrap removes jumps greater pi assert_array_equal unwrap + np pi check unwrap maintains continuity assert_ np all diff unwrap rand np pi test_period check unwrap removes jumps greater assert_array_equal unwrap + period= check unwrap maintains continuity assert_ np all diff unwrap rand period= check simple case simple_seq = np array wrap_seq = np mod simple_seq assert_array_equal unwrap wrap_seq period= simple_seq check custom discont value uneven_seq = np array wrap_uneven = np mod uneven_seq no_discont = unwrap wrap_uneven period= assert_array_equal no_discont sm_discont = unwrap wrap_uneven period= discont= assert_array_equal sm_discont assert sm_discont dtype == wrap_uneven dtype instantiate_parametrized_tests TestFilterwindows TestCase parametrize dtype Bbhil + efd np typecodes AllInteger + np typecodes Float parametrize M test_hanning dtype str M int - None scalar = M w = hanning scalar ref_dtype = np result_type dtype np float assert w dtype == ref_dtype check symmetry assert_allclose w flipud w atol= e- check known value scalar assert_array_equal w np array scalar == assert_array_equal w np ones assert_almost_equal np sum w axis= parametrize dtype Bbhil + efd np typecodes AllInteger + np typecodes Float parametrize M test_hamming dtype str M int - None scalar = M w = hamming scalar ref_dtype = np result_type dtype np float assert w dtype == ref_dtype check symmetry assert_allclose w flipud w atol= e- check known value scalar assert_array_equal w np array scalar == assert_array_equal w np ones assert_almost_equal np sum w axis= parametrize dtype Bbhil + efd np typecodes AllInteger + np typecodes Float parametrize M test_bartlett dtype str M int - None scalar = M w = bartlett scalar ref_dtype = np result_type dtype np float assert w dtype == ref_dtype check symmetry assert_allclose w flipud w atol= e- check known value scalar assert_array_equal w np array scalar == assert_array_equal w np ones assert_almost_equal np sum w axis= parametrize dtype Bbhil + efd np typecodes AllInteger + np typecodes Float parametrize M test_blackman dtype str M int - None scalar = M w = blackman scalar ref_dtype = np result_type dtype np float assert w dtype == ref_dtype check symmetry assert_allclose w flipud w atol= e- check known value scalar assert_array_equal w np array scalar == assert_array_equal w np ones assert_almost_equal np sum w axis= parametrize dtype Bbhil + efd np typecodes AllInteger + np typecodes Float parametrize M test_kaiser dtype str M int - None scalar = M w = kaiser scalar ref_dtype = np result_type dtype np float assert w dtype == ref_dtype check symmetry assert_equal w flipud w check known value scalar assert_array_equal w np array scalar == assert_array_equal w np ones assert_almost_equal np sum w axis= xpassIfTorchDynamo_np reason= TODO implement TestTrapz TestCase test_simple x = np arange - r = trapz np exp - x np sqrt np pi dx= check integral normal equals assert_almost_equal r test_ndim x = np linspace y = np linspace z = np linspace wx = np ones_like x x - x wx = wx - = wy = np ones_like y y - y wy = wy - = wz = np ones_like z z - z wz = wz - = q = x None None + y None None + z None None qx = q wx None None sum axis= qy = q wy None None sum axis= qz = q wz None None sum axis= n-d ` x ` r = trapz q x=x None None axis= assert_almost_equal r qx r = trapz q x=y None None axis= assert_almost_equal r qy r = trapz q x=z None None axis= assert_almost_equal r qz -d ` x ` r = trapz q x=x axis= assert_almost_equal r qx r = trapz q x=y axis= assert_almost_equal r qy r = trapz q x=z axis= assert_almost_equal r qz TestSinc TestCase test_simple assert_ sinc == w = sinc np linspace - check symmetry assert_array_almost_equal w np flipud w test_array_like x = y = sinc np array x y = sinc list x y = sinc tuple x assert_array_equal y y assert_array_equal y y TestUnique TestCase test_simple x = np array assert_ np all unique x == assert_ unique np array == np array xpassIfTorchDynamo_np reason= unique implemented ComplexDouble test_simple_complex x = np array + j + j + j + j assert_ np all unique x == + j + j + j xpassIfTorchDynamo_np reason= TODO implement TestCheckFinite TestCase test_simple = b = np inf c = np nan np lib asarray_chkfinite assert_raises ValueError np lib asarray_chkfinite b assert_raises ValueError np lib asarray_chkfinite c test_dtype_order Regression test missing dtype order arguments = = np lib asarray_chkfinite order= F dtype=np float assert_ dtype == np float instantiate_parametrized_tests TestCorrCoef TestCase A = np array B = np array res = np array - - res = np array - - - - - - - - - - test_non_array assert_almost_equal np corrcoef - - test_simple tgt = corrcoef A assert_almost_equal tgt res assert_ np all np abs tgt = tgt = corrcoef A B assert_almost_equal tgt res assert_ np all np abs tgt = skip reason= deprecated numpy ignore test_ddof ddof raises DeprecationWarning suppress_warnings sup warnings simplefilter always assert_warns DeprecationWarning corrcoef A ddof=- sup filter DeprecationWarning ddof has no negligible effect function assert_almost_equal corrcoef A ddof=- res assert_almost_equal corrcoef A B ddof=- res assert_almost_equal corrcoef A ddof= res assert_almost_equal corrcoef A B ddof= res skip reason= deprecated numpy ignore test_bias bias raises DeprecationWarning suppress_warnings sup warnings simplefilter always assert_warns DeprecationWarning corrcoef A B assert_warns DeprecationWarning corrcoef A bias= sup filter DeprecationWarning bias has no negligible effect function assert_almost_equal corrcoef A bias= res test_complex x = np array j j j res = corrcoef x tgt = np array - j j assert_allclose res tgt assert_ np all np abs res = test_xy x = np array y = np array j j j assert_allclose np corrcoef x y np array - j j test_empty warnings catch_warnings record=True warnings simplefilter always RuntimeWarning assert_array_equal corrcoef np array np nan assert_array_equal corrcoef np array reshape np array reshape assert_array_equal corrcoef np array reshape np array np nan np nan np nan np nan test_extreme x = e- e e e- c = corrcoef x assert_array_almost_equal c np array - - assert_ np all np abs c = parametrize test_type np half np single np double test_corrcoef_dtype test_type cast_A = A astype test_type res = corrcoef cast_A dtype=test_type assert test_type == res dtype instantiate_parametrized_tests TestCov TestCase x = np array T res = np array - - x = np array ndmin= frequencies = np array x _repeats = np array T res = np array - - unit_frequencies = np ones dtype=np int_ weights = np array res = np array - - unit_weights = np ones x = np array test_basic assert_allclose cov x res test_complex x = np array j j j res = np array - j j assert_allclose cov x res assert_allclose cov x aweights=np ones res test_xy x = np array y = np array j j j assert_allclose cov x y np array - j j test_empty warnings catch_warnings record=True warnings simplefilter always RuntimeWarning assert_array_equal cov np array np nan assert_array_equal cov np array reshape np array reshape assert_array_equal cov np array reshape np array np nan np nan np nan np nan test_wrong_ddof warnings catch_warnings record=True warnings simplefilter always RuntimeWarning assert_array_equal cov x ddof= np array np inf -np inf -np inf np inf test_ D_rowvar assert_allclose cov x cov x rowvar=False y = np array assert_allclose cov x y cov x y rowvar=False test_ D_variance assert_allclose cov x ddof= np var x ddof= test_fweights assert_allclose cov x fweights=self frequencies cov x _repeats assert_allclose cov x fweights=self frequencies res assert_allclose cov x fweights=self unit_frequencies res nonint = frequencies + assert_raises TypeError RuntimeError cov x fweights=nonint f = np ones dtype=np int_ assert_raises RuntimeError cov x fweights=f f = np ones dtype=np int_ assert_raises RuntimeError cov x fweights=f f = - np ones dtype=np int_ assert_raises ValueError RuntimeError cov x fweights=f test_aweights assert_allclose cov x aweights=self weights res assert_allclose cov x aweights= weights cov x aweights=self weights assert_allclose cov x aweights=self unit_weights res w = np ones assert_raises RuntimeError cov x aweights=w w = np ones assert_raises RuntimeError cov x aweights=w w = - np ones assert_raises ValueError RuntimeError cov x aweights=w test_unit_fweights_and_aweights assert_allclose cov x fweights=self frequencies aweights=self unit_weights cov x _repeats assert_allclose cov x fweights=self frequencies aweights=self unit_weights res assert_allclose cov x fweights=self unit_frequencies aweights=self unit_weights res assert_allclose cov x fweights=self unit_frequencies aweights=self weights res assert_allclose cov x fweights=self unit_frequencies aweights= weights cov x aweights=self weights assert_allclose cov x fweights=self unit_frequencies aweights=self unit_weights res parametrize test_type np half np single np double test_cov_dtype test_type cast_x = x astype test_type res = cov cast_x dtype=test_type assert test_type == res dtype Test_I TestCase test_simple assert_almost_equal i np array need least one test above implementation piecewise A = np array expected = np array assert_almost_equal i A expected assert_almost_equal i -A expected B = np array assert_almost_equal i B np array Regression test gh- i _ = np i assert_equal i _ shape assert_array_equal np i np array test_complex = np array + j pytest raises TypeError RuntimeError match= i supported complex values i TestKaiser TestCase test_simple assert_ np isfinite kaiser assert_almost_equal kaiser np array assert_almost_equal kaiser np array assert_almost_equal kaiser np array assert_almost_equal kaiser np array test_int_beta kaiser skip reason= msort deprecated do bother TestMsort TestCase test_simple A = np array pytest warns DeprecationWarning match= msort deprecated assert_almost_equal msort A np array TestMeshgrid TestCase test_simple X Y = meshgrid assert_array_equal X np array assert_array_equal Y np array test_single_input X = meshgrid assert_array_equal X np array test_no_input args = assert_array_equal meshgrid args assert_array_equal meshgrid args copy=False test_indexing x = y = X Y = meshgrid x y indexing= ij assert_array_equal X np array assert_array_equal Y np array Test expected shapes z = assert_ meshgrid x y shape == assert_ meshgrid x y indexing= ij shape == assert_ meshgrid x y z shape == assert_ meshgrid x y z indexing= ij shape == assert_raises ValueError meshgrid x y indexing= notvalid test_sparse X Y = meshgrid sparse=True assert_array_equal X np array assert_array_equal Y np array test_invalid_arguments Test meshgrid complains about invalid arguments Regression test issue https github com numpy numpy issues assert_raises TypeError meshgrid indices= ij test_return_type Test appropriate dtype returned arrays Regression test issue https github com numpy numpy issues x = np arange dtype=np float y = np arange dtype=np float X Y = np meshgrid x y assert_ X dtype == x dtype assert_ Y dtype == y dtype copy X Y = np meshgrid x y copy=True assert_ X dtype == x dtype assert_ Y dtype == y dtype sparse X Y = np meshgrid x y sparse=True assert_ X dtype == x dtype assert_ Y dtype == y dtype test_writeback Issue X = np array Y = np array x y = np meshgrid X Y sparse=False copy=True x = assert_equal x assert_equal x X test_nd_shape b c d e = np meshgrid i i range expected_shape = assert_equal shape expected_shape assert_equal b shape expected_shape assert_equal c shape expected_shape assert_equal d shape expected_shape assert_equal e shape expected_shape test_nd_values b c = np meshgrid assert_equal assert_equal b assert_equal c test_nd_indexing b c = np meshgrid indexing= ij assert_equal assert_equal b assert_equal c xfail reason= TODO implement TestPiecewise TestCase test_simple Condition single bool list x = piecewise True False assert_array_equal x List conditions single bool list x = piecewise True False assert_array_equal x Conditions single bool array x = piecewise np array True False assert_array_equal x Condition single int array x = piecewise np array assert_array_equal x List conditions int array x = piecewise np array assert_array_equal x x = piecewise False True lambda x - assert_array_equal x - assert_raises_regex ValueError functions expected piecewise False True assert_raises_regex ValueError functions expected piecewise False True test_two_conditions x = piecewise True False False True assert_array_equal x test_scalar_domains_three_conditions x = piecewise True False False assert_equal x test_default No value specified x should x = piecewise True False assert_array_equal x Should set x x = piecewise True False assert_array_equal x test_ d x = np array y = piecewise x x assert_ y ndim == assert_ y == x = y = piecewise x True False assert_ y ndim == assert_ y == With ranges It failing before y = piecewise x False False True assert_array_equal y test_ d_comparison x = y = piecewise x x = x Should succeed assert_equal y With ranges It failing before x = y = piecewise x x = x x = x assert_array_equal y assert_raises_regex ValueError functions expected piecewise x x = x assert_raises_regex ValueError functions expected piecewise x x = x test_ d_ d_condition x = np array c = np array x y = piecewise x c assert_equal y test_multidimensional_extrafunc x = np array - - - y = piecewise x x x = - assert_array_equal y np array - - - instantiate_parametrized_tests TestBincount TestCase test_simple y = np bincount np arange assert_array_equal y np ones test_simple y = np bincount np array assert_array_equal y np array test_simple_weight x = np arange w = np array y = np bincount x w assert_array_equal y w test_simple_weight x = np array w = np array y = np bincount x w assert_array_equal y np array test_with_minlength x = np array y = np bincount x minlength= assert_array_equal y np array x = y = np bincount x minlength= assert_array_equal y np array test_with_minlength_smaller_than_maxvalue x = np array y = np bincount x minlength= assert_array_equal y np array y = np bincount x minlength= assert_array_equal y np array test_with_minlength_and_weights x = np array w = np array y = np bincount x w assert_array_equal y np array test_empty x = np array dtype=int y = np bincount x assert_array_equal x y test_empty_with_minlength x = np array dtype=int y = np bincount x minlength= assert_array_equal y np zeros dtype=int test_with_incorrect_minlength x = np array dtype=int assert_raises TypeError str object cannot interpreted lambda np bincount x minlength= foobar assert_raises ValueError RuntimeError must negative lambda np bincount x minlength=- x = np arange assert_raises TypeError str object cannot interpreted lambda np bincount x minlength= foobar assert_raises ValueError RuntimeError must negative lambda np bincount x minlength=- skipIfTorchDynamo flaky test skipif HAS_REFCOUNT reason= Python lacks refcounts test_dtype_reference_leaks gh- intp_refcount = sys getrefcount np dtype np intp double_refcount = sys getrefcount np dtype np double _ range np bincount assert_equal sys getrefcount np dtype np intp intp_refcount assert_equal sys getrefcount np dtype np double double_refcount _ range np bincount assert_equal sys getrefcount np dtype np intp intp_refcount assert_equal sys getrefcount np dtype np double double_refcount parametrize vals test_error_not_ d vals Test values has -D both array nested list vals_arr = np asarray vals assert_raises ValueError RuntimeError np bincount vals_arr assert_raises ValueError RuntimeError np bincount vals parametrize_interp_sc = parametrize sc subtest lambda x np float x name= real subtest lambda x _make_complex x name= complex-real subtest lambda x _make_complex x name= complex-imag subtest lambda x _make_complex x np multiply x - name= complex-both xpassIfTorchDynamo_np reason= TODO implement instantiate_parametrized_tests TestInterp TestCase test_exceptions assert_raises ValueError interp assert_raises ValueError interp assert_raises ValueError interp period= assert_raises ValueError interp period= assert_raises ValueError interp period= test_basic x = np linspace y = np linspace x = np linspace assert_almost_equal np interp x x y x test_right_left_behavior Needs range sizes test different code paths size == special cased size linear search size = goes through local search possibly binary search size range xp = np arange size dtype=np double yp = np ones size dtype=np double incpts = np array - size - size dtype=np double decpts = incpts - incres = interp incpts xp yp decres = interp decpts xp yp inctgt = np array dtype=float dectgt = inctgt - assert_equal incres inctgt assert_equal decres dectgt incres = interp incpts xp yp left= decres = interp decpts xp yp left= inctgt = np array dtype=float dectgt = inctgt - assert_equal incres inctgt assert_equal decres dectgt incres = interp incpts xp yp right= decres = interp decpts xp yp right= inctgt = np array dtype=float dectgt = inctgt - assert_equal incres inctgt assert_equal decres dectgt incres = interp incpts xp yp left= right= decres = interp decpts xp yp left= right= inctgt = np array dtype=float dectgt = inctgt - assert_equal incres inctgt assert_equal decres dectgt test_scalar_interpolation_point x = np linspace y = np linspace x = assert_almost_equal np interp x x y x x = assert_almost_equal np interp x x y x x = np float assert_almost_equal np interp x x y x x = np float assert_almost_equal np interp x x y x x = np nan assert_almost_equal np interp x x y x test_non_finite_behavior_exact_x x = xp = fp = np inf assert_almost_equal np interp x xp fp np inf np inf fp = np nan assert_almost_equal np interp x xp fp np nan np nan parametrize_interp_sc test_non_finite_any_nan sc test nans propagated assert_equal np interp np nan sc sc np nan assert_equal np interp np nan sc sc np nan assert_equal np interp sc np nan sc np nan assert_equal np interp sc np nan sc np nan parametrize_interp_sc test_non_finite_inf sc Test interp between opposite infs gives nan assert_equal np interp -np inf +np inf sc sc np nan assert_equal np interp sc -np inf +np inf sc np nan assert_equal np interp sc +np inf -np inf sc np nan unless y values equal assert_equal np interp -np inf +np inf sc sc parametrize_interp_sc test_non_finite_half_inf_xf sc Test interp where both axes have bound inf gives nan assert_equal np interp -np inf sc -np inf sc np nan assert_equal np interp -np inf sc +np inf sc np nan assert_equal np interp -np inf sc -np inf sc np nan assert_equal np interp -np inf sc +np inf sc np nan assert_equal np interp +np inf sc -np inf sc np nan assert_equal np interp +np inf sc +np inf sc np nan assert_equal np interp +np inf sc -np inf sc np nan assert_equal np interp +np inf sc +np inf sc np nan parametrize_interp_sc test_non_finite_half_inf_x sc Test interp where x axis has bound inf assert_equal np interp -np inf -np inf sc sc assert_equal np interp -np inf sc sc assert_equal np interp +np inf sc sc assert_equal np interp +np inf +np inf sc sc parametrize_interp_sc test_non_finite_half_inf_f sc Test interp where f axis has bound inf assert_equal np interp sc -np inf sc -np inf assert_equal np interp sc +np inf sc +np inf assert_equal np interp sc -np inf sc -np inf assert_equal np interp sc +np inf sc +np inf assert_equal np interp sc -np inf -np inf sc -np inf assert_equal np interp sc +np inf +np inf sc +np inf test_complex_interp test complex interpolation x = np linspace y = np linspace + + np linspace j x = y = x + + x j assert_almost_equal np interp x x y y test complex left right x = - left = + j assert_almost_equal np interp x x y left=left left x = right = + j assert_almost_equal np interp x x y right=right right test complex non finite x = xp = fp = + j np inf y = + j np inf + j np inf assert_almost_equal np interp x xp fp y test complex periodic x = - - - - - xp = - - fp = + j + j + j + j y = + j + j + j + j + j + j + j + j assert_almost_equal np interp x xp fp period= y test_zero_dimensional_interpolation_point x = np linspace y = np linspace x = np array assert_almost_equal np interp x x y x item xp = np array fp = np array - actual = np interp np array xp fp assert_equal actual assert_ isinstance actual np float np ndarray actual = np interp np array xp fp period= assert_equal actual assert_ isinstance actual np float np ndarray test_if_len_x_is_small xp = np arange fp = np sin xp assert_almost_equal np interp np pi xp fp test_period x = - - - - - xp = - - fp = y = assert_almost_equal np interp x xp fp period= y x = np array x order= F reshape - y = np array y order= C reshape - assert_almost_equal np interp x xp fp period= y instantiate_parametrized_tests TestPercentile TestCase skip reason= NP_VER fails CI no method= test_basic x = np arange assert_equal np percentile x assert_equal np percentile x assert_equal np percentile x x = np nan assert_equal np percentile x np nan assert_equal np percentile x method= nearest np nan skip reason= support Fraction objects test_fraction x = Fraction i i range p = np percentile x Fraction assert_equal p Fraction assert_equal type p Fraction p = np percentile x Fraction assert_equal p Fraction assert_equal type p Fraction p = np percentile x Fraction assert_equal p Fraction assert_equal type p Fraction p = np percentile x Fraction assert_equal p np array Fraction assert_equal type p np ndarray test_api d = np ones np percentile d None None False np percentile d None None False linear o = np ones np percentile d None o False linear xfail reason= TODO implement test_complex arr_c = np array + j + j + j dtype= D assert_raises TypeError np percentile arr_c arr_c = np array + j + j + j dtype= F assert_raises TypeError np percentile arr_c test_ D x = np array assert_array_equal np percentile x axis= skip reason= NP_VER fails CI no method= xpassIfTorchDynamo_np reason= TODO implement parametrize dtype np typecodes Float test_linear_nan_ D dtype METHOD H F arr = np asarray np nan dtype=dtype res = np percentile arr method= linear np testing assert_equal res np nan np testing assert_equal res dtype arr dtype H_F_TYPE_CODES = int_type np float int_type Bbhil np typecodes AllInteger + np float np float np float np float np float np float skip reason= NEP new parametrize input_dtype expected_dtype H_F_TYPE_CODES parametrize method expected inverted_cdf averaged_inverted_cdf closest_observation interpolated_inverted_cdf hazen weibull linear median_unbiased normal_unbiased test_linear_interpolation method expected input_dtype expected_dtype expected_dtype = np dtype expected_dtype hasattr np _get_promotion_state np _get_promotion_state == legacy expected_dtype = np promote_types expected_dtype np float arr = np asarray dtype=input_dtype actual = np percentile arr method=method np testing assert_almost_equal actual expected_dtype type expected method inverted_cdf closest_observation np testing assert_equal np asarray actual dtype np dtype input_dtype np testing assert_equal np asarray actual dtype np dtype expected_dtype TYPE_CODES = np typecodes AllInteger + np typecodes Float skip reason= NP_VER fails CI no method= parametrize dtype TYPE_CODES test_lower_higher dtype assert_equal np percentile np arange dtype=dtype method= lower assert_equal np percentile np arange dtype=dtype method= higher skip reason= NP_VER fails CI no method= parametrize dtype TYPE_CODES test_midpoint dtype assert_equal np percentile np arange dtype=dtype method= midpoint assert_equal np percentile np arange dtype=dtype + method= midpoint assert_equal np percentile np arange dtype=dtype method= midpoint assert_equal np percentile np arange dtype=dtype method= midpoint skip reason= NP_VER fails CI no method= parametrize dtype TYPE_CODES test_nearest dtype assert_equal np percentile np arange dtype=dtype method= nearest assert_equal np percentile np arange dtype=dtype method= nearest test_linear_interpolation_extrapolation arr = np random rand actual = np percentile arr np testing assert_equal actual arr max actual = np percentile arr np testing assert_equal actual arr min test_sequence x = np arange assert_equal np percentile x skip reason= NP_VER fails CI test_axis x = np arange reshape assert_equal np percentile x r = assert_equal np percentile x axis= r r = assert_equal np percentile x axis= np array r T ensure qth axis always first np array old_percentile x = np arange reshape assert_equal np percentile x shape assert_equal np percentile x shape assert_equal np percentile x axis= shape assert_equal np percentile x axis= shape assert_equal np percentile x axis= shape assert_equal np percentile x axis= shape assert_equal np percentile x axis= shape assert_equal np percentile x method= higher shape assert_equal np percentile x method= higher shape assert_equal np percentile x axis= method= higher shape assert_equal np percentile x axis= method= higher shape assert_equal np percentile x axis= method= higher shape assert_equal np percentile x axis= method= higher shape assert_equal np percentile x axis= method= higher shape skipif numpy __version__ reason= NP_VER fails NumPy CI test_scalar_q test no empty dimensions compatibility old percentile x = np arange reshape assert_equal np percentile x assert_ np isscalar np percentile x XXX our isscalar differs r = np array assert_equal np percentile x axis= r assert_equal np percentile x axis= shape r shape r = np array assert_almost_equal np percentile x axis= r assert_equal np percentile x axis= shape r shape out = np empty assert_equal np percentile x out=out assert_equal out out = np empty assert_equal np percentile x axis= out=out r assert_equal out r out = np empty assert_equal np percentile x axis= out=out r assert_equal out r test no empty dimensions compatibility old percentile x = np arange reshape assert_equal np percentile x method= lower assert_ np isscalar np percentile x r = np array c = np percentile x method= lower axis= assert_equal c r assert_equal c shape r shape r = np array c = np percentile x method= lower axis= assert_almost_equal c r assert_equal c shape r shape xfail reason= numpy x dtype int out int torch result float test_scalar_q_ x = np arange reshape out = np empty dtype=x dtype c = np percentile x method= lower out=out assert_equal c assert_equal out out = np empty dtype=x dtype c = np percentile x method= lower axis= out=out assert_equal c r assert_equal out r out = np empty dtype=x dtype c = np percentile x method= lower axis= out=out assert_equal c r assert_equal out r skip reason= NP_VER fails CI no method= test_exception assert_raises RuntimeError ValueError np percentile method= foobar assert_raises RuntimeError ValueError np percentile assert_raises RuntimeError ValueError np percentile - assert_raises RuntimeError ValueError np percentile list range + assert_raises RuntimeError ValueError np percentile list range + - test_percentile_list assert_equal np percentile skip reason= NP_VER fails CI no method= test_percentile_out x = np array y = np zeros p = np percentile x p out=y assert_equal np percentile x p y x = np array y = np zeros np percentile x p axis= out=y assert_equal np percentile x p axis= y y = np zeros np percentile x p axis= out=y assert_equal np percentile x p axis= y x = np arange reshape q dim float r = np array out = np empty assert_equal np percentile x axis= out=out r assert_equal out r r = np array out = np empty assert_equal np percentile x axis= out=out r assert_equal out r q dim int r = np array out = np empty dtype=x dtype c = np percentile x method= lower axis= out=out assert_equal c r assert_equal out r r = np array out = np empty dtype=x dtype c = np percentile x method= lower axis= out=out assert_equal c r assert_equal out r skip reason= NP_VER fails CI no method= test_percentile_empty_dim empty dims preserved d = np arange reshape assert_array_equal np percentile d axis= shape assert_array_equal np percentile d axis= shape assert_array_equal np percentile d axis= shape assert_array_equal np percentile d axis= shape assert_array_equal np percentile d axis=- shape assert_array_equal np percentile d axis=- shape assert_array_equal np percentile d axis=- shape assert_array_equal np percentile d axis=- shape assert_array_equal np percentile d axis= method= midpoint shape assert_array_equal np percentile d axis=- method= midpoint shape assert_array_equal np array np percentile d axis= shape assert_array_equal np array np percentile d axis= shape assert_array_equal np array np percentile d axis= shape assert_array_equal np array np percentile d axis= shape test_percentile_no_overwrite = np array np percentile overwrite_input=False assert_equal np array = np array np percentile assert_equal np array skip reason= NP_VER fails CI no method= test_no_p_overwrite p = np linspace num= np percentile np arange p method= midpoint assert_array_equal p np linspace num= p = np linspace num= tolist np percentile np arange p method= midpoint assert_array_equal p np linspace num= tolist test_percentile_overwrite = np array b = np percentile overwrite_input=True assert_equal b np array b = np percentile overwrite_input=True assert_equal b np array xpassIfTorchDynamo_np reason= pytorch percentile does support tuple axes test_extended_axis o = np random normal size= x = np dstack o assert_equal np percentile x axis= np percentile o item x = np moveaxis x - assert_equal np percentile x axis= - - np percentile o item x = x swapaxes copy assert_equal np percentile x axis= - np percentile o item x = x swapaxes copy assert_equal np percentile x axis= np percentile x axis=None assert_equal np percentile x axis= np percentile x axis= d = np arange reshape np random shuffle d ravel assert_equal np percentile d axis= np percentile d flatten assert_equal np percentile d axis= np percentile d flatten assert_equal np percentile d axis= - np percentile d flatten assert_equal np percentile d axis= np percentile d flatten assert_equal np percentile d axis= np percentile d flatten assert_equal np percentile d axis= - np percentile d flatten assert_equal np percentile d axis= np percentile d flatten test_extended_axis_invalid d = np ones assert_raises np AxisError np percentile d axis=- q= assert_raises np AxisError np percentile d axis= - q= assert_raises np AxisError np percentile d axis= q= assert_raises np AxisError np percentile d axis= q= each these refers same axis twice assert_raises ValueError np percentile d axis= q= assert_raises ValueError np percentile d axis= - - q= assert_raises ValueError np percentile d axis= - q= test_keepdims d = np ones assert_equal np percentile d axis=None keepdims=True shape xfail reason= pytorch percentile does support tuple axes test_keepdims_ assert_equal np percentile d axis= keepdims=True shape assert_equal np percentile d axis= keepdims=True shape assert_equal np percentile d axis= keepdims=True shape assert_equal np percentile d keepdims=True shape assert_equal np percentile d axis= keepdims=True shape assert_equal np percentile d axis= keepdims=True shape assert_equal np percentile d axis= keepdims=True shape skipif numpy __version__ reason= NP_VER fails NumPy x parametrize q subtest decorators= skip reason= Keepdims wrapper incorrect multiple q parametrize axis None subtest subtest decorators= skip reason= Tuple axes subtest - - decorators= skip reason= Tuple axes test_keepdims_out q axis d = np ones axis None shape_out = d ndim axis_norm = normalize_axis_tuple axis d ndim shape_out = tuple i axis_norm d shape i i range d ndim shape_out = np shape q + shape_out out = np empty shape_out result = np percentile d q axis=axis keepdims=True out=out assert result out assert_equal result shape shape_out skip reason= NP_VER fails CI no method= test_out o = np zeros d = np ones assert_equal np percentile d out=o o assert_equal np percentile d method= nearest out=o o o = np zeros assert_equal np percentile d out=o o assert_equal np percentile d method= nearest out=o o o = np zeros d = np ones assert_equal np percentile d out=o o assert_equal np percentile d method= nearest out=o o skip reason= NP_VER fails CI no method= test_out_nan warnings catch_warnings record=True warnings filterwarnings always RuntimeWarning o = np zeros d = np ones d = np nan assert_equal np percentile d out=o o assert_equal np percentile d method= nearest out=o o o = np zeros assert_equal np percentile d out=o o assert_equal np percentile d method= nearest out=o o o = np zeros assert_equal np percentile d out=o o assert_equal np percentile d method= nearest out=o o skip reason= NP_VER fails CI no method= xpassIfTorchDynamo_np reason= np percentile undocumented nan weirdness test_nan_behavior = np arange dtype=float = np nan assert_equal np percentile np nan assert_equal np percentile axis= np nan assert_equal np percentile axis= np array np nan = np arange dtype=float reshape = np nan = np nan no axis assert_equal np percentile np nan assert_equal np percentile ndim axis zeroed b = np percentile np arange dtype=float reshape b = np nan b = np nan assert_equal np percentile b axis zeroed b = np percentile np arange dtype=float reshape b = np nan b = np nan assert_equal np percentile b axis zeroed b = np percentile np arange dtype=float reshape b = np nan b = np nan assert_equal np percentile b axis zeroed b = np percentile np arange dtype=float reshape b = np nan b = np nan assert_equal np percentile b axis zeroed b = np percentile np arange dtype=float reshape b = np nan b = np nan assert_equal np percentile b axis zeroed b = np percentile np arange dtype=float reshape b = np nan b = np nan assert_equal np percentile b axis zeroed method= nearest b = np percentile np arange dtype=float reshape method= nearest b = np nan b = np nan assert_equal np percentile method= nearest b test_nan_q GH pytest raises RuntimeError ValueError np percentile np nan pytest raises RuntimeError ValueError np percentile np nan q = np linspace q = np nan pytest raises RuntimeError ValueError np percentile q instantiate_parametrized_tests TestQuantile TestCase most already tested TestPercentile skip reason= do chase ulp test_max_ulp x = = np quantile x The default linear method would result + = exactly representable formula leads ULP different result Ensure exact within ULP see gh- np testing assert_array_max_ulp maxulp= test_basic x = np arange assert_equal np quantile x assert_equal np quantile x assert_equal np quantile x xfail reason= quantile w integers bools test_correct_quantile_value = np array True tf_quant = np quantile True False assert_equal tf_quant assert_equal type tf_quant dtype = np array False True True quant_res = np quantile assert_array_equal quant_res assert_equal quant_res dtype dtype skip reason= support arrays Fractions test_fraction fractional input integral quantile x = Fraction i i range q = np quantile x assert_equal q assert_equal type q Fraction q = np quantile x assert_equal q Fraction assert_equal type q Fraction q = np quantile x Fraction assert_equal q Fraction assert_equal type q Fraction q = np quantile x Fraction assert_equal q np array Fraction assert_equal type q np ndarray q = np quantile x Fraction assert_equal q np array Fraction assert_equal type q np ndarray repeat integral input fractional quantile x = np arange assert_equal np quantile x Fraction Fraction skip reason= does raise numpy test_complex See gh- arr_c = np array + j + j + j dtype= D assert_raises TypeError np quantile arr_c arr_c = np array + j + j + j dtype= F assert_raises TypeError np quantile arr_c skipif numpy __version__ reason= NP_VER fails NumPy CI test_no_p_overwrite worth retesting because quantile does make copy p = np array p = p copy np quantile np arange p method= midpoint assert_array_equal p p p = p tolist p = p tolist np quantile np arange p method= midpoint assert_array_equal p p skip reason= XXX make quantile preserve integer dtypes parametrize dtype Bbhil np typecodes AllInteger test_quantile_preserve_int_type dtype res = np quantile np array dtype=dtype method= nearest assert res dtype == dtype skipif numpy __version__ reason= NP_VER fails NumPy CI parametrize method subtest inverted_cdf decorators= xpassIfTorchDynamo_np subtest averaged_inverted_cdf decorators= xpassIfTorchDynamo_np subtest closest_observation decorators= xpassIfTorchDynamo_np subtest interpolated_inverted_cdf decorators= xpassIfTorchDynamo_np subtest hazen decorators= xpassIfTorchDynamo_np subtest weibull decorators= xpassIfTorchDynamo_np linear subtest median_unbiased decorators= xpassIfTorchDynamo_np subtest normal_unbiased decorators= xpassIfTorchDynamo_np nearest lower higher midpoint test_quantile_monotonic method GH test value quantile monotonic p ordered Also tests boundary values mishandled p = np linspace quantile = np quantile np array p method=method assert_equal np sort quantile quantile Also test one where number data points clearly divisible quantile = np quantile p method=method assert_equal np sort quantile quantile skip reason= no hypothesis hypothesis given arr=arrays dtype=np float shape=st integers min_value= max_value= elements=st floats allow_infinity=False allow_nan=False min_value=- e max_value= e test_quantile_monotonic_hypo arr p = np arange quantile = np quantile arr p assert_equal np sort quantile quantile test_quantile_scalar_nan = np array = np nan assert_equal np quantile np nan instantiate_parametrized_tests TestMedian TestCase test_basic = np array = np arange = np arange reshape assert_equal np median assert_allclose np median assert_allclose np median assert_allclose np median axis= assert_equal np median axis= assert_allclose np median axis=None = np array assert_almost_equal + np median = np array assert_equal np median = np array assert_equal - np median xfail reason= median scalar output vs -dim test_basic_ check array scalar result = np array assert_equal np median ndim = np nan assert_equal np median ndim test_axis_keyword = np array np random randint size= orig = copy np median axis=None ax range ndim np median axis=ax assert_array_equal orig assert_allclose np median axis= assert_allclose np median T axis= assert_allclose np median assert_allclose np median axis=None assert_allclose np median T test_overwrite_keyword = np array = np array = np arange = np arange reshape assert_allclose np median copy overwrite_input=True assert_allclose np median copy overwrite_input=True assert_allclose np median copy overwrite_input=True assert_allclose np median copy overwrite_input=True axis= assert_allclose np median copy overwrite_input=True axis= assert_allclose np median copy overwrite_input=True axis=None assert_allclose np median copy overwrite_input=True axis= assert_allclose np median T copy overwrite_input=True axis= = np arange dtype=np float reshape np random shuffle ravel assert_allclose np median axis=None np median copy axis=None overwrite_input=True assert_allclose np median axis= np median copy axis= overwrite_input=True assert_allclose np median axis= np median copy axis= overwrite_input=True assert_allclose np median axis= np median copy axis= overwrite_input=True test_array_like x = assert_almost_equal np median x x = x assert_almost_equal np median x assert_allclose np median x axis= x test_out o = np zeros d = np ones assert_equal np median d out=o o o = np zeros assert_equal np median d out=o o o = np zeros assert_equal np median d out=o o test_out_nan warnings catch_warnings record=True warnings filterwarnings always RuntimeWarning o = np zeros d = np ones d = np nan assert_equal np median d out=o o o = np zeros assert_equal np median d out=o o o = np zeros assert_equal np median d out=o o test_nan_behavior = np arange dtype=float = np nan assert_equal np median np nan assert_equal np median axis= np nan = np arange dtype=float reshape = np nan = np nan no axis assert_equal np median np nan assert_equal np median ndim axis b = np median np arange dtype=float reshape b = np nan b = np nan assert_equal np median b axis b = np median np arange dtype=float reshape b = np nan b = np nan assert_equal np median b xpassIfTorchDynamo_np reason= median does support tuple axes test_nan_behavior_ = np arange dtype=float reshape = np nan = np nan axis b = np median np arange dtype=float reshape b = np nan b = np nan assert_equal np median b xfail reason= median scalar vs -dim test_nan_behavior_ = np arange dtype=float reshape = np nan = np nan no axis assert_equal np median ndim xpassIfTorchDynamo_np reason= median torch quantile does handle empty tensors skipif IS_WASM reason= fp errors don t work correctly test_empty mean empty array emits two warnings empty slice divide = np array dtype=float warnings catch_warnings record=True w warnings filterwarnings always RuntimeWarning assert_equal np median np nan assert_ w category RuntimeWarning assert_equal len w multiple dimensions = np array dtype=float ndmin= no axis warnings catch_warnings record=True w warnings filterwarnings always RuntimeWarning assert_equal np median np nan assert_ w category RuntimeWarning axis b = np array dtype=float ndmin= assert_equal np median axis= b assert_equal np median axis= b axis b = np array np nan dtype=float ndmin= warnings catch_warnings record=True w warnings filterwarnings always RuntimeWarning assert_equal np median axis= b assert_ w category RuntimeWarning xpassIfTorchDynamo_np reason= median tuple axes implemented test_extended_axis o = np random normal size= x = np dstack o assert_equal np median x axis= np median o item x = np moveaxis x - assert_equal np median x axis= - - np median o item x = x swapaxes copy assert_equal np median x axis= - np median o item assert_equal np median x axis= np median x axis=None assert_equal np median x axis= np median x axis= assert_equal np median x axis= - np median x axis=- d = np arange reshape np random shuffle d ravel assert_equal np median d axis= np median d flatten assert_equal np median d axis= np median d flatten assert_equal np median d axis= - np median d flatten assert_equal np median d axis= np median d flatten assert_equal np median d axis= np median d flatten assert_equal np median d axis= - np median d flatten assert_equal np median d axis= np median d flatten test_extended_axis_invalid d = np ones assert_raises np AxisError np median d axis=- assert_raises np AxisError np median d axis= - assert_raises np AxisError np median d axis= assert_raises np AxisError np median d axis= assert_raises ValueError np median d axis= test_keepdims d = np ones assert_equal np median d axis=None keepdims=True shape xpassIfTorchDynamo_np reason= median tuple axis test_keepdims_ d = np ones assert_equal np median d axis= keepdims=True shape assert_equal np median d axis= keepdims=True shape assert_equal np median d axis= keepdims=True shape assert_equal np median d axis= keepdims=True shape assert_equal np median d axis= keepdims=True shape skipif numpy __version__ reason= NP_VER fails NumPy x parametrize axis None subtest subtest decorators= skip reason= Tuple axes subtest - - decorators= skip reason= Tuple axes test_keepdims_out axis d = np ones axis None shape_out = d ndim axis_norm = normalize_axis_tuple axis d ndim shape_out = tuple i axis_norm d shape i i range d ndim out = np empty shape_out result = np median d axis=axis keepdims=True out=out assert result out assert_equal result shape shape_out xpassIfTorchDynamo_np reason= TODO implement instantiate_parametrized_tests TestSortComplex TestCase parametrize type_in type_out l D h F H F b F B F g G test_sort_real type_in type_out sort_complex type casting real input types = np array dtype=type_in actual = np sort_complex expected = np sort astype type_out assert_equal actual expected assert_equal actual dtype expected dtype test_sort_complex sort_complex handling complex input = np array + j - j - j + j dtype= D expected = np array - j - j + j + j dtype= D actual = np sort_complex assert_equal actual expected assert_equal actual dtype expected dtype __name__ == __main__ run_tests