mypy allow-untyped-defs typing Optional Union torch torch Tensor torch distributions constraints torch distributions distribution Distribution torch distributions independent Independent torch distributions transforms ComposeTransform Transform torch distributions utils _sum_rightmost torch types _size __all__ = TransformedDistribution TransformedDistribution Distribution r Extension Distribution which applies sequence Transforms base distribution Let f composition transforms applied X ~ BaseDistribution Y = f X ~ TransformedDistribution BaseDistribution f log p Y = log p X + log &#124; det dX dY &#124; Note ` ` event_shape ` ` ` TransformedDistribution ` maximum shape its base distribution its transforms since transforms can introduce correlations among events An example usage ` TransformedDistribution ` would Building Logistic Distribution X ~ Uniform f = + b logit X Y ~ f X ~ Logistic b base_distribution = Uniform transforms = SigmoidTransform inv AffineTransform loc=a scale=b logistic = TransformedDistribution base_distribution transforms For more examples please look implementations ` ~torch distributions gumbel Gumbel ` ` ~torch distributions half_cauchy HalfCauchy ` ` ~torch distributions half_normal HalfNormal ` ` ~torch distributions log_normal LogNormal ` ` ~torch distributions pareto Pareto ` ` ~torch distributions weibull Weibull ` ` ~torch distributions relaxed_bernoulli RelaxedBernoulli ` ` ~torch distributions relaxed_categorical RelaxedOneHotCategorical ` arg_constraints dict str constraints Constraint = __init__ base_distribution Distribution transforms Union Transform list Transform validate_args Optional bool = None - None isinstance transforms Transform transforms = transforms isinstance transforms list all isinstance t Transform t transforms raise ValueError transforms must Transform list Transforms transforms = transforms raise ValueError f transforms must Transform list transforms Reshape base_distribution according transforms base_shape = base_distribution batch_shape + base_distribution event_shape base_event_dim = len base_distribution event_shape transform = ComposeTransform transforms len base_shape transform domain event_dim raise ValueError f base_distribution needs have shape size least transform domain event_dim got base_shape forward_shape = transform forward_shape base_shape expanded_base_shape = transform inverse_shape forward_shape base_shape = expanded_base_shape base_batch_shape = expanded_base_shape len expanded_base_shape - base_event_dim base_distribution = base_distribution expand base_batch_shape reinterpreted_batch_ndims = transform domain event_dim - base_event_dim reinterpreted_batch_ndims base_distribution = Independent base_distribution reinterpreted_batch_ndims base_dist = base_distribution Compute shapes transform_change_in_event_dim = transform codomain event_dim - transform domain event_dim event_dim = max transform codomain event_dim transform coupled base_event_dim + transform_change_in_event_dim base dist coupled assert len forward_shape = event_dim cut = len forward_shape - event_dim batch_shape = forward_shape cut event_shape = forward_shape cut super __init__ batch_shape event_shape validate_args=validate_args expand batch_shape _instance=None new = _get_checked_instance TransformedDistribution _instance batch_shape = torch Size batch_shape shape = batch_shape + event_shape t reversed transforms shape = t inverse_shape shape base_batch_shape = shape len shape - len base_dist event_shape new base_dist = base_dist expand base_batch_shape new transforms = transforms super TransformedDistribution new __init__ batch_shape event_shape validate_args=False new _validate_args = _validate_args new constraints dependent_property is_discrete=False pyrefly ignore bad-override support transforms base_dist support support = transforms - codomain len event_shape support event_dim support = constraints independent support len event_shape - support event_dim support property has_rsample - bool type ignore override base_dist has_rsample sample sample_shape=torch Size Generates sample_shape shaped sample sample_shape shaped batch samples distribution parameters batched Samples first base distribution applies ` transform ` every transform list torch no_grad x = base_dist sample sample_shape transform transforms x = transform x x rsample sample_shape _size = torch Size - Tensor Generates sample_shape shaped reparameterized sample sample_shape shaped batch reparameterized samples distribution parameters batched Samples first base distribution applies ` transform ` every transform list x = base_dist rsample sample_shape transform transforms x = transform x x log_prob value Scores sample inverting transform s computing score using score base distribution log abs det jacobian _validate_args _validate_sample value event_dim = len event_shape log_prob Union Tensor float = y = value transform reversed transforms x = transform inv y event_dim += transform domain event_dim - transform codomain event_dim log_prob = log_prob - _sum_rightmost transform log_abs_det_jacobian x y event_dim - transform domain event_dim y = x log_prob = log_prob + _sum_rightmost base_dist log_prob y event_dim - len base_dist event_shape log_prob _monotonize_cdf value This conditionally flips ` ` value - -value ` ` ensure meth ` cdf ` monotone increasing sign = transform transforms sign = sign transform sign isinstance sign int sign == value sign value - + cdf value Computes cumulative distribution function inverting transform s computing score base distribution transform transforms - value = transform inv value _validate_args base_dist _validate_sample value value = base_dist cdf value value = _monotonize_cdf value value icdf value Computes inverse cumulative distribution function using transform s computing score base distribution value = _monotonize_cdf value value = base_dist icdf value transform transforms value = transform value value