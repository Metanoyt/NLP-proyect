Owner s module onnx Test support onnxscript PyTorch-ONNX converter onnxruntime typing Sequence noqa UP onnx_test_common onnxscript onnxscript onnx_types FLOAT torch torch onnx _internal torchscript_exporter jit_utils torch testing _internal common_utils TestONNXScriptRuntime onnx_test_common _TestONNXRuntime opset version local function supported after opset onnx-script requires users determine opset local function opset_version = test_selu_from_onnxscript_example x = torch randn requires_grad=True model = torch nn SELU onnxscript onnx_opset opset op custom_opset = onnxscript values Opset domain= onnx-script version= onnxscript script custom_opset Selu X default value supported onnxscript alpha = auto wrapped Constants gamma = alphaX = op CastLike alpha X gammaX = op CastLike gamma X neg = gammaX alphaX op Exp X - alphaX pos = gammaX X zero = op CastLike X op Where X = zero neg pos custom_selu g jit_utils GraphContext X g onnxscript_op Selu X setType X type torch onnx register_custom_op_symbolic symbolic_name= aten selu symbolic_fn=custom_selu opset_version=self opset_version run_test model x test_layer_norm x = torch randn y = torch randn z = torch randn N torch nn Module __init__ prob super __init__ dropout = torch nn Dropout prob forward x dropout x M torch nn Module __init__ num_layers super __init__ num_layers = num_layers lns = torch nn ModuleList torch nn LayerNorm eps=i i range num_layers celu = torch nn CELU celu = torch nn CELU dropout = N forward x y z res = celu x res = celu y ln lns z = ln z res + res dropout z model = M onnxscript onnx_opset opset op custom_opset = onnxscript values Opset domain= onnxscript version= onnxscript script custom_opset layer_norm X axes Sequence int weight FLOAT bias FLOAT eps float mean = op ReduceMean X axes=axes D = X - mean op Sub X mean DD = D D op Mul D D var = op ReduceMean DD axes=axes vareps = var + eps op Add var eps stddev = op Sqrt vareps invstddev = op Reciprocal stddev normalized = D invstddev op Mul D invstddev normalizedw = op CastLike normalized weight Type issue missing Op normalizedscaled = normalizedw weight op Mul normalized weight normalizedscaled + bias torch onnx symbolic_helper parse_args v v v f none custom_layer_norm g input normalized_shape weight bias eps cudnn_enable comprehension supported onnxscript axes = -i i range len normalized_shape - g onnxscript_op layer_norm input weight bias axes_i=axes eps_f=eps setType input type torch onnx register_custom_op_symbolic symbolic_name= aten layer_norm symbolic_fn=custom_layer_norm opset_version=self opset_version run_test model x y z __name__ == __main__ common_utils run_tests