mypy allow-untyped-defs sympy sympy multipledispatch dispatch __all__ = SingletonInt SingletonInt sympy AtomicExpr This probably super important unless we multiple dispatch situations other more exotic Expr types _op_priority = __new__ cls args coeff=None kwargs instance = super __new__ cls args kwargs instance The semantics should match NestedIntSymNodeImpl c core NestedIntSymNodeImpl h __init__ val coeff= _val = val _coeff = coeff super __init__ See NOTE Inequalities nested int _eval_Eq other isinstance other SingletonInt other _val == _val _coeff == other _coeff sympy true sympy false This necessary so calling expr free_symbols exprs contain Singleton does error property free_symbols set __mul__ other isinstance other SingletonInt raise ValueError SingletonInt cannot multiplied another SingletonInt SingletonInt _val coeff=self _coeff other __rmul__ other isinstance other SingletonInt raise ValueError SingletonInt cannot multiplied another SingletonInt SingletonInt _val coeff=self _coeff other Make sure we promptly raise error instead falling back building expression tree There probably more ops how can we exhaustive __add__ other raise NotImplementedError NYI __sub__ other raise NotImplementedError NYI __truediv__ other raise NotImplementedError NYI __floordiv__ other raise NotImplementedError NYI __mod__ other raise NotImplementedError NYI See NOTE Inequalities nested int dispatch sympy Integer SingletonInt _eval_is_ge b sympy false raise ValueError Symbolic SingletonInt Relation indeterminate dispatch SingletonInt sympy Integer type ignore no-redef _eval_is_ge b noqa F b = sympy true raise ValueError Symbolic SingletonInt Relation indeterminate dispatch SingletonInt SingletonInt type ignore no-redef _eval_is_ge b noqa F _val == b _val _coeff = b _coeff sympy true sympy false raise ValueError Symbolic SingletonInt Relation indeterminate