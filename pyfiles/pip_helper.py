glob logging shlex shutil sys collections abc Iterable importlib metadata PackageNotFoundError version noqa UP typing Optional Union cli lib common utils run_command logger = logging getLogger __name__ pip_install_packages packages Iterable str = env=None requirements Optional str = None constraints Optional str = None prefer_uv bool = False - None use_uv = prefer_uv shutil which uv None base = sys executable -m uv pip install use_uv sys executable -m pip install cmd = base requirements cmd += -r requirements constraints cmd += -c constraints cmd += list packages logger info pip installing packages s join map shlex quote cmd run_command join map shlex quote cmd env=env pip_install_first_match pattern str extras Optional str = None pref_uv=False wheel = first_matching_pkg pattern target = f wheel extras extras wheel logger info Installing s target pip_install_packages target prefer_uv=pref_uv run_python args Union str list str env=None Run python current environment isinstance args str args = shlex split args cmd = sys executable + args run_command join map shlex quote cmd env=env pkg_exists name str - bool try pkg_version = version name logger info s already exist version s name pkg_version True except PackageNotFoundError logger info s installed name False first_matching_pkg pattern str - str matches = sorted glob glob pattern matches raise FileNotFoundError f No wheel matching pattern matches