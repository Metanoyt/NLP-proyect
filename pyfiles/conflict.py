mypy allow-untyped-defs operator utils _toposort groupby variadic isvariadic __all__ = AmbiguityWarning supercedes consistent ambiguous ambiguities super_signature edge ordering AmbiguityWarning Warning pass supercedes b A consistent strictly more specific than B len len b only case empty b variadic len b == isvariadic b - len == len b all map issubclass b len len b p = p = while p len p len b cur_a = p cur_b = b p isvariadic cur_a isvariadic cur_b issubclass cur_a cur_b False p += p += isvariadic cur_a assert p == len - p == len b - issubclass cur_a cur_b isvariadic cur_b assert p == len b - issubclass cur_a cur_b False p += p == len b - p == len consistent b It possible argument list satisfy both A B Need check empty args b isvariadic b b isvariadic Non-empty args check mutual subclasses len == len b all issubclass aa bb issubclass bb aa aa bb zip b p = p = while p len p len b cur_a = p cur_b = b p issubclass cur_b cur_a issubclass cur_a cur_b False isvariadic cur_a isvariadic cur_b p += p += isvariadic cur_a p += isvariadic cur_b p += We only need check variadic ends Variadic types guaranteed last element isvariadic cur_a type ignore possibly-undefined p == len b isvariadic cur_b type ignore possibly-undefined p == len ambiguous b A consistent B neither strictly more specific consistent b supercedes b supercedes b ambiguities signatures All signature pairs such A ambiguous B signatures = list map tuple signatures b signatures b signatures hash hash b ambiguous b any supercedes c supercedes c b c signatures super_signature signatures A signature would break ambiguities n = len signatures assert all len s == n s signatures max type mro sig i sig signatures key=len i range n edge b tie_breaker=hash A should checked before B Tie broken tie_breaker defaults ` ` hash ` ` A either supersedes B B does supersede A B does then call tie_breaker supercedes b supercedes b tie_breaker tie_breaker b ordering signatures A sane ordering signatures check first last Topological sort edges given ` ` edge ` ` ` ` supercedes ` ` signatures = list map tuple signatures edges = b signatures b signatures edge b edges = groupby operator itemgetter edges s signatures s edges edges s = edges = k b b v k v edges items type ignore assignment attr-defined _toposort edges