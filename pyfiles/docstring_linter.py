__future__ annotations itertools json sys functools cached_property pathlib Path typing Any TYPE_CHECKING _FILE = Path __file__ absolute _PATH = Path p absolute p sys path _OVERRIDES = override typing_extensions override typing override TYPE_CHECKING _FILE parent _PATH _linter _linter TYPE_CHECKING collections abc Callable Iterator Sequence GRANDFATHER_LIST = _FILE parent docstring_linter-grandfather json We tolerate increase block size before demanding docstring TOLERANCE_PERCENT = MAX_LINES = MIN_DOCSTRING = docstrings shorter than too short DESCRIPTION = ` docstring_linter ` reports long functions methods classes without docstrings strip METHOD_OVERRIDE_HINT = If method overrides method parent adding ` typing_extensions override ` decorator will make error go away DocstringLinter _linter FileLinter linter_name = docstring_linter description = DESCRIPTION is_fixer = False path_to_blocks dict str list dict str Any path_to_errors dict str list dict str Any __init__ argv Sequence str &#124; None = None - None super __init__ argv add_arguments parser add_argument path_to_blocks = path_to_errors = lint_all - bool success = super lint_all _report _write_grandfather success _lint pf _linter PythonFile - Iterator _linter LintResult p = str pf path path_to_blocks print Repeated file p file=sys stderr blocks = pf blocks bad = b b blocks _is_bad_block b pf bad = _dont_require_constructor_and_class_docs blocks bad gf = _grandfathered pf path bad yield _block_result b pf b sorted bad - gf as_data b _linter Block - dict str Any status = grandfather b gf bad b bad good status status b as_data path_to_blocks p = as_data b b blocks _error pf _linter PythonFile result _linter LintResult - None path_to_errors str pf path = str result line result name cached_property _grandfather - dict str dict str Any try open args grandfather fp json load fp type ignore no-any-return except FileNotFoundError except Exception e print ERROR e GRANDFATHER_LIST file=sys stderr raise cached_property _max_lines - dict str int args max_class args max_def _grandfathered path Path &#124; None bad set _linter Block - set _linter Block path None args no_grandfather args write_grandfather set grand dict str int = _grandfather get str path tolerance_ratio = + args grandfather_tolerance grandfathered b _linter Block - bool lines = int grand get b display_name tolerance_ratio b line_count = lines b b bad grandfathered b _block_result b _linter Block pf _linter PythonFile - _linter LintResult def_name = function b category == msg = f docstring found def_name b name b line_count lines len b docstring s = len b docstring == s needed = f needed args min_docstring msg = f msg too short len b docstring character s needed msg = f No msg b is_method msg = f msg METHOD_OVERRIDE_HINT _linter LintResult msg pf tokens b begin start _display pf _linter PythonFile results list _linter LintResult - Iterator str args report yield super _display pf results _dont_require_constructor_and_class_docs blocks Sequence _linter Block bad set _linter Block - set _linter Block args lint_init bad good = b b blocks len b docstring = args min_docstring has_class_init_doc b _linter Block - bool b is_class Is whose constructor documented children = blocks i i b children any b is_init b good b children Is constructor whose documented b is_init b parent None blocks b parent good b b bad has_class_init_doc b _is_bad_block b _linter Block pf _linter PythonFile - bool max_lines = _max_lines b category b is_override pf omitted pf tokens b begin b dedent b line_count max_lines len b docstring args min_docstring args lint_local b is_local args lint_protected b name startswith _ _report - None args lintrunner path_to_blocks args report report = k s k v path_to_blocks items s = file_summary v &#124; path_to_errors print json dumps report sort_keys=True indent= _write_grandfather - None args write_grandfather results dict str dict str int = path blocks path_to_blocks items block blocks block status == bad d = results setdefault path d block display_name = block line_count open args grandfather w fp json dump results fp sort_keys=True indent= make_recursive blocks list dict str Any - list dict str Any rec i int - dict str Any d = dict blocks i d children = rec c c d children d rec i i b enumerate blocks b parent None make_terse blocks Sequence dict str Any index_by_line bool = True - dict str dict str Any result dict str dict str Any = max_line = max b start_line b blocks blocks line_field_width = len str max_line b blocks root = f b category b full_name i itertools count name = root + bool i f i + name result break d = docstring_len len b docstring lines b line_count status b get status good start_line = b start_line index_by_line d name = name result f start_line line_field_width = d d line = start_line result name = d kids = b children all isinstance k int k kids assert all isinstance k dict k kids d children = make_terse kids result file_summary blocks Sequence dict str Any report_all bool = False - dict str str to_line v dict str Any - str &#124; None status = v status == good report_all None fail = status == grandfather fail = grandfathered assert status == bad fail = FAIL name = v name lines = v lines docs = v docstring_len parens = name startswith f name parens lines= docs= fail t = make_terse blocks r = k line k v t items line = to_line v while r all k startswith k r r = k v k v r items r add_arguments add Callable Any - None h = Set grandfather list add -- grandfather -g default=str GRANDFATHER_LIST type=str help=h h = Tolerance grandfather sizes percent add -- grandfather-tolerance -t default=TOLERANCE_PERCENT type=float help=h h = Lint __init__ separately add -- lint-init -i action= store_true help=h h = Lint definitions inside other functions add -- lint-local -o action= store_true help=h h = Lint functions methods classes start _ add -- lint-protected -p action= store_true help=h h = Maximum number lines undocumented add -- max-class -c default=MAX_LINES type=int help=h h = Maximum number lines undocumented function add -- max-def -d default=MAX_LINES type=int help=h h = Minimum number characters docstring add -- min-docstring -s default=MIN_DOCSTRING type=int help=h h = Disable grandfather list add -- no-grandfather -n action= store_true help=h h = Print report all classes defs add -- report -r action= store_true help=h h = Rewrite grandfather list add -- write-grandfather -w action= store_true help=h __name__ == __main__ DocstringLinter run