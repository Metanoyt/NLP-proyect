Initializer script installs stuff pip __future__ annotations argparse logging os shutil subprocess sys time run_command args list str env dict str str &#124; None = None - subprocess CompletedProcess str logging debug $ s join args start_time = time monotonic try subprocess run args env=env text=True encoding= utf- check=True finally end_time = time monotonic logging debug took dms end_time - start_time main - None parser = argparse ArgumentParser description= pip initializer parser add_argument packages nargs= + help= pip packages install parser add_argument -- verbose action= store_true help= verbose logging parser add_argument -- dry-run help= do install anything just print what would done args = parser parse_args logging basicConfig format= threadName s levelname s message s level=logging NOTSET args verbose logging DEBUG stream=sys stderr env dict str str = os environ UV_PYTHON sys executable UV_PYTHON_DOWNLOADS never FORCE_COLOR CLICOLOR_FORCE uv_index = env get UV_INDEX env get PIP_EXTRA_INDEX_URL uv_index env UV_INDEX = uv_index If we global install use ` -- user ` install so you do need root access order initialize linters However ` pip install -- user ` interacts poorly virtualenvs see https bit ly vD kvl conda see https bit ly KG ZfU So these cases perform regular installation in_conda = env get CONDA_PREFIX None in_virtualenv = env get VIRTUAL_ENV None need_user_flag = in_conda in_virtualenv uv str &#124; None = shutil which uv is_uv_managed_python = uv python sys base_prefix replace \\ uv is_uv_managed_python need_user_flag pip_args = uv pip install sys executable pip_args = sys executable -mpip install pip_args = pip install need_user_flag pip_args append -- user pip_args extend args packages package args packages package_name _ version = package partition = version == raise RuntimeError f Package package_name did have version specified Please specify version produce consistent linting experience dry_run = args dry_run == dry_run print f Would have run pip_args sys exit run_command pip_args env=env __name__ == __main__ main