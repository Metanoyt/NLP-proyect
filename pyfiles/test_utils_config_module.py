Owner s module unknown os pickle unittest mock patch os environ ENV_TRUE = os environ ENV_FALSE = os environ ENV_STR = os environ ENV_STR_EMPTY = typing Optional torch testing _internal fake_config_module config fake_config_module config fake_config_module config torch testing _internal common_utils run_tests TestCase torch utils _config_module _ConfigEntry _UNSET_SENTINEL Config TestConfigModule TestCase tearDown Config changes get persisted between test cases k config _config config _config k user_override = _UNSET_SENTINEL test_base_value_loading assertTrue config e_bool assertTrue config nested e_bool assertTrue config e_optional assertEqual config e_int assertEqual config e_float assertEqual config e_string string assertEqual config e_list assertEqual config e_set assertEqual config e_tuple assertEqual config e_dict assertEqual config e_none None assertRaises AttributeError msg= fake_config_module does_not_exist does exist config does_not_exist test_type_loading assertEqual config get_type e_optional Optional bool assertEqual config get_type e_none Optional bool test_overrides config e_bool = False assertFalse config e_bool config nested e_bool = False assertFalse config nested e_bool config e_int = assertEqual config e_int config e_float = assertEqual config e_float config e_string = string assertEqual config e_string string config e_list = assertEqual config e_list config e_set = assertEqual config e_set config e_tuple = assertEqual config e_tuple config e_dict = assertEqual config e_dict config e_none = none assertEqual config e_none none config e_none = None assertEqual config e_none None config e_optional = None assertEqual config e_optional None config e_optional = False assertEqual config e_optional False assertRaises AttributeError msg= fake_config_module does_not_exist does exist config does_not_exist = test_none_override_semantics config e_bool = None assertIsNone config e_bool k config _config config _config k user_override = _UNSET_SENTINEL test_reference_semantics config e_list append assertEqual config e_list config e_set add assertEqual config e_set config e_dict = assertEqual config e_dict test_env_name_semantics assertTrue config e_env_default assertFalse config e_env_default_FALSE assertTrue config e_env_force config e_env_default = False assertFalse config e_env_default config e_env_force = False assertTrue config e_env_force test_env_name_string_semantics assertEqual config e_env_default_str assertEqual config e_env_default_str_empty config e_env_default_str = override assertEqual config e_env_default_str override test_multi_env assertTrue config e_env_default_multi assertTrue config e_env_force_multi test_save_config p = config save_config assertDictEqual pickle loads p _cache_config_ignore_prefix magic_cache_config e_bool True e_dict e_float e_int e_list e_none None e_set e_string string e_tuple nested e_bool True _e_ignored True e_compile_ignored True magic_cache_config_ignored True _save_config_ignore e_ignored e_config True e_jk True e_jk_false False e_env_default True e_env_default_FALSE False e_env_default_str e_env_default_str_empty e_env_force True e_optional True config e_bool = False config e_ignored = False config load_config p assertTrue config e_bool assertFalse config e_ignored test_save_config_portable p = config save_config_portable assertDictEqual p e_bool True e_dict e_float e_int e_list e_none None e_set e_string string e_tuple nested e_bool True e_ignored True e_compile_ignored True e_config True e_jk True e_jk_false False e_env_default True e_env_default_FALSE False e_env_default_str e_env_default_str_empty e_env_force True e_optional True config e_bool = False config _e_ignored = False config load_config p assertTrue config e_bool assertFalse config _e_ignored test_codegen_config config e_bool = False config e_ignored = False code = config codegen_config assertEqual code torch testing _internal fake_config_module e_bool = False torch testing _internal fake_config_module e_env_default = True torch testing _internal fake_config_module e_env_default_FALSE = False torch testing _internal fake_config_module e_env_default_str = torch testing _internal fake_config_module e_env_default_str_empty = torch testing _internal fake_config_module e_env_force = True test_codegen_config_function logging warnings config e_list = print warnings warn logging warn config e_set = print config e_func = warnings warn code = config codegen_config assertIn _warnings code assertIn logging code assertIn torch testing _internal fake_config_module e_list = print _warnings warn logging warn torch testing _internal fake_config_module e_set = print torch testing _internal fake_config_module e_func = _warnings warn code test_get_hash hash_value = b \x \xf \xc \x di\x f\x -\x \xdc\x \xd \xd \xf \x c\x assertEqual config get_hash hash_value Test cached value assertEqual config get_hash hash_value assertEqual config get_hash hash_value config _hash_digest = fake assertEqual config get_hash fake config e_bool = False assertNotEqual config get_hash hash_value config e_bool = True Test ignored values config e_compile_ignored = False assertEqual config get_hash hash_value test_dict_copy_semantics p = config shallow_copy_dict assertDictEqual p e_bool True e_dict e_float e_int e_list e_none None e_set e_string string e_tuple nested e_bool True e_ignored True _e_ignored True e_compile_ignored True _cache_config_ignore_prefix magic_cache_config _save_config_ignore e_ignored magic_cache_config_ignored True e_config True e_jk True e_jk_false False e_env_default True e_env_default_FALSE False e_env_default_str e_env_default_str_empty e_env_force True e_optional True p = config to_dict assertEqual p e_bool True e_dict e_float e_int e_list e_none None e_set e_string string e_tuple nested e_bool True e_ignored True _e_ignored True e_compile_ignored True _cache_config_ignore_prefix magic_cache_config _save_config_ignore e_ignored magic_cache_config_ignored True e_config True e_jk True e_jk_false False e_env_default True e_env_default_FALSE False e_env_default_str e_env_default_str_empty e_env_force True e_optional True p = config get_config_copy assertEqual p e_bool True e_dict e_float e_int e_list e_none None e_set e_string string e_tuple nested e_bool True e_ignored True _e_ignored True e_compile_ignored True _cache_config_ignore_prefix magic_cache_config _save_config_ignore e_ignored magic_cache_config_ignored True e_config True e_jk True e_jk_false False e_env_default True e_env_default_FALSE False e_env_default_str e_env_default_str_empty e_env_force True e_optional True Shallow + deep copy semantics config e_dict = assertEqual p e_dict assertEqual p e_dict assertEqual p e_dict test_patch assertTrue config e_bool config patch e_bool False assertFalse config e_bool assertTrue config e_bool config patch e_bool=False assertFalse config e_bool assertTrue config e_bool assertRaises AssertionError config patch does_not_exist pass test_make_closur_patcher revert = config _make_closure_patcher e_bool=False assertFalse config e_bool revert assertTrue config e_bool test_unittest_patch patch torch testing _internal fake_config_module e_bool False patch torch testing _internal fake_config_module e_bool False assertFalse config e_bool unittest mock has some very weird semantics around deletion attributes when undoing patches assertFalse config e_bool assertTrue config e_bool test_bad_jk_type assertRaises AssertionError msg= AssertionError justknobs only support booleans thisisnotvalid boolean _ConfigEntry Config default= bad justknob= fake_knob test_alias assertFalse config e_aliasing_bool assertFalse config e_aliased_bool config patch e_aliasing_bool=True assertTrue config e_aliasing_bool assertTrue config e_aliased_bool config patch e_aliased_bool=True assertTrue config e_aliasing_bool test_reference_is_default t = config e_dict assertTrue config _is_default e_dict t = b assertFalse config _is_default e_dict test_invalid_config_int assertRaises AssertionError _ConfigEntry Config default= env_name_default= FAKE_DISABLE value_type=int test_invalid_config_float assertRaises AssertionError _ConfigEntry Config default= env_name_force= FAKE_DISABLE value_type=float __name__ == __main__ run_tests