mypy allow-untyped-defs functools hashlib inspect json logging os time typing Any Optional torch _inductor config config torch _inductor codecache cutlass_key torch _inductor codegen cuda cutlass_utils serialization torch _inductor codegen cuda cuda_env get_cuda_arch get_cuda_version torch _inductor codegen cuda serialization get_cutlass_operation_serializer torch _inductor runtime cache_dir_utils cache_dir torch _inductor utils clear_on_fresh_cache log = logging getLogger __name__ CONFIG_PREFIX str = configs get_config_request_key arch str cuda_version str instantiation_level str - str Return key full ops based cutlass key arch cuda version instantiation level serialization py file hash Get hash serialization py cutlass_utils py files using their module file paths get_file_hash file_module file_path = inspect getfile file_module open file_path rb f hashlib sha f read hexdigest serialization_hash = get_file_hash serialization cutlass_utils_hash = get_file_hash cutlass_utils hash_target = - join cutlass_key hex arch cuda_version instantiation_level serialization_hash cutlass_utils_hash hashlib sha hash_target encode utf- hexdigest _generate_config_filename request_key str - str Generate filename full ops f CONFIG_PREFIX _ request_key json clear_on_fresh_cache functools cache maybe_fetch_ops - Optional list Any Fetch ops databases config force_disable_caches None setup arch str = get_cuda_arch get_cuda_version might we want use version str = join get_cuda_version split instantiation_level str = config cuda cutlass_instantiation_level filename filepath request_key str = get_config_request_key arch version instantiation_level filename str = _generate_config_filename request_key filepath str = os path join cache_dir filename try fetch serialized_ops Optional list str = None start_time = time time os path isfile filepath locally try open filepath f serialized_ops = json load f assert isinstance serialized_ops list f Expected serialized ops list got type serialized_ops except Exception log warning Failed load CUTLASS config s local cache filename exc_info=True serialized_ops = None config is_fbcode torch _inductor fb cutlass_remote_cache maybe_fetch_cutlass_configs_from_remote remote serialized_ops = maybe_fetch_cutlass_configs_from_remote filepath serialized_ops None None deserialize serializer = get_cutlass_operation_serializer full_ops = serializer deserialize x x serialized_ops type ignore union-attr log info Loaded ops s cache fs filename time time - start_time full_ops