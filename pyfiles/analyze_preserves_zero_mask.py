dataclasses itertools typing Any Optional TYPE_CHECKING sympy torch torch _inductor config torch _inductor dtype_propagation DtypePropagationOpsHandler torch _inductor index_propagation SymPyOps TypedExpr ops_handler DefaultHandler virtualized StoreMode V TYPE_CHECKING torch _inductor scheduler SchedulerNode construct_symbol count int dtype torch dtype - sympy Symbol sympy Symbol f unknown_ count PreservesZeros SymPyOps DefaultHandler For prologue kernels where loads masked does final store kernel preserve zeros __init__ - None count = itertools count store_preserves_zeros Optional bool = None dtype_prop = DtypePropagationOpsHandler load name str index sympy Expr - TypedExpr In prologue fusion all loads get broadcasted dtype = dtype_prop load name index TypedExpr sympy Float dtype is_floating_point sympy Integer dtype store name str index sympy Expr value TypedExpr mode StoreMode = None - None assert isinstance PreservesZeros should only have single store prologue assert store_preserves_zeros None store_preserves_zeros = value is_constant value expr == indirect_indexing args Any kwargs Any - sympy Expr construct_symbol next count torch int _default name str args tuple Any kwargs dict str Any - Any torch _inductor codegen common OpDecompositions hasattr OpDecompositions name getattr OpDecompositions name args kwargs value dtype = getattr dtype_prop name args kwargs TypedExpr construct_symbol next count dtype dtype prologue_preserves_zero_mask prologue SchedulerNode - bool Does prologue preserve zero masks preserves_zeros = PreservesZeros V set_ops_handler preserves_zeros prologue _body prologue get_ranges store_preserves_zeros = preserves_zeros store_preserves_zeros assert isinstance store_preserves_zeros bool store_preserves_zeros dataclasses dataclass DTypeContainer dtype torch dtype is_scalar bool = False RecordLowPrecisionOps DefaultHandler __init__ disallow_fp _ops bool = False - None disallow_fp _ops = disallow_fp _ops low_precision_numeric_op = False dtype_prop = DtypePropagationOpsHandler non_numeric_ops = to_dtype constant where load name str index sympy Expr - DTypeContainer DTypeContainer dtype_prop load name index staticmethod store name str index sympy Expr value TypedExpr mode StoreMode = None - None pass check_bounds expr sympy Expr size sympy Expr lower bool upper bool - None pass staticmethod pyrefly ignore bad-override indirect_indexing args Any kwargs Any - sympy Expr sympy S Zero _default name str args tuple Any kwargs dict str Any - Any out_dtype = getattr dtype_prop name args kwargs out = DTypeContainer out_dtype is_scalar= name == constant name == constant DTypeContainer torch float is_scalar=True uses_low_prec = any isinstance dtype_cont DTypeContainer dtype_cont dtype None low_prec_float dtype_cont dtype dtype_cont itertools chain out args kwargs values uses_low_prec name non_numeric_ops low_precision_numeric_op = True disallow_fp _ops out dtype torch float torch float out is_scalar low_precision_numeric_op = True out low_prec_float dtype torch dtype - bool dtype is_floating_point dtype itemsize can_codegen_without_upcasts prologue SchedulerNode disallow_fp _ops bool = False - bool Can prologue run without ` upcast_to_fp ` while preserving numerics This only true node only contains dtype conversions indexing other non-arithmetic operators If disallow_fp _ops True then we also disallow ops explicitly computed fp fp prologue get_operation_names = V graph low_precision_codegen_ops True low_prec_analysis = RecordLowPrecisionOps disallow_fp _ops Need turn off upcasting do analysis whether we can turn off config patch triton codegen_upcast_to_fp False V set_ops_handler low_prec_analysis prologue _body prologue get_ranges low_prec_analysis low_precision_numeric_op