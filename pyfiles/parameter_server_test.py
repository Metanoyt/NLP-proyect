mypy allow-untyped-defs If you need modify file make test pass please also apply same edits accordingly https github com pytorch examples blob master distributed rpc batch parameter_server py https pytorch org tutorials intermediate rpc_async_execution html#batch-updating-parameter-server threading datetime datetime time perf_counter torch torch distributed rpc rpc torch nn nn torch optim torch testing _internal dist_utils dist_init worker_name torch testing _internal distributed rpc rpc_agent_test_fixture RpcAgentTestFixture batch_size = in_features = out_features = num_batches = timed_log text print f datetime now strftime H M S text BatchUpdateParameterServer __init__ batch_update_size model = nn Linear in_features out_features lock = threading Lock future_model = torch futures Future batch_update_size = batch_update_size curr_update_size = optimizer = optim SGD model parameters lr= momentum= p model parameters p grad = torch zeros_like p get_model model staticmethod rpc functions async_execution update_and_fetch_model ps_rref grads = ps_rref local_value p g zip model parameters grads strict=True p grad None p grad = g p grad += g lock timed_log f PS got curr_update_size batch_update_size updates curr_update_size += fut = future_model curr_update_size = batch_update_size p model parameters p grad = batch_update_size curr_update_size = optimizer step optimizer zero_grad fut set_result model timed_log PS updated model future_model = torch futures Future fut Trainer __init__ ps_rref ps_rref = ps_rref loss_fn = nn L Loss get_next_batch _ range num_batches inputs = torch randn batch_size in_features labels = torch zeros batch_size out_features yield inputs labels train name = rpc get_worker_info name m = ps_rref rpc_sync get_model inputs labels get_next_batch timed_log f name processing one batch loss_fn m inputs labels backward timed_log f name reporting grads m = rpc rpc_sync ps_rref owner BatchUpdateParameterServer update_and_fetch_model args= ps_rref p grad p m cpu parameters timed_log f name got updated model run_trainer ps_rref trainer = Trainer ps_rref trainer train run_ps trainers timed_log Start training start = perf_counter ps_rref = rpc RRef BatchUpdateParameterServer len trainers futs = rpc rpc_async trainer run_trainer args= ps_rref trainer trainers torch futures wait_all futs stop = perf_counter timed_log Finish training timed_log f Time spent training stop - start s ParameterServerTest RpcAgentTestFixture dist_init setup_rpc=False test_batch_updating_parameter_server rank = rpc init_rpc name=worker_name rank backend=self rpc_backend rank=self rank world_size=self world_size rpc_backend_options=self rpc_backend_options rpc init_rpc name=worker_name rank backend=self rpc_backend rank=self rank world_size=self world_size rpc_backend_options=self rpc_backend_options run_ps f worker_name r r range world_size rpc shutdown