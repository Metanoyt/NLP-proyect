os collections abc Generator contextlib contextmanager ExitStack torch distributed elastic multiprocessing errors record __all__ = worker_main TORCH_WORKER_SERVER_SOCKET = TORCH_WORKER_SERVER_SOCKET contextmanager _worker_server socket_path str - Generator None None None torch _C _distributed_c d _WorkerServer server = _WorkerServer socket_path try yield finally server shutdown record contextmanager worker_main - Generator None None None This context manager wraps your main entry function This combines existing ` ` errors record ` ` logic well new ` ` _WorkerServer ` ` exposes handlers via unix socket specified ` ` Torch_WORKER_SERVER_SOCKET ` ` Example worker_main main pass __name__ == __main__ main ExitStack stack socket_path = os environ get TORCH_WORKER_SERVER_SOCKET socket_path None stack enter_context _worker_server socket_path yield