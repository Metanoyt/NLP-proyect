Owner s oncall jit os unittest torch torch _lazy torch _lazy config torch _lazy ir_cache torch _lazy metrics metrics torch _lazy ts_backend torch testing _internal common_utils IS_WINDOWS run_tests TestCase torch _lazy ts_backend init torch _lazy config set_reuse_ir True get_test_device cuda LTC_TS_CUDA os environ cpu unittest skipIf IS_WINDOWS To fixed TestLazyReuseIr TestCase testAdd device = get_test_device x = torch randn device=device y = torch randn device=device z = torch zeros device=device device = lazy x_lazy = x detach clone device=device y_lazy = y detach clone device=device z_lazy = z detach clone device=device _ range z += x + y _ range z_lazy += x_lazy + y_lazy torch _lazy mark_step torch testing assert_close z cpu z_lazy cpu assert metrics counter_value IrNodeReused_torch lazy AddTensor = metrics reset torch _lazy ir_cache reset testAddSub device = get_test_device x = torch randn device=device y = torch randn device=device z = torch zeros device=device device = lazy x_lazy = x detach clone device=device y_lazy = y detach clone device=device z_lazy = z detach clone device=device i range i z += x + y z += x - y i range i z_lazy += x_lazy + y_lazy z_lazy += x_lazy - y_lazy torch _lazy mark_step torch testing assert_close z cpu z_lazy cpu assert metrics counter_value IrNodeReused_torch lazy AddTensor = metrics reset torch _lazy ir_cache reset testAddSubFallback torch _lazy config set_force_fallback aten sub device = get_test_device x = torch randn device=device y = torch randn device=device z = torch zeros device=device device = lazy x_lazy = x detach clone device=device y_lazy = y detach clone device=device z_lazy = z detach clone device=device i range i z += x + y z += x - y i range i z_lazy += x_lazy + y_lazy z_lazy += x_lazy - y_lazy torch _lazy mark_step torch testing assert_close z cpu z_lazy cpu assert metrics counter_value IrNodeReused_torch lazy AddTensor = metrics reset torch _lazy ir_cache reset torch _lazy config set_force_fallback testBatchNorm device = get_test_device x = torch randn device=device weight = torch randn device=device bias = torch randn device=device _ range BatchNorm d does extra checks dimensions which SymInts don t support yet so we call ` torch ops aten native_batch_norm ` bypass checks z _ _ = torch ops aten native_batch_norm x weight bias None None True e- z_legit _ _ = torch ops aten _native_batch_norm_legit x weight bias True e- device = lazy x_lazy = x detach clone device=device weight_lazy = weight detach clone device=device bias_lazy = bias detach clone device=device _ range z_lazy _ _ = torch ops aten native_batch_norm x_lazy weight_lazy bias_lazy None None True e- z_legit_lazy _ _ = torch ops aten _native_batch_norm_legit x_lazy weight_lazy bias_lazy True e- torch _lazy mark_step torch testing assert_close z cpu z_lazy cpu torch testing assert_close z_legit cpu z_legit_lazy cpu assert metrics counter_value IrNodeReused_torch lazy NativeBatchNorm = metrics reset torch _lazy ir_cache reset __name__ == __main__ run_tests