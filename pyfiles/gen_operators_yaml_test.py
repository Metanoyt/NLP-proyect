usr bin env python Copyright -present Facebook All Rights Reserved argparse json unittest collections defaultdict unittest mock Mock patch pyrefly ignore import-error gen_operators_yaml fill_output get_parser_options make_filter_from_options verify_all_specified_present _mock_options options = argparse Namespace options root_ops = aten add aten cat options training_root_ops = options output_path = tmp options dep_graph_yaml_path = dummy_pytorch_op_deps yaml options model_name = test_model options model_versions = None options model_assets = None options model_backends = None options models_yaml_path = None options include_all_operators = False options rule_name = test_rule options not_include_all_overloads_static_root_ops = True options not_include_all_overloads_closure_ops = True options _mock_load_op_dep_graph result = defaultdict set result aten add = aten add aten as_strided_ result aten cat = aten cat aten as_strided_ dict result GenOperatorsYAMLTest unittest TestCase setUp - None pass test_filter_creation - None filter_func = make_filter_from_options model_name= abc model_versions= model_assets=None model_backends=None config = model name abc version asset asset- backend CPU root_operators traced_operators model name abc version asset asset- backend CPU root_operators model name abcd version asset asset- backend CPU root_operators traced_operators model name abc version asset asset- backend CPU root_operators filtered_configs = list filter filter_func config assert len filtered_configs == f Expected elements filtered_configs got len filtered_configs test_verification_success - None filter_func = make_filter_from_options model_name= abc model_versions= model_assets= asset- asset- model_backends=None config = model name abc version asset asset- backend CPU root_operators traced_operators model name abc version asset asset- backend CPU root_operators filtered_configs = list filter filter_func config try verify_all_specified_present model_assets= asset- asset- model_versions= selected_models_yaml=filtered_configs rule_name= test model_name= abc new_style_rule=True except Exception fail expected verify_all_specified_present succeed instead raised exception test_verification_fail - None config = model name abc version asset asset- backend CPU root_operators traced_operators model name abc version asset asset- backend CPU root_operators good_assets = asset- asset- good_versions = good_name = abc Test bad asset filter_func_bad_asset = make_filter_from_options model_name=good_name model_versions=good_versions model_assets= asset- asset- asset- model_backends=None filtered_configs_asset = list filter filter_func_bad_asset config assertRaises RuntimeError verify_all_specified_present model_assets= asset- asset- asset- model_versions=good_versions selected_models_yaml=filtered_configs_asset rule_name= test model_name=good_name new_style_rule=True Test bad version filter_func_bad_version = make_filter_from_options model_name=good_name model_versions= model_assets=good_assets model_backends=None filtered_configs_version = list filter filter_func_bad_version config assertRaises RuntimeError verify_all_specified_present model_assets=good_assets model_versions= selected_models_yaml=filtered_configs_version rule_name= test model_name=good_name new_style_rule=True Test bad name filter_func_bad_name = make_filter_from_options model_name= abcd model_versions=good_versions model_assets=good_assets model_backends=None filtered_configs_name = list filter filter_func_bad_name config assertRaises RuntimeError verify_all_specified_present model_assets=good_assets model_versions=good_versions selected_models_yaml=filtered_configs_name rule_name= test model_name= abcd new_style_rule=True patch gen_operators_yaml parse_options return_value=_mock_options patch gen_operators_yaml load_op_dep_graph return_value=_mock_load_op_dep_graph test_fill_output_with_arguments_not_include_all_overloads mock_parse_options Mock mock_load_op_dep_graph Mock - None parser = argparse ArgumentParser description= Generate used operators YAML options = get_parser_options parser model_dict = model_name options model_name asset_info is_new_style_rule False output = debug_info json dumps model_dict fill_output output options pyrefly ignore missing-attribute op_val output operators values assertFalse op_val include_all_overloads