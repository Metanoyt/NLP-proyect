usr bin env python Owner s oncall r p Copyright c Facebook Inc its affiliates All rights reserved This source code licensed under BSD-style license found LICENSE file root directory source tree abs json logging dataclasses asdict unittest mock patch torch distributed elastic events _get_or_create_logger construct_and_record_rdzv_event Event EventSource NodeState RdzvEvent torch testing _internal common_utils run_tests TestCase EventLibTest TestCase assert_event actual_event expected_event assertEqual actual_event name expected_event name assertEqual actual_event source expected_event source assertEqual actual_event timestamp expected_event timestamp assertDictEqual actual_event metadata expected_event metadata patch torch distributed elastic events get_logging_handler test_get_or_create_logger logging_handler_mock logging_handler_mock return_value = logging NullHandler logger = _get_or_create_logger test_destination assertIsNotNone logger assertEqual len logger handlers assertIsInstance logger handlers logging NullHandler test_event_created event = Event name= test_event source=EventSource AGENT metadata= key value key assertEqual test_event event name assertEqual EventSource AGENT event source assertDictEqual key value key event metadata test_event_deser event = Event name= test_event source=EventSource AGENT metadata= key value key key json_event = event serialize deser_event = Event deserialize json_event assert_event event deser_event RdzvEventLibTest TestCase patch torch distributed elastic events record_rdzv_event patch torch distributed elastic events get_logging_handler test_construct_and_record_rdzv_event get_mock record_mock get_mock return_value = logging StreamHandler construct_and_record_rdzv_event run_id= test_run_id message= test_message node_state=NodeState RUNNING record_mock assert_called_once patch torch distributed elastic events record_rdzv_event patch torch distributed elastic events get_logging_handler test_construct_and_record_rdzv_event_does_not_run_if_invalid_dest get_mock record_mock get_mock return_value = logging NullHandler construct_and_record_rdzv_event run_id= test_run_id message= test_message node_state=NodeState RUNNING record_mock assert_not_called assert_rdzv_event actual_event RdzvEvent expected_event RdzvEvent assertEqual actual_event name expected_event name assertEqual actual_event run_id expected_event run_id assertEqual actual_event message expected_event message assertEqual actual_event hostname expected_event hostname assertEqual actual_event pid expected_event pid assertEqual actual_event node_state expected_event node_state assertEqual actual_event master_endpoint expected_event master_endpoint assertEqual actual_event rank expected_event rank assertEqual actual_event local_id expected_event local_id assertEqual actual_event error_trace expected_event error_trace get_test_rdzv_event - RdzvEvent RdzvEvent name= test_name run_id= test_run_id message= test_message hostname= test_hostname pid= node_state=NodeState RUNNING master_endpoint= test_master_endpoint rank= local_id= error_trace= test_error_trace test_rdzv_event_created event = get_test_rdzv_event assertEqual event name test_name assertEqual event run_id test_run_id assertEqual event message test_message assertEqual event hostname test_hostname assertEqual event pid assertEqual event node_state NodeState RUNNING assertEqual event master_endpoint test_master_endpoint assertEqual event rank assertEqual event local_id assertEqual event error_trace test_error_trace test_rdzv_event_deserialize event = get_test_rdzv_event json_event = event serialize deserialized_event = RdzvEvent deserialize json_event assert_rdzv_event event deserialized_event assert_rdzv_event event RdzvEvent deserialize event test_rdzv_event_str event = get_test_rdzv_event assertEqual str event json dumps asdict event __name__ == __main__ run_tests