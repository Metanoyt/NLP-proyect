Git Utility helpers CLI tasks logging pathlib Path cli lib common path_helper remove_dir git GitCommandError RemoteProgress Repo logger = logging getLogger __name__ PrintProgress RemoteProgress Simple progress logger git operations __init__ interval int = super __init__ _last_percent = - _interval = interval update op_code cur max=None message= msg = _cur_line message max cur percent = int cur max percent = _last_percent percent _interval == _last_percent = percent logger info Progress d - s percent msg msg logger info msg clone_external_repo target str repo str dst str = update_submodules=False Clone repository pinned commit optional submodules dst = dst target try logger info Cloning s s target dst Clone fetch remove_dir dst r = Repo clone_from repo dst progress=PrintProgress r git fetch -- all -- tags Checkout pinned commit commit = get_post_build_pinned_commit target logger info Checking out pinned s commit s target commit r git checkout commit Update submodules requested update_submodules r submodules logger info Updating d submodule s len r submodules sm r submodules sm update init=True recursive=True progress=PrintProgress logger info Successfully cloned s target r commit except GitCommandError logger exception Git operation failed raise get_post_build_pinned_commit name str prefix= github ci_commit_pins - str path = Path prefix f name txt path exists raise FileNotFoundError f Pin file found path path read_text encoding= utf- strip