mypy allow-untyped-defs collections OrderedDict This file contains helper functions implement experimental functionality named tensors python All these experimental unstable subject change deletion check_serializing_named_tensor tensor tensor has_names raise RuntimeError NYI Named tensors don t support serialization Please drop names via ` tensor = tensor rename None ` before serialization build_dim_map tensor Returns map dim dim_name where dim name dim named dim index otherwise OrderedDict idx name None name name idx name enumerate tensor names unzip_namedshape namedshape isinstance namedshape OrderedDict namedshape = namedshape items hasattr namedshape __iter__ isinstance namedshape tuple raise RuntimeError f Expected namedshape OrderedDict iterable tuples got type namedshape len namedshape == raise RuntimeError Expected namedshape non-empty zip namedshape namer_api_name inplace inplace rename_ rename is_ellipsis item item == Ellipsis item == single_ellipsis_index names fn_name ellipsis_indices = i i name enumerate names is_ellipsis name len ellipsis_indices = raise RuntimeError f fn_name More than one Ellipsis found names f names This function supports up one Ellipsis len ellipsis_indices == ellipsis_indices None expand_single_ellipsis numel_pre_glob numel_post_glob names names numel_pre_glob len names - numel_post_glob replace_ellipsis_by_position ellipsis_idx names tensor_names globbed_names = expand_single_ellipsis ellipsis_idx len names - ellipsis_idx - tensor_names names ellipsis_idx + globbed_names + names ellipsis_idx + resolve_ellipsis names tensor_names fn_name Expands inside ` names ` equal list names ` tensor_names ` ellipsis_idx = single_ellipsis_index names fn_name ellipsis_idx None names replace_ellipsis_by_position ellipsis_idx names tensor_names update_names_with_list tensor names inplace Special case tensor rename None len names == names None tensor _update_names None inplace tensor _update_names resolve_ellipsis names tensor names namer_api_name inplace inplace update_names_with_mapping tensor rename_map inplace dim_map = build_dim_map tensor old_dim rename_map keys new_dim = rename_map old_dim old_dim dim_map keys dim_map old_dim = new_dim raise RuntimeError f namer_api_name inplace Tried rename dim old_dim dim f new_dim Tensor tensor names dim old_dim does exist tensor _update_names tuple dim_map values inplace update_names tensor names rename_map inplace There two usages tensor rename names returns view tensor named dims ` names ` ` names ` must length ` tensor dim ` otherwise ` names ` then expanded greedily equal corresponding names ` tensor names ` For example ` ` ` xdoctest +SKIP x = torch empty names= N C H W x rename height width names N C height width xdoctest +SKIP x rename batch width names batch C H width ` ` ` tensor rename rename_map returns view tensor has rename dims specified mapping ` rename_map ` For example ` ` ` xdoctest +SKIP x = torch empty names= N C H W x rename W= width H= height names N C height width ` ` ` Finally tensor rename has in-place version called tensor rename_ has_names = len names has_rename_pairs = bool rename_map has_names has_rename_pairs raise RuntimeError f namer_api_name inplace This function takes either positional f args keyword args both Use tensor namer_api_name inplace names f name dims tensor namer_api_name inplace rename_map rename dims Special case tensor rename which valid dim tensor has_names has_rename_pairs update_names_with_list tensor names inplace has_names update_names_with_list tensor names inplace update_names_with_mapping tensor rename_map inplace