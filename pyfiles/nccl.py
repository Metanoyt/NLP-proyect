mypy allow-untyped-defs collections warnings collections abc Sequence typing Optional Union torch cuda __all__ = all_reduce reduce broadcast all_gather reduce_scatter SUM = ncclRedOp_t is_available tensors hasattr torch _C _nccl_all_reduce warnings warn PyTorch compiled NCCL support stacklevel= False devices = set tensor tensors tensor is_sparse False tensor is_contiguous False tensor is_cuda False device = tensor get_device device devices False devices add device True version Returns version NCCL This function returns tuple containing major minor patch version numbers NCCL The suffix also included tuple version suffix exists Returns tuple The version information NCCL ver = torch _C _nccl_version major = ver minor = ver patch = ver suffix = torch _C _nccl_version_suffix decode utf- suffix == major minor patch major minor patch suffix unique_id torch _C _nccl_unique_id init_rank num_ranks uid rank torch _C _nccl_init_rank num_ranks uid rank _check_sequence_type inputs Union torch Tensor Sequence torch Tensor - None isinstance inputs collections abc Container isinstance inputs torch Tensor raise TypeError Inputs should collection tensors all_reduce inputs outputs=None op=SUM streams=None comms=None _check_sequence_type inputs outputs None outputs = inputs _check_sequence_type outputs torch _C _nccl_all_reduce inputs outputs op streams comms ` output ` used ` outputs ` taking list tensors So we have two arguments BC reasons reduce inputs Sequence torch Tensor output Optional Union torch Tensor Sequence torch Tensor = None root int = op int = SUM streams Optional Sequence torch cuda Stream = None comms=None outputs Optional Sequence torch Tensor = None - None _check_sequence_type inputs _output torch Tensor outputs None output None raise ValueError output outputs can both specified outputs deprecated favor output taking single output tensor The signature reduce reduce inputs output=None root= op=SUM streams=None comms=None warnings warn ` nccl reduce ` output tensor list deprecated Please specify single output tensor argument output instead instead FutureWarning stacklevel= _output = outputs root isinstance output torch Tensor isinstance output collections abc Sequence User called old API positional arguments list output tensors warnings warn nccl reduce output tensor list deprecated Please specify single output tensor FutureWarning stacklevel= _output = output root _output = inputs root output None output torch _C _nccl_reduce inputs _output root op streams comms broadcast inputs Sequence torch Tensor root int = streams=None comms=None - None _check_sequence_type inputs torch _C _nccl_broadcast inputs root streams comms all_gather inputs Sequence torch Tensor outputs Sequence torch Tensor streams=None comms=None - None _check_sequence_type inputs _check_sequence_type outputs torch _C _nccl_all_gather inputs outputs streams comms reduce_scatter inputs Sequence torch Tensor outputs Sequence torch Tensor op int = SUM streams=None comms=None - None _check_sequence_type inputs _check_sequence_type outputs torch _C _nccl_reduce_scatter inputs outputs op streams comms