mypy allow-untyped-defs usr bin env python Copyright c Facebook Inc its affiliates All rights reserved This source code licensed under BSD-style license found LICENSE file root directory source tree Taken modified original source https eli thegreenplace net redirecting-all-kinds-of-stdout-in-python ctypes logging os sys contextlib contextmanager functools partial IS_WINDOWS = sys platform == win IS_MACOS = sys platform == darwin logger = logging getLogger __name__ get_libc IS_WINDOWS IS_MACOS logger warning NOTE Redirects currently supported Windows MacOs None ctypes CDLL libc so libc = get_libc _c_std stream str ctypes c_void_p in_dll libc stream _python_std stream str stdout sys stdout stderr sys stderr stream _VALID_STD = stdout stderr contextmanager redirect std str to_file str Redirect ` ` std ` ` one ` ` stdout ` ` ` ` stderr ` ` file path specified ` ` to_file ` ` This method redirects underlying std file descriptor just python s ` ` sys stdout &#124; stderr ` ` See usage details Directory ` ` dst_filename ` ` assumed exist destination file overwritten already exists note Due buffering cross source writes guaranteed appear wall-clock order For instance example below possible C-outputs appear before python outputs log file Usage syntactic-sugar redirect stdout tmp stdout log redirect_stdout tmp stdout log print python stdouts redirected libc = ctypes CDLL libc so libc printf b c stdouts also redirected os system echo system stdouts also redirected print stdout restored std _VALID_STD raise ValueError f unknown standard stream std must one _VALID_STD c_std = _c_std std python_std = _python_std std std_fd = python_std fileno _redirect dst libc fflush c_std python_std flush os dup dst fileno std_fd os fdopen os dup std_fd orig_std open to_file mode= w+b dst _redirect dst try yield finally _redirect orig_std redirect_stdout = partial redirect stdout redirect_stderr = partial redirect stderr