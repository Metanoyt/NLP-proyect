usr bin env python Test verify fuzzer produces deterministic output same seed subprocess sys pathlib Path run_fuzzer_with_seed seed Run fuzzer specific seed generated code cmd = sys executable fuzzer py -- seed str seed -- template unbacked Clear output directory first torchfuzz_dir = Path tmp torchfuzz torchfuzz_dir exists f torchfuzz_dir glob py f unlink result = subprocess run cmd capture_output=True text=True cwd=Path __file__ parent Always attempt read generated file even execution failed result returncode = print f Fuzzer failed code result returncode print f stdout result stdout print f stderr result stderr Prefer compare exact Program Source fuzzer printed stdout which reflects executed code even files overwritten between runs src_block = None lines = result stdout splitlines i line enumerate lines line strip == === Program Source === Collect until next delimiter line === end j = i + block_lines = while j len lines lines j startswith === block_lines append lines j j += src_block = \n join block_lines break src_block src_block Fallback parse exact path fuzzer ran stdout Running tmp torchfuzz fuzz_XXXX py path = None line lines line startswith Running line strip endswith py path = line split Running strip break path None Fallback pick most recently modified fuzz_ py tmp torchfuzz py_files = sorted torchfuzz_dir glob fuzz_ py key=lambda p p stat st_mtime reverse=True py_files print No Python files generated tmp torchfuzz None path = str py_files Read content generated file actually executed open path f f read test_deterministic_output Test fuzzer produces identical output same seed seed = Use seed mentioned user s issue num_runs = outputs = print f Running fuzzer num_runs times seed seed i range num_runs print f Run i + output = run_fuzzer_with_seed seed output None print f Failed get output run i + False outputs append output Compare all outputs first_output = outputs all_identical = all output == first_output output outputs all_identical print ‚úì SUCCESS All outputs identical print f Generated code length len first_output characters True print ‚úó FAILURE Outputs differ between runs Show differences debugging i output enumerate outputs output = first_output print f \nDifferences between run run i Simple line-by-line comparison lines = first_output splitlines lines = output splitlines min_lines = min len lines len lines line_num range min_lines lines line_num = lines line_num print f Line line_num + print f Run lines line_num print f Run i lines line_num break len lines = len lines print f Different number lines len lines vs len lines False main Main function run determinism test print Testing fuzzer determinism print = success = test_deterministic_output success print \nüéâ Test PASSED Fuzzer deterministic sys exit print \n‚ùå Test FAILED Fuzzer deterministic sys exit __name__ == __main__ main