mypy ignore-errors io json os pathlib Path unittest mock TestCase LinterTestCase TestCase LinterClass = None rewrite_expected = REWRITE_EXPECTED os environ assertExpected path Path actual str suffix str - None expected_file = Path f path suffix rewrite_expected expected_file exists assertEqual expected_file read_text actual expected_file write_text actual replace s str linter = LinterClass dummy pf = LinterClass make_file contents=s replacement _results = linter _replace pf replacement mock patch sys stdout new_callable=io StringIO lint_test path args mock_stdout _lint_test path args mock_stdout mock patch sys stdout new_callable=io StringIO lint_fix_test path args mock_stdout rep results linter = _lint_test path args mock_stdout r = results - path = linter paths assertEqual r original path read_text assertEqual rep r replacement assertExpected path r replacement python r _lint_test path args mock_stdout subTest from-command-line linter = LinterClass str path args linter lint_all assertExpected path mock_stdout getvalue lintrunner replacement results = no replacement no results subTest from-lintrunner linter = LinterClass -- lintrunner str path args pf = LinterClass make_file path replacement results = linter _replace pf actual = json loads d d linter _display pf results actual = json dumps actual indent= sort_keys=True + \n assertExpected path actual json replacement results linter