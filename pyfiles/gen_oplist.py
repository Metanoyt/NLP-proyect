usr bin env python __future__ annotations argparse json os sys functools reduce typing Any yaml tools lite_interpreter gen_selected_mobile_ops_header write_selected_mobile_ops torchgen selective_build selector combine_selective_builders SelectiveBuilder extract_all_operators selective_builder SelectiveBuilder - set str set selective_builder operators keys extract_training_operators selective_builder SelectiveBuilder - set str ops = op_name op selective_builder operators items op is_used_for_training ops append op_name set ops throw_if_any_op_includes_overloads selective_builder SelectiveBuilder - None ops = op_name op selective_builder operators items op include_all_overloads ops append op_name ops raise Exception noqa TRY Operators include all overloads + allowed since -- allow-include-all-overloads + specified format join ops gen_supported_mobile_models model_dicts list Any output_dir str - None supported_mobile_models_source = Generated gen_oplist py #include fb supported_mobile_models SupportedMobileModels h struct SupportedMobileModelCheckerRegistry SupportedMobileModelCheckerRegistry auto ref = facebook pytorch supported_model SupportedMobileModelChecker singleton ref set_supported_md _hashes std unordered_set std string supported_hashes_template This global object initializing which causes registration happen SupportedMobileModelCheckerRegistry register_model_versions Generate SupportedMobileModelsRegistration cpp md _hashes = set model_dict model_dicts debug_info model_dict debug_info = json loads model_dict debug_info debug_info is_new_style_rule asset_info debug_info asset_info values md _hashes update asset_info md _hash supported_hashes = md md _hashes supported_hashes += f md \n open os path join output_dir SupportedMobileModelsRegistration cpp wb out_file source = supported_mobile_models_source format supported_hashes_template=supported_hashes out_file write source encode utf- main argv list Any - None This binary generates files selected_mobile_ops h Primary operators used templated selective build Kernel Function dtypes captured tracing selected_operators yaml Selected root non-root operators either via tracing static analysis parser = argparse ArgumentParser description= Generate operator lists parser add_argument -- output-dir -- output_dir help= The directory store output yaml files selected_mobile_ops h + selected_kernel_dtypes h selected_operators yaml required=True parser add_argument -- model-file-list-path -- model_file_list_path help= Path file contains locations individual + model YAML files contain set used operators This + file path must have leading -symbol which will stripped + out before processing required=True parser add_argument -- allow-include-all-overloads -- allow_include_all_overloads help= Flag allow operators include all overloads + If set operators registered without using traced style will + break build action= store_true default=False required=False options = parser parse_args argv os path isfile options model_file_list_path print Processing model file options model_file_list_path model_dicts = model_dict = yaml safe_load open options model_file_list_path model_dicts append model_dict print Processing model directory options model_file_list_path assert options model_file_list_path == model_file_list_path = options model_file_list_path model_dicts = open model_file_list_path model_list_file model_file_names = model_list_file read split model_file_name model_file_names open model_file_name rb model_file model_dict = yaml safe_load model_file model_dicts append model_dict selective_builders = SelectiveBuilder from_yaml_dict m m model_dicts While we have model_dicts generate supported mobile models api gen_supported_mobile_models model_dicts options output_dir We may have selective builders since there may any viable pt_operator_library rule marked dep pt_operator_registry rule This potentially error we should probably raise assertion failure here However needs investigated further selective_builder = SelectiveBuilder from_yaml_dict len selective_builders selective_builder = reduce combine_selective_builders selective_builders options allow_include_all_overloads throw_if_any_op_includes_overloads selective_builder open os path join options output_dir selected_operators yaml wb out_file out_file write yaml safe_dump selective_builder to_dict default_flow_style=False encode utf- write_selected_mobile_ops os path join options output_dir selected_mobile_ops h selective_builder __name__ == __main__ main sys argv