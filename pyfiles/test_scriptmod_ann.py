Owner s oncall jit os sys warnings typing Dict List Optional torch Make helper files test importable pytorch_test_dir = os path dirname os path dirname os path realpath __file__ sys path append pytorch_test_dir torch testing _internal common_utils raise_on_run_directly torch testing _internal jit_utils JitTestCase TestScriptModuleInstanceAttributeTypeAnnotation JitTestCase NB There no tests ` Tuple ` ` NamedTuple ` here In fact reassigning non-empty Tuple attribute previously typed containing empty Tuple SHOULD fail See note ` _check py ` test_annotated_falsy_base_type M torch nn Module __init__ - None super __init__ x int = forward x int x = x warnings catch_warnings record=True w checkModule M assert len w == test_annotated_nonempty_container M torch nn Module __init__ - None super __init__ x List int = forward x List int x = x warnings catch_warnings record=True w checkModule M assert len w == test_annotated_empty_tensor M torch nn Module __init__ - None super __init__ x torch Tensor = torch empty forward x torch Tensor x = x x warnings catch_warnings record=True w checkModule M torch rand assert len w == test_annotated_with_jit_attribute M torch nn Module __init__ - None super __init__ x = torch jit Attribute List int forward x List int x = x x warnings catch_warnings record=True w checkModule M assert len w == test_annotated_class_level_annotation_only M torch nn Module x List int __init__ - None super __init__ x = forward y List int x = y x warnings catch_warnings record=True w checkModule M assert len w == test_annotated_class_level_annotation_and_init_annotation M torch nn Module x List int __init__ - None super __init__ x List int = forward y List int x = y x warnings catch_warnings record=True w checkModule M assert len w == test_annotated_class_level_jit_annotation M torch nn Module x List int __init__ - None super __init__ x List int = torch jit annotate List int forward y List int x = y x warnings catch_warnings record=True w checkModule M assert len w == test_annotated_empty_list M torch nn Module __init__ - None super __init__ x List int = forward x List int x = x assertRaisesRegexWithHighlight RuntimeError Tried set nonexistent attribute x = x assertWarnsRegex UserWarning doesn t support instance-level annotations empty non-base types torch jit script M test_annotated_empty_list_lowercase M torch nn Module __init__ - None super __init__ x list int = forward x list int x = x assertRaisesRegexWithHighlight RuntimeError Tried set nonexistent attribute x = x assertWarnsRegex UserWarning doesn t support instance-level annotations empty non-base types torch jit script M test_annotated_empty_dict M torch nn Module __init__ - None super __init__ x Dict str int = forward x Dict str int x = x assertRaisesRegexWithHighlight RuntimeError Tried set nonexistent attribute x = x assertWarnsRegex UserWarning doesn t support instance-level annotations empty non-base types torch jit script M test_annotated_empty_dict_lowercase M torch nn Module __init__ - None super __init__ x dict str int = forward x dict str int x = x assertRaisesRegexWithHighlight RuntimeError Tried set nonexistent attribute x = x assertWarnsRegex UserWarning doesn t support instance-level annotations empty non-base types torch jit script M test_annotated_empty_optional M torch nn Module __init__ - None super __init__ x Optional str = None forward x Optional str x = x assertRaisesRegexWithHighlight RuntimeError Wrong type attribute assignment x = x assertWarnsRegex UserWarning doesn t support instance-level annotations empty non-base types torch jit script M test_annotated_with_jit_empty_list M torch nn Module __init__ - None super __init__ x = torch jit annotate List int forward x List int x = x assertRaisesRegexWithHighlight RuntimeError Tried set nonexistent attribute x = x assertWarnsRegex UserWarning doesn t support instance-level annotations empty non-base types torch jit script M test_annotated_with_jit_empty_list_lowercase M torch nn Module __init__ - None super __init__ x = torch jit annotate list int forward x list int x = x assertRaisesRegexWithHighlight RuntimeError Tried set nonexistent attribute x = x assertWarnsRegex UserWarning doesn t support instance-level annotations empty non-base types torch jit script M test_annotated_with_jit_empty_dict M torch nn Module __init__ - None super __init__ x = torch jit annotate Dict str int forward x Dict str int x = x assertRaisesRegexWithHighlight RuntimeError Tried set nonexistent attribute x = x assertWarnsRegex UserWarning doesn t support instance-level annotations empty non-base types torch jit script M test_annotated_with_jit_empty_dict_lowercase M torch nn Module __init__ - None super __init__ x = torch jit annotate dict str int forward x dict str int x = x assertRaisesRegexWithHighlight RuntimeError Tried set nonexistent attribute x = x assertWarnsRegex UserWarning doesn t support instance-level annotations empty non-base types torch jit script M test_annotated_with_jit_empty_optional M torch nn Module __init__ - None super __init__ x = torch jit annotate Optional str None forward x Optional str x = x assertRaisesRegexWithHighlight RuntimeError Wrong type attribute assignment x = x assertWarnsRegex UserWarning doesn t support instance-level annotations empty non-base types torch jit script M test_annotated_with_torch_jit_import torch jit M torch nn Module __init__ - None super __init__ x = jit annotate Optional str None forward x Optional str x = x assertRaisesRegexWithHighlight RuntimeError Wrong type attribute assignment x = x assertWarnsRegex UserWarning doesn t support instance-level annotations empty non-base types torch jit script M __name__ == __main__ raise_on_run_directly test test_jit py