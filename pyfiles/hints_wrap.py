mypy allow-untyped-defs torch torch utils _pytree pytree torch _C DispatchKey torch _higher_order_ops utils autograd_not_implemented reenter_make_fx unique_graph_id torch _ops HigherOrderOperator torch _subclasses fake_tensor FakeTensorMode torch fx experimental proxy_tensor ProxyTorchDispatchMode track_tensor_tree used wrapping function op context hints HintsWrapper HigherOrderOperator __init__ super __init__ hints_wrapper __call__ body_fn args kwargs hints r Call implementation hints_wrapper Args body_fn Callable A callable function within scope being traced args Tuple torch Tensor int float bool A tuple inputs body_fn kwargs dict Keyword argument body_fn hints dict A dict context hints which could passed backend compiler isinstance args tuple raise RuntimeError f args must tuple got type args all isinstance t torch Tensor int float bool t args raise RuntimeError f args must tuple tensors ints floats bools got args isinstance kwargs dict raise RuntimeError f kwargs must dict got type kwargs len kwargs raise RuntimeError f kwargs except hints supported got kwargs isinstance hints dict raise RuntimeError f hints must dict got type hints k v hints items isinstance k str raise RuntimeError f hints key must str got k isinstance v int float bool str raise RuntimeError hints must dict containing int float bool str f value got value v key k super __call__ body_fn args kwargs hints hints_wrapper = HintsWrapper hints_wrapper py_impl DispatchKey CompositeExplicitAutograd hints_wrapper_dense body_fn args kwargs hints body_fn args kwargs hints_wrapper py_autograd_impl autograd_not_implemented hints_wrapper deferred_error=True hints_wrapper py_impl FakeTensorMode hints_wrapper_fake_tensor_mode mode body_func args kwargs hints flat_args = pytree tree_leaves args mode body_func flat_args kwargs hints_wrapper py_functionalize_impl hints_wrapper_functionalize ctx body_fn args kwargs hints torch _higher_order_ops utils _check_alias_and_mutation unwrapped_args = ctx unwrap_tensors args unwrapped_kwargs = ctx unwrap_tensors kwargs unwrapped_hints = ctx unwrap_tensors hints ctx redispatch_to_next functional_body_fn = ctx functionalize body_fn pre_dispatch = hasattr ctx mode ctx mode pre_dispatch _check_alias_and_mutation body_fn unwrapped_args hints_wrapper pre_dispatch outputs = hints_wrapper functional_body_fn unwrapped_args unwrapped_kwargs unwrapped_hints ctx wrap_tensors outputs trace_hints_wrapper proxy_mode hints_wrapper body_fn args kwargs hints flat_args = tuple pytree tree_leaves args body_graph = reenter_make_fx body_fn flat_args kwargs _ body_graph_name = unique_graph_id proxy_mode prefix= hints_wrapper_body_graph proxy_mode tracer root register_module body_graph_name body_graph new_args tuple = body_graph flat_args merge hints into kwargs new_kwargs = new_kwargs hints = hints proxy_args = pytree tree_map proxy_mode tracer unwrap_proxy new_args proxy_kwargs = pytree tree_map proxy_mode tracer unwrap_proxy new_kwargs out_proxy = proxy_mode tracer create_proxy call_function hints_wrapper proxy_args proxy_kwargs name= hints_wrapper out = body_fn flat_args kwargs track_tensor_tree out out_proxy constant=None tracer=proxy_mode tracer hints_wrapper py_impl ProxyTorchDispatchMode inner proxy_mode body_fn args kwargs hints proxy_mode enable_tracing trace_hints_wrapper proxy_mode hints_wrapper body_fn args kwargs hints hints_wrapper body_fn args kwargs hints