__future__ annotations abc ABC abstractmethod typing Any Optional TYPE_CHECKING Union torch torch _inductor config torch _inductor ir torch _inductor virtualized V ir FixedLayout FlexibleLayout Layout TYPE_CHECKING collections abc Sequence sympy KernelInputs ABC Class store provide access input nodes kernels This takes tuple input nodes provides methods access information about these nodes such their device type device __init__ input_nodes list Any scalars Optional dict str Union float int = None out_dtype Optional torch dtype = None Initialize tuple input nodes Args input_nodes A tuple input nodes store out_dtype Optional output dtype store _input_nodes = input_nodes _device_name Optional str = None _scalars = scalars scalars None _out_dtype = out_dtype assert len input_nodes Expected least one input node nodes reorder Optional Sequence int = None - list Any Return stored input nodes optionally reordered Args reorder Optional sequence indices reorder nodes For example would nodes order Returns The tuple input nodes optionally reordered reorder None _input_nodes assert len _input_nodes == len reorder f Reorder length mismatch len _input_nodes vs len reorder _input_nodes i i reorder property count - int Get number input nodes Returns The number input nodes len _input_nodes property device_type - Optional str Get device type first node Returns The device type e g cuda cpu ir get_device_type _input_nodes device - torch device Get device first node Returns The device first node _input_nodes get_device device_name - Optional str Get device name information Returns A tuple gpu_name vendor model _device_name None device = device device_type == cuda device_properties = torch cuda get_device_properties device _device_name = device_properties gcnArchName _device_name shapes_symbolic - tuple tuple Any Get symbolic shapes all input nodes Returns A tuple shape tuples each input node tuple node get_size node _input_nodes shapes_hinted - tuple tuple int Get size hints shapes all input nodes Returns A tuple shape tuples integer hints each input node tuple V graph sizevars size_hints node get_size fallback=torch _inductor config unbacked_symint_fallback node _input_nodes strides_symbolic - tuple tuple sympy Integer Get symbolic strides all input nodes Returns A tuple stride tuples each input node tuple node get_stride node _input_nodes strides_hinted - tuple tuple int Get size hints strides all input nodes Returns A tuple stride tuples integer hints each input node tuple V graph sizevars size_hints node get_stride fallback=torch _inductor config unbacked_symint_fallback node _input_nodes dtypes - tuple torch dtype Get dtypes all input nodes Returns A tuple dtypes each input node tuple node get_dtype node _input_nodes dtype idx int = - torch dtype Get dtype specific input node Args idx Index node get dtype default Returns The dtype specified input node _input_nodes idx get_dtype abstractmethod out_dtype - torch dtype Get output dtype whether passed inferred nodes Returns The output dtype get_scalar name str - Union float int Get scalar value given name Args name Name scalar get Returns The scalar value assert name _scalars f Scalar name found required _scalars name abstractmethod output_layout flexible bool = True - Layout Abstract method handle output layout generation Args out_dtype Optional output dtype If provided infer inputs flexible If True FlexibleLayout otherwise FixedLayout MMKernelInputs KernelInputs Specialized KernelInputs matrix multiplication operations Provides additional methods access M N K dimensions __init__ input_nodes list Any scalars Optional dict str Union float int = None out_dtype Optional torch dtype = None mat _idx int = - mat _idx int = - Initialize tuple input nodes By default we assume last input nodes mat mat caller can adjust when necessary super __init__ input_nodes scalars out_dtype mm we need least nodes we need know which nodes main matrixes e g addmm bias mat mat whereas others might mat mat scale etc assert len _input_nodes = Expected least input nodes Adjust assertions handle negative indices m _idx m _idx = mat _idx mat _idx mat _idx m _idx += len input_nodes mat _idx m _idx += len input_nodes assert = m _idx len input_nodes f Invalid mat _idx mat _idx assert = m _idx len input_nodes f Invalid mat _idx mat _idx _mat _idx = mat _idx _mat _idx = mat _idx mnk_symbolic - tuple sympy Integer sympy Integer sympy Integer Get symbolic M N K dimensions matrix multiplication Handles both D MM D BMM tensors M extracted second-to-last dimension first operand mat N extracted last dimension second operand mat K extracted last dimension first operand mat Returns A tuple M N K dimensions mat = nodes _mat _idx mat = nodes _mat _idx m = mat get_size - M second-to-last dimension mat k = mat get_size - K last dimension mat n = mat get_size - N last dimension mat Ensure K dimensions match between operands k = mat get_size - K second-to-last dimension mat V graph sizevars check_equals k k m n k out_dtype - torch dtype Get output dtype whether passed inferred nodes Returns The output dtype _out_dtype None _out_dtype mat mat get_dtype output_layout flexible bool = True - Layout Handle output layout generation matrix multiplication Args out_dtype Optional output dtype If provided infer inputs flexible If True FlexibleLayout otherwise FixedLayout mat mat = mat mat out_dtype = out_dtype NOTE taken mm_common mm_args b m k = mat get_size b k n = mat get_size b = V graph sizevars check_equals_and_simplify b b zip b b size = b m n flexible FlexibleLayout device out_dtype size FixedLayout device out_dtype size mat mat - tuple Any Any Get mat mat nodes Returns A tuple mat mat nodes nodes = nodes nodes _mat _idx nodes _mat _idx mnk_hinted - tuple int int int Get hinted M N K dimensions matrix multiplication Handles both D MM D BMM tensors Uses shapes_hinted base get integer hints dimensions Returns A tuple M N K dimensions integers hinted_shapes = shapes_hinted mat _shape = hinted_shapes _mat _idx mat _shape = hinted_shapes _mat _idx m = mat _shape - M second-to-last dimension mat k = mat _shape - K last dimension mat n = mat _shape - N last dimension mat Ensure K dimensions match between operands k_check = mat _shape - K second-to-last dimension mat assert k == k_check f K dimensions don t match k vs k_check m n k