functools os shutil sys io BytesIO torch torch jit mobile _export_operator_list _load_for_lite_interpreter _OPERATORS = set _FILENAMES = _MODELS = save_model cls Save model dump all ops functools wraps cls wrapper_save _MODELS append cls model = cls scripted = torch jit script model buffer = BytesIO scripted _save_to_buffer_for_lite_interpreter buffer seek mobile_module = _load_for_lite_interpreter buffer ops = _export_operator_list mobile_module _OPERATORS update ops path = f cls __name__ ptl _FILENAMES append path scripted _save_for_lite_interpreter path wrapper_save save_model ModelWithDTypeDeviceLayoutPinMemory torch nn Module forward x int = torch ones size= x dtype=torch int layout=torch strided device= cpu pin_memory=False save_model ModelWithTensorOptional torch nn Module forward index = torch zeros = = = index gradient scalarrayint Tensor Scalar spacing int dim=None int edge_order= - Tensor save_model ModelWithScalarList torch nn Module forward int values = torch tensor == torch gradient values spacing=torch scalar_tensor dtype=torch float == torch gradient values spacing= torch tensor item upsample_linear d vec Tensor input int output_size bool align_corners float scale_factors - Tensor save_model ModelWithFloatList torch nn Upsample __init__ - None super __init__ scale_factor= mode= linear align_corners=False recompute_scale_factor=True index Tensor Tensor Tensor indices - Tensor save_model ModelWithListOfOptionalTensors torch nn Module forward index values = torch tensor values torch tensor index conv d Tensor input Tensor weight Tensor bias=None int stride= int padding= int dilation= int groups= - Tensor save_model ModelWithArrayOfInt torch nn Conv d __init__ - None super __init__ stride= padding= add Tensor Tensor Tensor other Scalar alpha= - Tensor ones_like Tensor ScalarType dtype=None Layout layout=None Device device=None bool pin_memory=None MemoryFormat memory_format=None - Tensor save_model ModelWithTensors torch nn Module forward b = torch ones_like + b save_model ModelWithStringOptional torch nn Module forward b = torch tensor dtype=torch int out = torch empty size= dtype=torch float torch div b out=out torch div b rounding_mode= trunc out save_model ModelWithMultipleOps torch nn Module __init__ - None super __init__ ops = torch nn Sequential torch nn ReLU torch nn Flatten forward x x = - ops x __name__ == __main__ command = sys argv ops_yaml = sys argv backup = ops_yaml + bak command == setup tests = ModelWithDTypeDeviceLayoutPinMemory ModelWithTensorOptional ModelWithScalarList ModelWithFloatList ModelWithListOfOptionalTensors ModelWithArrayOfInt ModelWithTensors ModelWithStringOptional ModelWithMultipleOps shutil copyfile ops_yaml backup open ops_yaml f op _OPERATORS f write f - op \n command == shutdown file _MODELS os path isfile file os remove file shutil move backup ops_yaml