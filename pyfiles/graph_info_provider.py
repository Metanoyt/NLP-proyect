typing Any Optional networkx nx torch fx Graph Node GraphInfoProvider This provides information about graph such nodes edges their runtime memory requirements It also provides methods create graphs information provided __RECOMPUTABLE_NODE_ONLY_GRAPH = recomputable_node_only_graph __RECOMPUTABLE_NODE_ONLY_GRAPH_WITH_LARGER_GRAPH_CONTEXT = recomputable_node_only_graph_with_larger_graph_context __FULL_NX_JOINT_GRAPH = full_nx_joint_graph __SIMPLIFIED_FX_JOINT_GRAPH = fx_joint_graph __init__ graph_nodes_in_order list str graph_edges list tuple str str all_recomputable_banned_nodes list str all_node_runtimes Optional dict str float = None all_node_memories Optional dict str float = None recorded_knapsack_input_memories Optional list float = None recorded_knapsack_input_runtimes Optional list float = None joint_graph Optional Graph = None graph_nodes_in_order = graph_nodes_in_order graph_edges = graph_edges all_node_runtimes dict str float = dict all_node_runtimes None recorded_knapsack_input_runtimes None raise ValueError Either all_node_runtimes recorded_knapsack_input_runtimes must provided all_node_runtimes = node recorded_knapsack_input_runtimes i i node enumerate all_recomputable_banned_nodes all_node_runtimes update all_node_runtimes all_node_memories dict str float = dict all_node_memories None recorded_knapsack_input_memories None raise ValueError Either all_node_memories recorded_knapsack_input_memories must provided all_node_memories = node recorded_knapsack_input_memories i i node enumerate all_recomputable_banned_nodes all_node_memories update all_node_memories all_recomputable_banned_nodes = all_recomputable_banned_nodes all_recomputable_banned_nodes_set = set all_recomputable_banned_nodes recorded_knapsack_input_memories = recorded_knapsack_input_memories recorded_knapsack_input_runtimes = recorded_knapsack_input_runtimes _lazily_initialized_graphs dict str Any = __RECOMPUTABLE_NODE_ONLY_GRAPH None __RECOMPUTABLE_NODE_ONLY_GRAPH_WITH_LARGER_GRAPH_CONTEXT None __FULL_NX_JOINT_GRAPH None __SIMPLIFIED_FX_JOINT_GRAPH None classmethod inialize_from_graph cls joint_graph Graph all_recomputable_banned_nodes list Node recorded_knapsack_input_memories list float recorded_knapsack_input_runtimes list float - GraphInfoProvider Enables initialization joint graph graph_nodes_in_order = node name node joint_graph nodes graph_edges = node name user name node joint_graph nodes user node users all_recomputable_banned_node_names = node name node all_recomputable_banned_nodes cls graph_nodes_in_order=graph_nodes_in_order graph_edges=graph_edges all_recomputable_banned_nodes=all_recomputable_banned_node_names recorded_knapsack_input_memories=recorded_knapsack_input_memories recorded_knapsack_input_runtimes=recorded_knapsack_input_runtimes joint_graph=joint_graph property recomputable_node_only_graph - nx DiGraph _lazily_initialized_graphs __RECOMPUTABLE_NODE_ONLY_GRAPH None _lazily_initialized_graphs __RECOMPUTABLE_NODE_ONLY_GRAPH = _create_recomputable_node_only_graph _lazily_initialized_graphs __RECOMPUTABLE_NODE_ONLY_GRAPH property recomputable_node_only_graph_with_larger_graph_context - nx DiGraph _lazily_initialized_graphs __RECOMPUTABLE_NODE_ONLY_GRAPH_WITH_LARGER_GRAPH_CONTEXT None _lazily_initialized_graphs __RECOMPUTABLE_NODE_ONLY_GRAPH_WITH_LARGER_GRAPH_CONTEXT = _create_recomputable_node_only_graph_with_larger_graph_context _lazily_initialized_graphs __RECOMPUTABLE_NODE_ONLY_GRAPH_WITH_LARGER_GRAPH_CONTEXT property full_joint_nx_graph - nx DiGraph _lazily_initialized_graphs __FULL_NX_JOINT_GRAPH None _lazily_initialized_graphs __FULL_NX_JOINT_GRAPH = _create_full_joint_graph _lazily_initialized_graphs __FULL_NX_JOINT_GRAPH property simplified_fx_joint_graph - Graph _lazily_initialized_graphs __SIMPLIFIED_FX_JOINT_GRAPH None _lazily_initialized_graphs __SIMPLIFIED_FX_JOINT_GRAPH = _recreate_psuedo_joint_graph _lazily_initialized_graphs __SIMPLIFIED_FX_JOINT_GRAPH get_non_ac_peak_memory - float sum all_node_memories node_name node_name all_recomputable_banned_nodes_set get_theoretical_max_runtime - float sum all_node_runtimes node_name node_name all_recomputable_banned_nodes_set get_knapsack_memory_input - list float recorded_knapsack_input_memories recorded_knapsack_input_memories all_node_memories node_name node_name all_recomputable_banned_nodes get_knapsack_runtime_input - list float recorded_knapsack_input_runtimes recorded_knapsack_input_runtimes all_node_runtimes node_name node_name all_recomputable_banned_nodes _create_recomputable_node_only_graph - nx DiGraph graph = nx DiGraph recomputable_node all_recomputable_banned_nodes graph add_node recomputable_node b graph_edges all_recomputable_banned_nodes_set b all_recomputable_banned_nodes_set graph add_edge b graph _create_recomputable_node_only_graph_with_larger_graph_context - nx DiGraph Create dictionary store reachable nodes each node all_recomputable_banned_nodes_set = set all_recomputable_banned_nodes reachable_nodes = node all_recomputable_banned_nodes_set Use BFS find all reachable nodes predecessors = dict nx bfs_predecessors full_joint_nx_graph node reachable_recomputable_nodes = set predecessors keys intersection all_recomputable_banned_nodes_set reachable_nodes node = reachable_recomputable_nodes Create candidate graph candidate_graph = nx DiGraph candidate_graph add_nodes_from all_recomputable_banned_nodes_set node all_recomputable_banned_nodes_set node reachable_nodes node Check there overlapping path overlapping_path = False intermediate_node reachable_nodes node intermediate_node = node node reachable_nodes intermediate_node overlapping_path = True break overlapping_path candidate_graph add_edge node node candidate_graph _create_full_joint_graph - nx DiGraph graph = nx DiGraph node graph_nodes_in_order node == output continue graph add_node node b graph_edges == output b == output continue graph add_edge b graph _recreate_psuedo_joint_graph - Graph Create dictionary store dependencies each node node_dependencies dict str list str = node node graph_nodes_in_order b graph_edges node_dependencies b node_dependencies raise ValueError f Edge b references non-existent node node_dependencies b append joint_graph = Graph Create nodes graph nodes dict str Node = node_name graph_nodes_in_order input_nodes = nodes dep dep node_dependencies node_name input_nodes node = joint_graph call_function lambda x x tuple input_nodes node name = node_name node = joint_graph placeholder node_name nodes node_name = node joint_graph _visualize_recomputable_candidate_graph_with_larger_context layout_k float = layout_iterations int = - None Visualize recomputable candidate graph larger context matplotlib cm colors mcolors pyplot plt pos = nx spring_layout recomputable_node_only_graph_with_larger_graph_context k=layout_k iterations=layout_iterations pos = nx spectral_layout graph_with_indirect_edges plt figure figsize= Create dictionary node labels using index labels = node recomputable_node_only_graph_with_larger_graph_context nodes node get index node node recomputable_node_only_graph_with_larger_graph_context nodes Extract memory values normalize them norm = mcolors Normalize vmin=min get_knapsack_memory_input vmax=max get_knapsack_memory_input cmap = cm viridis type ignore attr-defined Assign colors based memory node_colors = cmap norm float recomputable_node_only_graph_with_larger_graph_context nodes node memory node recomputable_node_only_graph_with_larger_graph_context nodes Draw graph parsed nodes only nx draw_networkx_nodes recomputable_node_only_graph_with_larger_graph_context pos node_color=node_colors node_size= label= Parsed Nodes nx draw_networkx_edges recomputable_node_only_graph_with_larger_graph_context pos arrows=True arrowsize= nx draw_networkx_labels recomputable_node_only_graph_with_larger_graph_context pos labels=labels font_size= font_weight= bold plt title Memory Colour Coded Dependency Graph Recomputable Nodes plt colorbar cm ScalarMappable norm=norm cmap=cmap label= Memory plt show