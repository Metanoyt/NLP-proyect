Owner s module distributions pytest torch torch distributions biject_to constraints transform_to torch testing _internal common_cuda TEST_CUDA torch testing _internal common_utils run_tests EXAMPLES = constraints symmetric False constraints positive_semidefinite False constraints positive_definite False constraints symmetric True - - constraints positive_semidefinite False - - constraints positive_definite False - - constraints symmetric True constraints positive_semidefinite True constraints positive_definite False constraints symmetric True - - constraints positive_semidefinite False - - constraints positive_definite False - - constraints symmetric True - - - - constraints positive_semidefinite True - - - - constraints positive_definite False - - - - constraints symmetric True - - constraints positive_semidefinite True - - constraints positive_definite True - - CONSTRAINTS = constraints real constraints real_vector constraints positive constraints greater_than - - constraints greater_than constraints greater_than constraints greater_than - constraints greater_than_eq constraints greater_than_eq constraints greater_than_eq - constraints less_than - - constraints less_than constraints less_than constraints less_than - constraints unit_interval constraints interval - - - constraints interval - - constraints interval constraints half_open_interval - - - constraints half_open_interval - - constraints half_open_interval constraints simplex constraints corr_cholesky constraints lower_cholesky constraints positive_definite build_constraint constraint_fn args is_cuda=False args constraint_fn t = torch cuda DoubleTensor is_cuda torch DoubleTensor constraint_fn t x isinstance x list x x args pytest mark parametrize constraint_fn result value EXAMPLES pytest mark parametrize is_cuda False pytest param True marks=pytest mark skipif TEST_CUDA reason= CUDA found test_constraint constraint_fn result value is_cuda t = torch cuda DoubleTensor is_cuda torch DoubleTensor assert constraint_fn check t value all == result pytest mark parametrize constraint_fn args c c c CONSTRAINTS pytest mark parametrize is_cuda False pytest param True marks=pytest mark skipif TEST_CUDA reason= CUDA found test_biject_to constraint_fn args is_cuda constraint = build_constraint constraint_fn args is_cuda=is_cuda try t = biject_to constraint except NotImplementedError pytest skip ` biject_to ` implemented assert t bijective f biject_to constraint bijective constraint_fn constraints corr_cholesky D D- where D = = size last dim x = torch randn dtype=torch double x = torch randn dtype=torch double is_cuda x = x cuda y = t x assert constraint check y all \n join f Failed biject_to constraint f x = x f biject_to x = y x = t inv y assert torch allclose x x f Error biject_to constraint inverse j = t log_abs_det_jacobian x y assert j shape == x shape x dim - t domain event_dim pytest mark parametrize constraint_fn args c c c CONSTRAINTS pytest mark parametrize is_cuda False pytest param True marks=pytest mark skipif TEST_CUDA reason= CUDA found test_transform_to constraint_fn args is_cuda constraint = build_constraint constraint_fn args is_cuda=is_cuda t = transform_to constraint constraint_fn constraints corr_cholesky D D- where D = = size last dim x = torch randn dtype=torch double x = torch randn dtype=torch double is_cuda x = x cuda y = t x assert constraint check y all f Failed transform_to constraint x = t inv y y = t x assert torch allclose y y f Error transform_to constraint pseudoinverse __name__ == __main__ run_tests