Owner s oncall jit torch torch testing FileCheck torch testing _internal common_utils raise_on_run_directly torch testing _internal jit_utils JitTestCase TestBatchMM JitTestCase staticmethod _get_test_tensors n int torch tensor + x + x + x + x + x + x x == torch tensor + x + x + x + x + x + x x range n test_batch_mm_no_mutation test_batch_mm T torch Tensor T torch Tensor T torch Tensor T torch Tensor T torch Tensor T torch Tensor T torch Tensor T torch Tensor torch mm T T + torch mm T T + torch mm T T + torch mm T T test_batch_mm_scripted = torch jit script test_batch_mm tensors = TestBatchMM _get_test_tensors expected = test_batch_mm tensors FileCheck check_count aten mm exactly=True run test_batch_mm_scripted graph run_pass batch_mm test_batch_mm_scripted graph FileCheck check_count prim MMTreeReduce exactly=True run test_batch_mm_scripted graph actual = test_batch_mm_scripted tensors assertEqual expected actual atol= e- rtol= e- test_batch_mm_permitted_mutation test_batch_mm T torch Tensor T torch Tensor T torch Tensor T torch Tensor T torch Tensor T torch Tensor T torch Tensor T torch Tensor result = result product = torch mm T T + torch mm T T + torch mm T T + torch mm T T result constant = torch tensor result test_batch_mm_scripted = torch jit script test_batch_mm tensors = TestBatchMM _get_test_tensors expected = test_batch_mm tensors FileCheck check_count aten mm exactly=True run test_batch_mm_scripted graph run_pass batch_mm test_batch_mm_scripted graph FileCheck check_count prim MMTreeReduce exactly=True run test_batch_mm_scripted graph actual = test_batch_mm_scripted tensors assertEqual expected actual atol= e- rtol= e- test_batch_mm_prohibited_mutation torch jit script test_batch_mm n int T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n torch relu_ T result = torch mm T T + torch mm T T + torch mm T T + torch mm T T result FileCheck check_count aten mm exactly=True run test_batch_mm graph run_pass batch_mm test_batch_mm graph FileCheck check_count aten mm exactly=True check_not prim MMTreeReduce run test_batch_mm graph test_batch_mm_prohibited_mutation_multiple_adds torch jit script test_batch_mm n int T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n torch relu_ T result = result no_mutated_parameters = torch mm T T + torch mm T T + torch mm T T + torch mm T T result all_parameters = torch mm T T + torch mm T T + torch mm T T + torch mm T T + torch mm T T result run_pass batch_mm test_batch_mm graph FileCheck check_count prim MMTreeReduce exactly=True check_count aten mm exactly=True run test_batch_mm graph test_batch_mm_prohibited_mutation_if_node torch jit script test_batch_mm n int use_t bool T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n use_t torch relu_ T torch mm T T + torch mm T T + torch mm T T + torch mm T T + torch mm T T torch mm T T + torch mm T T + torch mm T T + torch mm T T run_pass batch_mm test_batch_mm graph FileCheck check_count aten mm exactly=True check_count prim MMTreeReduce exactly=True run test_batch_mm graph test_batch_mm_side_permitted_mutation torch jit script test_batch_mm n int result = A = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n result T = torch mm A T result T = torch mm A T result T = torch mm A T result T = torch mm A T result T = torch mm A T result T = torch mm A T result T = torch mm A T result T = torch mm A T result FileCheck check_count aten mm exactly=True run test_batch_mm graph run_pass batch_mm test_batch_mm graph FileCheck check_count prim MMBatchSide exactly=True check_not aten mm run test_batch_mm graph test_batch_mm_side_prohibited_mutation_uncommon_side torch jit script test_batch_mm n int A = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n torch relu_ T result = result T = torch mm A T result T = torch mm A T result T = torch mm A T result T = torch mm A T result T = torch mm A T result T = torch mm A T result T = torch mm A T result T = torch mm A T result T = torch mm A T result T = torch mm A T result FileCheck check_count aten mm exactly=True run test_batch_mm graph run_pass batch_mm test_batch_mm graph FileCheck check_count aten mm exactly=True run test_batch_mm graph FileCheck check_count prim MMBatchSide exactly=True run test_batch_mm graph test_batch_mm_side_prohibited_mutation_common_side torch jit script test_batch_mm n int A = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n T = torch zeros n n torch relu_ A result = result T = torch mm A T result T = torch mm A T result T = torch mm A T result T = torch mm A T result T = torch mm A T result T = torch mm A T result T = torch mm A T result T = torch mm A T result T = torch mm A T result T = torch mm A T result FileCheck check_count aten mm exactly=True run test_batch_mm graph run_pass batch_mm test_batch_mm graph FileCheck check_count aten mm exactly=True check_not prim MMBatchSide run test_batch_mm graph __name__ == __main__ raise_on_run_directly test test_jit py