Python polyfills builtins __future__ annotations builtins functools operator collections abc Callable typing TYPE_CHECKING TypeVar decorators substitute_in_graph TYPE_CHECKING collections abc Iterable __all__ = all any enumerate sum _T = TypeVar _T substitute_in_graph builtins all can_constant_fold_through=True all iterable Iterable object - bool elem iterable elem False True substitute_in_graph builtins any can_constant_fold_through=True any iterable Iterable object - bool elem iterable elem True False substitute_in_graph builtins enumerate is_embedded_type=True type ignore arg-type enumerate iterable Iterable _T start int = - Iterable tuple int _T isinstance start int raise TypeError f type start __name__ r object cannot interpreted integer x iterable yield start x start += substitute_in_graph builtins sum can_constant_fold_through=True type ignore arg-type sum iterable Iterable _T start _T = - _T type ignore assignment functools reduce operator add iterable start _CallableIterator __init__ fn sentinel type ignore no-untyped-def fn = fn sentinel = sentinel __iter__ type ignore no-untyped-def __next__ type ignore no-untyped-def The iterator created case will call object no arguments each call its __next__ method r = fn If value returned equal sentinel StopIteration will raised r == sentinel raise StopIteration otherwise value will returned r _SENTINEL_MISSING pass TODO guilhermeleobas use substitute_in_graph iter iter_ fn_or_iterable sentinel=_SENTINEL_MISSING type ignore no-untyped-def Without second argument object must collection object which supports iterable __iter__ sequence protocol __getitem__ integer starting sentinel _SENTINEL_MISSING iterable = fn_or_iterable hasattr iterable __iter__ iterator = iterable __iter__ hasattr iterator __next__ iterator raise TypeError f type iterator object iterable hasattr iterable __getitem__ Needs new function avoid iter becoming generator sequence_protocol iterable type ignore no-untyped-def i = while True try yield iterable __getitem__ i i += except IndexError break sequence_protocol iterable raise TypeError f type iterable object iterable If second argument sentinel given then object must callable object fn = fn_or_iterable isinstance fn Callable type ignore arg-type raise TypeError iter v w v must callable _CallableIterator fn sentinel