======= BEGIN Dynamo patch ======= Owner s module dynamo ruff noqa flake noqa Test copied https raw githubusercontent com python cpython refs tags v Lib test test_bool py sys torch torch _dynamo test_case unittest torch _dynamo test_case CPythonTestCase torch testing _internal common_utils run_tests __TestCase = CPythonTestCase ======= END DYNAMO PATCH ======= Test properties bool promised PEP unittest test support os_helper os BoolTest __TestCase test_subclass try torch _dynamo error_on_graph_break False C bool pass except TypeError pass fail bool should subclassable assertRaises TypeError int __new__ bool test_repr assertEqual repr False False assertEqual repr True True assertIs eval repr False False assertIs eval repr True True test_str assertEqual str False False assertEqual str True True test_int assertEqual int False assertIsNot int False False assertEqual int True assertIsNot int True True test_float assertEqual float False assertIsNot float False False assertEqual float True assertIsNot float True True test_complex assertEqual complex False j assertEqual complex False False assertEqual complex True + j assertEqual complex True True test_math assertEqual +False assertIsNot +False False assertEqual -False assertIsNot -False False assertEqual abs False assertIsNot abs False False assertEqual +True assertIsNot +True True assertEqual -True - assertEqual abs True assertIsNot abs True True assertWarns DeprecationWarning We need put bool variable because constant ~False evaluated compile time due constant folding consequently DeprecationWarning would issued during module loading during test execution false = False assertEqual ~false - assertWarns DeprecationWarning also check warning issued case constant folding compile time assertEqual eval ~False - assertWarns DeprecationWarning true = True assertEqual ~true - assertWarns DeprecationWarning assertEqual eval ~True - assertEqual False+ assertEqual True+ assertEqual +False assertEqual +True assertEqual False+False assertIsNot False+False False assertEqual False+True assertIsNot False+True True assertEqual True+False assertIsNot True+False True assertEqual True+True assertEqual True-True assertIsNot True-True False assertEqual False-False assertIsNot False-False False assertEqual True-False assertIsNot True-False True assertEqual False-True - assertEqual True assertEqual False assertIsNot False False assertEqual True assertIsNot True True assertEqual False assertIsNot False False assertEqual True assertIsNot True False assertEqual True assertIsNot True True assertEqual False assertIsNot False False b False True i assertEqual b i int b i assertIsNot b i bool int b i False True b False True assertIs b bool int int b assertIs &#124; b bool int &#124; int b assertIs a^b bool int ^int b assertEqual int b int int b assertIsNot int b bool int int b assertEqual &#124; int b int &#124; int b assertIsNot &#124; int b bool int &#124; int b assertEqual a^int b int ^int b assertIsNot a^int b bool int ^int b assertEqual int b int int b assertIsNot int b bool int int b assertEqual int &#124; b int &#124; int b assertIsNot int &#124; b bool int &#124; int b assertEqual int ^b int ^int b assertIsNot int ^b bool int ^int b assertIs == True assertIs == False assertIs True assertIs False assertIs = True assertIs = False assertIs True assertIs False assertIs = True assertIs = False assertIs = True assertIs = False x = assertIs x x True assertIs x x False assertIs x True assertIs x False assertIs x False assertIs x True x = assertIs x x True assertIs x x False assertIs x True assertIs x False assertIs x False assertIs x True assertIs True False assertIs False True test_convert assertRaises TypeError bool assertIs bool True assertIs bool True assertIs bool - True assertIs bool False assertIs bool hello True assertIs bool False assertIs bool False test_keyword_args assertRaisesRegex TypeError keyword argument bool x= test_format assertEqual d False assertEqual d True assertEqual x False assertEqual x True test_hasattr assertIs hasattr append True assertIs hasattr wobble False test_callable assertIs callable len True assertIs callable False test_isinstance assertIs isinstance True bool True assertIs isinstance False bool True assertIs isinstance True int True assertIs isinstance False int True assertIs isinstance bool False assertIs isinstance bool False test_issubclass assertIs issubclass bool int True assertIs issubclass int bool False test_contains assertIs False assertIs True test_string assertIs xyz endswith z True assertIs xyz endswith x False assertIs xyz isalnum True assertIs #$ isalnum False assertIs xyz isalpha True assertIs #$ isalpha False assertIs isdigit True assertIs xyz isdigit False assertIs xyz islower True assertIs XYZ islower False assertIs isdecimal True assertIs xyz isdecimal False assertIs isnumeric True assertIs xyz isnumeric False assertIs isspace True assertIs \xa isspace True assertIs \u isspace True assertIs XYZ isspace False assertIs X istitle True assertIs x istitle False assertIs XYZ isupper True assertIs xyz isupper False assertIs xyz startswith x True assertIs xyz startswith z False test_boolean assertEqual True assertNotIsInstance True bool assertIs True True True assertEqual True &#124; assertNotIsInstance True &#124; bool assertIs True &#124; True True assertEqual True ^ assertNotIsInstance True ^ bool assertIs True ^ True False test_fileclosed try open os_helper TESTFN w encoding= utf- f assertIs f closed False assertIs f closed True finally os remove os_helper TESTFN test_types types always true t bool complex dict float int list object set str tuple type assertIs bool t True test_operator operator assertIs operator truth False assertIs operator truth True assertIs operator not_ False assertIs operator not_ True assertIs operator contains False assertIs operator contains True assertIs operator lt False assertIs operator lt True assertIs operator is_ True True True assertIs operator is_ True False False assertIs operator is_not True True False assertIs operator is_not True False True test_marshal marshal assertIs marshal loads marshal dumps True True assertIs marshal loads marshal dumps False False test_pickle pickle proto range pickle HIGHEST_PROTOCOL + assertIs pickle loads pickle dumps True proto True assertIs pickle loads pickle dumps False proto False test_picklevalues Test specific backwards-compatible pickle values pickle assertEqual pickle dumps True protocol= b I \n assertEqual pickle dumps False protocol= b I \n assertEqual pickle dumps True protocol= b I \n assertEqual pickle dumps False protocol= b I \n assertEqual pickle dumps True protocol= b \x \x \x assertEqual pickle dumps False protocol= b \x \x \x test_convert_to_bool Verify TypeError occurs when bad things returned __bool__ This isn t really bool test s related check = lambda o assertRaises TypeError bool o torch _dynamo error_on_graph_break False Foo object __bool__ check Foo torch _dynamo error_on_graph_break False Bar object __bool__ Yes check Bar torch _dynamo error_on_graph_break False Baz int __bool__ check Baz __bool__ must bool int torch _dynamo error_on_graph_break False Spam int __bool__ check Spam torch _dynamo error_on_graph_break False Eggs __len__ - assertRaises ValueError bool Eggs test_interpreter_convert_to_bool_raises torch _dynamo error_on_graph_break False SymbolicBool __bool__ raise TypeError Symbol __gt__ other SymbolicBool x = Symbol assertRaises TypeError x msg = x true msg = x false This used create negative refcounts see gh- del x test_from_bytes assertIs bool from_bytes b \x big False assertIs bool from_bytes b abcd little True test_sane_len test just tests our assumptions about __len__ will start failing __len__ changes assertions badval illegal - torch _dynamo error_on_graph_break False A __len__ badval try bool A except Exception e_bool try len A except Exception e_len assertEqual str e_bool str e_len test_blocked torch _dynamo error_on_graph_break False A __bool__ = None assertRaises TypeError bool A torch _dynamo error_on_graph_break False B __len__ __bool__ = None assertRaises TypeError bool B test_real_and_imag assertEqual True real assertEqual True imag assertIs type True real int assertIs type True imag int assertEqual False real assertEqual False imag assertIs type False real int assertIs type False imag int test_bool_called_at_least_once torch _dynamo error_on_graph_break False X __init__ count = __bool__ count += True f x x True pass x = X f x assertGreaterEqual x count test_bool_new assertIs bool __new__ bool False assertIs bool __new__ bool True assertIs bool __new__ bool False assertIs bool __new__ bool False False assertIs bool __new__ bool True True __name__ == __main__ run_tests