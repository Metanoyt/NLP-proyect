Owner s module inductor unittest torch torch _dynamo utils counters torch _inductor runtime benchmarking Benchmarker TritonBenchmarker torch _inductor test_case run_tests TestCase torch testing _internal common_utils decorateIf instantiate_parametrized_tests parametrize torch testing _internal inductor_utils GPU_TYPE HAS_CPU HAS_GPU ALL_BENCHMARKER_CLASSES = Benchmarker TritonBenchmarker instantiate_parametrized_tests TestBenchmarker TestCase setUp super setUp torch manual_seed counters clear staticmethod get_counter_value benchmarker_cls fn_name counters inductor f benchmarking benchmarker_cls __name__ fn_name staticmethod make_params device size= fn fn_args fn_kwargs = torch sum torch randn size device=device _callable = lambda fn fn_args fn_kwargs noqa E fn fn_args fn_kwargs _callable unittest skipIf HAS_CPU HAS_GPU requires CPU GPU decorateIf unittest expectedFailure lambda params params benchmarker_cls Benchmarker params device == GPU_TYPE parametrize benchmarker_cls ALL_BENCHMARKER_CLASSES parametrize device GPU_TYPE cpu test_benchmark_smoke benchmarker_cls device benchmarker = benchmarker_cls fn fn_args fn_kwargs _ = make_params device timing = benchmarker benchmark fn fn_args fn_kwargs assertGreater timing assertEqual get_counter_value benchmarker_cls benchmark assertEqual get_counter_value benchmarker_cls benchmark_cpu device == cpu benchmark_gpu unittest skipIf HAS_CPU requires CPU parametrize benchmarker_cls ALL_BENCHMARKER_CLASSES test_benchmark_cpu_smoke benchmarker_cls device= cpu benchmarker = benchmarker_cls _ _callable = make_params device timing = benchmarker benchmark_cpu _callable assertGreater timing assertEqual get_counter_value benchmarker_cls benchmark_cpu unittest skipIf HAS_GPU requires GPU decorateIf unittest expectedFailure lambda params params benchmarker_cls Benchmarker parametrize benchmarker_cls ALL_BENCHMARKER_CLASSES test_benchmark_gpu_smoke benchmarker_cls device=GPU_TYPE benchmarker = benchmarker_cls _ _callable = make_params device timing = benchmarker benchmark_gpu _callable assertGreater timing assertEqual get_counter_value benchmarker_cls benchmark_gpu unittest skipIf HAS_CPU HAS_GPU requires CPU GPU unittest expectedFailure parametrize benchmarker_cls ALL_BENCHMARKER_CLASSES test_benchmark_safely_infers_device_no_devices benchmarker_cls device= cpu HAS_CPU GPU_TYPE benchmarker = benchmarker_cls fn _ _ _ = make_params device benchmarker benchmark fn unittest skipIf HAS_CPU HAS_GPU requires CPU GPU unittest expectedFailure parametrize benchmarker_cls ALL_BENCHMARKER_CLASSES test_benchmark_safely_infers_device_many_devices benchmarker_cls benchmarker = benchmarker_cls fn cpu_args cpu_kwargs _ = make_sum cpu _ gpu_args gpu_kwargs _ = make_sum GPU_TYPE many_devices_args = cpu_args + gpu_args many_devices_kwargs = cpu_kwargs many_devices_kwargs update gpu_kwargs benchmarker benchmark fn many_devices_args many_devices_kwargs __name__ == __main__ run_tests