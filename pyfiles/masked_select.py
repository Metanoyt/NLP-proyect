Masked select operator implementation typing Optional torch torchfuzz operators base Operator torchfuzz tensor_fuzzer Spec TensorSpec MaskedSelectOperator Operator Operator selecting elements tensor based mask __init__ super __init__ masked_select property torch_op_name - Optional str Return torch operation name torch masked_select can_produce output_spec Spec - bool Masked select produces D tensor we ll synthesize inputs match size isinstance output_spec TensorSpec len output_spec size == fuzz_inputs_specs output_spec Spec num_inputs int = - list Spec Generate input specs masked_select operation isinstance output_spec TensorSpec raise ValueError MaskedSelectOperator can only produce TensorSpec outputs Input tensor - can any shape type input_tensor_spec = TensorSpec size= Fixed size consistency stride= Contiguous dtype=output_spec dtype Match output dtype Mask tensor - must boolean broadcastable input mask_spec = TensorSpec size= Same size input simplicity stride= Contiguous dtype=torch bool input_tensor_spec mask_spec codegen output_name str input_names list str output_spec Spec - str Generate code masked_select synthesized inputs match size Constructs input tensor mask so exactly k elements selected where k = output_spec size No data-dependent guards len input_names = raise ValueError MaskedSelectOperator requires exactly two inputs isinstance output_spec TensorSpec len output_spec size = raise ValueError MaskedSelectOperator requires D TensorSpec output k = output_spec size Build D input length = k mask first k positions True Use input s device output dtype avoid mismatches f _x_ms = torch arange max k device= input_names device input_names dtype \n f _mask_ms = torch zeros_like _x_ms dtype=torch bool \n f _mask_ms k = True\n f output_name = torch masked_select _x_ms _mask_ms