mypy ignore-errors io itertools json sys tempfile pathlib Path unittest mock tools linter adapters _linter block _get_decorators tools linter adapters docstring_linter DocstringLinter file_summary make_recursive make_terse _PARENT = Path __file__ parent absolute _PATH = Path p absolute p sys path _PARENT _PATH linter_test_case LinterTestCase linter_test_case LinterTestCase TEST_FILE = Path tools test docstring_linter_testdata python_code py txt TEST_FILE = Path tools test docstring_linter_testdata more_python_code py txt TEST_BLOCK_NAMES = Path tools test docstring_linter_testdata block_names py txt ARGS = -- max-class= -- max-def= -- min-docstring= TestDocstringLinter LinterTestCase LinterClass = DocstringLinter maxDiff = _ test_python_code lint_test TEST_FILE ARGS mock patch sys stdout new_callable=io StringIO test_end_to_end mock_stdout argv_base = ARGS str TEST_FILE str TEST_FILE report = -- report write = -- write-grandfather out = _next_stdout mock_stdout run name argv DocstringLinter argv_base + argv lint_all assertExpected TEST_FILE next out name tempfile TemporaryDirectory td grandfather_file = f td grandfather json grandfather = f -- grandfather= grandfather_file Find some failures run before txt grandfather Rewrite grandfather file run before json grandfather report write actual = Path grandfather_file read_text assertExpected TEST_FILE actual grandfather json Now there no failures run after txt grandfather run after json grandfather report test_report actual = _dumps _data assertExpected TEST_FILE actual report json test_terse terse = make_terse _data index_by_line=False actual = _dumps terse assertExpected TEST_FILE actual terse json test_terse_line terse = make_terse _data index_by_line=True actual = _dumps terse assertExpected TEST_FILE actual terse line json test_recursive recursive = make_recursive _data actual = _dumps recursive assertExpected TEST_FILE actual recursive json test_terse_recursive recursive = make_recursive _data terse = make_terse recursive index_by_line=False actual = _dumps terse assertExpected TEST_FILE actual recursive terse json test_terse_line_recursive recursive = make_recursive _data terse = make_terse recursive index_by_line=True actual = _dumps terse assertExpected TEST_FILE actual recursive terse line json test_file_summary actual = _dumps file_summary _data report_all=True assertExpected TEST_FILE actual single line json test_file_names f = DocstringLinter make_file TEST_BLOCK_NAMES actual = b full_name b f blocks expected = top top fun top fun sab top fun sub top fun top fun sub top fun sub top fun top fun sub top fun sab top run top run sub top run sub assertEqual actual expected test_decorators tests = itertools product INDENTS DECORATORS items indent name expected test_inputs tests ind = indent data test_inputs prog = join ind + d + \n d data pf = DocstringLinter make_file prog = i i t enumerate pf tokens t string == def_t = next subTest Decorator indent=indent name=name data=data actual = list _get_decorators pf tokens def_t assertEqual actual expected _dumps d dict - str json dumps d sort_keys=True indent= + \n _data file=TEST_FILE docstring_file = DocstringLinter make_file file b as_data b docstring_file blocks _next_stdout mock_stdout length = while True s = mock_stdout getvalue yield s length length = len s CONSTANT = A = COMMENT = simple function OVER = override WRAPS = functools wraps fn MASSIVE = some long path very_long_function_name adjust_something_fiddly= disable_something_critical=True MASSIVE_FLAT = some long path very_long_function_name adjust_something_fiddly= disable_something_critical=True DEF = function pass INDENTS = DECORATORS = none DEF COMMENT DEF CONSTANT COMMENT DEF OVER CONSTANT DEF Probably even Python - one OVER OVER DEF OVER COMMENT DEF OVER COMMENT DEF COMMENT OVER COMMENT DEF two OVER WRAPS OVER WRAPS DEF COMMENT OVER COMMENT WRAPS COMMENT DEF massive MASSIVE_FLAT OVER MASSIVE OVER DEF