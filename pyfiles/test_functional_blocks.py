Owner s oncall jit os sys torch torch testing FileCheck Make helper files test importable pytorch_test_dir = os path dirname os path dirname os path realpath __file__ sys path append pytorch_test_dir torch testing _internal common_utils raise_on_run_directly torch testing _internal jit_utils JitTestCase TestFunctionalBlocks JitTestCase test_subgraph_creation fn x y z x = x + y = y + z = z + z add_ z = z z y = y z y y = y + x + y + z graph = torch jit script fn graph run_pass create_functional_graphs graph all uses x y should sunk FileCheck check r x check_not r x check FunctionalGraph check r x run graph FileCheck check r y check_not r y check FunctionalGraph check r y run graph Don t allow any outputs which escape scope so there one final addition graph FileCheck check Tensor = prim Functional check_next aten add run graph z + z add_ considered non functional z = z z should considered functional FileCheck check add check add_ check_not mul check FunctionalGraph run graph __name__ == __main__ raise_on_run_directly test test_jit py