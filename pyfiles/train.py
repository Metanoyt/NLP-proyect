mypy ignore-errors argparse json warnings pandas pd type ignore import-untyped torch _inductor autoheuristic autoheuristic_utils CHOICE_COL get_metadata_str_from_log TODO AlnisM Fix these warnings warnings filterwarnings ignore message= The behavior DataFrame concatenation empty all-NA entries deprecated warnings filterwarnings ignore message= DataFrameGroupBy apply operated grouping columns AHTrain Base AutoHeuristic training __init__ - None parser = argparse ArgumentParser add_base_arguments args = None add_base_arguments parser add_argument dataset type=str help= Path text file containing data collected AutoHeuristic parser add_argument -- nrows type=int default=None help= Only read first n rows dataset parser add_argument -- heuristic-name type=str default= learned_heuristic help= Name heuristic generated parser add_argument -- data nargs= action= append metavar= TYPE PATH help= Specify name datasets file paths evaluated parser add_argument -- save-dot action= store_true help= Export heuristic graphviz dot parser add_argument -- ranking type=int default=None help= Makes AutoHeuristic learn heuristic ranks choices instead predicting single choice The argument number choices heuristic will provide parse_args parser parse_args parse_log log_path nrows=None df metadata = deserialize_data log_path numerical_features = metadata numerical_features categorical_features = metadata categorical_features choices = df CHOICE_COL unique tolist features = numerical_features + categorical_features nrows None df = df head nrows df = filter_df df df metadata features categorical_features choices generate_heuristic args = parse_args main args dataset args data args nrows args heuristic_name args save_dot args ranking None filter_df df df add_new_features results results add_real_datasets datasets other_datasets cat_feature cats other_datasets name path other_datasets df_other choices _ _ _ = get_df path cat_feature cats=cat_feature cats apply_filters=False datasets name = df_other handle_categorical_features cat_feature cats categorical_features results Doing here because we create another df testing purposes other df does contain all categories categorical feature pd dummies will create columns missing categories cat_feature cats cat_feature cats = cat_feature categorical_features cat_feature cat_feature cats categories = cat_feature cats cat_feature categories = results cat_feature unique cat_feature cats cat_feature = categories results cat_feature = pd Categorical results cat_feature categories=categories dummy_col_ _col_val = col categorical_features unique_vals = results col unique val unique_vals dummy_col_ _col_val f col _ val = col val one-hot encode categorical features results = pd get_dummies results columns=categorical_features results cat_feature cats dummy_col_ _col_val gen_precondition opt_name shared_memory device_capa f check_precondition metadata AHMetadata context AHContext - bool metadata name == get_name metadata shared_memory == shared_memory str metadata device_capa == device_capa codegen_boilerplate heuristic_name opt_name threshold shared_memory device_capa dt pass gen_predict_fn_def pass write_heuristic_to_file lines heuristic_name output_file = f torch _inductor autoheuristic artifacts _ heuristic_name py path = f output_file open path w f f write \n join lines + \n deserialize_data log_path json_string = get_metadata_str_from_log log_path metadata = deserialize_metadata json_string df = pd read_csv log_path skiprows= on_bad_lines= skip df metadata deserialize_metadata json_string json loads json_string __name__ == __main__ train = AHTrain train generate_heuristic