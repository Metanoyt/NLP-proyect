Implementation higher-order operators __future__ annotations typing TYPE_CHECKING onnxscript ir convenience ir_convenience torch torch onnx _internal _lazy_import onnxscript_ir ir torch onnx _internal exporter _core torch onnx _internal exporter _torchlib _torchlib_registry onnx_impl torch onnx ops _symbolic_impl TYPE_CHECKING collections abc Sequence _call_symbolic_op op_type str domain str args Sequence ir Value &#124; None kwargs dict str int &#124; float &#124; str &#124; bool &#124; list int &#124; list float &#124; list str dtypes Sequence int version int &#124; None metadata_props dict str str &#124; None - Sequence ir Value Call operator given arguments keyword arguments Arguments always inputs while keyword arguments attributes This wrapper around IR node creation hooks into _builder OpRecorder tracer so all nodes created recorded same way we use onnxscript ops directly assert _core current_tracer None tracer = _core current_tracer inputs = list args If final inputs None strip them node inputs input reversed inputs input None break inputs pop Construct filter out None attributes attributes = attr attr ir_convenience convert_attributes kwargs type ignore arg-type attr value None type ignore union-attr tracer nodes append node = ir Node domain op_type inputs=inputs attributes=attributes num_outputs=len dtypes version=version metadata_props=metadata_props Set dtypes outputs We set them here because graph builder Uses PyTorch types which sometimes inaccurate when they ONNX only types like float e m value dtype zip node outputs dtypes value dtype = ir DataType dtype The shape set graph builder We don t need set here node outputs onnx_impl torch ops onnx_symbolic _symbolic default no_compile=True onnx_symbolic_symbolic inputs Sequence ir Value &#124; None op_type str onnx_dtype int shape Sequence int &#124; ir Value attr_keys Sequence str attr_types Sequence str attr_pos Sequence tuple int int attr_ints Sequence int attr_floats Sequence float attr_strs Sequence str metadata_props_keys Sequence str = metadata_props_values Sequence str = domain str = version int &#124; None = None - ir Value del shape Unused The shapes set graph builder encoded = _symbolic_impl EncodedAttrs attr_keys=list attr_keys attr_types=list attr_types attr_pos=list attr_pos attr_ints=list attr_ints attr_floats=list attr_floats attr_strs=list attr_strs attrs = encoded to_dict _call_symbolic_op op_type domain inputs attrs dtypes= onnx_dtype version=version metadata_props=dict zip metadata_props_keys metadata_props_values onnx_impl torch ops onnx_symbolic _symbolic_multi_out default no_compile=True onnx_symbolic_symbolic_multi_out inputs Sequence ir Value &#124; None op_type str onnx_dtypes Sequence int shapes Sequence Sequence int &#124; ir Value attr_keys Sequence str attr_types Sequence str attr_pos Sequence tuple int int attr_ints Sequence int attr_floats Sequence float attr_strs Sequence str metadata_props_keys Sequence str = metadata_props_values Sequence str = domain str = version int &#124; None = None - Sequence ir Value del shapes Unused The shapes set graph builder encoded = _symbolic_impl EncodedAttrs attr_keys=list attr_keys attr_types=list attr_types attr_pos=list attr_pos attr_ints=list attr_ints attr_floats=list attr_floats attr_strs=list attr_strs attrs = encoded to_dict _call_symbolic_op op_type domain inputs attrs dtypes=onnx_dtypes version=version metadata_props=dict zip metadata_props_keys metadata_props_values