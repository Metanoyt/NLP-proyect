======= BEGIN Dynamo patch ======= Owner s module dynamo ruff noqa flake noqa Test copied https raw githubusercontent com python cpython refs tags v Lib test test_exception_variations py sys torch torch _dynamo test_case unittest torch _dynamo test_case CPythonTestCase torch testing _internal common_utils run_tests xfailIfTorchDynamo __TestCase = CPythonTestCase redirect statements sys importlib abc redirect_imports = test mapping_tests test typinganndata test test_grammar test test_math test test_iter test typinganndata ann_module RedirectImportFinder importlib abc MetaPathFinder find_spec fullname path target=None Check problematic one fullname redirect_imports try Attempt standalone module name = fullname removeprefix test r = importlib import_module name Redirect module sys modules sys modules fullname = r Return module spec found module importlib util find_spec name except ImportError None None Add custom finder sys meta_path sys meta_path insert RedirectImportFinder ======= END DYNAMO PATCH ======= unittest ExceptTestCases __TestCase test_try_except_else_finally hit_except = False hit_else = False hit_finally = False try raise Exception nyaa except hit_except = True hit_else = True finally hit_finally = True assertTrue hit_except assertTrue hit_finally assertFalse hit_else test_try_except_else_finally_no_exception hit_except = False hit_else = False hit_finally = False try pass except hit_except = True hit_else = True finally hit_finally = True assertFalse hit_except assertTrue hit_finally assertTrue hit_else test_try_except_finally hit_except = False hit_finally = False try raise Exception yarr except hit_except = True finally hit_finally = True assertTrue hit_except assertTrue hit_finally test_try_except_finally_no_exception hit_except = False hit_finally = False try pass except hit_except = True finally hit_finally = True assertFalse hit_except assertTrue hit_finally test_try_except hit_except = False try raise Exception ahoy except hit_except = True assertTrue hit_except test_try_except_no_exception hit_except = False try pass except hit_except = True assertFalse hit_except test_try_except_else hit_except = False hit_else = False try raise Exception foo except hit_except = True hit_else = True assertFalse hit_else assertTrue hit_except test_try_except_else_no_exception hit_except = False hit_else = False try pass except hit_except = True hit_else = True assertFalse hit_except assertTrue hit_else test_try_finally_no_exception hit_finally = False try pass finally hit_finally = True assertTrue hit_finally test_nested hit_finally = False hit_inner_except = False hit_inner_finally = False try try raise Exception inner exception except hit_inner_except = True finally hit_inner_finally = True finally hit_finally = True assertTrue hit_inner_except assertTrue hit_inner_finally assertTrue hit_finally test_nested_else hit_else = False hit_finally = False hit_except = False hit_inner_except = False hit_inner_else = False try try pass except hit_inner_except = True hit_inner_else = True raise Exception outer exception except hit_except = True hit_else = True finally hit_finally = True assertFalse hit_inner_except assertTrue hit_inner_else assertFalse hit_else assertTrue hit_finally assertTrue hit_except test_nested_exception_in_except hit_else = False hit_finally = False hit_except = False hit_inner_except = False hit_inner_else = False try try raise Exception inner exception except hit_inner_except = True raise Exception outer exception hit_inner_else = True except hit_except = True hit_else = True finally hit_finally = True assertTrue hit_inner_except assertFalse hit_inner_else assertFalse hit_else assertTrue hit_finally assertTrue hit_except test_nested_exception_in_else hit_else = False hit_finally = False hit_except = False hit_inner_except = False hit_inner_else = False try try pass except hit_inner_except = True hit_inner_else = True raise Exception outer exception except hit_except = True hit_else = True finally hit_finally = True assertFalse hit_inner_except assertTrue hit_inner_else assertFalse hit_else assertTrue hit_finally assertTrue hit_except test_nested_exception_in_finally_no_exception hit_else = False hit_finally = False hit_except = False hit_inner_except = False hit_inner_else = False hit_inner_finally = False try try pass except hit_inner_except = True hit_inner_else = True finally hit_inner_finally = True raise Exception outer exception except hit_except = True hit_else = True finally hit_finally = True assertFalse hit_inner_except assertTrue hit_inner_else assertTrue hit_inner_finally assertFalse hit_else assertTrue hit_finally assertTrue hit_except test_nested_exception_in_finally_with_exception hit_else = False hit_finally = False hit_except = False hit_inner_except = False hit_inner_else = False hit_inner_finally = False try try raise Exception inner exception except hit_inner_except = True hit_inner_else = True finally hit_inner_finally = True raise Exception outer exception except hit_except = True hit_else = True finally hit_finally = True assertTrue hit_inner_except assertFalse hit_inner_else assertTrue hit_inner_finally assertFalse hit_else assertTrue hit_finally assertTrue hit_except __name__ == __main__ run_tests