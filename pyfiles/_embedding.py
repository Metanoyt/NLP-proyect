mypy allow-untyped-defs math numpy np _convert_np make_np _utils make_grid tensorboard compat tf tensorboard plugins projector projector_config_pb EmbeddingInfo _HAS_GFILE_JOIN = hasattr tf io gfile join _gfile_join b The join API different between tensorboard s TF stub TF https github com tensorflow tensorboard issues We need try both because ` tf ` may point either stub real TF _HAS_GFILE_JOIN tf io gfile join b fs = tf io gfile get_filesystem fs join b make_tsv metadata save_path metadata_header=None metadata_header metadata = str x x metadata len metadata_header = len metadata raise AssertionError len header must equal number columns metadata metadata = \t join str e e l l metadata_header + metadata metadata_bytes = tf compat as_bytes \n join metadata + \n tf io gfile GFile _gfile_join save_path metadata tsv wb f f write metadata_bytes https github com tensorflow tensorboard issues image label will squared make_sprite label_img save_path PIL Image io BytesIO ensures sprite image has correct dimension described https www tensorflow org get_started embedding_viz nrow = math ceil label_img size arranged_img_CHW = make_grid make_np label_img ncols=nrow augment images so #images equals nrow nrow arranged_augment_square_HWC = np zeros arranged_img_CHW shape arranged_img_CHW shape arranged_img_HWC = arranged_img_CHW transpose chw - hwc arranged_augment_square_HWC arranged_img_HWC shape = arranged_img_HWC im = Image fromarray np uint arranged_augment_square_HWC clip BytesIO buf im save buf format= PNG im_bytes = buf getvalue tf io gfile GFile _gfile_join save_path sprite png wb f f write im_bytes get_embedding_info metadata label_img subdir global_step tag info = EmbeddingInfo info tensor_name = f tag str global_step zfill info tensor_path = _gfile_join subdir tensors tsv metadata None info metadata_path = _gfile_join subdir metadata tsv label_img None info sprite image_path = _gfile_join subdir sprite png info sprite single_image_dim extend label_img size label_img size info write_pbtxt save_path contents config_path = _gfile_join save_path projector_config pbtxt tf io gfile GFile config_path wb f f write tf compat as_bytes contents make_mat matlist save_path tf io gfile GFile _gfile_join save_path tensors tsv wb f x matlist x = str i item i x f write tf compat as_bytes \t join x + \n