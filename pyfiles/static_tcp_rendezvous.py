usr bin env python mypy allow-untyped-defs Copyright c Facebook Inc its affiliates All rights reserved This source code licensed under BSD-style license found LICENSE file root directory source tree datetime logging typing cast Optional torch distributed PrefixStore Store TCPStore torch distributed elastic rendezvous RendezvousHandler RendezvousInfo RendezvousParameters RendezvousStoreInfo torch distributed elastic rendezvous utils parse_rendezvous_endpoint __all__ = StaticTCPRendezvous create_rdzv_handler logger = logging getLogger __name__ _default_timeout_seconds = StaticTCPRendezvous RendezvousHandler Static rendezvous wrapper around TCPStore Creates TCPStore based input parameters listener agent group_rank= __init__ master_addr str master_port int rank int world_size int run_id str timeout int master_addr = master_addr master_port = master_port rank = rank world_size = world_size run_id = run_id timeout = datetime timedelta seconds=timeout _store Optional Store = None get_backend - str static property use_agent_store - bool True next_rendezvous - RendezvousInfo logger info Creating TCPStore c d Store implementation is_master = rank == _store _store = TCPStore type ignore call-arg master_addr master_port world_size is_master timeout multi_tenant=True store = PrefixStore run_id _store TCPStore server instance used trainer code bootstrap_store_info = RendezvousStoreInfo master_addr master_port RendezvousInfo store rank world_size bootstrap_store_info is_closed False set_closed pass num_nodes_waiting get_run_id - str run_id shutdown - bool True create_rdzv_handler params RendezvousParameters - RendezvousHandler rank params config raise ValueError rank absent RendezvousParameters Try add -- node-rank cmd request endpoint = params endpoint strip endpoint raise ValueError endpoint absent RendezvousParameters Try add -- master-port -- master-addr cmd request master_addr master_port = parse_rendezvous_endpoint endpoint - master_port == - raise ValueError f Port absent endpoint endpoint Try launching -- master-port world_size = params max_nodes rank = cast int params config get rank run_id = params run_id timeout params config timeout = int params config timeout timeout = _default_timeout_seconds StaticTCPRendezvous master_addr master_port rank world_size run_id timeout