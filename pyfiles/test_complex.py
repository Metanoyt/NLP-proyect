Owner s oncall jit cmath os sys itertools product textwrap dedent typing Dict List torch torch testing _internal common_utils IS_MACOS raise_on_run_directly torch testing _internal jit_utils execWrapper JitTestCase Make helper files test importable pytorch_test_dir = os path dirname os path dirname os path realpath __file__ sys path append pytorch_test_dir TestComplex JitTestCase test_script fn complex checkScript fn + j test_complexlist fn List complex idx int idx input = j + j - - j checkScript fn input test_complexdict fn Dict complex complex key complex - complex key input = + j - j - - j j checkScript fn input - - j test_pickle ComplexModule torch jit ScriptModule __init__ - None super __init__ = + j b = + j + j - j - + j c = + j - j - - j j torch jit script_method forward b int b + j loaded = getExportImportCopy ComplexModule assertEqual loaded + j assertEqual loaded b + j + j - j - assertEqual loaded c + j - j - - j j assertEqual loaded + j test_complex_parse fn int b torch Tensor dim int verifies ` emitValueToTensor ` s behavior b dim = + j j + + j - j - t = torch tensor t = torch tensor j checkScript fn t t test_complex_constants_and_ops vals = - - - + i i range + - i i range complex_vals = tuple complex x y x y product vals vals funcs_template = dedent func complex cmath func_or_const checkCmath func_name funcs_template=funcs_template funcs_str = funcs_template format func_or_const=func_name scope = execWrapper funcs_str globals scope cu = torch jit CompilationUnit funcs_str f_script = cu func f = scope func func_name isinf isnan isfinite new_vals = vals + float inf float nan - float inf final_vals = tuple complex x y x y product new_vals new_vals final_vals = complex_vals final_vals res_python = None res_script = None try res_python = f except Exception e res_python = e try res_script = f_script except Exception e res_script = e res_python = res_script isinstance res_python Exception continue msg = f Failed func_name input Python res_python Script res_script assertEqual res_python res_script msg=msg unary_ops = log log sqrt exp sin cos asin acos atan sinh cosh tanh asinh acosh atanh phase isinf isnan isfinite --- Unary ops --- op unary_ops checkCmath op fn x complex abs x val complex_vals checkScript fn val pow_complex_float x complex y float pow x y pow_float_complex x float y complex pow x y checkScript pow_float_complex j checkScript pow_complex_float j pow_complex_complex x complex y complex pow x y x y zip complex_vals complex_vals Reference https github com pytorch pytorch issues x == continue checkScript pow_complex_complex x y IS_MACOS --- Binary op --- rect_fn x float y float cmath rect x y x y product vals vals checkScript rect_fn x y func_constants_template = dedent func cmath func_or_const float_consts = pi e tau inf nan complex_consts = infj nanj x float_consts + complex_consts checkCmath x funcs_template=func_constants_template test_infj_nanj_pickle ComplexModule torch jit ScriptModule __init__ - None super __init__ = + j torch jit script_method forward infj int nanj int infj == infj + cmath infj nanj + cmath nanj loaded = getExportImportCopy ComplexModule assertEqual loaded + cmath infj assertEqual loaded + cmath nanj test_complex_constructor Test all scalar types fn_int real int img int complex real img checkScript fn_int checkScript fn_int - checkScript fn_int - checkScript fn_int - - fn_float real float img float complex real img checkScript fn_float checkScript fn_float - checkScript fn_float checkScript fn_float - - fn_bool real bool img bool complex real img checkScript fn_bool True True checkScript fn_bool False False checkScript fn_bool False True checkScript fn_bool True False fn_bool_int real bool img int complex real img checkScript fn_bool_int True checkScript fn_bool_int False checkScript fn_bool_int False - checkScript fn_bool_int True fn_int_bool real int img bool complex real img checkScript fn_int_bool True checkScript fn_int_bool False checkScript fn_int_bool - True checkScript fn_int_bool False fn_bool_float real bool img float complex real img checkScript fn_bool_float True checkScript fn_bool_float False checkScript fn_bool_float False - checkScript fn_bool_float True fn_float_bool real float img bool complex real img checkScript fn_float_bool True checkScript fn_float_bool False checkScript fn_float_bool - True checkScript fn_float_bool False fn_float_int real float img int complex real img checkScript fn_float_int checkScript fn_float_int - checkScript fn_float_int - checkScript fn_float_int fn_int_float real int img float complex real img checkScript fn_int_float checkScript fn_int_float - checkScript fn_int_float - checkScript fn_int_float - test_torch_complex_constructor_with_tensor tensors = torch rand torch randint - torch tensor False fn_tensor_float real img float complex real img fn_tensor_int real img int complex real img fn_tensor_bool real img bool complex real img fn_float_tensor real float img complex real img fn_int_tensor real int img complex real img fn_bool_tensor real bool img complex real img tensor tensors checkScript fn_tensor_float tensor checkScript fn_tensor_int tensor checkScript fn_tensor_bool tensor True checkScript fn_float_tensor tensor checkScript fn_int_tensor tensor checkScript fn_bool_tensor True tensor fn_tensor_tensor real img complex real img + complex x y product tensors tensors checkScript fn_tensor_tensor x y test_comparison_ops fn complex b complex == b fn complex b complex = b fn complex b float == b fn complex b float = b x y = - j j checkScript fn x x checkScript fn x y checkScript fn x x checkScript fn x y x y = + j checkScript fn x y checkScript fn x y test_div fn complex b complex b x y = - j j checkScript fn x y test_complex_list_sum fn x List complex sum x checkScript fn torch randn dtype=torch cdouble tolist test_tensor_attributes tensor_real x x real tensor_imag x x imag t = torch randn dtype=torch cdouble checkScript tensor_real t checkScript tensor_imag t test_binary_op_complex_tensor mul x complex y torch Tensor x y add x complex y torch Tensor x + y eq x complex y torch Tensor x == y ne x complex y torch Tensor x = y sub x complex y torch Tensor x - y div x complex y torch Tensor x - y ops = mul add eq ne sub div shape x = + j y = torch randn shape dtype=torch cfloat op ops eager_result = op x y scripted = torch jit script op jit_result = scripted x y assertEqual eager_result jit_result __name__ == __main__ raise_on_run_directly test test_jit py