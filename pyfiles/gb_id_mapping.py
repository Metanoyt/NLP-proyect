argparse ast json re pathlib Path typing Any Optional get_source_segment source str node ast AST - Optional str ast get_source_segment source node load_registry path Path - dict str Any path exists path open f json load f type ignore no-any-return save_registry reg dict str Any path Path - None path open w f json dump reg f indent= next_gb_id reg dict str Any - str ids = int x x reg x startswith GB x isdigit f GB max ids default=- + d clean_string s Any - Any Normalizes string literals removing formatting artifacts escape sequences Handles f-strings quotes newlines other syntax elements cleaner output isinstance s str Convert f-string prefix regular string prefix e g f hello - hello s = re sub r ^f \ r s Replace quoted strings f-prefix middle space e g f - s = re sub r \ f \ s Remove surrounding quotes keeping only content e g hello - hello s = re sub r ^ \ \ $ r \ s Replace any whitespace s = join s splitlines Replace escaped quotes their unescaped versions s = s encode decode unicode_escape Replace adjacent quoted strings space e g - s = re sub r s s expand_hints hints list str dynamo_dir Optional str = None - list str Expands hint references their actual values graph_break_hints Uses exec avoid dependencies dynamo_dir None script_dir = Path __file__ resolve parent dynamo_dir_path = script_dir parent parent torch _dynamo dynamo_dir_path = Path dynamo_dir graph_break_hints_path = dynamo_dir_path graph_break_hints py open graph_break_hints_path f hints_source = f read hints_namespace dict str Any = exec hints_source hints_namespace hint_constants = name value name value hints_namespace items isinstance value list name isupper name startswith _ expanded_hints = hint hints expanded = False name value hint_constants items f graph_break_hints name hint expanded_hints extend value expanded = True break expanded expanded_hints append hint expanded_hints extract_info_from_keyword source str kw ast keyword - Any Extracts returns value keyword argument AST node This function handles different types AST nodes - If node constant returns constant value - If node f-string reconstructs string evaluating formatted values concatenating them string literals - For other types cleans source segment remove formatting artifacts param_source = get_source_segment source kw value isinstance kw value ast Constant kw value value isinstance kw value ast JoinedStr evaluated_context = value kw value values isinstance value ast FormattedValue pyrefly ignore bad-argument-type evaluated_context append f ast unparse value value isinstance value ast Constant pyrefly ignore bad-argument-type evaluated_context append value value join evaluated_context clean_string param_source find_unimplemented_v _calls path str dynamo_dir Optional str = None - list dict str Any results = path_obj = Path path path_obj is_dir file_paths = path_obj glob py file_paths = path_obj type ignore assignment file_path file_paths open file_path f source = f read try tree = ast parse source node ast walk tree isinstance node ast FunctionDef node name unimplemented_v unimplemented_v _with_warning continue isinstance node ast Call isinstance node func ast Name node func id unimplemented_v unimplemented_v _with_warning info dict str Any = gb_type None context None explanation None hints kw node keywords kw arg info pyrefly ignore unsupported-operation info kw arg = extract_info_from_keyword source kw info gb_type None continue info hints hints = info hints expanded_hints = items = re findall r ^ hints items expanded_hints extend items graph_break_hints hints expanded_hints extend expand_hints hints dynamo_dir info hints = expanded_hints results append info except SyntaxError print f Syntax error file_path results create_registry dynamo_dir str registry_path str - None calls = find_unimplemented_v _calls dynamo_dir registry = gb_types = info calls gb_types info gb_type = info GB_ID_INDEX = i gb_type info enumerate sorted gb_types items GB_ID_INDEX gb_id = f GB i d hints = info hints registry gb_id = Gb_type gb_type Context info context Explanation info explanation Hints hints hints open registry_path w f json dump registry f indent= main - None repo_root = Path __file__ resolve parent parent parent registry_path = repo_root torch _dynamo graph_break_registry json try torch _dynamo default_dynamo_dir = str Path torch _dynamo __file__ parent except ImportError default_dynamo_dir = str repo_root torch _dynamo parser = argparse ArgumentParser description= Manage graph break registry subparsers = parser add_subparsers dest= command help= Command execute create_parser = subparsers add_parser create help= Create registry scratch create_parser add_argument -- dynamo_dir type=str default=default_dynamo_dir help= Directory search unimplemented_v calls parser add_argument -- registry-path type=str default=str registry_path help= Path save registry JSON file args = parser parse_args args command == create create_registry args dynamo_dir args registry_path parser print_help __name__ == __main__ main