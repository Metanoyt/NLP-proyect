Owner s oncall jit os sys typing List torch Make helper files test importable pytorch_test_dir = os path dirname os path dirname os path realpath __file__ sys path append pytorch_test_dir torch testing _internal common_utils raise_on_run_directly torch testing _internal jit_utils JitTestCase Tests Python slice supported TorchScript TestSlice JitTestCase test_slice_kwarg slice_kwarg x List int x slice stop= assertRaisesRegex RuntimeError Slice does accept any keyword arguments torch jit script slice_kwarg test_slice_three_nones three_nones x List int x slice None None None checkScript three_nones range test_slice_two_nones two_nones x List int x slice None None checkScript two_nones range test_slice_one_none one_none x List int x slice None checkScript one_none range test_slice_stop_only fn x List int x slice checkScript fn range test_slice_stop_only_with_nones fn x List int x slice None None checkScript fn range test_slice_start_stop fn x List int x slice checkScript fn range test_slice_start_stop_with_none fn x List int x slice None checkScript fn range test_slice_start_stop_step fn x List int x slice checkScript fn range test_slice_string fn x str x slice None checkScript fn foo_bar test_slice_tensor fn x torch Tensor x slice None checkScript fn torch ones test_slice_tensor_multidim fn x torch Tensor x slice None checkScript fn torch ones test_slice_tensor_multidim_with_dots fn x torch Tensor x slice None checkScript fn torch ones test_slice_as_variable fn x List int = slice x checkScript fn range test_slice_stop_clipped fn x List int x slice checkScript fn range test_slice_dynamic_index t x slice = x zero = one = zero + slice = x zero one slice + slice checkScript t torch zeros test_tuple_slicing tuple_slice bool b = b = c = b - e = c - e checkScript tuple_slice torch tensor optimize=True scripted_fn = torch jit script tuple_slice assertEqual scripted_fn torch tensor tuple_graph = scripted_fn graph slices = tuple_graph findAllNodes prim TupleConstruct num_outputs = len x output type elements x slices there should only one tupleSlice length assertTrue num_outputs == run_pass lower_all_tuples tuple_graph assertTrue Tuple str tuple_graph test_module_list_slicing Bar torch nn Module __init__ identifier str super __init__ identifier = identifier forward Foo torch nn Module __init__ - None super __init__ module_list = Bar A Bar B Bar C Bar D Bar E test = torch nn ModuleList module_list forward test - test scripted_foo = torch jit script Foo result result = scripted_foo assertEqual len result assertEqual result identifier E assertEqual result identifier C assertEqual result identifier A assertEqual len result assertEqual result identifier B assertEqual result identifier C assertEqual result identifier D __name__ == __main__ raise_on_run_directly test test_jit py