Owner s module unknown torch torch testing _internal common_utils run_tests TemporaryFileName TestCase torch utils ThroughputBenchmark TwoLayerNet torch jit ScriptModule __init__ D_in H D_out super __init__ linear = torch nn Linear D_in H linear = torch nn Linear H D_out torch jit script_method forward x x h _relu = linear x clamp min= h _relu = linear x clamp min= cat = torch cat h _relu h _relu y_pred = linear cat y_pred TwoLayerNetModule torch nn Module __init__ D_in H D_out super __init__ linear = torch nn Linear D_in H linear = torch nn Linear H D_out forward x x h _relu = linear x clamp min= h _relu = linear x clamp min= cat = torch cat h _relu h _relu y_pred = linear cat y_pred TestThroughputBenchmark TestCase linear_test Module profiler_output_path= D_in = H = D_out = B = NUM_INPUTS = module = Module D_in H D_out inputs = _ range NUM_INPUTS inputs append torch randn B D_in torch randn B D_in bench = ThroughputBenchmark module input inputs can do both args kwargs here bench add_input input x =input i range NUM_INPUTS just unpack list inputs module_result = module inputs i bench_result = bench run_once inputs i torch testing assert_close bench_result module_result stats = bench benchmark num_calling_threads= num_warmup_iters= num_iters= profiler_output_path=profiler_output_path print stats test_script_module linear_test TwoLayerNet test_module linear_test TwoLayerNetModule test_profiling TemporaryFileName fname linear_test TwoLayerNetModule profiler_output_path=fname linear_with_compile_test Module dtype contextlib nullcontext torch _dynamo config torch _inductor config inductor_config config error_on_recompile = True inductor_config cpp_wrapper = True inductor_config freezing = True D_in = H = D_out = B = autocast = dtype = torch float module = Module D_in H D_out input = torch randn B D_in torch randn B D_in torch no_grad torch amp autocast cpu enabled=autocast dtype=dtype torch _dynamo reset module input module = torch compile module module input module input ctx = nullcontext dtype == torch float dtype == torch bfloat ctx = torch amp autocast cpu enabled=autocast dtype=dtype torch no_grad ctx bench = ThroughputBenchmark module bench add_input input module_result = module input bench_result = bench run_once input torch testing assert_close bench_result module_result stats = bench benchmark num_calling_threads= num_warmup_iters= num_iters= print stats test_compile dtypes = torch float torch float torch bfloat dtype dtypes linear_with_compile_test TwoLayerNetModule dtype __name__ == __main__ run_tests