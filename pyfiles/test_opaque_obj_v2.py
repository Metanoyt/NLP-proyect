Owner s module custom-operators torch torch _dynamo test_case run_tests TestCase torch _library opaque_object register_opaque_type OpaqueQueue __init__ queue list torch Tensor init_tensor_ torch Tensor - None super __init__ queue = queue init_tensor_ = init_tensor_ push tensor torch Tensor - None queue append tensor pop - torch Tensor len queue queue pop init_tensor_ size - int len queue TestOpaqueObject TestCase setUp lib = torch library Library _TestOpaqueObject FRAGMENT noqa TOR register_opaque_type OpaqueQueue _TestOpaqueObject_OpaqueQueue torch library define _TestOpaqueObject queue_push _TestOpaqueObject_OpaqueQueue Tensor b - tags=torch Tag pt _compliant_tag lib=self lib torch library impl _TestOpaqueObject queue_push CompositeExplicitAutograd lib=self lib push_impl queue OpaqueQueue b torch Tensor - None assert isinstance queue OpaqueQueue queue push b lib define queue_pop _TestOpaqueObject_OpaqueQueue - Tensor pop_impl queue OpaqueQueue - torch Tensor assert isinstance queue OpaqueQueue queue pop lib impl queue_pop pop_impl CompositeExplicitAutograd torch library custom_op _TestOpaqueObject queue_size mutates_args= size_impl queue OpaqueQueue - int assert isinstance queue OpaqueQueue queue size super setUp tearDown lib _destroy super tearDown test_ops queue = OpaqueQueue torch zeros torch ops _TestOpaqueObject queue_push queue torch ones + size = torch ops _TestOpaqueObject queue_size queue assertEqual size popped = torch ops _TestOpaqueObject queue_pop queue assertEqual popped torch ones + size = torch ops _TestOpaqueObject queue_size queue assertEqual size __name__ == __main__ run_tests