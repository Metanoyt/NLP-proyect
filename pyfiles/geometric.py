mypy allow-untyped-defs typing Optional Union torch torch Tensor torch distributions constraints torch distributions distribution Distribution torch distributions utils broadcast_all lazy_property logits_to_probs probs_to_logits torch nn functional binary_cross_entropy_with_logits torch types _Number Number __all__ = Geometric Geometric Distribution r Creates Geometric distribution parameterized attr ` probs ` where attr ` probs ` probability success Bernoulli trials math P X=k = -p ^ k p k = note func ` torch distributions geometric Geometric ` math ` k+ ` -th trial first success hence draws samples math ` \ \ldots\ ` whereas func ` torch Tensor geometric_ ` ` k ` -th trial first success hence draws samples math ` \ \ldots\ ` Example xdoctest +IGNORE_WANT non-deterministic m = Geometric torch tensor m sample underlying Bernoulli has chance chance tensor Args probs Number Tensor probability sampling ` ` Must range logits Number Tensor log-odds sampling ` ` pyrefly ignore bad-override arg_constraints = probs constraints unit_interval logits constraints real support = constraints nonnegative_integer __init__ probs Optional Union Tensor Number = None logits Optional Union Tensor Number = None validate_args Optional bool = None - None probs None == logits None raise ValueError Either ` probs ` ` logits ` must specified both probs None pyrefly ignore read-only probs = broadcast_all probs assert logits None helps mypy pyrefly ignore read-only logits = broadcast_all logits probs_or_logits = probs probs None logits isinstance probs_or_logits _Number batch_shape = torch Size assert probs_or_logits None helps mypy batch_shape = probs_or_logits size super __init__ batch_shape validate_args=validate_args _validate_args probs None Add extra check beyond unit_interval value = probs valid = value valid all invalid_value = value data ~valid raise ValueError Expected parameter probs f type value __name__ shape tuple value shape f distribution repr f positive found invalid values \n invalid_value expand batch_shape _instance=None new = _get_checked_instance Geometric _instance batch_shape = torch Size batch_shape probs __dict__ new probs = probs expand batch_shape logits __dict__ new logits = logits expand batch_shape super Geometric new __init__ batch_shape validate_args=False new _validate_args = _validate_args new property mean - Tensor probs - property mode - Tensor torch zeros_like probs property variance - Tensor probs - probs lazy_property logits - Tensor probs_to_logits probs is_binary=True lazy_property probs - Tensor logits_to_probs logits is_binary=True sample sample_shape=torch Size shape = _extended_shape sample_shape tiny = torch finfo probs dtype tiny torch no_grad torch _C _get_tracing_state JIT WORKAROUND lack support uniform_ u = torch rand shape dtype=self probs dtype device=self probs device u = u clamp min=tiny u = probs new shape uniform_ tiny u log -self probs log p floor log_prob value _validate_args _validate_sample value value probs = broadcast_all value probs probs = probs clone memory_format=torch contiguous_format probs probs == value == = value -probs log p + probs log entropy binary_cross_entropy_with_logits logits probs reduction= none probs