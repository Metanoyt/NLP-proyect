collections abc Sequence pathlib Path re match _match typing Optional Union read_file fname Union Path str - list str open fname encoding= utf- f f readlines _embed_headers content list str include_dirs list Path processed_files set str - str line_idx cur_line enumerate content Eliminate warning ` #pragma once main file ` cur_line startswith #pragma once content line_idx = continue m = _match ^\\s #include\\s ^ + cur_line m None continue include_dir include_dirs path = include_dir m path exists continue str path processed_files content line_idx = continue processed_files add str path content line_idx = _embed_headers read_file path include_dirs processed_files break join content embed_headers fname str include_dirs Optional Union Sequence str Sequence Path str = None - str include_dirs None base_dir = Path __file__ parent parent parent include_dirs = base_dir base_dir aten src isinstance include_dirs str include_dirs = Path include_dirs include_dirs = Path x x include_dirs _embed_headers read_file fname include_dirs fname __name__ == __main__ sys len sys argv print f Usage \n sys argv filename sys exit print embed_headers sys argv