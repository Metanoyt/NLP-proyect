Python execution state recording replay functionality This module provides mechanisms capturing replaying Python execution state - ModuleRecord Tracks module access patterns attribute usage - DummyModule Lightweight module substitute replay - ExecutionRecord Manages execution context including globals locals builtins - ExecutionRecorder Records variable states module access during execution The module enables serialization reproduction Python execution environments particularly useful debugging testing frameworks need capture recreate specific program states dataclasses dataclasses field io BufferedReader BufferedWriter types CellType CodeType ModuleType typing Any IO Union typing_extensions Self torch utils _import_utils import_dill dill = import_dill dataclasses dataclass ModuleRecord module ModuleType accessed_attrs dict str Any = field default_factory=dict dataclasses dataclass DummyModule name str is_torch bool = False value object = None property __name__ - str name dataclasses dataclass ExecutionRecord code CodeType closure tuple CellType globals dict str Any = field default_factory=dict locals dict str Any = field default_factory=dict builtins dict str Any = field default_factory=dict code_options dict str Any = field default_factory=dict dump f Union IO str BufferedWriter - None assert dill None replay_record requires ` pip install dill ` dill dump f classmethod load cls f Union IO bytes BufferedReader - Self assert dill None replay_record requires ` pip install dill ` dill load f dataclasses dataclass ExecutionRecorder LOCAL_MOD_PREFIX = ___local_mod_ code CodeType closure tuple CellType globals dict str Any = field default_factory=dict locals dict str Any = field default_factory=dict builtins dict str Any = field default_factory=dict code_options dict str Any = field default_factory=dict name_to_modrec dict str ModuleRecord = field default_factory=dict add_local_var name str var Any - None isinstance var ModuleType locals name = _add_mod var locals name = var add_global_var name str var Any - None isinstance var ModuleType globals name = _add_mod var globals name = var add_local_mod name str mod ModuleType - None assert isinstance mod ModuleType add_global_var name mod record_module_access mod ModuleType name str val Any - None isinstance val ModuleType name_to_modrec mod __name__ accessed_attrs name = _add_mod val mod __name__ name_to_modrec name_to_modrec mod __name__ accessed_attrs name = val get_record - ExecutionRecord ExecutionRecord code closure ExecutionRecorder _resolve_modules globals ExecutionRecorder _resolve_modules locals builtins copy code_options copy _add_mod mod ModuleType - ModuleRecord mod __name__ name_to_modrec name_to_modrec mod __name__ = ModuleRecord mod name_to_modrec mod __name__ classmethod _resolve_modules cls vars dict str Any - dict str Any resolve_module var Any - Any isinstance var ModuleRecord var dummy_mod = DummyModule var module __name__ attr_name attr_value var accessed_attrs items attr_value = resolve_module attr_value dummy_mod __setattr__ attr_name attr_value dummy_mod k resolve_module v k v vars items