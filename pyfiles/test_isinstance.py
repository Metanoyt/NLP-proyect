Owner s oncall jit os sys warnings typing Any Dict List Optional Tuple torch Make helper files test importable pytorch_test_dir = os path dirname os path dirname os path realpath __file__ sys path append pytorch_test_dir torch testing _internal common_utils raise_on_run_directly torch testing _internal jit_utils JitTestCase Tests torch jit isinstance TestIsinstance JitTestCase test_int int_test x Any assert torch jit isinstance x int assert torch jit isinstance x float x = checkScript int_test x test_float float_test x Any assert torch jit isinstance x float assert torch jit isinstance x int x = checkScript float_test x test_bool bool_test x Any assert torch jit isinstance x bool assert torch jit isinstance x float x = False checkScript bool_test x test_list list_str_test x Any assert torch jit isinstance x List str assert torch jit isinstance x List int assert torch jit isinstance x Tuple int x = checkScript list_str_test x test_list_tensor list_tensor_test x Any assert torch jit isinstance x List torch Tensor assert torch jit isinstance x Tuple int x = torch tensor torch tensor torch tensor checkScript list_tensor_test x test_dict dict_str_int_test x Any assert torch jit isinstance x Dict str int assert torch jit isinstance x Dict int str assert torch jit isinstance x Dict str str x = b checkScript dict_str_int_test x test_dict_tensor dict_int_tensor_test x Any assert torch jit isinstance x Dict int torch Tensor x = torch tensor checkScript dict_int_tensor_test x test_tuple tuple_test x Any assert torch jit isinstance x Tuple str int str assert torch jit isinstance x Tuple int str str assert torch jit isinstance x Tuple str x = b checkScript tuple_test x test_tuple_tensor tuple_tensor_test x Any assert torch jit isinstance x Tuple torch Tensor torch Tensor x = torch tensor torch tensor checkScript tuple_tensor_test x test_optional optional_test x Any assert torch jit isinstance x Optional torch Tensor assert torch jit isinstance x Optional str x = torch ones checkScript optional_test x test_optional_none optional_test_none x Any assert torch jit isinstance x Optional torch Tensor assert torch jit isinstance x Optional str TODO above line eager will evaluate True while TS interpreter will evaluate False first torch jit isinstance refines None type x = None checkScript optional_test_none x test_list_nested list_nested x Any assert torch jit isinstance x List Dict str int assert torch jit isinstance x List List str x = b aa bb checkScript list_nested x test_dict_nested dict_nested x Any assert torch jit isinstance x Dict str Tuple str str str assert torch jit isinstance x Dict str Tuple int int int x = aa aa aa b bb bb bb checkScript dict_nested x test_tuple_nested tuple_nested x Any assert torch jit isinstance x Tuple Dict str Tuple str str str List bool Optional str assert torch jit isinstance x Dict str Tuple int int int assert torch jit isinstance x Tuple str assert torch jit isinstance x Tuple List bool List str List int x = aa aa aa b bb bb bb True False True None checkScript tuple_nested x test_optional_nested optional_nested x Any assert torch jit isinstance x Optional List str x = b c checkScript optional_nested x test_list_tensor_type_true list_tensor_type_true x Any assert torch jit isinstance x List torch Tensor x = torch rand torch rand checkScript list_tensor_type_true x test_tensor_type_false list_tensor_type_false x Any assert torch jit isinstance x List torch Tensor x = checkScript list_tensor_type_false x test_in_if list_in_if x Any torch jit isinstance x List int assert True torch jit isinstance x List str assert True x = checkScript list_in_if x test_if_else list_in_if_else x Any torch jit isinstance x Tuple str str str assert True assert True x = b c checkScript list_in_if_else x test_in_while_loop list_in_while_loop x Any count = while torch jit isinstance x List Dict str int count = count = count + assert count == x = b aa bb checkScript list_in_while_loop x test_type_refinement type_refinement obj Any hit = False torch jit isinstance obj List torch Tensor hit = hit el obj perform some tensor operation y = el clamp noqa F torch jit isinstance obj Dict str str hit = hit str_cat = val obj values str_cat = str_cat + val assert == str_cat assert hit x = torch rand torch rand checkScript type_refinement x x = checkScript type_refinement x test_list_no_contained_type list_no_contained_type x Any assert torch jit isinstance x List x = err_msg = Attempted use List without contained type r Please add contained type e g List\ int\ assertRaisesRegex RuntimeError err_msg torch jit script list_no_contained_type assertRaisesRegex RuntimeError err_msg list_no_contained_type x test_tuple_no_contained_type tuple_no_contained_type x Any assert torch jit isinstance x Tuple x = err_msg = Attempted use Tuple without contained type r Please add contained type e g Tuple\ int\ assertRaisesRegex RuntimeError err_msg torch jit script tuple_no_contained_type assertRaisesRegex RuntimeError err_msg tuple_no_contained_type x test_optional_no_contained_type optional_no_contained_type x Any assert torch jit isinstance x Optional x = err_msg = Attempted use Optional without contained type r Please add contained type e g Optional\ int\ assertRaisesRegex RuntimeError err_msg torch jit script optional_no_contained_type assertRaisesRegex RuntimeError err_msg optional_no_contained_type x test_dict_no_contained_type dict_no_contained_type x Any assert torch jit isinstance x Dict x = aa err_msg = Attempted use Dict without contained types r Please add contained type e g Dict\ int int\ assertRaisesRegex RuntimeError err_msg torch jit script dict_no_contained_type assertRaisesRegex RuntimeError err_msg dict_no_contained_type x test_tuple_rhs fn x Any assert torch jit isinstance x int List str assert torch jit isinstance x List float Tuple int str assert torch jit isinstance x List float str checkScript fn checkScript fn foo bar baz test_nontuple_container_rhs_throws_in_eager fn x Any assert torch jit isinstance x int List str fn x Any assert torch jit isinstance x List str Tuple int str err_highlight = must type tuple types assertRaisesRegex RuntimeError err_highlight fn assertRaisesRegex RuntimeError err_highlight fn test_empty_container_throws_warning_in_eager fn x Any torch jit isinstance x List int warnings catch_warnings record=True w x List int = fn x assertEqual len w warnings catch_warnings record=True w x int = fn x assertEqual len w test_empty_container_special_cases Should throw Boolean value Tensor no values ambiguous error torch _jit_internal check_empty_containers torch Tensor Should throw Boolean value Tensor more than one value ambiguous error torch _jit_internal check_empty_containers torch rand __name__ == __main__ raise_on_run_directly test test_jit py